<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Cinquecento Manual</title>
<link rel="stylesheet" type="text/css" href="reset.css"/>
<link rel="stylesheet" type="text/css" href="styles.css"/>
</head>

<body>

<div id="side1">
<a href="#sec:introduction">Introduction</a><br />
<br />
<em>Basic Language</em><br />
<a href="#sec:input">Input</a><br />
<a href="#sec:comments">Comments</a><br />
<a href="#sec:keywords">Keywords</a><br />
<a href="#sec:identifiers">Identifiers</a><br />
<a href="#sec:literals">Literals</a><br />
<a href="#sec:scope">Scope and Variables</a><br />
<a href="#sec:types">Types</a><br />
<a href="#sec:functions">Functions</a><br />
<a href="#sec:control">Control Operators</a><br />
<a href="#sec:statements">Control Flow Statements</a><br />
<a href="#sec:constants">Constants</a><br />
<a href="#sec:records">Records</a><br />
<br />
<em>Using Domains</em><br />
<a href="#sec:domainover">Overview of Domains</a><br />
<a href="#sec:backtick">Backtick Operator</a><br />
<a href="#sec:litdom">The Literal Domain</a><br />
<a href="#sec:casts">Type and Domain Casting</a><br />
<a href="#sec:mixeddom">Mixed-domain Expressions</a><br />
<a href="#sec:cvalueops">C Operators</a><br />
<a href="#sec:pointers">Pointers</a><br />
<br />
<em>Defining Domains</em><br />
<a href="#sec:mkdom">Domain constructor</a><br />
<a href="#sec:namespaces">Name spaces</a><br />
<a href="#sec:addressspaces">Address spaces</a><br />
<a href="#sec:ctypes">Ctypes</a><br />
<br />
<em>Data Structures</em><br />
<a href="#sec:containers">Container Types</a><br />
<a href="#sec:lists">Lists</a><br />
<a href="#sec:vectors">Vectors</a><br />
<a href="#sec:tables">Tables</a><br />
<a href="#sec:characters">Characters</a><br />
<a href="#sec:strings">Strings</a><br />
<br />
<em>Built-in Libraries</em><br />
<a href="#sec:io">I/O</a><br />
<a href="#sec:fs">Filesystem Functions</a><br />
<a href="#sec:fmt">Formatted Output</a><br />
<a href="#sec:system">System Functions</a><br />
<a href="#sec:other">Other Functions</a><br />
<br />
<br />
<a href="#sec:cinterface">C Interface</a><br />
<br />
<a href="#sec:synindex">Syntax Index</a><br />
<a href="#sec:cindex">C Interface Index</a><br />
<a href="#sec:fnindex">Built-in Function Index</a><br />
</div>

<div id="content">

<div id="title">
<h3>Cinquecento Manual</h3>
</div>

<h4 id="sec:introduction">Introduction</h4>

<p>
This manual describes the
language and built-in library functions
of the L1 implementation of Cinquecento.
</p>

<p>
Cinquecento is a programming language designed for
examining programs in execution.  Its most
distinguishing feature is an extensible abstraction,
called a <em>domain</em>, that represents a target
program in execution.
</p>

<p>
A domain presents the state of a target program through
an interface based on the syntax and semantics of C.
Ordinary C expressions can be used to read or modify
target program memory.  More complex C idioms for
traversing data structures, such as pointer-chasing
loops, generally work without modification.  All C
types, operators, and control flow statements work as
expected.  The names and types of target program data
can be specified in C declaration syntax; minor
extensions allow machine-level specification of
location, layout, and encoding of data in memory.
</p>

<p>
A Cinquecento program can use multiple domains to
manipulate multiple simultaneously active target
programs.

Heterogeneity is expected: the targets may be different
programs, or the same program with different types,
symbols, or executable format; and the targets may
execute on different machines, of possibly different
architecture or operating system.

Example applications include comparing executions of
different versions of a program, comparing executions
of a program across several machine types or operating
systems, and validating global state in a
distributed, multi-process program.
</p>

<p>
Each domain encapsulates user-defined functions that
implement access to the associated target.  These
include functions that define the types and symbols of
the target, and functions that read and write its
memory and other run-time state.  Rather than favor the
idiosyncrasies of one operating system, architecture,
compiler, or debugging information format, Cinquecento
specifies a small, extensible interface that allows
users to easily tailor domains for their target
environment.  New domain implementations can be written
entirely in Cinquecento; built-in library functions and
accompanying programs simplify construction of domains
for common environments, such as x86 Linux systems.
</p>

<p>
Apart from domains and the C-based syntax, Cinquecento
is a simple dynamic language with conventional
functional semantics.  A dialect of Scheme at its
heart, Cinquecento is lexically scoped, dynamically
typed, properly tail recursive, and has first-class
functions and automatic memory management.  Schemers
will note departure in Cinquecento's model of integers
(which rigorously emulates C's fixed precision
semantics), the more imperative flavor of its built-in
list data type, and the absence (today) of a compelling
macro system.
</p>

<p>
The Cinquecento language design and implementation is
an active research project, still undergoing revision,
extension, and tuning.

We strive to keep this manual current with the
implementation it accompanies, but until things settle
down, sometimes we will fall behind.
</p>

<p>
We welcome feedback of any kind from all users.
</p>

<h4 id="sec:input">Input</h4>

<p>
A Cinquecento program consists of a sequence of
expressions to be evaluated in order by the Cinquecento
evaluator.
</p>

<p id="syn:_at_include">
The Cinquecento evaluator reads code from its current
<em>input file</em>.
During parsing of an input file, an occurrence (not
within a string literal or comment) of either of the
forms
</p>
<div class="code">
@include &lt;<span class="arg">filename</span>&gt;<br />
@include "<span class="arg">filename</span>"
</div>
<p>
is replaced with the contents of the named file.
The first form searches for
<span class="arg">filename</span>
in the Cinquecento system load path.
The second form searches the directory that contains the
current input file.
</p>

<p>
The current input file is temporarily switched to 
<span class="arg">filename</span> during the substitution.
</p>

<!-- i don't understand
     why the short vertical separation appears here;
     it seems dependent on the code div above, even
     if the body of that div is empty. -->

<h4 id="sec:comments">Comments</h4>

<p>
The following are comments:
</p>

<ul>
<li>
Input enclosed in <span class="val">/*</span>
<span class="val">*/</span>;
</li>
<li>
Input between <span class="val">//</span>
and the beginning of the next line;
</li>
<li>
Lines beginning with <span class="val">#!</span>.
</li>
</ul>

<h4 id="sec:keywords">Keywords</h4>

<p>
The following are the keywords of Cinquecento.
</p>

<div class="code">
<!-- pipe through mc -60
@const 
@containerof
@define
@lambda 
@let
@local
@global 
@names 
@record 
@typeof
break 
case 
char 
const
continue 
default 
do 
double 
else 
enum 
float 
for 
if 
int 
long 
return 
short 
signed 
sizeof 
struct 
switch 
typedef 
union 
unsigned 
void 
volatile
while 
-->
<pre>
@const       break        float        switch 
@containerof case         for          typedef 
@define      char         if           union 
@lambda      const        int          unsigned 
@let         continue     long         void 
@local       default      return       volatile
@global      do           short        while 
@names       double       signed 
@record      else         sizeof 
@typeof      enum         struct 
</pre>
</div>

<h4 id="sec:identifiers">Identifiers</h4>

<p>
Identifiers are non-keyword tokens used to identify
Cinquecento variables and the symbols represented
within domains.
</p>

<p>
The first character of an identifier must be a letter or underscore.
Subsequent characters must be letters, underscores, or digits.
</p>

<p>
There is an exception: the two character sequence <span class="val">::</span>
may appear anywhere within an identifier, including
at the beginning.
</p>


<h4 id="sec:literals">Literals</h4>

<p>
Literals are lexical tokens that encode character, string,
and integer constants.  Their syntax follows that of C literals.
</p>

<p>
A character literal is a printable ASCII character
surrounded by single quotes.
</p>

<p>
Cinquecento also recognizes the C character escape sequences:
<span class="val">\a</span>,
<span class="val">\b</span>,
<span class="val">\f</span>,
<span class="val">\n</span>,
<span class="val">\r</span>,
<span class="val">\t</span>,
<span class="val">\v</span>,
<span class="val">\\</span>,
<span class="val">\?</span>,
<span class="val">\'</span>,
<span class="val">\"</span>,
<span class="val">\<span class="arg">o</span></span>,
<span class="val">\<span class="arg">oo</span></span>,
<span class="val">\<span class="arg">ooo</span></span>,
<span class="val">\x<span class="arg">h</span>...<span class="arg">h</span></span>.
</p>


<p>
A string literal is a sequence of ASCII or escaped characters
surrounded by double quotes.
</p>

<p>
Two string literals separated by
whitespace are concatenated into
a single string.
</p>

<p>
An integer literal is a sequence of digit characters.
With no prefix, integer literals are interpreted in decimal.
The <span class="val">0x</span> prefix and <span class="val">0X</span> prefix causes hexadecimal interpretation.
The <span class="val">0</span> prefix causes octal interpretation.
The <span class="val">0b</span> prefix and <span class="val">0B</span> prefix causes hexadecimal interpretation.
</p>

<p>
As in C, the C type of an integer constant is
ordinarily the smallest integer type (up
to <span class="val">int</span>) that can represent the
value.  The suffixes <span class="val">U</span>,
<span class="val">UL</span>, <span class="val">ULL</span>,
<span class="val">L</span>, 
<span class="val">LL</span>, and their lowercase variants
impose the specified long and/or unsigned types upon the value.
</p>

<p>
Cinquecento currently does not support floating point types or values.
</p>

<h4 id="sec:scope">Scope and Variables</h4>

<p>
Cinquecento is lexically scoped and dynamically typed.
</p>

<p>
The block statement:
</p>
<div class="code">
<pre>
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>
introduces a new level of lexical scope.
</p>

<p>
Expressions that appear outside of a block statement
are called top-level expressions.

The outermost level of scope, called the top-level environment,
contains bindings for built-in
functions and other values.
</p>

<p>
Bindings are mutable.  The assignment form
</p>
<div class="code">
<span class="arg">var</span> = <span class="arg">expr</span>;
</div>
<p>
updates the value bound to the variable <span class="arg">var</span>
to the value of <span class="arg">expr</span>.
</p>

<p>
If <span class="arg">var</span> is an unbound variable,
the <span class="id">=</span> operator implicitly creates
a binding for <span class="arg">var</span>
that is visible in the innermost
level of lexical scope.  If the assignment occurs
in a top-level expression, a new binding is added
to the top-level environment.
There is no way to remove a binding from any scope.
</p>

<p>
The other assignment operators
(<span class="id">+=</span>,
<span class="id">-=</span>,
<span class="id">*=</span>,
<span class="id">/=</span>,
<span class="id">%=</span>,
<span class="id">&amp;=</span>,
<span class="id">|=</span>,
<span class="id">^=</span>,
<span class="id">&lt;&lt;=</span>,
<span class="id">&gt;&gt;=</span>,
<span class="id">++</span>,
<span class="id">--</span>)
update existing bindings but do not
create new ones.
</p>

<p>
The <span class="fnindex" id="syn:_at_local">@local</span> statement
explicitly declares new variable bindings for the block
in which it appears:
</p>
<div class="code">
<pre>
{
	@local <span class="arg">var</span>, ... ;
	...
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>
establishes new bindings for the
variables <span class="arg">var ... </span> within the
enclosing block.

These bindings shadow any other bindings of
<span class="arg">var ... </span> in enclosing blocks
or the top-level environment.

Any number of <span class="id">@local</span> statements
may appear in a block, but they all must appear 
before any other statements.
</p>

<p>
The <span class="fnindex" id="syn:_at_global">@global</span>
statement declares new variable bindings in the
top-level environment:
</p>
<div class="code">
<pre>
@global <span class="arg">var</span>, ... ;
</pre>
</div>

<p>
Variables declared with
<span class="id">@local</span>
and
<span class="id">@global</span>
are initially bound to the undefined value.
</p>

<p>
The parameters of a <span class="id">@lambda</span> form
establish local bindings in the block that forms the
body of the function definition, just as if they had
been declared with <span class="id">@local</span>.
</p>

<p>
A reference to an unbound variable is an error.
</p>

<h4 id="sec:types">Types</h4>

<p>
Cinquecento defines several types of values.  Every
value in Cinquecento belongs to exactly one type.  For
each type there is a predicate to test whether a value
belongs to the type.
</p>

<p>
Types with standard semantics include <em>string</em>,
<em>function</em>, <em>record</em>, <em>record descriptor</em>,
and <em>file descriptor</em>.
</p>

<p>
The types special to Cinquecento are <em>cvalue</em>,
<em>ctype</em>, <em>domain</em>, <em>address
space</em>, <em>name space</em>, and <em>range</em>.
These types represent different aspects of a program in
execution; their roles are described in the
<a href="#sec:domainover">overview of domains</a>.
</p>

<p>
There are also several container types for storing
values of any type: <em>list</em>, <em>vector</em>, and
<em>table</em>.
</p>

<p>
The special value <tt>nil</tt> is not a member of any
other type or equal to any other value.
</p>

<p>
The <em>undefined</em> value is the value of
uninitialized variables.  There is no literal
expression for this value.
</p>

<p>
There are no explicit numeric types.  In Cinquecento,
all arithmetic is performed using C operators over
values of type cvalue.
</p>

<p>
The following functions are predicates on the type of a
value.  They each test their
argument <span class="arg">val</span> for membership in
a particular type and return
the cvalue <span class="arg">1</span> if
the value belongs to the type,   
or <span class="arg">0</span> otherwise.
</p>

<div class="table-short">
<table>

<tr>
<td>
Address space
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isas">isas(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
C type
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isctype">isctype(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
C value
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:iscvalue">iscvalue(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Domain
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isdom">isdom(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
File descriptor
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isfd">isfd(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
List
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:islist">islist(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Nil
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isnil">isnil(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Name space
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isns">isns(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Procedure
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isprocedure">isprocedure(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Range
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrange">isrange(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Record
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrec">isrec(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Record descriptor
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrd">isrd(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
String
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isstring">isstring(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Table
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:istable">istable(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Undefined
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isundefined">isundefined(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Vector
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isvector">isvector(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

</table>
</div>

<!-- this is wrong: equal is like scheme equal,
     but implemented only on lists for now -->

<!-- <div class="docitem" id="fn:equal"> -->
<!-- <div class="proto"> -->
<!-- <div class="function"> -->
<!-- <span class="id">equal(<span class="arg">v1</span>,<span class="arg">v2</span>)</span> -->
<!-- </div> -->
<!-- <div class="param"> -->
<!-- <span class="arg">v1</span>: <span class="type">any value</span> -->
<!-- </div> -->
<!-- <div class="param"> -->
<!-- <span class="arg">v2</span>: <span class="type">any value</span> -->
<!-- </div> -->
<!-- <div class="returns"> -->
<!-- <span class="type">cvalue (1 or 0)</span> -->
<!-- </div> -->
<!-- </div> -->
<!-- <div class="desc"> -->
<!-- Compares <span class="arg">v1</span> -->
<!-- and <span class="arg">v2</span> for equality. -->
<!-- Generally two values are <span class="id">equal</span> -->
<!-- if they are the same instance of an object (pointer equality). -->
<!-- Several types define equality based on their value: -->
<!-- <span class="type">ctype</span>, -->
<!-- <span class="type">cvalue</span>, -->
<!-- <span class="type">range</span>, and -->
<!-- <span class="type">string</span>. -->
<!-- </div> -->
<!-- </div> -->


<h4 id="sec:functions">Functions</h4>

<p>
As in Scheme and other functional languages,
Cinquecento functions are first-class values.
They may be dynamically created, returned from
functions, bound to variables, and stored in containers.
</p>

<p>
Cinquecento functions are closures over their lexical
environment: free variables in the body of a function
definition refer to the bindings of those variables
contained in the enclosing blocks or in the top-level
environment.
</p>

<p>
The <span class="fnindex" id="syn:_at_lambda">@lambda</span>
expression defines new function values.  The syntax
is:
</p>

<div class="code">
<pre>
@lambda <span class="arg">formals</span> { <span class="arg">statement</span>; ... }
</pre>
</div>

<p>
The syntax of <span class="arg">formals</span> determines
how formal parameters are bound to actual parameters:
</p>

<ul>
<li>
If <span class="arg">formals</span> is a list of variable identifiers of the form
<span class="id">(<span class="arg">v1</span>, <span class="arg">v2</span>, ...,
<span class="arg">vn</span>)</span>,
then the function accepts
<span class="arg"><em>n</em></span> parameters,
and each actual
parameter is bound to the corresponding variable.
<span class="arg">Formals</span> may be <span class="id">()</span>,
defining a function of zero parameters.
</li>

<li>
If <span class="arg">formals</span> is a list of identifiers of the form
<span class="id">(<span class="arg">v1</span>, <span class="arg">v2</span>, ...,
<span class="arg">vn</span>, <span class="arg">varg</span> ...)</span> (where the
final <span class="id">...</span> is concrete syntax),
then the function is a variable arity function of at
least
<span class="arg"><em>n</em></span> parameters .
The first <span class="arg"><em>n</em></span> actual parameters
are bound to the first <span class="arg"><em>n</em></span> variables;
<span class="arg"><em>n</em></span> may be zero.
The remaining parameters, possibly zero, are passed in a freshly allocated
list that is bound to <span class="arg">varg</span>.
</li>

</ul>

<p>
The body of the function is a sequence of statements
to be evaluated when the function is called.
</p>

<p>
A function call is an expression of the form
</p>
<div class="code">
<pre>
<span class="arg">fn</span>(<span class="arg">expr</span>, ...)
</pre>
</div>
<p>
where <span class="arg">fn</span> is an expression
that evaluates to a function.

The number of expressions appearing in the argument
list <span class="arg">expr</span>, ... must match
the number expected by the function.
</p>

<p>

A <span class="fnindex" id="syn:return">return</span>
statement in the body of a function returns control to
the expression that called the function.  The syntax
variants are:
</p>
<div class="code">
<pre>
return;
return <span class="arg">expr</span>;
</pre>
</div>
<p>
The first form returns the value <span class="val">nil</span>.
The second form returns the value of <span class="arg">expr</span>. 
</p>

<p>
The value of a function call expression is the value
returned by evaluation
of a <span class="id">return</span> statement in
the body of the called function, or the value of the
last evaluated expression in the body 
if the function returns without reaching a
<span class="id">return</span> statement.
</p>

<p>
The <span class="fnindex" id="syn:_at_define">@define</span> form
is syntactic sugar for naming a function definition.
For example
</p>
<div class="code">
<pre>
@define <span class="arg">name</span>(<span class="arg">var</span>, ...)
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>

is equivalent to 
</p>
<div class="code">
<pre>
<span class="arg">name</span> = @lambda(<span class="arg">var</span>, ...)
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>

<p>
The built-in function <span class="id">apply</span>
and the syntax form <span class="id">@lazyapply</span>
are used to call functions.
</p>

<div class="docitem" id="fn:apply">
<div class="proto">
<div class="function">
<span class="id">apply(<span class="arg">fn</span>, <span class="arg">arg</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Calls the function <span class="arg">fn</span>
on the arguments <span class="arg">arg ... </span>
and returns the value returned by the call.
</div>
</div>

<div class="docitem" id="syn:_at_lazyapply">
<div class="proto">
<div class="function">
<span class="id">@lazyapply(<span class="arg">fn</span>, <span class="arg">arg</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any expression</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Like <span class="id">apply</span>,
<span class="id">@lazyapply</span>
calls the function <span class="arg">fn</span>, but
the arguments are evaluated lazily.  This is
implemented by passing each argument expression <span class="arg">arg ... </span>
as a procedure that, when called, 
evaluates the argument expression.
<span class="id">@lazyapply</span> returns the value returned by the call.
</div>
</div>


<h4 id="sec:control">Control Operators</h4>

<p>
Several built-in functions support non-local control
flow.
</p>

<div class="docitem" id="fn:error">
<div class="proto">
<div class="function">
<span class="id">error(<span class="arg">fmt</span>, <span class="arg">arg</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
Aborts the current continuation and signals an error to the current caller of the
Cinquecento evaluator.  An error message
is formatted by passing <span class="arg">fmt</span> and <span class="arg">arg ...</span>
to <span class="id"><a href="#fn:sprintfa">sprintfa</a></span>
and printed along with a stack trace to the current
output stream.
</div>
</div>

<div class="docitem" id="fn:fault">
<div class="proto">
<div class="function">
<span class="id">fault()</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
<span class="id">Fault</span> should be called
only in the context of an address space 
<span class="id">get</span> or <span class="id">put</span>
function to signal an address space access error
to the Cinquecento evaluator. 
</div>
</div>

<div class="docitem" id="fn:callcc">
<div class="proto">
<div class="function">
<span class="id">callcc(<span class="arg">fn</span>)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Calls <span class="arg">fn</span>, passing the current
continuation, represented as a function,
as its sole argument.  Returns the value
returned by the call to <span class="arg">fn</span>.

<div>
It is currently unsafe to call the continuation
passed <span class="arg">fn</span> if the
continuation returns to calls to built-in
functions.
</div>
</div>
</div>

<h4 id="sec:statements">Control Flow Statements</h4>

<p>
Cinquecento supports the control flow statements of C,
including the loop statements <span class="val">do</span>-<span class="val">while</span>,
<span class="val">for</span>,
and <span class="val">while</span>,
the conditional statements <span class="val">if</span>,
<span class="val">if</span>-<span class="val">else</span>,
and <span class="val">switch</span> (with <span class="val">case</span>
and <span class="val">default</span> labels),
and the <span class="val">goto</span> statement.
</p>

<p>
These statements have the same syntax they have in C.
Control flow through loops and <span class="val">switch</span> 
statements can be controlled with <span class="val">break</span>
and <span class="val">continue</span> as in C.
</p>

<p>
Unlike C, the <span class="val">switch</span> statement
dispatches values of any type, not just integers.
The <span class="val">==</span> operator determines
equality.
</p>

<p>
The <span class="val">case</span>s of a
<span class="val">switch</span> are compared in
lexical order; control jumps to the first statement
with a matching <span class="val">case</span> label, or to the
optional <span class="val">default</span> label,
regardless of where it appears, if
no <span class="val">case</span> matches.
Control skips past the <span class="val">switch</span> body 
if there is no matching case
and no <span class="val">default</span> label.
</p>

<p>
None of the non-local control transfer statements
(<span class="val">break</span>, <span class="val">continue</span>,
<span class="val">goto</span>) can be used to leave
or enter the body of a function.
</p>

<h4 id="sec:constants">Constants</h4>

<p id="syn:_at_const">
The <span class="id">@const</span> form defines constant expressions.
The syntax is:
</p>
<div class="code">
<pre>
@const <span class="arg">id</span> = <span class="arg">expr</span>;
</pre>
</div>

<p>
The identifier <span class="arg">id</span> is bound to
<span class="arg">expr</span> in a global constant name space.
</p>

<p>
Occurrences of <span class="arg">id</span> in the current
and subsequent input files are lexically
replaced with <span class="arg">expr</span>.
</p>

<p>
The constant name space is distinct from the top level
environment and local scopes occupied by Cinquecento
variables.  The use of the same identifier as both a constant
and a variable has undefined behavior.  (This feature needs more work.)
</p>


<h4 id="sec:records">Records</h4>

<p id="syn:_at_record">
The Cinquecento record system allows the creation of new
aggregate types with named fields.  A <em>record descriptor</em>
is a Cinquecento value that define a particular record type;
it associates a record type name with the definition
of the record type.
A <em>record</em> is instance of a record type.
It has an associated record descriptor and bindings for
the fields defined by the record descriptor.
</p>

<p>
For example, the expression:
</p>
<div class="code">
<pre>
@record myrec { field1, field2, field3 };
</pre>
</div>
<p>
defines a new record type, named <span class="id">myrec</span>.

The record type has three fields, named
<span class="id">field1</span>, 
<span class="id">field2</span>, and 
<span class="id">field3</span>.

The value of the <span class="id">@record</span> expression
is the resulting record descriptor.
</p>

<p>
In addition, evaluation of
the <span class="id">@record</span> expression
implicitly defines two functions,
named <span class="id">myrec</span>
and <span class="id">ismyrec</span>,
in the innermost level of lexical scope.
</p>

<p>
The function <span class="id">ismyrec</span> is a predicate
for instances of <span class="id">myrec</span>.  Like
the type predicates, it accepts
a single argument and returns <span class="val">1</span>
if the argument is an instance of <span class="id">myrec</span>,
and <span class="val">0</span> otherwise.
</p>

<p>
The function <span class="id">myrec</span> is the
constructor for instances of the <span class="id">myrec</span> type.

For example:
</p>
<div class="code">
<pre>
x = myrec("abc", 1, @lambda(x){ printf("hi\n")});
</pre>
</div>
<p>

binds <span class="id">x</span> to a new instance of the
<span class="id">myrec</span> type.
</p>

<p>
The function <span class="id">myrec</span>
expects either zero arguments,
in which case the fields of the new instance are bound to <span class="id">nil</span>,
or exactly as many arguments as there are fields in the type,
in which case the arguments are bound to the fields in the order
they were given in the <span class="id">@record</span> definition.
</p>

<p>
The dot operator provides access to the fields of a record instance:
</p>
<div class="code">
<pre>
printf("%a", x.field1);   // print x's field1
x.field1 = "bcd";         // update x's field1

x.field2 += 5;		  // update x's field2
++x.field2;               // update x's field2

x.field3("blah");	  // call the value of x's field3
</pre>
</div>

<p>
The following routines operate on records and record descriptors.
</p>

<div class="docitem" id="fn:rdof">
<div class="proto">
<div class="function">
<span class="id">rdof(<span class="arg">r</span>)</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">record</span>
</div>
<div class="returns">
<span class="type">record descriptor</span>
</div>
</div>
<div class="desc">
Returns the record descriptor associated with the record
<span class="arg">r</span>. 
</div>
</div>

<div class="docitem" id="fn:rdfields">
<div class="proto">
<div class="function">
<span class="id">rdfields(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns the list of field names for the record descriptor
<span class="arg">rd</span> in the order they were given in the
<span class="id">@record</span> definition for <span class="arg">rd</span>.
</div>
</div>

<div class="docitem" id="fn:rdis">
<div class="proto">
<div class="function">
<span class="id">rdis(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns a function that is a predicate for instances of
the record descriptor <span class="arg">rd</span>.  The
function takes a single argument and returns non-zero
if and only if the argument is an instance of <span class="arg">rd</span>.
</div>
</div>

<div class="docitem" id="fn:rdname">
<div class="proto">
<div class="function">
<span class="id">rdname(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name associated with the record descriptor
<span class="arg">rd</span>. 
</div>
</div>

<p>
Record descriptors have an associated format procedure
that is implicitly called when 
the <span class="val">%a</span> conversion of the
formatted I/O library routines is applied to an instance of the record type.
The format procedure takes a single argument,
the record instance,
and returns a string representing the formatted
record.
</p>

<p>
The following routines access the format procedure
associated with a record descriptor.
</p>

<div class="docitem" id="fn:rdfmt">
<div class="proto">
<div class="function">
<span class="id">rdfmt(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the format procedure of the record descriptor
<span class="arg">rd</span>. 
</div>
</div>

<div class="docitem" id="fn:rdsetfmt">
<div class="proto">
<div class="function">
<span class="id">rdsetfmt(<span class="arg">rd</span>,<span class="arg">fmt</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the format procedure of the record descriptor
<span class="arg">rd</span> to <span class="arg">fmt</span>.
</div>
</div>


<h4 id="sec:domainover">Overview of Domains</h4>

<p>
This section summarizes the concepts and terminology
of Cinquecento domains.
</p>

<p>
A domain is an interface to three features of a program
in execution: its memory, symbols, and types.  This
interface is defined procedurally; like an object in an
object-oriented language, a domain encapsulates the
implementation of a predefined set of operations.
</p>

<p>
The domain interface can be called directly, but
normally Cinquecento programs interact with domains
through C expressions, which are translated by the
Cinquecento evaluator into implicit calls to the domain
interface.
</p>

<p>
A domain is formed by pairing a Cinquecento
<span class="type">address space</span> with a Cinquecento <span class="type">name space</span>.
These objects define complementary subsets of the domain interface.
</p>

<p>
An <span class="type">address space</span> represents the memory of a C program:
a mapping of byte addresses to byte values.
It encapsulates four functions.
Two access functions,
<span class="type">get</span>
and <span class="type">put</span>,
read and write memory.
<span class="type">Ismapped</span>
tests whether a contiguous
address range is accessible.
<span class="type">Map</span>
returns the accessible address
ranges.
</p>

<p>
A <span class="type">name space</span>
catalogs the symbols and types of a C program.
It encapsulates five functions.
<span class="type">Looksym</span>
and <span class="type">looktype</span>
map symbol and type names to their definitions.
<span class="type">Enumsym</span>
and <span class="type">enumtype</span>
list the symbols and types
of the name space.
<span class="type">Lookaddr</span>
maps an address to the nearest
symbol.
</p>

<p>
Address spaces and name spaces can be shared among domains.
For example, domains representing multiple running instances of the same
program binary will necessarily have separate address spaces, but
may share a common name space.
</p>

<p>
Domains are supported by two other types of Cinquecento values:
<span class="type">ctype</span>
and <span class="type">cvalue</span>.
</p>

<p>
A <span class="type">ctype</span> represents
a type that can be defined in a C program.
Ctypes both identify C types
(<em>e.g.</em>, pointer to <span class="val">struct foo</span>),
and define C types
(<em>e.g.</em>, the fields and size of <span class="val">struct foo</span>).
</p>

<p>
A <span class="type">cvalue</span> represents a typed,
scalar value that can be computed in a C program.
Every cvalue has an associated ctype that defines
its type.  Cvalues in Cinquecento are much like
<span class="type">rvalues</span> in C: they can be read and written
from memory using variable reference and assignment
operators, combined with other cvalues using C
operators, and cast to other types using casting operators.
</p>

<p>
Every cvalue has an associated domain that
gives meaning to C operations performed on the cvalue.
For example, when a cvalue pointer is dereferenced,
memory is accessed through the address space of its associated domain.
When a cvalue is cast to another type,
the new type definition is obtained from 
the name space of its associated domain.
</p>

<p>
Cvalues from different domains can be combined
without casting in certain sensible cases,
such as array indexing.

A cvalue also can be explicitly cast into a different
domain using the <em>extended cast operator</em>.
</p>

<p>
Domains, name spaces, and address spaces are
first-class values in Cinquecento.
Name spaces and address spaces can be constructed from
Cinquecento functions that implement their interfaces.
In addition, a syntax form, <span class="id"><a
href="#syn:_at_names">@names</a></span>, defines new name spaces
using an extended form of C declaration syntax.  
</p>

<p>
Programs can extend
the domain interface by associating additional functions
with name spaces and address spaces
to expose platform-specific
debugging functionality,
such as access to registers, process control,
and breakpoint control.
</p>


<h4 id="sec:backtick">Backtick Operator</h4>

<p>
Symbols and types in a domain are referenced with the backtick operator.
</p>

<p>
An expression of the form
</p>
<div class="code">
<pre>
dom`x
</pre>
</div>
<p>
resolves <span class="val">x</span> 
as either a symbol or type name in the domain 
<span class="val">dom</span>, depending on the context
of the expression.
</p>

<p>
Symbol resolution occurs when the backtick expression
appears where an lvalue or rvalue would be expected in C.
For example, in the expression
</p>
<div class="code">
<pre>
dom`x = dom`y;
</pre>
</div>
<p>
the names
<span class="val">x</span>
and
<span class="val">y</span>
are both resolved as symbols
in the domain
<span class="val">dom</span>.
</p>

<p>
In general, the syntax for symbol resolution is:
</p>
<div class="code">
<pre>
<span class="arg">domain</span>`<span class="arg">identifier</span>
</pre>
</div>

<p>
where <span class="arg">domain</span> is a
variable bound to a domain (not an expression that evaluates to a domain), and
<span class="arg">identifier</span> is a symbol defined in the domain.

</p>

<p>

To obtain the type and location
associated with the symbol, the evaluator implicitly calls
<span class="val"><span class="arg">domain</span>.looksym(<span class="arg">identifier</span>)</span>
</p>


<!-- <p> -->
<!-- The resulting reference may be used -->
<!-- to examine or modify the value stored at the location.  When the -->
<!-- location is read, such as in the reference -->
<!-- to <span class="val">dom`y</span> above, -->
<!-- the <span class="type">get</span> function -->
<!-- of the domain is called. -->
<!-- When the location is written, such as in the -->
<!-- reference to <span class="val">dom`x</span> -->
<!-- above, the <span class="type">put</span> function -->
<!-- of the domain is called. -->
<!-- </p> -->

<p>
Normally the left operand to backtick must be a domain.
However, if the right operand is the name of an enumeration
constant, the right operand may be a name space.  The
resulting cvalue has type and value of the constant
as defined in the name space, and a freshly allocated
domain with the same name space and the address space
of the literal domain.
</p>


<p>
Type resolution occurs when the backtick expression
appears where a type name would be expected or accepted in C:
the operand to <span class="id">sizeof</span>,
and the type operand of the cast operator.
The Cinquecento <span class="id">@typeof</span> operator,
which is syntactically similar to <span class="id">sizeof</span>,
also accepts a type name.
</p>

<p>
Variants of the type resolution form express the different forms of C type names:
</p>
<div class="table-short">
<table>

<tr>
<td>
Base types
</td>
<td>
<span class="id">
<span class="arg">domain</span>`<span class="arg">identifier</span> ...
</span>
</td>
</tr>

<tr>
<td>
<span class="id">typedef</span>s
</td>
<td>
<span class="id">
<span class="arg">domain</span>`<span class="arg">identifier</span>
</span>
</td>
</tr>


<tr>
<td>
Structs
</td>
<td>
<span class="id">
struct <span class="arg">domain</span>`<span class="arg">identifier</span>
</span>
</td>
</tr>

<tr>
<td>
Unions
</td>
<td>
<span class="id">
union <span class="arg">domain</span>`<span class="arg">identifier</span>
</span>
</td>
</tr>

<tr>
<td>
Enums
</td>
<td>
<span class="id">
enum <span class="arg">domain</span>`<span class="arg">identifier</span>
</span>
</td>
</tr>

</table>
</div>

<p>
The first variant references base C type specifiers,
which comprise one or more type specifier tokens.
For example, these expressions
</p>
<div class="code">
<pre>
dom`int
dom`unsigned long
dom`signed short int
</pre>
</div>
<p>
reference the base C types
<span class="id">int</span>, 
<span class="id">unsigned long</span>, 
and <span class="id">signed short int</span>.
</p>

<p>
The second variant is used to reference types
defined with <span class="id">typedef</span>.
The <span class="arg">domain</span> may be omitted for this variant.
The meaning of this abbreviated form depends on the context.
When used in the operand to <span class="id">sizeof</span>
or <span class="id">@typeof</span>, the type name is resolved
in the literal domain (see next section).
When used in the type operand to the cast operator,
the meaning is the same as if the domain has been specified,
since the cast operator always resolves the type name in the domain
of its other operand (see <a href="#sec:casts">Type and Domain Casting</a>).
</p>


<h4 id="sec:litdom">The Literal Domain</h4>

<p>
Cinquecento represents arithmetic literals as cvalues
from the built-in literal domain <span class="val">litdom</span>.
This domain is constructed from the <span class="val">clp64le</span> name space
and the abstract address space returned by
<span class="id"><a href="#fn:sprintfa">mknas</a></span>.
Only the size of arithmetic types matters in this domain; 
pointer size and endianness are irrelevant,
because expressions in this domain never reference memory.
</p>

<h4 id="sec:casts">Type and Domain Casting</h4>

<p>
The Cinquecento casting operators can be used to
change the type or domain of a cvalue.
</p>

<p>
The standard cast operator <span class="id">()</span>
operates on a syntactically specified type and a cvalue.
It returns a new cvalue that has been cast to
the new type.  The domain of the cvalue is searched
(using looktype) for a ctype definition of 
the specified type.
If one is found, the operator returns a new
cvalue in the same domain and the new type.
(Change of representation.)
</p>

<p>
The extended cast operator operands on a ctype
or domain value and a cvalue.

If the operand is a ctype, the behavior is similar
to that of the standard cast operator <span class="id">()</span>.
Regardless of the definition of the ctype,
the ctype is used as a name to search the
domain of the cvalue operand.
</p>

<p>
If the operand is a domain, the resulting
cvalue is the original cvalue, with the new
domain....
</p>


<h4 id="sec:mixeddom">Mixed-domain Expressions</h4>

<p>
A binary C operator may be applied to cvalue operands
from two different domains.  Several rules determine
the outcome of such <em>mixed-domain expressions</em>.
These rules give sensible meaning to mixed-domain
expressions that yield or compare arithmetic
quantities, but disallow rarely sensible
mixed-domain combinations of pointer values.
</p>

<p>
The first rule concerns expressions in which exactly
one operand is from the literal domain,
such as
<span class="val">dom`x+5</span>.
The domain of the literal operand is implicitly
converted to the domain of the other, non-literal
operand.
</p>

<p>
The second rule concerns mixed-domain arithmetic,
bitwise, and relational operations on non-literal
operands that are not pointers.  Such operands are both
converted to the literal domain.  This rule allows
comparison or aggregation of arithmetic values from
different domains to be expressed naturally without the
clutter of explicit domain conversions.
</p>

<p>
The third rule concerns mixed expressions in which one
operand is a pointer.  Pointer addition operations
(including array subscripting) comprise one pointer
operand and one arithmetic operand.  In mixed-domain
pointer addition, the domain of the arithmetic operand
is implicitly cast to that of the pointer operand.
Since the type of the result is pointer, the domain of
the result should remain in the domain of the pointer
operand.  (This rule also maintains consistency with
the rule for literals.)  Pointer subtraction operations
involve either one pointer operand and one arithmetic
operand or two pointer operands.  In the former case,
the rule is the same as that for pointer addition.  The
latter case is disallowed: it makes no sense to relate
locations in two different address spaces.  A program
that wishes to do so must explicitly domain cast one of
the operands.
</p>

<p>
The final rule is that all other mixed-domain
expressions are disallowed.  Generally this rule covers
the other mixed-domain pointer expressions.  For
example, comparison of pointers from different domains
is prohibited for the same reason that pointer
subtraction is prohibited.  An explicit domain cast can
be used to circumvent this rule.
</p>


<h4 id="sec:cvalueops">C Operators</h4>

<p>
The operators of C are defined over Cinquecento cvalues
and have isomorphic semantics.

The operator set includes arithmetic, bitwise, relational, and logical operators,
as well as operators for accessing values of C's aggregate data types,
and pointer dereference.  All of the operators observe the precedence
and associativity rules of C.
</p>

<p>
The binary arithmetic and bitwise operators
(<span class="id">+</span>,
<span class="id">-</span>,
<span class="id">*</span>,
<span class="id">/</span>,
<span class="id">%</span>,
<span class="id">&amp;</span>,
<span class="id">|</span>,
<span class="id">^</span>,
<span class="id">&lt;&lt;</span>,
<span class="id">&gt;&gt;</span>
)
operate on cvalues of integer type.
Each yields a cvalue of value and
type equivalent to the result in C of
the same operator on operands of
equivalent type and value.
Overflow and underflow semantics on arithmetic are preserved,
and the C type promotion and conversion rules are applied.
</p>


<p>
Similarly, the unary operators 
(<span class="id">+</span>,
<span class="id">-</span>,
<span class="id">!</span>,
<span class="id">~</span>)
operate on cvalues of integer type
and yield a cvalue of type and value
equivalent to the result in C of
the same operator on an operand of equivalent
type and value.
</p>

<p>
The relational operators 
(<span class="id">&lt;</span>,
<span class="id">&lt;=</span>,
<span class="id">&gt;</span>,
<span class="id">&gt;=</span>,
<span class="id">==</span>,
<span class="id">!=</span>)
compare cvalues.  The result of each operator
is a boolean: <span class="val">0</span>
or <span class="val">1</span>, represented
as a cvalue of type <span class="val">int</span>
in the literal domain.
</p>

<p>
The logical operators
(<span class="id">&amp;&amp;</span> and 
<span class="id">||</span>)
compute logical and and over integers, treated as boolean values,
as in C.  Evaluation is short circuited, as in C.
</p>

<h4 id="sec:pointers">Pointers</h4>

<p>
Pointer-typed cvalues represent typed locations.
The domain of a pointer-typed cvalue provides the address space in
which pointer operators on the cvalue are applied.
</p>

<p>
As in C, one way to obtain a pointer is through the unary
reference operator.  For example, the statement
</p>

<div class="code">
	p = &amp;dom`x;
</div>

<p>
binds <span class="val">p</span>
to a cvalue that represents the
location associated with
<span class="val">x</span> in <span class="val">dom</span>.
</p>

<p>
The C pointer dereference operator <span class="val">*</span> is defined
in Cinquecento over pointer-typed cvalues.  Precisely
as a C programmer would expect, <span class="val">*</span> accesses the
contents of the location in the associated domain,
using the pointed-to type to determine the number of bytes to access
and their encoding.  For example, given the above
binding of <span class="val">p</span>, either of the two expressions:
</p>

<div class="code">
	a = *p;		a = dom`x;
</div>

<p>
would bind <span class="val">a</span> to the same cvalue.
</p>

<p>
Pointer arithmetic works as expected.  The following
sequence of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`x;
p = p+1;
</pre>
</div>

<p>
leaves <span class="val">p</span> bound to a pointer cvalue that
refers to the location following <span class="val">x</span>
in <span class="val">dom</span>.
In C pointer arithmetic, the amount by which the value
of a pointer is incremented is determined by the size
of the underlying type of the pointer.  In Cinquecento,
this size is determined by the definition of the type
in the domain of the cvalue.
</p>

<p>
Pointers to aggregate types also work as expected.  The
following sequence of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`t;
p->next = p+1;
</pre>
</div>

<p>
assigns the <span class="val">next</span> field of the <span class="val">struct T</span>
at location <span class="val">t</span> in <span class="val">dom</span> to point to
the beginning of the next logical <span class="val">struct T</span>.
Although there is no symbol corresponding to this
location, we can, as in C, use pointers to impute types
to otherwise untyped locations.
</p>

<p>
The C pointer/array relationship works as expected.
This sequence of expressions has an equivalent effect
to the preceding one:
</p>

<div class="code">
<pre>
p = &amp;dom`t;
p[0].next = p+1;
</pre>
</div>

<p>
The adherence to C pointer semantics extends to
disregard for pointer safety.  The following sequence
of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`x;
p = p+256;
</pre>
</div>

<p>
binds <span class="val">p</span> to a pointer to a location that
does not exist in the address space of <span class="val">dom</span> (since
we used <span class="val">mkzas</span> to create a fixed 1024-byte address
space).
</p>

<p>
Such pointers, as in C, are harmless until
dereferenced.  An attempt to dereference a pointer to
an unmapped location in Cinquecento raises a top-level
access fault exception that aborts execution of the
current Cinquecento program (but leaves the Cinquecento
system running).  There is no way for a program to
catch this or any other Cinquecento exception: they are
indications to the user that there is a bug in their
Cinquecento program, which they should stop and fix.
(Automated recovery from bugs is for robots and
spacecraft, not debuggers.)  Programs can test, without
risk of raising an exception, whether a span of storage
in a domain is mapped by calling the built-in function
<span class="val">ismapped</span>.
</p>

<p>
Operations on incorrect pointer values in Cinquecento,
unlike such operations in C, never cause corruption to
the runtime of the Cinquecento system.  The
environment, control, and other execution state of the
Cinquecento system are not represented by a domain, and
thus are not addressable data that a Cinquecento
program can mutate.  (For example, you cannot apply the
<span class="val">&amp;</span> operator to a Cinquecento variable in hope of
discovering its address.)  As with other safe
functional language runtimes, misbehavior or failure of
the Cinquecento runtime is an implementation bug, never
a consequence of operating on erroneous user data.
</p>

<h4 id="sec:mkdom">Domain constructor</h4>

<p>
New domain instances are created with
<span class="id">mkdom</span>.
</p>

<div class="docitem" id="fn:mkdom">
<div class="proto">
<div class="function">
<span class="id">mkdom(<span class="arg">ns</span>,<span class="arg">as</span>)</span>
</div>
<div class="param">
<span class="arg">ns</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">as</span>: <span class="type">address space</span>
</div>
<div class="returns">
<span class="type">domain</span>
</div>
</div>
<div class="desc">
Returns a new domain instance whose associated name space 
and address space are
<span class="arg">ns</span> and
<span class="arg">as</span>.
</div>
</div>

<h4 id="sec:domobj">Domains as objects</h4>

<p>
Cinquecento address spaces and name spaces encapsulate
functions that implement the behavior of these
abstractions.  The structure of this encapsulation is
similar to that of simple objects in a conventional
object-oriented language.
</p>

<h4 id="sec:namespaces">Name spaces</h4>

<p>
Name spaces catalog information about C types and symbols.
</p>

<p>
C types are represented by the Cinquecento type <em>ctype</em>.
Ctypes represent two related but subtly different concepts:
C type names and C type definitions.
</p>

<p>
C type names are the syntactic constructions, such
as <tt>int*</tt>, that in C appear as type declarations
and as type operands to operators such as
<tt>sizeof</tt> and the cast operator.
</p>

<p>
C type definitions are the definition of types referenced
by type names.  What a definition specifies depends on the type.  

For base C types, the definition specifies the number of bytes
used to represent values of the type and how the bytes are
interpreted (<em>e.g.</em>, big- or little-endian order).

For pointers, it specifies the size and representation
of the pointer value in memory.

For aggregates, it specifies the offset from the beginning
of the aggregate to each field, 
the name and type of each field,
and the total size of the aggregate.

For enums, it specifies the enumeration constant
identifiers and their values, and the common type used to
repesent all values of the enumeration.

For typedefs, it specifies the binding of a name to another
type.
</p>

<p>
The distinction between type name and definition enables
Cinquecento to represent multiple
programs that have potentially conflicting meanings for
the same type.

For example, the type name <tt>int*</tt> always
references the type pointer-to-<tt>int</tt>, but
there are many possible definitions for this type.

One domain can define it to be a 64-bit address of a
64-bit integer encoded in big-endian order, while
another may be define it be a 32-bit address of a
32-bit integer encoded in little-endian order.  Given a
ctype for <tt>int*</tt>, part of the role of a name space is to
provide a ctype that defines its encoding.
</p>

<p>
Functions that operate on ctypes are described in the
section <a href="#sec:ctypes">Ctypes</a>.
</p>

<p>
Several
functions retrieve type information from a name space.
</p>

<div class="docitem" id="fn:nsptr">
<div class="proto">
<div class="function">
<span class="id">nsptr(<span class="arg">ns</span>)</span>
</div>
<div class="param">
<span class="arg">ns</span>: <span class="type">name space</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a base type defined in <span class="arg">ns</span>
that can represent the pointer type defined in <span class="arg">ns</span>.
</div>
</div>

<div class="docitem" id="fn:nsrepbase">
<div class="proto">
<div class="function">
<span class="id">nsrepbase(<span class="arg">ns</span>,<span class="arg">rep</span>)</span>
</div>
<div class="param">
<span class="arg">ns</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">rep</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a base type defined
in <span class="arg">ns</span> whose representation
is <span class="arg">rep</span>,
or <span class="val">nil</span> if there is no such
type.
</div>
</div>


<p>
C symbols have three components: the type of the symbol
(represented as a ctype),
the name of the symbol (string),
and the location of the symbol (cvalue).
C symbols are not represented by a distinct Cinquecento
type; rather a symbol is represented by a vector
containing the three components.
</p>

<p>
The representation may change in a later version of Cinquecento.
To avoid future incompatibility, programs should use the following
interface to create and access symbols.  (The notation
<span class="arg">symbol</span> denotes the representation
of symbols.)
</p>


<div class="docitem" id="fn:mksym">
<div class="proto">
<div class="function">
<span class="id">mksym(<span class="arg">type</span>,<span class="arg">id</span>,<span class="arg">loc</span>)
</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">cvalue</span> or
<span class="type">nil</span>
</div>

<div class="returns">
<span class="type">symbol</span>
</div>
</div>
<div class="desc">
Constructs a new symbol from
<span class="arg">type</span>,
<span class="arg">id</span>, and
<span class="arg">val</span>.
Usually <span class="arg">val</span>
gives the offset in bytes of the object named
by the symbol from the beginning of the
address space in which it is located.
<span class="arg">Val</span> may be <span class="val">nil</span>,
in which case the symbol is used only to associate a type with a name.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:symtype">
<span class="id">symtype(<span class="arg">sym</span>)
</span>
</div>
<div class="function"  id="fn:symid">
<span class="id">symid(<span class="arg">sym</span>)
</span>
</div>
<div class="function"  id="fn:symoff">
<span class="id">symoff(<span class="arg">sym</span>)
</span>
</div>
<div class="param">
<span class="arg">sym</span>: <span class="type">symbol</span>
</div>
<div class="returns">
see description
</div>
</div>
<div class="desc">
Each of these functions returns one of the components of 
<span class="arg">symbol</span>.
</div>
</div>

<p>
Name spaces implement an interface of five functions:
</p>

<ol>
<li><span class="arg">looktype(ctype) -> ctype</span></li>
<li><span class="arg">enumtype() -> table</span></li>
<li><span class="arg">looksym(string) -> symbol</span></li>
<li><span class="arg">enumsym() -> table</span></li>
<li><span class="arg">lookaddr(cval) -> symbol</span></li>
</ol>

<p>
Given a type name (as a ctype), <span
class="arg">looktype</span> returns a ctype representing
the definition of the type.  If the name space does not
define the type, <span class="arg">looktype</span>
returns <span class="val">nil</span>.
</p>

<p>
Given a symbol name, <span class="arg">looksym</span>
returns the corresponding symbol.
If the name space does not
define the symbol, <span class="arg">looksym</span>
returns <span class="val">nil</span>.
</p>

<p>
<span class="arg">Enumtype</span> and <span
class="arg">enumsym</span> each return a table
representing the mapping defined by <span
class="arg">looktype</span> and
<span class="arg">looksym</span>.  For <span
class="arg">enumtype</span> the keys are type names (as
ctypes) and the values are the corresponding definitions
(also as ctypes).  For <span class="arg">enumsym</span>
the keys are symbol names (as strings) and the values
are the corresponding definitions (as vectors).
</p>

<p>
<span class="arg">Lookaddr</span> performs the inverse
of <span class="arg">looksym</span>.  Given an address,
<span class="arg">lookaddr</span> returns the symbol
definition whose offset is the greatest value less than
or equal to the address in the name space.  If more
than one symbol qualifies, an arbitrary one is returned.
</p>

<p>
Given a type name (as a ctype), <span
class="arg">looktype</span> returns a ctype representing
the definition of the type.  If the name space does not
define the type, <span class="arg">looktype</span>
returns <span class="val">nil</span>.
</p>

<p>
Every name space created by a Cinquecento program
inherits type and symbol definitions from an
existing name space.

This inheritance relation starts with
a <em>root name space</em> that defines the
representation of the C base types,
including the size and encoding for each base type.
</p>

<p>
The built-in root name spaces correspond to several
common machine models, and vary in the size of
pointers and <span class="id">long</span> integers.
</p>

<div class="table-short">
<table>

<tr>
<th>Root name space</th>
<th>Endianness</th>
<th><span class="id">sizeof(void*)</span></th>
<th><span class="id">sizeof(long)</span></th>
</tr>

<tr>
<td>
<span class="id">c32le</span>
</td>
<td>
little
</td>
<td>
4
</td>
<td>
4
</td>
</tr>

<tr>
<td>
<span class="id">c32be</span>
</td>
<td>
big
</td>
<td>
4
</td>
<td>
4
</td>
</tr>

<tr>
<td>
<span class="id">c64le</span>
</td>
<td>
little
</td>
<td>
4
</td>
<td>
8
</td>
</tr>

<tr>
<td>
<span class="id">c64be</span>
</td>
<td>
big
</td>
<td>
4
</td>
<td>
8
</td>
</tr>

<tr>
<td>
<span class="id">clp64le</span>
</td>
<td>
little
</td>
<td>
8
</td>
<td>
8
</td>
</tr>
<tr>
<td>

<span class="id">clp64be</span>
</td>
<td>
big
</td>
<td>
8
</td>
<td>
8
</td>
</tr>

</table>
</div>
 

<p>To construct a new name space, you must supply an
implementation of the name space interface.
Cinquecento provides three mechanisms for doing so.
The <span class="id"><a href="#fn:mkns">mkns</a></span>
function accepts predefined functions and returns a
new name space.  The <span class="id"><a
href="#fn:mknsraw">mknsraw</a></span> function accepts
two tables that define the symbols and types in the
namespace.  Finally, the <span class="id"><a
href="#syn:_at_names">@names</a></span> syntactic form
accepts symbol and type definitions in C declaration
syntax.  Each of these mechanisms also accepts an
optional human-readable name to be associated with
resulting name space; this name is used only for
presentation, and need not be unique.  The remainder of
this section further describes these mechanisms.
</p>

<div class="docitem" id="fn:mkns">
<div class="proto">
<div class="function">
<span class="id">mkns(<span class="arg">looktype</span>,<span class="arg">enumtype</span>,<span class="arg">looksym</span>,<span class="arg">enumsym</span>,<span class="arg">lookaddr</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">looktype</span>, <span class="arg">enumtype</span>, <span class="arg">looksym</span>, <span class="arg">enumsym</span>, <span class="arg">lookaddr</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">name space</span>
</div>
</div>
<div class="desc">
The five function parameters implement the Cinquecento
name space interface.  <span class="id">Mkns</span>
constructs and returns a new name space corresponding
to this implementation.  If specified, <span
class="arg">name</span> is a human-readable name
associated with the name space.
</div>
</div>

<div class="docitem" id="fn:mknsraw">
<div class="proto">
<div class="function">
<span class="id">mknsraw(<span class="arg">parent</span>,<span class="arg">typetab</span>,<span class="arg">symtab</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">parent</span>: <span class="type">namespace</span>
</div>
<div class="param">
<span class="arg">typetab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">symtab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">name space</span>
</div>
</div>
<div class="desc">
<span class="arg">Typetab</span> is a table whose keys
are type names (as ctypes) and whose values are type
definitions (as ctypes).  The type definitions may be
<em>incomplete</em>: types definitions may refer to
type names rather than fully specified types.  As long
as a definition for the referenced type occurs either
elsewhere in <span class="arg">typetab</span> or in the
name space <span class="arg">parent</span>, the type
definition will be implicitly resolved.  If a referenced
type is defined in both <span
class="arg">typetab</span> and <span
class="arg">parent</span>, the <span
class="arg">typetab</span> definition has precedence.
</div>
<div class="desc">
<span class="arg">Symtab</span> is a table whose keys
are symbol names (as strings) and whose values are
symbols (in the 3-element vector form defined above).
As with <span class="arg">typetab</span>, the types
occurring in symbols may be type references.
</div>
<div class="desc">
<span class="id">Mknsraw</span> resolves all type
references, then constructs and returns a new name
space.
If specified, <span
class="arg">name</span> is a human-readable name
associated with the name space.
</div>
</div>

<div class="docitem" id="syn:_at_names">
<div class="proto">
<div class="syntax">
<span class="id">@names <span class="arg">parent</span> [ $ <span class="arg">name</span> ] {
	<span class="arg">decl</span> ...
};
</span>
</div>
<div class="param">
<span class="arg">parent</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">decl</span>: <span class="type">see description</span>
</div>
<div class="returns">
<span class="type">name space</span>
</div>
</div>
<div class="desc">
This syntax constructs a new name space from a sequence
of symbol and type declarations.  The declarations are
written in an extension of the C variable and type
declaration syntax.  If specified,
<span
class="arg">name</span> is a human-readable name
associated with the name space.

</div>
<div class="desc">
There are four forms of declaration: aggregates, symbols,
enums, and typedefs.
</div>

<div class="desc">
The syntax for an aggregate declaration is the same as C
aggregate declaration except that:
<ul>
<li> each field declaration must includes an offset
         expression that specifies the offset of the
          field relative to the beginning of the
          aggregate;</li>
<li> the declaration must end with a final offset
          expression (not associated with any field)
          that specifies the size of the aggregate.</li>
</ul>
The offset expression has two variants: one (<span class="val">@<span class="arg">expr</span></span>)
to specify the offset in <em>bytes</em>, and
one (<span class="val">@@<span class="arg">expr</span></span>)
to specify the offset in <em>
bits</em>.  The bit offset variant must be used to
define fields corresponding to C bitfields.
</div>
<div class="desc">
The syntax for a symbol declaration is the same as C
variable declarations (without initializers) except
that: each symbol declaration may be preceded by an
offset expression that specifies the offset of the
first byte in the address space of the object named by
the symbol.
The offset expression syntax is the same as the byte offset expression
used in aggregate fields.  There is no way to associate a bit offset
with a symbol.
</div>

<div class="desc">
The syntax for enum declarations is the same as their syntax in C,
except that the terms in expressions used to define enumeration values
must be literal values or preceding constant names within the same enumeration.
</div>

<div class="desc">
The syntax for typedef declarations is the same as their syntax in C.
</div>
</div>

<h4 id="sec:addressspaces">Address spaces</h4>

<p>
Cinquecento address spaces represent byte-addressed
storage by providing methods to reflect the set
of <em>mapped</em> locations &mdash; the set of
addresses backed by storage &mdash; and methods to read
and write the contents of mapped locations.  The
prototypical address space represents the live memory
of a running programs, but address spaces can also
represent less dynamic content, such as the content of
files or strings.  More generally, address spaces can
be composed of ordinary Cinquecento functions that
manage a view of arbitrary synthetic storage.
</p>

<p>
Several built-in functions create new address spaces
with specific forms of backing storage.
</p>

<p>
The function <tt>mknas()</tt> returns a null address
space that has no backing storage.  Any attempt to read
or write this address space fails.  This address space
is used to construct domains that act solely as sources
for types and symbols; for example, the literal domain
is backed by a null address space.
</p>

<p>
The function <tt>mksas(<em>str</em>)</tt> creates an
address base backed by the string <em>str</em>.  The
memory associated with the string is shared with the
address space, so that an update made to either the
string or the address space will be reflected in the
other.
</p>

<p>
The function <tt>mkzas(<em>len</em>)</tt> creates a
zero-filled address space backed by
<tt><em>len</em></tt> bytes of unshared, cleared
memory supplied by the system.
</p>


<p>
Mapped locations in an address space are subdivided
into disjoint <em>units</em>.  Each unit spans a
contiguous range of the address space.  Units are
commonly used to represent the sparse page-based
virtual address spaces of running programs.  The units
of an address space need not be of equal size, and the
number of units and their dimensions may change over
time.
</p>

<p>
Every address space implements four methods
(this interface is tentatively planned for future version,
but not currently supported):
</p>
<div class="table-short">
<table>

<tr>
<td align="right">
<span class="arg">unit</span>&emsp;:&emsp;
</td>
<td align="right">
<span class="type">cvalue</span>&emsp;&rarr;&emsp;
</td>
<td>
<span class="type">range</span> <em>or</em> <span class="type">nil</span>
</td>
</tr>

<tr>
<td align="right">
<span class="arg">limit</span>&emsp;:&emsp;
</td>
<td align="right">
<span class="type">void</span>&emsp;&rarr;&emsp;
</td>
<td>
<em>list of</em> <span class="type">cvalue</span>
</td>
</tr>

<tr>
<td align="right">
<span class="arg">get</span>&emsp;:&emsp;
</td>
<td align="right">
<span class="type">range</span>&emsp;&rarr;&emsp;
</td>
<td>
<span class="type">string</span> <em>or</em> <span class="type">nil</span>
</td>
</tr>

<tr>
<td align="right">
<span class="arg">put</span>&emsp;:&emsp;
</td>
<td align="right">
<span class="type">range</span> &times; <span class="type">string</span>&emsp;&rarr;&emsp;
</td>
<td>
<span class="type">cvalue</span> <em>or</em> <span class="type">nil</span>
</td>
</tr>

</table>
</div>

<p>
The range type represents a contiguous span of
locations in an address space.
A range is constructed by the function
<tt>mkrange(<em>beg</em>,<em>len</em>)</tt>, where
<tt><em>beg</em></tt> is the non-negative start address
of the range and <tt><em>len</em></tt> is the positive
number of bytes in the range; both are cvalues.  Empty
ranges are invalid.  The functions
<tt>rangebeg(<em>range</em>)</tt> and
<tt>rangelen(<em>range</em>)</tt> return the start
address and byte count from a range as cvalues.
</p>

<p>
The <span class="arg">unit</span> method queries the
units of an address space.  Its argument is an address.
If the address is mapped,
<span class="arg">unit</span> returns a range that specifies
the boundaries of the containing unit.  Otherwise it returns
<span class="type">nil</span>.
</p>

<p>
The <span class="arg">limit</span> method queries the
overall address boundaries of an address space.  It
returns a list containing two addresses (as cvalues).
The first is the smallest address defined by the
address space; the second is the highest.  These values
need not be mapped, but are merely the minimum and
maximum address values handled by the address space.
</p>

<p>
The <span class="arg">get</span> method reads from a range of the
address space, returning the stored bytes as a string.
<span class="arg">Get</span> fails (returns <span class="type">nil</span>)
if the access includes unmapped locations.
<span class="arg">Get</span> may also fail
if the access spans
the boundary of a unit of the address space.
</p>

<p>
The <span class="arg">put</span> method writes to a
range of the address space.  The string argument
contains the bytes to be written; its length be of
equal to that of the range argument.  If the write
succeeds, the number of bytes written (always the
length of the string) is returned.  
<span class="arg">Put</span> fails (returns <span class="type">nil</span>)
if the access includes unmapped locations.
<span class="arg">Put</span> may also fail
if the access spans
the boundary of a unit of the address space.
</p>

<p>
The function <tt>mkas(<em>dispatch</em>)</tt>
constructs a custom address space.  Dispatch is a
program-defined variable arity function that
encapsulates the <tt><em>map</em></tt>,
<tt><em>get</em></tt>, and <tt><em>put</em></tt>
functions.  The first argument to dispatch is a string
whose value is the name of the function to be called;
dispatch must apply the corresponding function to the
remaining arguments.
</p>

<p>
Ordinarily the functions represented by
<em>dispatch</em> are implicitly invoked by the
Cinquecento implementation during evaluation of C
expressions that involve storage access operations
(such as dereferencing a pointer).  However, programs
may directly invoked these functions by name using an
overloaded form of the C binary dot operator:
</p>
<div class="code">
<pre>
; as.get(mkrange(0,1024));
</pre>
</div>

<p>
When the left operand of a dot expression is an address
space, the result of the expression is a variable arity
function that, when called, calls the dispatch function
of the address space.  The arguments it passes to
dispatch are, first, the identifier appearing as the
right operand to the dot expression as a string,
followed by the arguments to the call.
</p>

<p>
In addition, if the right operand is the identifier
<tt>dispatch</tt>, then the result of the expression is
simply the dispatch function of the address space,
instead of the curried version described above.
For example, the above call to <tt>get</tt> is equivalent to:
</p>
<div class="code">
<pre>
; as.dispatch("get",mkrange(0,1024));
</pre>
</div>

<p>
As a syntactic convenience, the left operand to the dot
operator can also be a domain, in which case the same
operation is performed on the underlying address space.
</p>

<p>
The address spaces returned by the standard address
space constructors all implement a dispatch function
that can be accessed with the dot operator in the same
way as a custom address space.
</p>

<p>
The dot operator on address spaces will accept any
valid identifier (not just <tt>map</tt>, <tt>get</tt>,
<tt>put</tt>, and <tt>dispatch</tt>), providing a way
for programs to extend the standard address space
interface with additional custom functions.  This
feature can be used, for example, to associate a
function for setting breakpoints with an address space.
</p>


<h4 id="sec:ctypes">Ctypes</h4>

<p>The Cinquecento type <em>ctype</em> represents types
defined in C programs.  The predicate
<a href="#fn:isctype"><span class="id">isctype</span></a> tests whether a value is
a ctype.
The <span class="fnindex"><a href="#syn:_at_typeof">@typeof</a></span>
operator can be used to obtain a ctype representing the
type of a cvalue or the type denoted by a type name.
</p>

<div class="docitem" id="syn:_at_typeof">
<div class="proto">
<div class="function">
<span class="id">@typeof(<span class="arg">typename</span>)</span>
</div>
<div class="function">
<span class="id">@typeof(<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">typename</span>: <span class="type">type name expression</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">cvalue expression</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
The <span class="id">@typeof</span> operator is similar
to the <span class="id">sizeof</span> operator in that
it is applied to either a type name or to an expression
that yields a cvalue.  In both cases it returns a ctype
value that represents the type of its operand.  In the
type name case, if the operand is a fully qualified
type name, then the type name is resolved in the domain
referenced by the type name; otherwise, the type name
is resolved in the literal domain.
</div>
</div>

<p>
In Cinquecento, the set of types that can be defined in
a C program are divided into several categories.  The
main categories are: the <tt>void</tt> type, the base
arithmetic types (<tt>char</tt>, <tt>int</tt>,
<tt>unsigned long</tt>, <em>etc</em>), pointers,
arrays, aggregates (<tt>struct</tt> and
<tt>union</tt>), functions, enumerations, and
<tt>typedef</tt>s.  In addition, Cinquecento also has
separate categories for bitfields, enumeration
constants, undefined types, and a special extended
accessor type.
</p>

<p>
The following table summarizes the category-specific
functions that manipulate ctypes.  The predicates
determine to which category a ctype belongs.  Each
predicate takes one argument, a ctype, and returns
<span class="val">1</span> if the predicate is true for
that ctype, <span class="val">0</span> otherwise.  With
the exception
of <span class="id">issu</span>, <span class="id">isstruct</span>,
and <span class="id">isunion</span>, the predicates are
mutually exclusive; <span class="id">issu</span>
returns true if its argument is structure or union
aggregate, <span class="id">isstruct</span> returns
true if its argument is a structure,
and <span class="id">isunion</span> returns true if its
argument is a union.  The accessors return attributes
of a ctype instance in each category; the constructors
construct new instances of each category.  Descriptions of
the accessors and constructors follow the table.
</p>

<div class="table">
<table>

<tr>
<th>Type category</th>
<th>Predicate</th>
<th>Accessors</th>
<th>Constructors</th>
</tr>

<tr>
<td>
Aggregate
</td>
<td>
<span class="fnindex" id="fn:isstruct">isstruct</span><br />
<span class="fnindex" id="fn:issu">issu</span><br />
<span class="fnindex" id="fn:isunion">isunion</span>
</td>
<td>
<span class="fnindex"><a href="#fn:fields">fields</a></span><br />
<span class="fnindex"><a href="#fn:suetag">suetag</a></span><br />
<span class="fnindex"><a href="#fn:susize">susize</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_struct">mkctype_struct</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_union">mkctype_union</a></span>
</td>
</tr>

<tr>
<td>
Array
</td>
<td><span class="fnindex" id="fn:isarray">isarray</span></td>
<td>
<span class="fnindex"><a href="#fn:arraynelm">arraynelm</a></span><br />
<span class="fnindex"><a href="#fn:subtype">subtype</a></span><br />
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_array">mkctype_array</a></span>
</td>
</tr>

<tr>
<td>
Base C type
</td>
<td><span class="fnindex" id="fn:isbase">isbase</span></td>
<td>
<span class="fnindex">baseid</span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_base">mkctype_base</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_char">mkctype_char</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_short">mkctype_short</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_int">mkctype_int</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_long">mkctype_long</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_vlong">mkctype_vlong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uchar">mkctype_uchar</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ushort">mkctype_ushort</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uint">mkctype_uint</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ulong">mkctype_ulong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uvlong">mkctype_uvlong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_float">mkctype_float</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_double">mkctype_double</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ldouble">mkctype_ldouble</a></span>
</td>
</tr>

<tr>
<td>
Bitfield
</td>
<td><span class="fnindex" id="fn:isbitfield">isbitfield</span></td>
<td>
<span class="fnindex"><a href="#fn:bitfieldcontainer">bitfieldcontainer</a></span><br />
<span class="fnindex"><a href="#fn:bitfieldpos">bitfieldpos</a></span><br />
<span class="fnindex"><a href="#fn:bitfieldwidth">bitfieldwidth</a></span><br />
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_bitfield">mkctype_bitfield</a></span>
</td>
</tr>

<tr>
<td>
Enumeration
</td>
<td><span class="fnindex" id="fn:isenum">isenum</span></td>
<td>
<span class="fnindex"><a href="#fn:enumconsts">enumconsts</a></span><br />
<span class="fnindex"><a href="#fn:suetag">suetag</a></span><br />
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_enum">mkctype_enum</a></span><br />
</td>
</tr>

<tr>
<td>
Enumeration constant
</td>
<td><span class="fnindex" id="fn:isenumconst">isenumconst</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_const">mkctype_const</a></span>
</td>
</tr>

<tr>
<td>
Extended accessor
</td>
<td><span class="fnindex" id="fn:isxaccess">isxaccess</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span><br />
<span class="fnindex"><a href="#fn:xaccessget">xaccessget</a></span><br />
<span class="fnindex"><a href="#fn:xaccessput">xaccessput</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_xaccess">mkctype_xaccess</a></span>
</td>
</tr>


<tr>
<td>
Function
</td>
<td><span class="fnindex" id="fn:isfunc">isfunc</span></td>
<td>
<span class="fnindex"><a href="#fn:params">params</a></span><br />
<span class="fnindex"><a href="#fn:rettype">rettype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_fn">mkctype_fn</a></span>
</td>
</tr>

<tr>
<td>
Pointer
</td>
<td><span class="fnindex" id="fn:isptr">isptr</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_ptr">mkctype_ptr</a></span>
</td>
</tr>

<tr>
<td>
Typedef
</td>
<td><span class="fnindex" id="fn:istypedef">istypedef</span></td>
<td>
<span class="fnindex"><a href="#fn:typedefid">typedefid</a></span><br />
<span class="fnindex"><a href="#fn:typedeftype">typedeftype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_typedef">mkctype_typedef</a></span>
</td>
</tr>

<tr>
<td>
Undefined
</td>
<td><span class="fnindex" id="fn:isundeftype">isundeftype</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_undef">mkctype_undef</a></span>
</td>
</tr>

<tr>
<td>
Void
</td>
<td><span class="fnindex" id="fn:isvoid">isvoid</span></td>
<td>
<em>n/a</em>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_void">mkctype_void</a></span>
</td>
</tr>

</table>
</div>

<p>
The following functions are the ctype accessors.
</p>

<div class="docitem" id="fn:subtype">
<div class="proto">
<div class="function">
<span class="id">subtype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype or nil</span>
</div>
</div>
<div class="desc">
The ctype categories array, enumeration, enumeration
constant, pointer, undefined, and extended accessor each modify another,
subordinate ctype.  Given a ctype from any one of these
categories, <span class="id">subtype</span> returns the
subordinate ctype, or <span class="val">nil</span> if
the ctype does not define its subordinate.
</div>
</div>

<div class="docitem" id="fn:fields">
<div class="proto">
<div class="function">
<span class="id">fields(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing the
definitions of the fields in the aggregate <span
class="arg">type</span>.  Each item in the vector defines a field 
that can be examined with the functions
<span class="fnindex"><a
href="#fn:fieldid">fieldid</a></span>, <span
class="fnindex"><a
href="#fn:fieldoff">fieldoff</a></span>, and <span
class="fnindex"><a
href="#fn:fieldtype">fieldtype</a></span>.
Modifying the vector may cause undefined effects.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:fieldid">fieldid(<span class="arg">field</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:fieldoff">fieldoff(<span class="arg">field</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:fieldtype">fieldtype(<span class="arg">field</span>)</span>
</div>
<div class="param">
<span class="arg">field</span>: <span class="type">item in the vector returned by <span
class="fnindex"><a
href="#fn:fields">fields</a></span></span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
These functions examine an aggregate field definition returned by <span
class="fnindex"><a href="#fn:fields">fields</a></span>.  <span
class="id">Fieldid</span> returns the name of the field
as a string.  <span class="id">Fieldoff</span> returns
the offset in bytes of the field from the start of the
aggregate as a cvalue, or <span class="val">nil</span>
if the offset is undefined.  <span
class="id">Fieldtype</span> returns the type of the
field as a ctype.
</div>
</div>

<div class="docitem" id="fn:suetag">
<div class="proto">
<div class="function">
<span class="id">suetag(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate or enumeration ctype</span>
</div>
<div class="returns">
<span class="type">string or nil</span>
</div>
</div>
<div class="desc">
Returns the tag of the aggregate or enumeration
ctype <span class="arg">type</span> as a string.
Returns <span class="val">nil</span>
if <span class="arg">type</span> does not define a tag
(<em>i.e.</em>, if <span class="arg">type</span> is an
anonymous aggregate or enumeration).
</div>
</div>

<div class="docitem" id="fn:susize">
<div class="proto">
<div class="function">
<span class="id">susize(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
Returns the size in bytes of the aggregate
ctype <span class="arg">type</span> as a cvalue.
Returns <span class="val">nil</span>
if <span class="arg">type</span> does not define its size.
</div>
</div>

<div class="docitem" id="fn:arraynelm">
<div class="proto">
<div class="function">
<span class="id">arraynelm(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">array ctype</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
Returns the number of elements in the array type <span
class="arg">type</span>.  Returns <span class="val">nil</span> if the type does not define the number of elements.
</div>
</div>

<div class="docitem" id="fn:baseid">
<div class="proto">
<div class="function">
<span class="id">baseid(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name of the base C type represented
by <span class="arg">type</span> as a string.
</div>
</div>

<div class="docitem" id="fn:basebase">
<div class="proto">
<div class="function">
<span class="id">basebase(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the integer representation (with FIXME
unspecified semantics) of the base C type represented
by <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:baserep">
<div class="proto">
<div class="function">
<span class="id">baserep(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the integer representation (with FIXME
unspecified semantics) of the representation of the base C type represented
by <span class="arg">type</span> (indeed!).
</div>
</div>

<div class="docitem" id="fn:bitfieldcontainer">
<div class="proto">
<div class="function">
<span class="id">bitfieldcontainer(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the ctype in which the bitfield type
represented by <span class="arg">type</span> is contained.
</div>
</div>

<div class="docitem" id="fn:bitfieldpos">
<div class="proto">
<div class="function">
<span class="id">bitfieldpos(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the bit offset within its container of the
first bit of the bitfield type represented by
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:bitfieldwidth">
<div class="proto">
<div class="function">
<span class="id">bitfieldwidth(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the width of the bitfield type represented
by <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:enumconsts">
<div class="proto">
<div class="function">
<span class="id">enumconsts(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">enumeration ctype</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing the definitions of the
constants in the enumeration
type <span class="arg">type</span>.  Each item in the
vector is a two-element vector that defines one
constant.  The first element is the name of the
constant as a string, the second is the value of
constant as a cvalue.
</div>
</div>

<div class="docitem" id="fn:params">
<div class="proto">
<div class="function">
<span class="id">params(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">function ctype</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing the
definitions of the parameters in the function type represented by <span
class="arg">type</span>.  Each item in the vector defines a parameter
that can be examined with the functions
<span class="fnindex"><a
href="#fn:paramid">paramid</a></span> and <span
class="fnindex"><a
href="#fn:paramtype">paramtype</a></span>.
The parameters occur in the vector in the order they are 
declared in the function type represented by <span
class="arg">type</span>.
Modifying the vector may cause undefined effects.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:paramid">paramid(<span class="arg">param</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:paramtype">paramtype(<span class="arg">param</span>)</span>
</div>
<div class="param">
<span class="arg">param</span>: <span class="type">item in the vector returned by <span
class="fnindex"><a
href="#fn:fieldtype">params</a></span></span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
These functions examine a parameter definition returned by <span
class="fnindex"><a href="#fn:params">params</a></span>.  <span
class="id">Paramid</span> returns the name of the parameter
as a string.  <span
class="id">Paramtype</span> returns the type of the
parameter as a ctype.
</div>
</div>

<div class="docitem" id="fn:rettype">
<div class="proto">
<div class="function">
<span class="id">rettype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">function ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the return type of the function type represented by
<span class="arg">type</span>.
</div>
</div>


<div class="docitem" id="fn:typedefid">
<div class="proto">
<div class="function">
<span class="id">typedefid(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name of the type defined by the typedef type represented by
<span class="arg">type</span> as a string.
</div>
</div>

<div class="docitem" id="fn:typedeftype">
<div class="proto">
<div class="function">
<span class="id">typedeftype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the type aliased defined by the typedef type represented by
<span class="arg">type</span> as a ctype.
</div>
</div>

<div class="docitem" id="fn:settypedeftype">
<div class="proto">
<div class="function">
<span class="id">settypedeftype(<span class="arg">typedef</span>, <span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">typedef</span>: <span class="type">typedef ctype</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Modifies the typedef ctype <span class="arg">typedef</span> to be
an alias for <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:xaccessget">
<div class="proto">
<div class="function">
<span class="id">xaccessget(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">extended accessor ctype</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the get function of the extended accessor ctype
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:xaccessput">
<div class="proto">
<div class="function">
<span class="id">xaccessput(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">extended accessor ctype</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the put function of the extended accessor ctype
<span class="arg">type</span>.
</div>
</div>

<p>
The following functions are the ctype constructors.
</p>

<div class="docitem">
<div class="proto">

<div class="function">
<span class="id" id="fn:mkctype_struct">mkctype_struct(<span class="arg">tag</span>[,<span class="arg">fields</span>,<span class="arg">size</span>])</span>
</div>

<div class="function">
<span class="id" id="fn:mkctype_union">mkctype_union(<span class="arg">tag</span>[,<span class="arg">fields</span>,<span class="arg">size</span>])</span>
</div>

<div class="param">
<span class="arg">tag</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">fields</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">size</span>: <span class="type">size</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a struct or union
aggregate type.
<span class="arg">Tag</span> is the type tag.  If
specified, <span class="arg">fields</span> is a vector
defining the fields of the aggregate, each element of
which is constructed
by <span class="fnindex"><a href="#fn:mkfield">mkfield</a></span>,
and <span class="arg">size</span> is the size in bytes
of the aggregate.
</div>
</div>

<div class="docitem" id="fn:mkfield">
<div class="proto">
<div class="function">
<span class="id">mkfield(<span class="arg">type</span>,<span class="arg">id</span>[,<span class="arg">off</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">off</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">

Returns a new field definition that is a suitable
element of the <span class="arg">fields</span>
argument
of <span class="fnindex"><a href="#fn:mkctype_struct">mkctype_struct</a></span>
or <span class="fnindex"><a href="#fn:mkctype_union">mkctype_union</a></span>.
<span class="arg">Type</span> is the type of the field,
<span class="arg">id</span> is the name of the field, and
<span class="arg">off</span>, if specified, is the offset in bytes of the field from the beginning of the aggregate.
</div>
</div>


<div class="docitem" id="fn:mkctype_array">
<div class="proto">
<div class="function">
<span class="id">mkctype_array(<span class="arg">type</span>[,<span class="arg">nelm</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="param">
<span class="arg">nelm</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an array of 
represented by <span class="arg">type</span>.
<span class="arg">Nelm</span>, if specified, is the number of elements
in arrays represented by the type.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:mkctype_base">mkctype_base(<span class="arg">base</span>[,<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_char">mkctype_char([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_short">mkctype_short([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_int">mkctype_int([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_long">mkctype_long([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_vlong">mkctype_vlong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uchar">mkctype_uchar([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ushort">mkctype_ushort([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uint">mkctype_uint([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ulong">mkctype_ulong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uvlong">mkctype_uvlong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_float">mkctype_float([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_double">mkctype_double([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_longdouble">mkctype_longdouble([<span class="arg">rep</span>])</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">

<span class="id">mkctype_base</span> returns a new
ctype representing the base C type corresponding to the
base type specified by <span class="arg">base</span>,
an integer (with FIXME unspecifed semantics).
The remaining functions each return a new ctype
representing the base C type corresponding to the
suffix of the function name.  The returned type is
incomplete unless the <span class="arg">rep</span>
argument, which specifies the representation of the
type (with FIXME unspecifed semantics), is provided.
</div>
</div>

<div class="docitem" id="fn:mkctype_bitfield">
<div class="proto">
<div class="function">
<span class="id">mkctype_bitfield(<span class="arg">type</span>,<span class="arg">width</span>,<span class="arg">pos</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">width</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">pos</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a bitfield type.  The
constructed bitfield type
has <span class="arg">width</span> bits, is contained in a
field of the type represented
by <span class="arg">type</span>, and starts at bit
offset <span class="arg">pos</span> in the containing type.
</div>
</div>

<div class="docitem" id="fn:mkctype_enum">
<div class="proto">
<div class="function">
<span class="id">mkctype_enum(<span class="arg">tag</span>[,<span class="arg">consts</span>[,<span class="arg">type</span>]])</span>
</div>
<div class="param">
<span class="arg">tag</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">consts</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an enumeration type.  
<span class="arg">Tag</span> is the type tag.  
If specified, <span class="arg">consts</span> is a vector defining
the constants of the enumeration type.  Each element of 
<span class="arg">consts</span> is a two-element vector.
The first element is the name of the
constant as a string, the second is the value of
constant as a cvalue.  <span class="arg">Type</span>, if specified, is the
underlying (subordinate) type of the enumeration.
</div>
</div>

<div class="docitem" id="fn:mkctype_const">
<div class="proto">
<div class="function">
<span class="id">mkctype_const(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing the type of an enumeration constant.
<span class="arg">Type</span> is the underlying (subordinate)
enumeration type of the constant.
</div>
</div>

<div class="docitem" id="fn:mkctype_fn">
<div class="proto">
<div class="function">
<span class="id">mkctype_fn(<span class="arg">rettype</span>,<span class="arg">params</span>)</span>
</div>
<div class="param">
<span class="arg">rettype</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">params</span>: <span class="type">vector</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a function type.
<span class="arg">Type</span> is the return type of the function.
<span class="arg">Params</span> is a vector
defining the parameters of the function, each element of which
is constructed
by <span class="fnindex"><a href="#fn:mkparam">mkparam</a></span>.
</div>
</div>

<div class="docitem" id="fn:mkparam">
<div class="proto">
<div class="function">
<span class="id">mkparam(<span class="arg">type</span>[,<span class="arg">id</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a new parameter definition that is a suitable
element of the <span class="arg">params</span>
argument
of <span class="fnindex"><a href="#fn:mkctype_fn">mkctype_fn</a></span>.
<span class="arg">Type</span> is the type of the parameter and
<span class="arg">id</span>, if specified and non-nil,
is the name of the parameter.
</div>
</div>

<div class="docitem" id="fn:mkctype_ptr">
<div class="proto">
<div class="function">
<span class="id">mkctype_ptr(<span class="arg">type</span>[,<span class="arg">reptype</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">reptype</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a pointer to the type represented by
<span class="arg">type</span>.  If
specified, <span class="arg">reptype</span> is a ctype
representing the pointer representation type.
</div>
</div>

<div class="docitem" id="fn:mkctype_typedef">
<div class="proto">
<div class="function">
<span class="id">mkctype_typedef(<span class="arg">id</span>[,<span class="arg">type</span>])</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a typedef.  
<span class="arg">Id</span> is the name of typedef.
If specified, <span class="arg">type</span> is a ctype representing
the aliased type.
</div>
</div>

<div class="docitem" id="fn:mkctype_undef">
<div class="proto">
<div class="function">
<span class="id">mkctype_undef(<span class="arg">id</span>[,<span class="arg">type</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an undefined type whose name is
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:mkctype_void">
<div class="proto">
<div class="function">
<span class="id">mkctype_void()</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing the void type.
</div>
</div>

<div class="docitem" id="fn:mkctype_xaccess">
<div class="proto">
<div class="function">
<span class="id">mkctype_xaccess(<span class="arg">type</span>,<span class="arg">get</span>,<span class="arg">put</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">get</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">put</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a type whose values
are accessed through calls to custom accessor
functions, rather than through calls to the address
space interface.  The ctype <span
class="arg">type</span> is the underlying (subordinate)
type of the value.  When the system dereferences a
pointer to a value of the type, it calls <span
class="arg">get</span>, passing the domain of the
pointer cvalue.  <span class="arg">Get</span> returns a
cvalue, which the system casts to <span
class="arg">type</span>.
</div>
<div class="desc">
Similarly, when the system assigns through a pointer to
a value of the type, it calls <span
class="arg">put</span> on the domain of the pointer and
the new value to be written.  The new value is cast to
<span class="arg">type</span> before the call.  The
return value is ignored.
</div>
</div>

<div class="docitem" id="fn:typename">
<div class="proto">
<div class="function">
<span class="id">typename(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a ctype representing the type name of <span class="arg">type</span>.
</div>
</div>


<h4 id="sec:containers">Container Types</h4>

<p>
Cinquecento supports three built-in container types:
lists, vectors, and tables.
</p>

<p>
Several functions operate on any type of container.
</p>

<div class="docitem" id="fn:length">
<div class="proto">
<div class="function">
<span class="id">length(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">string</span>, or <span class="type">table</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of items stored in 
<span class="arg">container</span>.
</div>
</div>

<div class="docitem" id="fn:isempty">
<div class="proto">
<div class="function">
<span class="id">isempty(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">string</span>, or <span class="type">table</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns <span class="val">1</span> if <span
class="arg">container</span> contains zero elements, <span class="val">0</span> otherwise.
</div>
</div>

<div class="docitem" id="fn:copy">
<div class="proto">
<div class="function">
<span class="id">copy(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">table</span>, or <span class="type">string</span>
</div>
<div class="returns">
<span class="type">same as container</span>
</div>
</div>
<div class="desc">
Returns a shallow copy of <span class="arg">container</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:foreach">foreach(<span class="arg">fn</span>,<span class="arg">container</span>,[<span class="arg">container2</span>, ...])</span>
</div>
<div class="function">
<span class="id" id="fn:map">map(<span class="arg">fn</span>,<span class="arg">container</span>,[<span class="arg">container2, ...</span>])</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, or <span class="type">table</span>
</div>
<div class="param">
<span class="arg">container2, ... </span>: <span class="type">list</span> or <span class="type">vector</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">

<div>
Calls <span class="arg">fn</span> on each item in the provided <span
class="arg">containers</span>. 
If the containers are either lists or vectors,
<span class="id">foreach</span> 
calls <span class="arg">fn</span>
on corresponding elements of the containers.
<span class="arg">fn</span> must 
accept as many arguments as there are containers,
and the containers must have the same length.
</div>

<div>
If <span class="arg">container</span> is a table,
then no other containers may be provided, and 
<span class="id">foreach</span> visits each key/value pair in
unspecified order, calling <span class="arg">fn</span>
with the key and value, in that order, as separate
arguments.
</div>

<div>
<span class="id">Foreach</span> discards the values
returned by <span class="arg">fn</span> and returns
<span class="val">nil</span>.
</div>

<div>
<span class="id">Map</span> is like <span class="id">foreach</span>
except that it collects the values
returned by <span class="arg">fn</span> in a list,
and returns the list.  If the <span class="arg">containers</span>
are vectors or lists,
the order of the elements in
the list returned by <span class="id">map</span>
corresponds to the order of the elements
in the <span class="arg">containers</span>.
</div>

</div>
</div>

<div class="docitem" id="fn:sort">
<div class="proto">
<div class="function">
<span class="id">sort(<span class="arg">container</span>,<span class="arg">cmp</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or vector</span>
</div>
<div class="param">
<span class="arg">cmp</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Sorts in place the elements of <span
class="arg">container</span>, using <span
class="arg">cmp</span> to compare elements.  <span
class="arg">Cmp</span> accepts two arguments, each an
element of <span class="arg">container</span>, and
returns: a negative cvalue if the first argument
compares less than the second; a positive cvalue if the
first argument compares greater than the second; or
zero if they are equal.  Returns <span class="arg">container</span>
following the update.
</div>
</div>

<div class="docitem" id="fn:bsearch">
<div class="proto">
<div class="function">
<span class="id">bsearch(<span class="arg">key</span>,<span class="arg">container</span>,<span class="arg">cmp</span>)</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or vector</span>
</div>
<div class="param">
<span class="arg">cmp</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">element of container or nil</span>
</div>
</div>
<div class="desc">
Searches the elements of <span
class="arg">container</span> for one matching <span class="arg">key</span>.
The elements of the container must be sorted in ascending order
according to the comparison function <span class="arg">cmp</span>.
<span
class="arg">Cmp</span> accepts two arguments, first (always) <span class="arg">key</span> and second an
element of <span class="arg">container</span>, and
returns: a negative cvalue if the first argument
compares less than the second; a positive cvalue if the
first argument compares greater than the second; or
zero if they are equal.
</div>
</div>

<div class="docitem" id="fn:pop">
<div class="proto">
<div class="function">
<span class="id">pop(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or table</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">container</span></span>
</div>
</div>
<div class="desc">
If <span class="arg">container</span> is a list,
removes and returns the first element, shifting any
remaining elements down one position.
If <span class="arg">container</span> is a table,
removes and returns an arbitrary key/value pair.
The pair is returned as a vector, with the key
in the first element and value in the second.
If the list or table is empty, <span class="id">pop</span> returns <span class="id">nil</span>.
</div>
</div>


<div class="docitem" id="fn:concat">
<div class="proto">
<div class="function">
<span class="id">concat(<span class="arg">x1</span>,<span class="arg">x2</span>)</span>
</div>
<div class="param">
<span class="arg">x1</span>: <span class="type">list or string</span>
</div>
<div class="param">
<span class="arg">x2</span>: <span class="type">list or string</span>
</div>
<div class="returns">
<span class="type">list or string</span>
</div>
</div>
<div class="desc">
Returns the concatentation of the arguments.  The arguments must
be of the same type.
</div>
</div>

<div class="docitem" id="fn:count">
<div class="proto">
<div class="function">
<span class="id">count(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of occurrences of <span class="arg">v</span>
in <span class="arg">container</span>.
</div>
</div>

<div class="docitem" id="fn:index">
<div class="proto">
<div class="function">
<span class="id">index(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the index of the first occurrences of <span class="arg">v</span>
in <span class="arg">container</span> or <span class="val">nil</span>
if <span class="arg">v</span> is not in <span class="arg">container</span>.
</div>
</div>

<div class="docitem" id="fn:ismember">
<div class="proto">
<div class="function">
<span class="id">ismember(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, table, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns <span class="val">1</span> if <span class="arg">v</span>
occurs in <span class="arg">container</span> or <span class="val">0</span>
otherwise.
</div>
</div>

<div class="docitem" id="fn:delete">
<div class="proto">
<div class="function">
<span class="id">delete(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or table</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">container</span>
</div>
</div>
<div class="desc">
Deletes every occurrence of <span class="arg">v</span>
in <span class="arg">container</span>.
Returns <span class="arg">container</span> following the update.
</div>
</div>

<p>
Containers can be indexed with C array reference
operator (<span class="id">[]</span>).  The statement
</p>
<div class="code">
<pre>
	x = C[i];
</pre>
</div>
<p>
reads the <span class="id">i</span>th element from
container <span class="id">C</span>.  Likewise,
</p>
<div class="code">
<pre>
	C[i] = x;
</pre>
</div>
<p>
assigns the <span class="id">i</span>th element to
the value bound to <span class="id">x</span>, and the
statements
</p>
<div class="code">
<pre>
	C[i] += 1;	C[i]++;
</pre>
</div>
<p>
both increment the <span class="id">i</span>th element.
</p>

<p>
Unlike its use on C arrays, the <span class="id">[]</span>
operator on Cinquecento containers is not commutative.
In an
expression
<span class="id"><span class="arg">C</span>[<span class="arg">i</span>]</span>,
<span class="arg">C</span> must be a container and <span class="arg">i</span>
a valid index for the container.  For tables, a valid index is a key.
</p>

<h4 id="sec:lists">Lists</h4>

<p>
Lists are variable-length ordered collections, possibly
empty.  Lists are mutable, allowing items to be added
or deleted from any position, and contiguously indexed
from position 0.  The predicate
<a href="#fn:islist"><span class="id">islist</span></a> tests whether a value is
a list.
</p>

<div class="docitem" id="fn:list">
<div class="proto">
<div class="function">
<span class="id">list(<span class="arg">value</span>, ...)</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Constructs a new list containing the zero or more values passed as arguments.
The values are stored in argument order.
</div>
</div>

<div class="docitem" id="fn:mklist">
<div class="proto">
<div class="function">
<span class="id">mklist(<span class="arg">len</span>[,<span class="arg">val</span>])</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Constructs a new list of size <span class="arg">len</span>.
Each element is initialized to <span class="arg">val</span>, if specified,
otherwise to <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="syn:_emptylist_">
<div class="proto">
<div class="syntax">
<span class="id">[ <span class="arg">value</span>, ... ]</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
The syntax <span class="id">[...]</span> constructs a
new list containing the zero or more values enclosed in the
braces.  It is equivalent to calling <span
class="id">list</span> on the enclosed values.
</div>
</div>

<div class="docitem" id="fn:head">
<div class="proto">
<div class="function">
<span class="id">head(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">list</span></span>
</div>
</div>
<div class="desc">
Returns the first element of <span class="arg">list</span>.
</div>
</div>

<div class="docitem" id="fn:tail">
<div class="proto">
<div class="function">
<span class="id">tail(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a copy of <span class="arg">list</span> with the first element removed.
</div>
</div>


<div class="docitem" id="fn:listref">
<div class="proto">
<div class="function">
<span class="id">listref(<span class="arg">list</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">list</span></span>
</div>
</div>
<div class="desc">
Returns the item stored at position <span class="arg">idx</span> in
<span class="arg">list</span>.
</div>
</div>

<div class="docitem" id="listset">
<div class="proto">
<div class="function">
<span class="id">listset(<span class="arg">list</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Replaces the item at position <span
class="arg">idx</span> in <span
class="type">list</span> with <span
class="arg">value</span>.  It is an error if <span
class="type">list</span> does not contain more than
<span class="arg">idx</span> items.  Returns <span
class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:listins">
<div class="proto">
<div class="function">
<span class="id">listins(<span class="arg">list</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span>  at position <span
class="arg">idx</span> in <span
class="type">list</span>.  The elements at position <span
class="arg">idx</span> and higher, if any, are shifted up one position.
It is an error if <span
class="type">list</span> does not contain more than
<span class="arg">idx-1</span> items.  Returns <span
class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:listdel">
<div class="proto">
<div class="function">
<span class="id">listdel(<span class="arg">list</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Deletes the item at position <span
class="arg">idx</span> in <span
class="type">list</span>.  The elements at higher
positions, if any, are shifted down one position.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:append">
<div class="proto">
<div class="function">
<span class="id">append(<span class="arg">list</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span> at the end of
<span class="type">list</span>.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:push">
<div class="proto">
<div class="function">
<span class="id">push(<span class="arg">list</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span> at the beginning of
<span class="type">list</span>, shifting all other elements up one position.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:reverse">
<div class="proto">
<div class="function">
<span class="id">reverse(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a new list containing the elements of <span class="arg">list</span> in reverse order.
</div>
</div>

<div class="docitem" id="fn:slice">
<div class="proto">
<div class="function">
<span class="id">slice(<span class="arg">list</span>,
  <span class="arg">beg</span>,
  <span class="arg">end</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
<span class="arg">beg</span>: <span class="type">cvalue</span>
<span class="arg">end</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a new list containing the elements
of <span class="arg">list</span> starting at
index <span class="arg">beg</span> up, but not
including, index <span class="arg">end</span>.
</div>
</div>

<h4 id="sec:vectors">Vectors</h4>

<p>
Vectors are fixed-length ordered collections, possibly
empty.  Vectors are mutable, allowing items to be
changed at any position, and contiguously indexed from
position 0.  The predicate
<span class="id">isvector</span> tests whether a value is
a vector.
</p>

<div class="docitem" id="fn:mkvec">
<div class="proto">
<div class="function">
<span class="id">mkvec(<span class="arg">len</span>[,<span class="arg">val</span>])</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Constructs a new vector of size <span class="arg">len</span>.
Each element is initialized to <span class="arg">val</span>, if specified,
otherwise to <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="fn:vector">
<div class="proto">
<div class="function">
<span class="id">vector(<span class="arg">value</span>, ...)</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Constructs a new vector containing the zero or more values passed as arguments.
The values are stored in argument order.  The size of the vector is equal to the number of arguments.
</div>
</div>

<div class="docitem" id="fn:veclen">
<div class="proto">
<div class="function">
<span class="id">veclen(<span class="arg">vec</span>)</span>
</div>
<div class="param">
<span class="arg">vec</span>: <span class="type">vector</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of items in <span class="arg">vec</span>.
Equivalent to <tt>length(<span class="arg">vec</span>)</tt>.
</div>
</div>


<div class="docitem" id="fn:vecref">
<div class="proto">
<div class="function">
<span class="id">vecref(<span class="arg">vec</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">vec</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">vec</span></span>
</div>
</div>
<div class="desc">
Returns the item stored at position <span class="arg">idx</span> in
<span class="arg">vec</span>.
</div>
</div>

<div class="docitem" id="fn:vecset">
<div class="proto">
<div class="function">
<span class="id">vecset(<span class="arg">vec</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">vec</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Replaces the item at position <span
class="arg">idx</span> in <span
class="type">vec</span> with <span
class="arg">value</span>.  It is an error if <span
class="type">vec</span> does not contain more than
<span class="arg">idx</span> items.
</div>
</div>

<h4 id="sec:tables">Tables</h4>

<p>
Tables store key/value pairs.  Keys and values may be
any type of Cinquecento value other than <span
class="type">nil</span>.  The predicate
<span class="id">istable</span> tests whether a value is
a table.
</p>

<div class="docitem" id="fn:mktab">
<div class="proto">
<div class="function">
<span class="id">mktab()</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
Creates and returns a new, empty table.
</div>
</div>


<div class="docitem"  id="syn:_emptytable_">
<div class="proto">
<div class="syntax">
<span class="id">[ <span class="arg">key</span> : <span class="arg">value</span>, ... ]</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
This syntax constructs a
new table containing the zero or more key/value pairs enclosed in the
braces.  The syntax <span class="id">[ : ]</span> constructs an empty table.
</div>
</div>


<div class="docitem" id="fn:tabinsert">
<div class="proto">
<div class="function">
<span class="id">tabinsert(<span class="arg">tab</span>,<span class="arg">key</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Inserts the pair <span class="arg">key</span>/<span
class="arg">value</span> into <span
class="arg">tab</span>.  Any previous entry for
the same <span class="arg">key</span> is removed.
</div>
</div>

<div class="docitem" id="fn:tablook">
<div class="proto">
<div class="function">
<span class="id">tablook(<span class="arg">tab</span>,<span class="arg">key</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">depends on the contents of <span class="arg">tab</span></span>
</div>
</div>
<div class="desc">
Searches <span class="arg">tab</span> for a pair whose
key is <span class="arg">key</span> and returns the
associated value.  Returns <span class="val">nil</span>
if <span class="arg">tab</span> has no such pair.

</div>
</div>

<div class="docitem" id="fn:tabdelete">
<div class="proto">
<div class="function">
<span class="id">tabdelete(<span class="arg">tab</span>,<span class="arg">key</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Deletes the pair with key <span class="arg">key</span>
from <span class="arg">tab</span>, if it exists.
</div>
</div>

<div class="docitem" id="fn:tabkeys">
<div class="proto">
<div class="function">
<span class="id">tabkeys(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all keys in
<span class="arg">tab</span>.
</div>
</div>

<div class="docitem" id="fn:tabvals">
<div class="proto">
<div class="function">
<span class="id">tabvals(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all values in
<span class="arg">tab</span>.</div>
</div>

<div class="docitem" id="fn:tabenum">
<div class="proto">
<div class="function">
<span class="id">tabenum(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all keys and values in
<span class="arg">tab</span>.  The length of the
returned vector is twice the number of pairs in <span
class="arg">tab</span>.  The first half of the vector
contains the keys of <span class="arg">tab</span>; the
second half contains, in corresponding order,  the values.
</div>
</div>


<h4 id="sec:characters">Characters</h4>

<p>

ASCII characters are represented as cvalues of type
<span class="val">char</span> or <span
class="val">unsigned char</span>.
</p>

<p>
The following functions operate on characters.
</p>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:isalnum">isalnum(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isalpha">isalpha(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isascii">isascii(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isblank">isblank(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:iscntrl">iscntrl(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isdigit">isdigit(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isgraph">isgraph(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:islower">islower(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isodigit">isodigit(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isprint">isprint(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:ispunct">ispunct(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isspace">isspace(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isupper">isupper(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isxdigit">isxdigit(<span class="arg">char</span>)</span>
</div>
<div class="param">
<span class="arg">char</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue (1 or 0)</span>
</div>
</div>
<div class="desc">
These functions implement predicates on character values.
They correspond to the ctype (character type) interface of the
C library.  The predicates are based on fixed character values,
and do not depend on the locale of the Cinquecento
evaluator.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:tolower">tolower(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:toupper">toupper(<span class="arg">char</span>)</span>
</div>
<div class="param">
<span class="arg">char</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue (1 or 0)</span>
</div>
</div>
<div class="desc">
These functions convert a lowercase (or uppercase) character
to the corresponding uppercase (or lowercase) character.
</div>
</div>


<h4 id="sec:strings">Strings</h4>

<p>
The Cinquecento string type represents an array of
bytes.  Cinquecento strings have fixed length (possibly
zero), are indexed from position 0, and are not null
terminated.  Strings are mutable, but do not share
storage with other strings.  The maximum string length
is 2^64-1.  The predicate
<a href="#fn:isstring"><span class="id">isstring</span></a> tests whether a value is
a string.
</p>

<p>
The C relational operators (<tt>==</tt>, <tt>!=</tt>,
<tt>&lt;&lt;</tt>, <tt>></tt>, <tt>&lt;=</tt>, <tt>>=</tt>) are
defined over strings.  They compare the contents of the
strings.  There is no way to test whether two string
instances are the same object.
</p>

<p>
The binary C operator <tt>+</tt> concatenates strings.
</p>

<p>
The following functions comprise the basic string
operations.
</p>

<div class="docitem" id="fn:mkstr">
<div class="proto">
<div class="function">
<span class="id">mkstr(<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a new string containing <span
class="arg">len</span> null bytes.
</div>
</div>

<div class="docitem" id="fn:strlen">
<div class="proto">
<div class="function">
<span class="id">strlen(<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of bytes in <span class="arg">str</span>.
Equivalent to <tt>length(<span class="arg">str</span>)</tt>.
</div>
</div>

<div class="docitem" id="fn:strref">
<div class="proto">
<div class="function">
<span class="id">strref(<span class="arg">str</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue of type <span class="type">uchar</span>
</span>
</div>
</div>
<div class="desc">
Returns the character at index <span class="arg">idx</span> in
<span class="arg">str</span>.
</div>
</div>

<div class="docitem" id="fn:strstr">
<div class="proto">
<div class="function">
<span class="id">strstr(<span class="arg">s1</span>,<span class="arg">s2</span>)</span>
</div>
<div class="param">
<span class="arg">s1</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">s2</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
Returns the index in <span class="arg">s1</span> of the first occurrence
of the string <span class="arg">s2</span>, or nil if <span class="arg">s2</span>
does not match.
</div>
</div>

<div class="docitem" id="fn:substr">
<div class="proto">
<div class="function">
<span class="id">substr(<span class="arg">str</span>,<span class="arg">start</span>,<span class="arg">end</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">start</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">end</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the substring of <span
class="arg">from</span> starting at position
<span class="arg">start</span> up to but not including position 
<span class="arg">end</span>.
</div>
</div>

<div class="docitem" id="fn:strput">
<div class="proto">
<div class="function">
<span class="id">strput(<span class="arg">to</span>,<span class="arg">offset</span>,<span class="arg">from</span>)</span>
</div>
<div class="param">
<span class="arg">to</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">offset</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">from</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Copies the contents of string <span
class="arg">from</span> into <span 
class="arg">to</span>.  The copy begins at position
<span class="arg">offset</span> within <span
class="arg">to</span>.  It is an error if <span class="arg">to</span> is too short for <span
class="arg">from</span> to be copied in entirety.
</div>
</div>

<div class="docitem" id="fn:memset">
<div class="proto">
<div class="function">
<span class="id">memset(<span class="arg">str</span>,<span class="arg">byte</span>[,<span class="arg">lim</span>])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">byte</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">lim</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Fills the first <span class="arg">lim</span> bytes of string <span
class="arg">str</span> with the low eight bits of <span class="arg">byte</span>.
If <span class="arg">lim</span> is unspecified, the entire string is filled.
</div>
</div>

<div class="docitem" id="fn:strton">
<div class="proto">
<div class="function">
<span class="id">strton(<span class="arg">str</span>[,<span class="radix">base</span>])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">base</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Converts the contents of <span class="arg">str</span>
to an integer cvalue in the literal domain.  The format
of <span class="arg">str</span> may be any valid C
integer constant.  If provided and non-zero, <span class="arg">base</span>
specifies the base in which the string is interpreted.
</div>
</div>

<div class="docitem" id="fn:split">
<div class="proto">
<div class="function">
<span class="id">split(<span class="arg">str</span>[,<span class="arg">set</span>[,<span class="arg">lim</span>]])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">set</span>: <span class="type">string or nil</span>
</div>
<div class="param">
<span class="arg">lim</span>: <span class="type">cval</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Searches <span class="arg">str</span> for substrings delimited
by characters in <span class="arg">set</span> and returns
a list of the substrings.

If <span class="arg">set</span> is not specified or is <span class="val">nil</span>,
the split occurs on consecutive white space delimiters.  Otherwise,
the split occurs on each occurrence of a delimiters from <span class="arg">set</span>,
and consecutive delimiters yield empty strings.

If <span class="arg">lim</span> is specified, at most
<span class="arg">lim</span> splits are performed; if input remains,
it is returned as the final element of the returned list.
</div>
</div>


<div class="docitem" id="fn:mapfile">
<div class="proto">
<div class="function">
<span class="id">mapfile(<span class="arg">filename</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the contents of
the file named <span class="arg">filename</span>.
</div>
</div>

<p>
Several functions move strings to and
from address spaces.
</p>

<div class="docitem" id="fn:stringof">
<div class="proto">
<div class="function">
<span class="id">stringof(<span class="arg">ptr</span>)</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of type <span class="type">char*</span> or <span class="type">unsigned char*</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the bytes
beginning at <span class="arg">ptr</span> from the
address space associated with <span
class="arg">ptr</span>.  The string extends to, but
does not include, the first null byte at or beyond
<span class="arg">ptr</span>.  <span
class="id">Stringof</span> does not span address space
mapping boundaries: if the boundary of the address
space mapping containing <span class="arg">ptr</span>
is reached before a null byte is encountered, then the
search ends and the string of bytes seen so far is
returned.
</div>
</div>

<div class="docitem" id="fn:getbytes">
<div class="proto">
<div class="function">
<span class="id">getbytes(<span class="arg">ptr</span>[,<span class="arg">len</span>])</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the bytes
beginning at <span class="arg">ptr</span> from the
address space associated with <span
class="arg">ptr</span>.  If provided, <span
class="arg">len</span> is a non-negative count of bytes
to read; otherwise, <tt>sizeof(*<span
class="arg">ptr</span>)</tt> bytes are read.  It is an
error for the read to cross the boundary of the address
space mapping containing <span
class="arg">ptr</span>.
</div>
</div>

<div class="docitem" id="fn:putbytes">
<div class="proto">
<div class="function">
<span class="id">putbytes(<span class="arg">ptr</span>,<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Copies the bytes in <span class="arg">str</span> into
address space associated with <span
class="arg">ptr</span>, starting at the location
pointed to by <span class="arg">ptr</span>.  It is an
error for the write to cross the boundary of the
address space mapping containing <span
class="arg">ptr</span>.
</div>
</div>

<h4 id="sec:io">I/O</h4>

<p>
Cinquecento supports I/O backed by regular files, network
connections, or user-defined functions.  Such I/O resources
are represented by an instance of the file descriptor type.
The predicate <a href="#fn:isfd"><span class="id">isfd</span></a>
tests whether a value is a file descriptor.
</p>

<p>
When the storage for a regular file or network
connection descriptor is collected, the system
implicitly closes the underlying system file resource.
(This is not true for descriptors backed by
user-defined functions.)
</p>

<div class="docitem" id="fn:open">
<div class="proto">
<div class="function">
<span class="id">open(<span class="arg">filename</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Opens the file named <span class="arg">filename</span> and
returns the associated file descriptor.  <span
class="arg">Mode</span> specifies the mode of access:
<span class="val">"r"</span> (read),
<span class="val">"w"</span> (create or truncate for writing),
<span class="val">"rw"</span> (create or truncate for reading and writing),
<span class="val">"a"</span> (append), or
<span class="val">"ra"</span> (append and read).
</div>
</div>

<div class="docitem" id="fn:fdopen">
<div class="proto">
<div class="function">
<span class="id">fdopen(<span class="arg">fd</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Creates and returns a Cinquecento file descriptor that
is bound to the system-level file
descriptor <span class="arg">fd</span> of the calling
process.
<span class="arg">Mode</span> specifies whether the
file descriptor can be read, written, or both; see
<span class="fnindex"><a href="#fn:open">open</a></span>.
The native file descriptor is closed if and when the
Cinquecento file descriptor is closed, including the
implicit close that occurs when a file descriptor is
garbage collected.
</div>
</div>


<div class="docitem" id="fn:tcpopen">
<div class="proto">
<div class="function">
<span class="id">tcpopen(<span class="arg">address</span>)</span>
</div>
<div class="param">
<span class="arg">address</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Opens a TCP connection to <span class="arg">address</span> and
returns the associated file descriptor.
<span class="arg">Address</span> is a string of the form
<tt>"<em>addr</em>:<em>port</em>"</tt>, where
<span class="arg">addr</span> is an IP address or hostname and
<span class="arg">port</span> is a port number or service
name.
</div>
</div>

<div class="docitem" id="fn:tcplisten">
<div class="proto">
<div class="function">
<span class="id">tcplisten(<span class="arg">address</span>)</span>
</div>
<div class="param">
<span class="arg">address</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Starts a TCP listener on <span class="arg">address</span> and
returns the associated file descriptor.
<span class="arg">Address</span> is a string of the form
<tt>"<em>addr</em>:<em>port</em>"</tt>, where
<span class="arg">addr</span> is an IP address or hostname and
<span class="arg">port</span> is a port number or service
name.
</div>
</div>

<div class="docitem" id="fn:tcpaccept">
<div class="proto">
<div class="function">
<span class="id">tcpaccept(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Accepts an incoming connection on the TCP listener associated
with <span class="arg">fd</span> (returned by 
<span class="fnindex"><a href="#fn:tcplisten">tcplisten</a></span>)
and returns a file descriptor for the new connection.
If no connection is waiting, the call blocks until one arrives.
</div>
</div>

<div class="docitem" id="fn:getpeername">
<div class="proto">
<div class="function">
<span class="id">getpeername(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the result of calling the
system <span class="id">getpeername</span> call on the
TCP connection associated with <span class="arg">fd</span>.
The return value is the string of raw bytes of the system socket address. 
</div>
</div>

<div class="docitem" id="fn:getsockname">
<div class="proto">
<div class="function">
<span class="id">getsockname(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the result of calling the
system <span class="id">getsockname</span> call on the
TCP connection associated with <span class="arg">fd</span>.
The return value is the string of raw bytes of the system socket address. 
</div>
</div>


<div class="docitem" id="fn:read">
<div class="proto">
<div class="function">
<span class="id">read(<span class="arg">fd</span>,<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Reads at most <span class="arg">len</span> bytes from the I/O
resource associated with <span class="arg">fd</span>.  The
call blocks until <span class="arg">len</span> bytes are
read or end of file is encountered.  Returns a string
containing the bytes read, or <tt>nil</tt> if end of
file was encountered and no bytes were read.
</div>
</div>

<div class="docitem" id="fn:write">
<div class="proto">
<div class="function">
<span class="id">write(<span class="arg">fd</span>,<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Writes the bytes contained in the string
<span class="arg">str</span> to the I/O resource associated
with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:close">
<div class="proto">
<div class="function">
<span class="id">close(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Closes the I/O resource associated with <span
class="arg">fd</span>.  Any pending buffered output is
written.  A call to <span class="id">close</span> on an
already closed descriptor has no effect.  A call to
<span class="id">read</span> or <span
class="id">write</span> on a closed descriptor draws an
error.
</div>
</div>

<div class="docitem" id="fn:seek">
<div class="proto">
<div class="function">
<span class="id">seek(<span class="arg">fd</span>, <span class="arg">offset</span>, <span class="arg">whence</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">offset</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">whence</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Invokes a system-level file seek operation (<span class="id">lseek</span>) on
the I/O resource associated
with <span class="arg">fd</span>.  The integer values
of <span class="arg">offset</span>
and <span class="arg">whence</span> are passed
unmodified to the seek; the caller is expected to know
how to use them.  Returns the value returned by the seek.
</div>
</div>

<div class="docitem" id="fn:ioctl">
<div class="proto">
<div class="function">
<span class="id">ioctl(<span class="arg">fd</span>, <span class="arg">offset</span>, <span class="arg">whence</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">req</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">dat</span>: <span class="type">cvalue or string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Invokes a system-level <span class="id">ioctl</span> operation
on the I/O resource associated
with <span class="arg">fd</span>.  The integer value
of <span class="arg">req</span> is passed unmodified.
If <span class="arg">dat</span> is a cvalue, its integer value is passed unmodified; otherwise a pointer to the contents of the string is passed.
The caller is expected to know how to use these arguments.
Returns the value returned by <span class="id">ioctl</span>.
</div>
</div>

<div class="docitem" id="fn:select">
<div class="proto">
<div class="function">
<span class="id">select(<span class="arg">rfds</span>, <span class="arg">wfds</span>, <span class="arg">efds</span>[, <span class="arg">timeout</span>])</span>
</div>
<div class="param">
<span class="arg">rfds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">wfds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">efds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">timeout</span>: <span class="type">list of cvalues</span>
</div>
<div class="returns">
<span class="type">list of lists of file descriptors</span>
</div>
</div>
<div class="desc">
Checks the status of the system-level file descriptors underlying the
file descriptors in <span class="arg">rfds</span>,
<span class="arg">wfds</span>, and
<span class="arg">efds</span> for ready-to-read,
ready-to-write, or pending exception, respectively.
Returns three fresh lists each containing,
respectively, the selected file descriptors
from <span class="arg">rfds</span>,
<span class="arg">wfds</span>, and
<span class="arg">efds</span>.  If
provided, <span class="arg">timeout</span> must be a
list of two cvalues &mdash; time in seconds and additional time
in microseconds &mdash;
specifying a period of time after which, if no descriptors are
otherwise ready, the call
to <span class="id">select</span> returns.
If <span class="arg">timeout</span> is not
provided, the call blocks until at least one descriptor becomes ready.
</div>
</div>


<div class="docitem" id="fn:fdname">
<div class="proto">
<div class="function">
<span class="id">fdname(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name of the I/O resource associated with <span
class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:mkfd">
<div class="proto">
<div class="function">
<span class="id">mkfd(<span class="arg">read</span>,<span class="arg">write</span>,<span class="arg">close</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">read</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">write</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">close</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">fd</span>
</div>
</div>

<div class="desc">
Returns a new file descriptor whose I/O semantics
are implemented by the functions <span class="arg">read</span>
and <span class="arg">write</span>.
</div>

<div class="desc">
<span class="arg">Read</span>
must be a function of one argument,
a cvalue <span class="arg">length</span>.
It is called to read data from the file descriptor;
it must return a string of length no greater than
<span class="arg">length</span>.
</div>

<div class="desc">
<span class="arg">Write</span>
must be a function of one argument,
a string <span class="arg">buf</span>.
It is called to write data to the file descriptor.
The system interprets a return value other than <span class="id">nil</span>
to signify an I/O error.
</div>

<div class="desc">
When the file descriptor is explicitly closed (by a call
to <span class="id">close</span>), the function
<span class="arg">close</span> is called with zero arguments.
Its return value is ignored.
Subsequent calls to <span class="id">close</span>
are ignored.
<span class="arg">Close</span> is <em>not</em>
called impliclity when the file descriptor storage is reclaimed;
use a finalizer to arrange the <span class="arg">close</span> call.
</div>

<div class="desc">
If <span class="arg">read</span> is <span class="id">nil</span>
then an attempt to read the resulting file descriptor draws an error;
similarly if <span class="arg">write</span> is <span class="id">nil</span>
the the file descriptor cannot be written.  
If <span class="arg">close</span> is <span class="id">nil</span>,
attempts to close operations are silently ignored.
</div>

<div class="desc">
If specified, <span class="arg">name</span> is the string
returned by <span class="id">fdname</span>; otherwise 
<span class="id">fdname</span> returns the empty string.
</div>
</div>


<h4 id="sec:fs">Filesystem Functions</h4>

<p>
This section documents functions that operate on the file system.
</p>

<div class="docitem" id="fn:access">
<div class="proto">
<div class="function">
<span class="id">access(<span class="arg">filename</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">

Evaluates <span class="arg">filename</span> for accessibility.
<span class="arg">Mode</span> is one or more (concatenated)
access mode specifications:
read permission
(<span class="val">"r"</span>),
write permission
(<span class="val">"w"</span>),
execute permission,
(<span class="val">"x"</span>),
and mere existence
(<span class="val">"f"</span>).
Returns
<span class="val">1</span>
if all specified modes are permitted,
otherwise
<span class="val">0</span>.
</div>
</div>

<div class="docitem" id="fn:mkdir">
<div class="proto">
<div class="function">
<span class="id">mkdir(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Creates a new directory named <span class="arg">name</span>.
</div>
</div>

<div class="docitem" id="fn:rmdir">
<div class="proto">
<div class="function">
<span class="id">rmdir(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Removes the directory named <span class="arg">name</span>.
</div>
</div>

<div class="docitem" id="fn:unlink">
<div class="proto">
<div class="function">
<span class="id">unlink(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Removes the file named <span class="arg">name</span>.
</div>
</div>


<h4 id="sec:fmt">Formatted Output</h4>

<p>
Cinquecento provides several functions for C-style
formatted output to various destinations.
</p>

<p>

Each function expects a format string argument.  The
format string may include conversion specifications
that are similar (but not identical) to those handled
by C stdio library functions.  Each conversion
specification begins with
the <span class="val">%</span> character, optionally
followed by zero or more modifiers characters,
optionally followed by a decimal width specifier, optionally
followed by the <span class="val">.</span> character
and a decimal precision specifier, finally followed by a single
verb character.  The accepted modifier characters are
<span class="val">+</span>, <span class="val">-</span>, <span class="val">0</span>,
<span class="val">#</span>, and a single space.  The
modifier characters and the width and precision
specifiers have the same effects they have in C.  In
addition, the
modifiers <span class="val">l</span>, <span class="val">L</span>, <span class="val">h</span>
are accepted but have no effect; unlike the C stdio
formatter, Cinquecento can determine the size of an
integer operand from its type.
</p>

<p>
The conversions are processed in order; each
operates in turn on the remaining values passed to the
format function.
</p>

<p>
The recognized verb characters are:
</p>

<div class="table">
<table>

<tr>
<td><span class="val">a</span></td>
<td>
Formats any type of value in an implementation-defined
format.
</td>
</tr>

<tr>
<td><span class="val">c</span></td>
<td>
Formats a character value as an ASCII character (if printable)
or in octal.
</td>
</tr>

<tr>
<td><span class="val">d,o,x,X,u</span></td>
<td>
Formats an integer or pointer value in signed decimal,
octal, lowercase hex, uppercase hex, or unsigned
decimal.
</td>
</tr>

<tr>
<td><span class="val">e</span></td>
<td>

Formats a value of an enumerated type as the name of a
constant having the same value.  If more than one
constant has the same value, one constant is picked in
an undefined manner.  If no constant has the value, the
value is formatted as if the <span class="val">d</span>
verb had been used.
</td>
</tr>

<tr>
<td><span class="val">p</span></td>
<td>
Formats a pointer value in lowercase hex.
</td>
</tr>

<tr>
<td><span class="val">s,b,B</span></td>
<td>
Formats strings.
If the value is not a string, then the result of calling <span class="id"><a
href="#fn:stringof">stringof</a></span> on the value is used.
<div>
<span class="val">s</span> copies the string value, stopping at the first null byte.
</div>
<div>
<span class="val">b</span> is like <span class="val">s</span>, except the entire
string is printed, including null bytes.
</div>
<div>
<span class="val">B</span> is like <span class="val">b</span>, except unprintable
characters are formatted as octal literals and " and \ are escaped.
</div>
</td>
</tr>

<tr>
<td>
<span class="val">t</span>
</td>
<td>
Formats a ctype.  The value may be in one of two forms:
(1) a ctype, in which case it is formatted as a
conventional C type specification, or (2) a vector,
representing a C symbol, of the form <span
class="val">[ <span class="arg">T</span>, <span
class="arg">ID</span>, ... ]</span>, where <span
class="arg">T</span> is a ctype and <span
class="arg">ID</span> is a string or <span
class="val">nil</span>, in which case the symbol is
formatted as conventional (possibly abstract) C
declaration.
</td>
</tr>

<tr>
<td>
<span class="val">y</span>
</td>
<td>
Formats an integer or pointer value as <span
class="val">"<span class="arg">symbol</span>+<span
class="arg">offset</span>"</span>.
<span class="arg">Symbol</span> is the name of the symbol returned
by a call to the name space <span class="arg"><a
href="#fn:lookaddr">lookaddr</a></span> operation on
the value.  <span class="arg">Offset</span> is the
difference between the value and the location of the symbol returned by
<span class="arg">lookaddr</span>.  If the difference
is zero, the offset is suppressed.
</td>
</tr>
</table>
</div>

<p>
The formatted output functions are:
</p>

<div class="docitem" id="fn:printf">
<div class="proto">
<div class="function">
<span class="id">printf(<span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sends formatted output to the current standard output.
</div>
</div>

<div class="docitem" id="fn:fprintf">
<div class="proto">
<div class="function">
<span class="id">fprintf(<span class="arg">fd</span>, <span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sends formatted output to I/O resource associated with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:sprintfa">
<div class="proto">
<div class="function">
<span class="id">sprintfa(<span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a new string containing formatted output.
</div>
</div>



<h4 id="sec:system">System Functions</h4>

<p>
This section documents various system-level functions.
</p>


<div class="docitem" id="fn:exit">
<div class="proto">
<div class="function">
<span class="id">exit(<span class="arg">status</span>)</span>
</div>
<div class="param">
<span class="arg">status</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
Causes the Cinquecento evaluator to exit with status <span class="arg">status</span>.
</div>
</div>


<div class="docitem" id="fn:getpid">
<div class="proto">
<div class="function">
<span class="id">getpid()</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the process identifier of the process in which
the Cinquecento system is running.
</div>
</div>

<div class="docitem" id="fn:gettimeofday">
<div class="proto">
<div class="function">
<span class="id">gettimeofday()</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the current time in microseconds.
</div>
</div>

<div class="docitem" id="fn:getenv">
<div class="proto">
<div class="function">
<span class="id">getenv(var)</span>
</div>
<div class="param">
<span class="arg">var</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">string or nil</span>
</div>
</div>
<div class="desc">
Returns the value associated with the variable <span class="arg">var</span>
in the environment of the calling process, or <span class="val">nil</span>
if the variable is undefined.
</div>
</div>


<div class="docitem" id="fn:uname">
<div class="proto">
<div class="function">
<span class="id">uname()</span>
</div>
<div class="returns">
<span class="type">list of strings</span>
</div>
</div>
<div class="desc">
Returns the system "uname" information as list of four
strings: operating system name, operating system
release, operating system version, and hardware
identifier.
</div>
</div>


<div class="docitem" id="fn:loadpath">
<div class="proto">
<div class="function">
<span class="id">loadpath()</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns the current load path as a list of strings.
</div>
</div>

<div class="docitem" id="fn:setloadpath">
<div class="proto">
<div class="function">
<span class="id">setloadpath(l)</span>
</div>
<div class="param">
<span class="arg">l</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the current load path to the list of strings <span class="arg">l</span>.
</div>
</div>


<div class="docitem" id="fn:backtrace">
<div class="proto">
<div class="function">
<span class="id">backtrace()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Prints to the current standard output a formatted
snapshot of the Cinquecento call stack.
</div>
</div>

<div class="docitem" id="fn:rand">
<div class="proto">
<div class="function">
<span class="id">rand(<span class="arg">max</span>)</span>
</div>
<div class="param">
<span class="arg">max</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns a random integer in the range [0...<span
class="arg">max</span>).  It is an error if <span
class="arg">max</span> exceeds the
implementation-defined maximum random number.
</div>
</div>

<div class="docitem" id="fn:randseed">
<div class="proto">
<div class="function">
<span class="id">randseed(<span class="arg">seed</span>)</span>
</div>
<div class="param">
<span class="arg">seed</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Seeds the random number generator used by <span class="id">rand</span>.
</div>
</div>

<div class="docitem" id="fn:resettop">
<div class="proto">
<div class="function">
<span class="id">resettop()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Resets the top-level environment to the initial
bindings established when the Cinquecento evaluator is
started.  All user-defined bindings are destroyed.
</div>
</div>


<div class="docitem" id="fn:finalize">
<div class="proto">
<div class="function">
<span class="id">finalize(v, fn)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function or nil</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">

Registers a finalizer function to be called before the
garbage collector reclaims storage for the
value <span class="arg">v</span>.  The GC schedules a
call to the finalizer <span class="arg">fn</span> some
time after determining that <span class="arg">v</span>
is unreachable.  The sole argument passed
to <span class="arg">fn</span>
is <span class="arg">v</span>.

<p>
At the time it is passed to the finalizer, the
value <span class="arg">v</span> is unreachable but
otherwise has no special status.  In particular, the
finalizer may reintroduce references to the value,
e.g. by storing it in a hash table.  The finalizer will
not be called again for such a reincarnated value;
a new call to <span class="id">finalize</span>
must be arranged.
</p>

<p>
Only one finalizer can be associated with a value at
a time; <span class="id">finalize</span> replaces
the previously registered finalizer, if any.
To disassociate a finalizer from a value <span class="arg">v</span>,
call <span class="id">finalize(<span class="arg">v</span>, nil)</span>.
</p>

<p>
When shutting down the last VM (via 
<span class="fnindex"><a href="#fn:cqctfreevm">cqctfreevm</a></span>),
the Cinquecento system performs a final garbage
collection and calls finalizers for unreachable values.
However, finalizers for objects that are still reachable
at shutdown may not be called.
</p>

</div>
</div>

<h4 id="sec:other">Other Functions</h4>

<p>
This section documents various other functions.
</p>

<div class="docitem" id="fn:eval">
<div class="proto">
<div class="function">
<span class="id">eval(<span class="arg">expr</span>)</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">eval</span> evaluates the Cinquecento
expression contained in the
string <span class="arg">expr</span> and returns the
computed value.  The evaluation occurs in the top-level
environment of the caller.
</div>
</div>


<div class="docitem" id="fn:inflate">
<div class="proto">
<div class="function">
<span class="id">inflate(<span class="arg">buf</span>)</span>
</div>
<div class="function">
<span class="id">inflatezlib(<span class="arg">buf</span>)</span>
</div>
<div class="param">
<span class="arg">buf</span>: <span class="type">string</span> or <span class="type">cvalue</span> of type <span class="type">char*</span> or <span class="type">unsigned char*</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
<span class="id">inflate</span> decompresses the
contents of the string represented
by <span class="arg">buf</span> using the deflate
compression algorithm (which is used for gzip, zip, and
zlib files).  <span class="id">inflatezlib</span> is
like <span class="id">inflate</span>, but operates on
strings with a zlib header and trailer.
</div>
</div>


<h4 id="sec:stdlib">Standard Libraries</h4>

<p>
The L1 implementation of Cinquecento comes with several 
standard libraries stored
in the lib/ subdirectory. Since they are included in
l1's load path, these libraries are loaded via the command:
</p>
<div class="code">
@include &lt;<span class="arg">library</span>&gt;<br />
</div>

<p>
This section gives non-exhaustive describions 
for several of the provided libraries.
</p>

<h5 id="lib:asutil.cqct">asutil.cqct</h5>

<span class="id">asutil.cqct</span> provides code for 
loading, saving, and copying address spaces. 

<div class="docitem" id="fn:asload">
<div class="proto">
<div class="function">
<span class="id">asload(<span class="arg">filename</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span> 
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Loads the address space saved to the file 
in <span class="arg">filename</span>.
</div>
</div>

<div class="docitem" id="fn:asload_str">
<div class="proto">
<div class="function">
<span class="id">asload_str(<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span> 
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Loads the address space saved in the string
<span class="arg">str</span>.
</div>
</div>

<div class="docitem" id="fn:assave">
<div class="proto">
<div class="function">
<span class="id">assave(<span class="arg">as</span>,
			<span class="arg">filename</span>)</span>
</div>
<div class="param">
<span class="arg">as</span>: <span class="type">address space</span> 
<span class="arg">filename</span>: <span class="type">string</span> 
</div>
<div class="returns">
<span class="type">undefined</span>
</div>
</div>
<div class="desc">
Saves the address space 
<span class="arg">as</span>
to the file <span class="arg">filename</span>.
</div>
</div>

<div class="docitem" id="fn:assave_str">
<div class="proto">
<div class="function">
<span class="id">assave_str(<span class="arg">as</span>)</span>
</div>
<div class="param">
<span class="arg">as</span>: <span class="type">address space</span> 
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Saves the address space 
<span class="arg">as</span> to a string, and returns that string.
</div>
</div>

<div class="docitem" id="fn:ascopy">
<div class="proto">
<div class="function">
<span class="id">ascopy(<span class="arg">as</span>)</span>
</div>
<div class="param">
<span class="arg">as</span>: <span class="type">address space</span> 
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Creates a copy of the address space <span class="arg">as</span>, 
and returns the copy. No changes to the returned address space
affect the passed address space.
</div>
</div>

<h5 id="lib:dump.cqct">dump.cqct</h5>

<span class="id">dump.cqct</span> provides code for printing
out namespaces and the values associated with typed pointers.

<div class="docitem" id="fn:printtype">
<div class="proto">
<div class="function">
<span class="id">printtype(<span class="arg">t</span>)</span>
</div>
<div class="param">
<span class="arg">t</span>: <span class="type">ctype</span> 
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string representation
of the provided ctype that can be included inside a @names directive. 
</div>
</div>

<div class="docitem" id="fn:dumpns">
<div class="proto">
<div class="function">
<span class="id">dumpns(<span class="arg">dn</span>)</span>
</div>
<div class="param">
<span class="arg">dn</span>: 
Domain or name space to be printed.
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Prints all types in the given domain or name space to standard out.
</div>
</div>

<div class="docitem" id="fn:objectStr">
<div class="proto">
<div class="function">
<span class="id">objectStr(<span class="arg">x</span>)</span>
</div>
<div class="param">
<span class="arg">x</span>: 
Pointer to a cvalue. 
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Pretty-prints the object pointed to by x based on x's ctype to
a string, and returns that string.
</div>
</div>

<h5 id="lib:dynamictypes.cqct">dynamictypes.cqct</h5>

This file provides the ability to create dynamic types, or types
that change based on their content. For example, consider the following
vector type:
<div class="code">
<pre>
struct Vector {
        unsigned int size;
        int data[];
};
</pre>
</div>
The data pointer is actually an array of length size.
With dynamic typing, one can specify types such that a pointer
<span class="id">p</span> pointing to an object of type 
<span class="id">Vector</span> can be translated into the appropriate
type using the <span class="id">refine</span> function. In this case,
that type will be:
<div class="code">
<pre>
stuct Vector {
        unsigned int size;
	int data[p->size];
};
</pre>
</div>

The basic idea is for the person defining the type to include an 
extra mapping in fields for the
keyword "refine", which specifies a function for performing the
transformation. Then for a pointer to an object p, one can call
refine(p) to create a pointer that points to the refined version
of the type of p.

For a complete example, see the <span class="function">example</span>
function in the file <span class="id">dynamictypes.cqct</span>.

<div class="docitem" id="fn:refine">
<div class="proto">
<div class="function">
<span class="id">refine(<span class="arg">p</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: 
A cvalue pointer. 
</div>
<div class="returns">
<span class="type">A cvalue pointer.</span>
</div>
</div>
<div class="desc">
Returns a pointer to the same address as is pointed to by 
<span class="arg">p</span>, but points to a refined version of
<span class="arg">p</span>'s type. The newly refined type inherits
any refinement properties from the old type so that further calls
to refine will behave as expected. If 
any part of the object <span class="arg">p</span> points to is
unmapped, or if any part of the refined structure <span class="arg">p</span>
would have pointed to on return is unmapped, then no changes are made.
</div>
</div>



<h4 id="sec:cinterface">C Interface</h4>

<p>
The following functions comprise the C interface to the
L1 implementation of Cinquecento.  The interface is defined in 
<span class="val">cqct.h</span>.
For an example of
how to use the interface, see the file <span
class="val">main.c</span> in the L1 implementation, which
implements a simple Cinquecento read-eval-print loop.
The functions are described below in the general order in
which they would be called.
</p>

<p>
The interface operates on values of several opaque
types.
</p>

<div class="table">
<table>
<tr>
<td><span class="id">Toplevel</span></td>
<td>Toplevel environment</td>
</tr>
<tr>
<td><span class="id">Val</span></td>
<td>Cinquecento value</td>
</tr>
<tr>
<td><span class="id">VM</span></td>
<td>Virtual machine for evaluating compiled Cinquecento expression</td>
</tr>
<tr>
<td><span class="id">Xfd</span></td>
<td>File descriptor interface</td>
</tr>
</table>
</div>

<p>
A <span class="id">Val</span> is pointer to a structure
whose fields generally should not be examined, except for one field,
<span class="id">qkind</span>, which specifies the
Cinquecento type of the object:
</p>

<div class="code">
<pre>
typedef
enum {
	Qundef = 0,	/* the undefined value */
	Qnil,		/* the nil value */
	Qnull,		/* the null value (unused) */
	Qas,		/* address space */
	Qbox,		/* box (private) */
	Qcl,		/* closure */
	Qcode,		/* code object (private) */
	Qcval,		/* cvalue */
	Qdom,		/* domain */
	Qfd,		/* file descriptor */
	Qlist,		/* list */
	Qns,		/* name space */
	Qpair,		/* pair (unused) */
	Qrange,		/* range */
	Qrd,		/* record descriptor */
	Qrec,		/* record */
	Qstr,		/* string */
	Qtab,		/* table */
	Qvec,		/* vector */
	Qxtn,		/* ctype */
	Qnkind		/* invalid (# of kinds) */
} Qkind;

struct Head {
	Qkind qkind;	/* kind of object */
	/* ... */
};

typedef struct Head* Val;
</pre>
</div>


<p>
Callers of the C interface may use the 
<span class="val">qkind</span> field to determine the
type of a Cinquecento value.
Some of the following
routines expect their <span class="val">Val</span>
arguments to be of a particular kind.
</p>

<p>
A <span class="id">Xfd</span> is a structure whose
fields define an interface to an open file descriptor.
The Cinquecento initializer,
<span class="id"><a href="#fn:cqctinit">cqctinit</a></span> uses its <span class="id">Xfd</span>
parameter to override the default destination of
standard I/O.
</p>

<div class="code">
<pre>
typedef struct Xfd Xfd;
struct Xfd {
	uint64_t (*read)(Xfd*, char*, uint64_t);
	uint64_t (*write)(Xfd*, char*, uint64_t);
	void (*close)(Xfd*);
	int fd;
};
</pre>
</div>

<p>
Each function is passed the <span class="id">xfd</span>
from which it was referenced.

The <span class="id">fd</span> is a convenience for the user;
the system does not use its value.

The other arguments to <span class="id">read</span>
and <span class="id">write</span> are a pointer to the
data buffer and the number of bytes to be transferred;
these functions should return the number of bytes
actually transferred or <span class="id">(uint64_t)-1</span> on error.

The function <span class="id">close</span>
is called when the system decides to close the file descriptor.

Any of the functions in an
<span class="id">Xfd</span> may be <span class="id">NULL</span>;
if the system needs to call a <span class="id">NULL</span> function, it becomes a no-op.
</p>

<div class="docitem" id="fn:cqctinit">
<div class="proto">
<div class="function">
<span class="id">Toplevel* cqctinit(int <span class="arg">gcthread</span>, uint64_t <span class="arg">heapmax</span>,
char **<span class="arg">loadpath</span>, 
Xfd *<span class="arg">in</span>, 
Xfd *<span class="arg">out</span>, 
Xfd *<span class="arg">err</span>)</span>
</div>
</div>
<div class="desc">
This function must be called first.  It allocates
and returns an initialized Cinquecento top-level environment
containing bindings for all built-in functions and
other values.  It also initializes the Cinquecento
storage manager.  If <span class="arg">gcthread</span>
is non-zero, the garbage collector runs in a separate
thread.  If <span class="arg">heapmax</span> is
non-zero, the memory allocator restricts the heap size
to <span class="arg">heapmax</span> megabytes.
If <span class="arg">loadpath</span> is non-NULL,
it is the vector of directories in which the
the @include &lt;<span class="arg">filename</span>>
form searches for <span class="arg">filename</span>; its final element must be NULL.
If <span class="arg">in</span> is non-NULL,
it specifies the input file to which the
the Cinquecento <span class="id">stdin</span> file descriptor
is bound; otherwise its default value is the standard input of the host
process.
Similarly, <span class="arg">out</span>
and <span class="arg">err</span>
specify the Cinquecento <span class="id">stdout</span>
and <span class="id">stderr</span> descriptors,
which are otherwise default to standard output and error.
</div>
</div>

<div class="docitem" id="fn:cqctfaulthook">
<div class="proto">
<div class="function">
<span class="id">int cqctfaulthook(void (*<span class="arg">fn</span>)(void), int <span class="arg">in</span>)</span>
</div>
</div>
<div class="desc">
In the event of a non-recoverable error in the
Cinquecento system, functions previously registered by
this interface are called in reverse order of their registration.
When <span class="arg">in</span> is non-zero, this
function registers <span class="arg">fn</span>;
when <span class="arg">in</span> is
zero, <span class="arg">fn</span> is unregistered.  At
most 4 functions can be registered.  When a
non-recoverable error occurs, if no functions are
registered, or if each registered function returns, the
system stops executing in an unspecified manner.
Programs wishing to regain control should register a
function that performs a non-local escape.
<span class="id">Cqctfaulthook</span> returns non-zero
if there an error occurs during (un)registration.
</div>
</div>


<div class="docitem" id="fn:cqctmkvm">
<div class="proto">
<div class="function">
<span class="id">VM* cqctmkvm(Toplevel *<span class="arg">top</span>)</span>
</div>
</div>
<div class="desc">
Returns a new Cinquecento evaluator initialized with
the top-level environment bound
to <span class="arg">top</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcompile">Val cqctcompile(char *<span class="arg">expr</span>,
char *<span class="arg">src</span>,
Toplevel *<span class="arg">top</span>,
char *<span class="arg">argsid</span>)</span>
</div>
</div>
<div class="desc">
Compiles Cinquecento code in the string
<span class="arg">expr</span> and returns a function
that, when called, executes the code.
If <span class="arg">argsid</span> is null, the returned
function takes no arguments; otherwise it is a variable arity
function whose argument list is bound to a parameter
whose name is the string pointed to <span class="arg">argsid</span>.
If <span class="arg">src</span> is non-zero, it will
be printed during error formatting as a location
identifier for <span class="arg">str</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcallfn">int cqctcallfn(VM *<span class="arg">vm</span>, Val <span class="arg">fn</span>, int <span class="arg">argc</span>, Val *<span class="arg">argv</span>, Val *<span class="arg">rv</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctcallthunk">int cqctcallthunk(VM *<span class="arg">vm</span>, Val <span class="arg">thunk</span>, Val *<span class="arg">rv</span>)</span>
</div>
</div>

<div class="desc">

<span class="id">Cqctcallfn</span> calls <span class="arg">fn</span>,
passing the <span class="arg">argc</span> arguments stored in the
array <span class="arg">argv</span>.  On success, the value returned
by <span class="arg">fn</span> is stored in the value pointed to by
<span class="arg">rv</span> and the call returns <span
class="val">0</span>.  If an error occurs, the call returns <span
class="val">-1</span>.

</div>

<div class="desc">
<span class="id">Cqctcallthunk</span> calls <span
class="arg">thunk</span>.  On success, the value returned by <span
class="arg">thunk</span> is stored in the value pointed to by <span
class="arg">rv</span> and the call returns <span class="val">0</span>.
If an error occurs, the call returns <span class="val">-1</span>.
</div>

</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqcteval">int cqcteval(VM *<span class="arg">vm</span>, char *<span class="arg">str</span>, char *<span class="arg">whence</span>, Val *<span class="arg">rv</span>)</span>
</div>
</div>

<div class="desc">
<span class="id">Cqcteval</span> composes
<span class="id">cqctparsestr</span>,
<span class="id">cqctcompile</span>, and
<span class="id">cqctcallthunk</span>.
The Cinquecento expression <span class="arg">str</span> is parsed, compiled, and executed.
On success, the value of the expression
is stored in the value pointed to by
<span class="arg">rv</span> and the call returns <span class="val">0</span>.
If an error occurs, the call returns <span class="val">-1</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctsprintval">char* cqctsprintval(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Prints the value <span class="arg">v</span> into a freshly allocated C string;
the
caller is responsible for freeing the returned string
with <span class="fnindex"><a href="#fn:cqctfreecstr">cqctfreecstr</a></span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcbase">Cbase cqctvalcbase(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns the name of the base C type of the cvalue
<span class="arg">v</span>.  The result is undefined
if <span class="arg">v</span> is not a cvalue.
The enumerated type <span class="id">Cbase</span> defines
the type names used by the system:
<div class="code">
<pre>
typedef
enum Cbase {
	Vundef=0,
	Vchar,
	Vshort,
	Vint,
	Vlong,
	Vvlong,
	Vuchar,
	Vushort,
	Vuint,
	Vulong,
	Vuvlong,
	Vfloat,
	Vdouble,
	Vlongdouble,
	Vnbase,
	Vptr = Vnbase,
	Vvoid,
	Vnallbase,
} Cbase;
</pre>
</div>
Only names in the range <span class="id">Vchar</span> ... <span class="id">Vlongdouble</span> will be returned by <span class="id">cqctvalcbase</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctint8val">Val cqctint8val(int8_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint16val">Val cqctint16val(int16_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint32val">Val cqctint32val(int32_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint64val">Val cqctint64val(int64_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint8val">Val cqctuint8val(uint8_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint16val">Val cqctuint16val(uint16_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint32val">Val cqctuint32val(uint32_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint64val">Val cqctuint64val(uint64_t <span class="arg">x</span>)</span>
</div>
</div>
<div class="desc">
These functions construct and return a Cinquecento literal cvalue
of the indicated type from <span class="arg">x</span>.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalint8">int8_t cqctvalint8(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint16">int16_t cqctvalint16(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint32">int32_t cqctvalint32(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint64">int64_t cqctvalint64(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint8">uint8_t cqctvaluint8(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint16">uint16_t cqctvaluint16(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint32">uint32_t cqctvaluint32(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint64">uint64_t cqctvaluint64(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
These functions convert the
value <span class="arg">v</span> to a C integer of the
indicated type.  The result is undefined
if <span class="arg">v</span> is not a cvalue.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrval">Val cqctcstrval(char *<span class="arg">s</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that is a
copy of the null-terminated C string <span class="arg">s</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrnval">Val cqctcstrnval(char *<span class="arg">s</span>, uint64_t <span class="arg">len</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string by copying <span class="arg">len</span> bytes starting at <span class="arg">s</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrvalshared">Val cqctcstrvalshared(char *<span class="arg">s</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that
shares storage with the null-terminated C string <span class="arg">s</span>.
Responsibility for the storage remains with the caller.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrnvalshared">Val cqctcstrnvalshared(char *<span class="arg">s</span>, uint64_t <span class="arg">len</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that shares the <span class="arg">len</span> bytes of storage starting at <span class="arg">s</span>.
Responsibility for the storage remains with the caller.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstr">char* cqctvalcstr(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Copies the Cinquecento string <span class="arg">v</span> to a C
string.  The result is undefined
if <span class="arg">v</span> is not a string.  The
caller is responsible for freeing the returned string
with <span class="fnindex"><a href="#fn:cqctfreecstr">cqctfreecstr</a></span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstrshared">char* cqctvalcstrshared(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the underlying contiguous storage
of the string <span class="arg">v</span>, if possible.
The storage is shared with the Cinquecento string
object; callers should arrange to protect this object
from garbage collection when appropriate.  The result
is zero if <span class="arg">v</span> is a string whose
storage cannot be represented by a single pointer (call 
<span class="fnindex"><a href="#fn:cqctvalcstr">cqctvalcstr</a></span>
instead), and undefined if <span class="arg">v</span> is not a
string.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstrlen">uint64_t cqctvalcstrlen(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns the number of bytes in the string <span class="arg">v</span>.
The result is undefined if <span class="arg">v</span> is not a string.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlength">uint64_t cqctlength(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
If <span class="arg">v</span> is a container object, returns the number of elements
in the container; it is equivalent to the built-in function <span class="id"><a href="#fn:length">length</a></span>.
The result is undefined if <span class="arg">v</span> is not a container.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlistvals">Val* cqctlistvals(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the array of <span class="id">Val</span>s in
the list <span class="arg">v</span>.
The number of elements in the array is the length returned by
<span class="id"><a href="#fn:cqctlength">cqctlength</a></span>.
The result is undefined if <span class="arg">v</span> is not a list.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvecvals">Val* cqctvecvals(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the array of <span class="id">Val</span>s in
the vector <span class="arg">v</span>.
The number of elements in the array is the length returned by
<span class="id"><a href="#fn:cqctlength">cqctlength</a></span>.
The result is undefined if <span class="arg">v</span> is not a vector.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctmkfd">Val cqctmkfd(Xfd *<span class="arg">Xfd</span>,
char *<span class="arg">name</span>);</span>
</div>
</div>
<div class="desc">
This function is a C wrapper for
<span class="fnindex"><a href="#fn:mkfd">mkfd</a></span>.
Returns a Cinquecento file descriptor value backed by the C functions
defined in <span class="arg">xfd</span>.
The first argument passed to each of the <span class="arg">xfd</span> functions will be a <em>copy</em> of <span class="arg">xfd</span>.
If <span class="arg">name</span> is <span class="id">NULL</span>,
the file descriptor is unnamed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctenvbind">void cqctenvbind(Toplevel *<span class="arg">top</span>, char *<span class="arg">name</span>,
Val <span class="arg">val</span>);</span>
</div>
</div>
<div class="desc">
Updates (or creates) the binding of <span class="arg">name</span>
in the top-level environment <span class="arg">top</span>
to <span class="arg">val</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctenvlook">Val cqctenvlook(Toplevel *<span class="arg">top</span>, char *<span class="arg">name</span>);</span>
</div>
</div>
<div class="desc">
Returns the value bound to <span class="arg">name</span>
in the top-level environment <span class="arg">top</span>
or <span class="id">NULL</span> if the variable is unbound.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcprotect">void cqctgcprotect(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Protects the value <span class="arg">v</span> from
garbage collection by registering it with the current
GC protection frame of <span class="arg">vm</span>.
References to the value will be valid until after at least
one of the following events: (1) the frame is popped, (2)
<span class="fnindex"><a href="#fn:cqctgcunprotect">cqctgcunprotect</a></span>
is called on the same arguments while the current GC frame is active,
or (3) <span class="arg">vm</span> is freed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcunprotect">void cqctgcunprotect(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Unregister <span class="arg">v</span> from the current GC protection frame
of <span class="arg">vm</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcpersist">void cqctgcpersist(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Protects the value <span class="arg">v</span> from
garbage collection.  
Unlike
values protected by <span class="id"><a href="#fn:cqctgcprotect">cqctgcprotect</a></span>,
the protection persists beyond return from the current GC protection
frame.
References to the value will be valid until
<span class="arg">vm</span> is freed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcunpersist">void cqctgcunpersist(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Remove the protection of <span class="arg">v</span>
established by a previous call to <span class="id"><a href="#fn:cqctgcprotect">cqctgcprotect</a></span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcdisable">void cqctgcdisable(VM *<span class="arg">vm</span>)</span>
</div>
</div>
<div class="desc">
Disable the garbage collector, if it is enabled.  If
the concurrent GC is selected, the underlying GC thread
is killed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcenable">void cqctgcenable(VM *<span class="arg">vm</span>)</span>
</div>
</div>
<div class="desc">
Reenable the garbage collector, if it was previously disabled with
<span class="fnindex"><a href="#fn:cqctgcdisable">cqctgcdisable</a></span>.
If the concurrent GC is selected, a fresh GC thread is started.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctinterrupt">void cqctinterrupt(VM *<span class="arg">vm</span>)</span>
</div>
</div>
<div class="desc">
Interrupt the Cinquecento evaluator <span class="arg">vm</span>,
if it is executing.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctfreecstr">void cqctfreecstr(char *<span class="arg">str</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctfreevm">void cqctfreevm(VM *<span class="arg">vm</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctfini">void cqctfini(Toplevel *<span class="arg">top</span>)</span>
</div>
</div>
<div class="desc">
These functions free the resources allocated by the above functions.
<span class="id">Cqctfreecstr</span> frees a C string returned by
<span class="fnindex"><a href="#fn:cqctval2cstr">cqctval2cstr</a></span>
or <span class="fnindex"><a href="#fn:cqctsprintval">cqctsprintval</a></span>.
<span class="id">Cqctfreevm</span> frees a virtual machine.
<span class="id">Cqctfini</span> frees a top-level
environment, and should be called only after all virtual
machines sharing the environment have been freed.
</div>
</div>

<h4 id="sec:synindex">Syntax Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<table>
<tr>
<td>
<a href="#syn:_emptylist_">[<span class="arg">value</span>, ... ]</a><br />
<a href="#syn:_emptytable_">[<span class="arg">key</span> : <span class="arg">value</span>, ...]</a><br />
<a href="#syn:_at_const">@const</a><br />
<a href="#syn:_at_global">@global</a><br />
<a href="#syn:_at_include">@include</a><br />
<a href="#syn:_at_lazyapply">@lazyapply</a><br />
<a href="#syn:_at_local">@local</a><br />
<a href="#syn:_at_names">@names</a><br />
<a href="#syn:_at_record">@record</a><br />
<a href="#syn:_at_define">@define</a><br />
<a href="#syn:_at_lambda">@lambda</a><br />
<a href="#syn:return">return</a><br />
<a href="#syn:_at_typeof">@typeof</a><br />
</td>
</tr>
</table>
</div>
</div>
</div>

<h4 id="sec:cindex">C Interface Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<table>
<tr>
<td>
<a href="#fn:cqctcallfn">cqctcallfn</a><br />
<a href="#fn:cqctcallthunk">cqctcallthunk</a><br />
<a href="#fn:cqctcompile">cqctcompile</a><br />
<a href="#fn:cqctcstrnval">cqctcstrnval</a><br />
<a href="#fn:cqctcstrnvalshared">cqctcstrnvalshared</a><br />
<a href="#fn:cqctcstrval">cqctcstrval</a><br />
<a href="#fn:cqctcstrvalshared">cqctcstrvalshared</a><br />
<a href="#fn:cqctenvbind">cqctenvbind</a><br />
<a href="#fn:cqctenvlook">cqctenvlook</a><br />
<a href="#fn:cqcteval">cqcteval</a><br />
<a href="#fn:cqctfaulthook">cqctfaulthook</a><br />
</td>
<td>
<a href="#fn:cqctfini">cqctfini</a><br />
<a href="#fn:cqctfreevm">cqctfreevm</a><br />
<a href="#fn:cqctgcpersist">cqctgcpersist</a><br />
<a href="#fn:cqctgcprotect">cqctgcprotect</a><br />
<a href="#fn:cqctgcenable">cqctgcenable</a><br />
<a href="#fn:cqctgcdisable">cqctgcdisable</a><br />
<a href="#fn:cqctgcunpersist">cqctgcunpersist</a><br />
<a href="#fn:cqctgcunprotect">cqctgcunprotect</a><br />
<a href="#fn:cqctinit">cqctinit</a><br />
<a href="#fn:cqctint8val">cqctint8val</a><br />
<a href="#fn:cqctint16val">cqctint16val</a><br />
<a href="#fn:cqctint32val">cqctint32val</a><br />
<a href="#fn:cqctint64val">cqctint64val</a><br />

</td>
<td>
<a href="#fn:cqctinterrupt">cqctinterrupt</a><br />
<a href="#fn:cqctlength">cqctlength</a><br />
<a href="#fn:cqctlistvals">cqctlistvals</a><br />
<a href="#fn:cqctmkfd">cqctmkfd</a><br />
<a href="#fn:cqctmkvm">cqctmkvm</a><br />
<a href="#fn:cqctsprintval">cqctsprintval</a><br />
<a href="#fn:cqctuint8val">cqctuint8val</a><br />
<a href="#fn:cqctuint16val">cqctuint16val</a><br />
<a href="#fn:cqctuint32val">cqctuint32val</a><br />
<a href="#fn:cqctuint64val">cqctuint64val</a><br />
<a href="#fn:cqctvalcbase">cqctvalcbase</a><br />
<a href="#fn:cqctvalcstr">cqctvalcstr</a><br />
</td>
<td>
<a href="#fn:cqctvalcstrlen">cqctvalcstrlen</a><br />
<a href="#fn:cqctvalcstrshared">cqctvalcstrshared</a><br />
<a href="#fn:cqctvalint8">cqctvalint8</a><br />
<a href="#fn:cqctvalint16">cqctvalint16</a><br />
<a href="#fn:cqctvalint32">cqctvalint32</a><br />
<a href="#fn:cqctvalint64">cqctvalint64</a><br />
<a href="#fn:cqctvaluint8">cqctvaluint8</a><br />
<a href="#fn:cqctvaluint16">cqctvaluint16</a><br />
<a href="#fn:cqctvaluint32">cqctvaluint32</a><br />
<a href="#fn:cqctvaluint64">cqctvaluint64</a><br />
<a href="#fn:cqctvecvals">cqctvecvals</a><br />
</td>
</tr>
</table>
</div>
</div>
</div>


<h4 id="sec:fnindex">Built-in Function Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<table>
<tr>
<td>
<a href="#fn:access">access</a><br />
<a href="#fn:append">append</a><br />
<a href="#fn:apply">apply</a><br />
<a href="#fn:arraynelm">arraynelm</a><br />
<a href="#fn:backtrace">backtrace</a><br />
<a href="#fn:basebase">basebase</a><br />
<a href="#fn:baseid">baseid</a><br />
<a href="#fn:baserep">baserep</a><br />
<a href="#fn:bitfieldcontainer">bitfieldcontainer</a><br />
<a href="#fn:bitfieldpos">bitfieldpos</a><br />
<a href="#fn:bitfieldwidth">bitfieldwidth</a><br />
<a href="#fn:bsearch">bsearch</a><br />
<a href="#fn:close">close</a><br />
<a href="#fn:concat">concat</a><br />
<a href="#fn:copy">copy</a><br />
<a href="#fn:count">count</a><br />
<a href="#fn:delete">delete</a><br />
<a href="#fn:enumconsts">enumconsts</a><br />
<a href="#fn:error">error</a><br />
<a href="#fn:eval">eval</a><br />
<a href="#fn:exit">exit</a><br />
<a href="#fn:fault">fault</a><br />
<a href="#fn:fdname">fdname</a><br />
<a href="#fn:fdopen">fdopen</a><br />
<a href="#fn:fieldid">fieldid</a><br />
<a href="#fn:fieldoff">fieldoff</a><br />
<a href="#fn:fields">fields</a><br />
<a href="#fn:fieldtype">fieldtype</a><br />
<a href="#fn:finalize">finalize</a><br />
<a href="#fn:foreach">foreach</a><br />
<a href="#fn:fprintf">fprintf</a><br />
<a href="#fn:getbytes">getbytes</a><br />
<a href="#fn:getenv">getenv</a><br />
<a href="#fn:getpid">getpid</a><br />
<a href="#fn:getpeername">getpeername</a><br />
<a href="#fn:getsockname">getsockname</a><br />
<a href="#fn:gettimeofday">gettimeofday</a><br />
<a href="#fn:head">head</a><br />
<a href="#fn:index">index</a><br />
<a href="#fn:inflate">inflate</a><br />
<a href="#fn:inflate">inflatezlib</a><br />
<a href="#fn:ioctl">ioctl</a><br />
<a href="#fn:isalnum">isalnum</a><br />
<a href="#fn:isalpha">isalpha</a><br />
<a href="#fn:isarray">isarray</a><br />
<a href="#fn:isas">isas</a><br />
<a href="#fn:isascii">isascii</a><br />
<a href="#fn:isbase">isbase</a><br />
<a href="#fn:isbitfield">isbitfield</a><br />
<a href="#fn:isblank">isblank</a><br />
<a href="#fn:iscntrl">iscntrl</a><br />
<a href="#fn:isctype">isctype</a><br />
<a href="#fn:iscvalue">iscvalue</a><br />
<a href="#fn:isdigit">isdigit</a><br />
<a href="#fn:isdomain">isdomain</a><br />
<a href="#fn:isempty">isempty</a><br />
</td>
<td>
<a href="#fn:isenum">isenum</a><br />
<a href="#fn:isenumconst">isenumconst</a><br />
<a href="#fn:isfd">isfd</a><br />
<a href="#fn:isfunc">isfunc</a><br />
<a href="#fn:isgraph">isgraph</a><br />
<a href="#fn:islist">islist</a><br />
<a href="#fn:islower">islower</a><br />
<a href="#fn:ismember">ismember</a><br />
<a href="#fn:isnil">isnil</a><br />
<a href="#fn:isns">isns</a><br />
<a href="#fn:isodigit">isodigit</a><br />
<a href="#fn:isprint">isprint</a><br />
<a href="#fn:isprocedure">isprocedure</a><br />
<a href="#fn:isptr">isptr</a><br />
<a href="#fn:ispunct">ispunct</a><br />
<a href="#fn:isrange">isrange</a><br />
<a href="#fn:isrd">isrd</a><br />
<a href="#fn:isrec">isrec</a><br />
<a href="#fn:isspace">isspace</a><br />
<a href="#fn:isstring">isstring</a><br />
<a href="#fn:isstruct">isstruct</a><br />
<a href="#fn:issu">issu</a><br />
<a href="#fn:istable">istable</a><br />
<a href="#fn:istypedef">istypedef</a><br />
<a href="#fn:isundeftype">isundeftype</a><br />
<a href="#fn:isunion">isunion</a><br />
<a href="#fn:isupper">isupper</a><br />
<a href="#fn:isvector">isvector</a><br />
<a href="#fn:isvoid">isvoid</a><br />
<a href="#fn:isxdigit">isxdigit</a><br />
<a href="#fn:length">length</a><br />
<a href="#fn:list">list</a><br />
<a href="#fn:listdel">listdel</a><br />
<a href="#fn:listins">listins</a><br />
<a href="#fn:listref">listref</a><br />
<a href="#fn:listset">listset</a><br />
<a href="#fn:map">map</a><br />
<a href="#fn:mapfile">mapfile</a><br />
<a href="#fn:memset">memset</a><br />
<a href="#fn:mkctype_array">mkctype_array</a><br />
<a href="#fn:mkctype_base">mkctype_base</a><br />
<a href="#fn:mkctype_bitfield">mkctype_bitfield</a><br />
<a href="#fn:mkctype_char">mkctype_char</a><br />
<a href="#fn:mkctype_const">mkctype_const</a><br />
<a href="#fn:mkctype_double">mkctype_double</a><br />
</td>
<td>
<a href="#fn:mkctype_enum">mkctype_enum</a><br />
<a href="#fn:mkctype_float">mkctype_float</a><br />
<a href="#fn:mkctype_fn">mkctype_fn</a><br />
<a href="#fn:mkctype_int">mkctype_int</a><br />
<a href="#fn:mkctype_ldouble">mkctype_ldouble</a><br />
<a href="#fn:mkctype_long">mkctype_long</a><br />
<a href="#fn:mkctype_ptr">mkctype_ptr</a><br />
<a href="#fn:mkctype_short">mkctype_short</a><br />
<a href="#fn:mkctype_struct">mkctype_struct</a><br />
<a href="#fn:mkctype_typedef">mkctype_typedef</a><br />
<a href="#fn:mkctype_uchar">mkctype_uchar</a><br />
<a href="#fn:mkctype_uint">mkctype_uint</a><br />
<a href="#fn:mkctype_ulong">mkctype_ulong</a><br />
<a href="#fn:mkctype_undef">mkctype_undef</a><br />
<a href="#fn:mkctype_union">mkctype_union</a><br />
<a href="#fn:mkctype_ushort">mkctype_ushort</a><br />
<a href="#fn:mkctype_uvlong">mkctype_uvlong</a><br />
<a href="#fn:mkctype_vlong">mkctype_vlong</a><br />
<a href="#fn:mkctype_void">mkctype_void</a><br />
<a href="#fn:mkctype_xaccess">mkctype_xaccess</a><br />
<a href="#fn:mkdir">mkdir</a><br />
<a href="#fn:mkdom">mkdom</a><br />
<a href="#fn:mkfd">mkfd</a><br />
<a href="#fn:mkfield">mkfield</a><br />
<a href="#fn:mklist">mklist</a><br />
<a href="#fn:mkns">mkns</a><br />
<a href="#fn:mknsraw">mknsraw</a><br />
<a href="#fn:mkparam">mkparam</a><br />
<a href="#fn:mkstr">mkstr</a><br />
<a href="#fn:mksym">mksym</a><br />
<a href="#fn:mktab">mktab</a><br />
<a href="#fn:mkvec">mkvec</a><br />
<a href="#fn:nsptr">nsptr</a><br />
<a href="#fn:nsrepbase">nsrepbase</a><br />
<a href="#fn:open">open</a><br />
<a href="#fn:paramid">paramid</a><br />
<a href="#fn:params">params</a><br />
<a href="#fn:paramtype">paramtype</a><br />
<a href="#fn:pop">pop</a><br />
<a href="#fn:printf">printf</a><br />
<a href="#fn:push">push</a><br />
<a href="#fn:putbytes">putbytes</a><br />
<a href="#fn:rand">rand</a><br />
<a href="#fn:rand">randseed</a><br />
<a href="#fn:rdis">rdis</a><br />
<a href="#fn:rdfields">rdfields</a><br />
</td>
<td>
<a href="#fn:rdfmt">rdfmt</a><br />
<a href="#fn:rdname">rdname</a><br />
<a href="#fn:rdof">rdof</a><br />
<a href="#fn:rdsetfmt">rdsetfmt</a><br />
<a href="#fn:read">read</a><br />
<a href="#fn:resettop">resettop</a><br />
<a href="#fn:rettype">rettype</a><br />
<a href="#fn:reverse">reverse</a><br />
<a href="#fn:seek">seek</a><br />
<a href="#fn:select">select</a><br />
<a href="#fn:setloadpath">setloadpath</a><br />
<a href="#fn:settypedeftype">settypedeftype</a><br />
<a href="#fn:slice">slice</a><br />
<a href="#fn:sort">sort</a><br />
<a href="#fn:split">split</a><br />
<a href="#fn:sprintfa">sprintfa</a><br />
<a href="#fn:stringof">stringof</a><br />
<a href="#fn:strlen">strlen</a><br />
<a href="#fn:strput">strput</a><br />
<a href="#fn:strref">strref</a><br />
<a href="#fn:strstr">strstr</a><br />
<a href="#fn:strton">strton</a><br />
<a href="#fn:substr">substr</a><br />
<a href="#fn:subtype">subtype</a><br />
<a href="#fn:suekind">suekind</a><br />
<a href="#fn:suetag">suetag</a><br />
<a href="#fn:susize">susize</a><br />
<a href="#fn:symid">symid</a><br />
<a href="#fn:symoff">symoff</a><br />
<a href="#fn:symtype">symtype</a><br />
<a href="#fn:tabdelete">tabdelete</a><br />
<a href="#fn:tabenum">tabenum</a><br />
<a href="#fn:tabinsert">tabinsert</a><br />
<a href="#fn:tabkeys">tabkeys</a><br />
<a href="#fn:tablook">tablook</a><br />
<a href="#fn:tabvals">tabvals</a><br />
<a href="#fn:tail">tail</a><br />
<a href="#fn:tcpaccept">tcpaccept</a><br />
<a href="#fn:tcplisten">tcplisten</a><br />
<a href="#fn:tcpopen">tcpopen</a><br />
<a href="#fn:tolower">tolower</a><br />
<a href="#fn:toupper">toupper</a><br />
<a href="#fn:typedefid">typedefid</a><br />
<a href="#fn:typedeftype">typedeftype</a><br />
<a href="#fn:typename">typename</a><br />
<a href="#fn:uname">uname</a><br />
<a href="#fn:unlink">unlink</a><br />
<a href="#fn:veclen">veclen</a><br />
<a href="#fn:vecref">vecref</a><br />
<a href="#fn:vecset">vecset</a><br />
<a href="#fn:vector">vector</a><br />
<a href="#fn:write">write</a><br />
<a href="#fn:xaccessget">xaccessget</a><br />
<a href="#fn:xaccessput">xaccessput</a><br />
</td>
</tr>
</table>

</div>
</div>
</div>

</div>
</body>
</html>
