<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Cinquecento Manual</title>
<link rel="stylesheet" type="text/css" href="reset.css"/>
<link rel="stylesheet" type="text/css" href="styles.css"/>
</head>

<body>

<div id="side1">
<a href="#sec:introduction">Introduction</a><br />
<br />
<em>Getting Started</em><br />
<a href="#sec:audience">Prerequisites</a><br />
<a href="#sec:repl">Interactive Use</a><br />
<br />
<em>Basic Language</em><br />
<a href="#sec:input">Input</a><br />
<a href="#sec:comments">Comments</a><br />
<a href="#sec:keywords">Keywords</a><br />
<a href="#sec:identifiers">Identifiers</a><br />
<a href="#sec:literals">Literals</a><br />
<a href="#sec:scope">Scope and Variables</a><br />
<a href="#sec:types">Types</a><br />
<a href="#sec:functions">Functions</a><br />
<a href="#sec:control">Control</a><br />
<a href="#sec:patterns">Pattern Matching</a><br />
<br />
<em>Using Domains</em><br />
<a href="#sec:domainover">Overview of Domains</a><br />
<a href="#sec:cids">C Identifiers</a><br />
<a href="#sec:cvalues">Cvalues</a><br />
<a href="#sec:ranges">Ranges</a><br />
<a href="#sec:symref">Symbol references</a><br />
<a href="#sec:litdom">The Literal Domain</a><br />
<a href="#sec:casts">Type and Domain Conversion</a><br />
<a href="#sec:cvalueops">C Operators</a><br />
<a href="#sec:equivalence">Equivalence and other relations</a><br />
<a href="#sec:pointers">Pointers</a><br />
<br />
<em>Defining Domains</em><br />
<a href="#sec:objects">The object model</a><br />
<a href="#sec:symbols">Symbols, Fields, Parameters</a><br />
<a href="#sec:namespaces">Name spaces</a><br />
<a href="#sec:rootnamespaces">Root name spaces</a><br />
<a href="#sec:_at_names"><span class="val">@names</span></a><br />
<a href="#sec:addressspaces">Address spaces</a><br />
<a href="#sec:ctypes">Ctypes</a><br />
<br />
<em>Data Structures</em><br />
<a href="#sec:records">Records</a><br />
<a href="#sec:containers">Container Types</a><br />
<a href="#sec:lists">Lists</a><br />
<a href="#sec:vectors">Vectors</a><br />
<a href="#sec:tables">Tables</a><br />
<a href="#sec:characters">Characters</a><br />
<a href="#sec:strings">Strings</a><br />
<a href="#sec:pairs">Pairs</a><br />
<br />
<em>System Operation</em><br />
<a href="#sec:storage">Storage Management</a><br />
<a href="#sec:compile">Quotation, Compilation, and Evaluation</a><br />
<a href="#sec:perf">Instrumentation</a><br />
<br />
<em>Built-in Libraries</em><br />
<a href="#sec:io">I/O</a><br />
<a href="#sec:fs">Filesystem Functions</a><br />
<a href="#sec:fmt">Formatted Output</a><br />
<a href="#sec:system">System Functions</a><br />
<a href="#sec:mash">Compression and Hashing</a><br />
<br />
<em>Implementation Details</em><br />
<a href="#sec:runtime">L1 runtime</a><br />
<a href="#sec:cinterface">C Interface</a><br />
<br />
<br />
<a href="#sec:bib">Bibliography</a><br />
<a href="#sec:synindex">Syntax Index</a><br />
<a href="#sec:cindex">C Interface Index</a><br />
<a href="#sec:fnindex">Built-in Function Index</a><br />
</div>

<div id="content">

<div id="title">
<h3>Cinquecento Manual</h3>
</div>

<h4 id="sec:introduction">Introduction</h4>

<p>
This manual describes the
language and built-in library functions
of the L1 implementation of Cinquecento.
</p>

<p>
Cinquecento is a programming language designed for
examining programs in execution.  It features an
extensible abstraction, called a <em>domain</em>, that
represents a program in execution as a language
value, and a syntactic interface to domains based on
the C programming language.
</p>

<p>
Cinquecento programs use fragments of C &mdash;
employing C operators, types, and control flow &mdash;
to examine or modify the state of target programs
represented by domains.  Complex C idioms for
traversing data structures, such as pointer-chasing
loops, usually port with little or no effort.  The
names and types of target program data are specified in
the syntax of C declarations; minor extensions allow
machine-level specification of location, layout, and
encoding of data in memory.
</p>

<p>
Multiple simultaneously active target programs can be
represented as distinct domains within a single
Cinquecento program.  Heterogeneity is expected: the
targets may be different programs, or the same program
with different types, symbols, or executable format,
and the targets may execute on different machines,
possibly of different architecture or operating system.

Example applications include comparing executions of
different versions of a program, comparing executions
of a program across machines or operating systems, and
validating global state in a distributed program.
</p>

<p>
Each domain encapsulates user-defined functions that
catalog the types and symbols of the target, plus
functions that read and write its memory and other
run-time state.  Rather than favor the idiosyncrasies
of one operating system, architecture, compiler, or
debugging information format, Cinquecento specifies a
small, extensible interface that allows users to tailor
domains for their target environment.  New domain
implementations can be written entirely in Cinquecento;
built-in library functions and accompanying programs
simplify construction of domains for common
environments, such as DWARF-based x86 Linux systems.
</p>

<p>
Apart from domains and the C-based syntax, Cinquecento
is a simple dynamic language with conventional
functional semantics.  A dialect of Scheme at heart,
Cinquecento is lexically scoped, dynamically typed,
properly tail recursive, and has first-class functions,
continuations, and automatic memory management.  Some
Schemers may cluck at Cinquecento's numbers
(which rigorously emulate the numbers of C), its
fledgling support for syntactic extension, and its
indulgence of imperative habits.
</p>

<p>
The Cinquecento language design and implementation is
an active research project, still undergoing revision,
extension, and tuning.

We strive to keep this manual current with the
implementation it accompanies, but until things settle
down, sometimes we will fall behind.
</p>

<p>
We welcome feedback of any kind from all users.
</p>

<h4 id="sec:audience">Prerequisites</h4>

<p>
Cinquecento is meant to serve programmers who are fluent in both C
and Scheme.  The essence of Cinquecento programming is
the use of functional abstraction, in the style
epitomized by Scheme, to program the evaluation of
expressions involving the syntax, operators, types,
memory model, and control flow of idiomatic C.
</p>

<p>
Many guides to artful use of C and Scheme are available
in libraries and on the web.  Throughout this manual we
avoid dispensing nutshell caricatures of ideas and
traditions explained well elsewhere.  Instead here we
suggest a few starting points from which one cannot be
led astray.
</p>

<p>
<em><a href="#bib:tspl">The Scheme Programming
Language</a></em> offers both an introduction to Scheme
and exposition of its many fine points.  The point most
central to Cinquecento is the role of
<span class="val">lambda</span> as an operator for
constructing stateful first-class functions.  A taste
and habit for stylistic use
of <span class="val">lambda</span> can be cultivated by
studying
<em><a href="#bib:ls">The Little Schemer</a></em>
or <em><a href="#bib:sicp">Structure and
Interpretation of Computer Programs</a></em>.
</p>

<p>
Into its Scheme-like setting, Cinquecento carries
nearly every feature of C other than static typing.
Understanding Cinquecento requires familiarity with the
sharp edges of C, especially sensitivity to the meaning
of types and operations involving pointers and
memory.  <em><a href="#bib:kr">The C Programming
Language</a></em> offers a concise and definitive
foundation, while
<em><a href="#bib:hs">C: A Reference
Manual</a></em> reveals many more edges.
</p>

<p>
Looking from another direction, the Cinquecento
programmer is primarily in the business of making,
operating, and extending custom debuggers.  Sooner or
later, it will be useful to understand how debuggers
represent and control program executions in your
environment.

</p>

<h4 id="sec:repl">Interactive Use</h4>

<p>
L1 includes a read-eval-print loop through which Cinquecento
expressions can be interactively evaluated.
</p>

<p>
Assuming that L1 has been made available in your path, you
can start the REPL in a shell by running the
command <span class="val">l1</span>:

</p>

<div class="code">
<pre>
% l1
;
</pre>
</div>

<p>
The semicolon is the REPL prompt.  Typing a complete
expression followed a newline sends the expression to
the evaluator.  The resulting value is printed on the
following line, followed by a new prompt:
</p>


<div class="code">
<pre>
; 3+3;
<span class="arg">6</span>
;
</pre>
</div>

<p>
Most Cinquecento expressions end with a semicolon.
(Welcome to the C part of the language.)  In this
manual, we show the printed output of interactions with
the evaluator in <span class="arg">italics</span>.
</p>

<p>
Some expressions cause output to be printed.
We show such output along with the value
printed by the REPL.
</p>

<div class="code">
<pre>
; { printf("hello, world\n"); 3+3; }
<span class="arg">hello, world</span>
<span class="arg">6</span>
;
</pre>
</div>

<p>
(Like blocks of statements in C, blocks of expressions
enclosed in curly braces do not require the final
semicolon.)
</p>

<p>
An error encountered during expression evaluation
aborts the evaluation and prints a diagnostic and stack
trace:
</p>

<div class="code">
<pre>
; for(i = 4; i >= 0; i--) printf("%d\n", 4/i);
<span class="arg">1
1
2
4
error: divide by zero
               entry	(&lt;stdin&gt;:1)</span>
</pre>
</div>

<p>
Long-running or non-terminating evaluations can be
interrupted by typing control-C.
Typing control-D exits the REPL.
</p>

<p>
The REPL does not offer line editing or expression
history.  Some users run L1 through a standalone tool
such as <span class="val">rlwrap</span> or from within
Emacs to obtain editing and history service.
</p>

<p>
The REPL does not accept multi-line input: the newline
signals the end of the expression.  In this manual, to
make the presentation easier to read, we sometimes
present multi-line input anyway.  The usual way to
handle longer input is to put it in a file.
</p>

<p>
The REPL can be directed to evaluate a file of
Cinquecento code with
the <span class="val"><a href="#syn:_at_include">@include</a></span>
form:
</p>

<div class="code">
<pre>
; @include "/home/me/file.cqct"
</pre>
</div>

<p>
Alternatively, the file name can be passed as an argument to
<span class="val">l1</span>:
</p>

<div class="code">
<pre>
% l1 /home/me/file.cqct
</pre>
</div>

<p>
in which case L1 exits
after evaluating the contents of the file.
</p>

<p>
An Emacs major mode for editing Cinquecento code is
included in the directory <span class="val">doc</span>
in the L1 source distribution.
</p>

<p>
Some demonstrations of Cinquecento are included in the
directory <span class="val">demo</span> in the L1
source distribution.  They make use of the process
control server <span class="val">sctl</span>,
which is available from <span class="val"><a href="http://cqctworld.org">cqctworld.org</a></span>.
Its usage is documented in a separate <a href="debug.html">manual</a>.
</p>

<h4 id="sec:input">Input</h4>

<p>
A Cinquecento program consists of a sequence of
expressions to be evaluated in order by the Cinquecento
evaluator.
</p>

<p id="syn:_at_include">
The Cinquecento evaluator reads code from its current
<em>input file</em>.
During parsing of an input file, an occurrence (not
within a string literal or comment) of either of the
forms
</p>
<div class="code">
@include &lt;<span class="arg">filename</span>&gt;<br />
@include "<span class="arg">filename</span>"
</div>
<p>
is replaced with the contents of the named file.
The first form searches for
<span class="arg">filename</span>
in the Cinquecento system load path.
The second form searches the directory that contains the
current input file.
</p>

<p>
The current input file is temporarily switched to 
<span class="arg">filename</span> during the substitution.
</p>

<!-- i don't understand
     why the short vertical separation appears here;
     it seems dependent on the code div above, even
     if the body of that div is empty. -->

<h4 id="sec:comments">Comments</h4>

<p>
The following are comments:
</p>

<ul>
<li>
Input enclosed by <span class="val">/*</span>
and <span class="val">*/</span>;
</li>
<li>
Input between <span class="val">//</span>
and the beginning of the next line;
</li>
<li>
Input enclosed by <span class="val">#!</span>
and <span class="val">!#</span>.  (This syntax
is intended for executable scripts on Unix.)
</li>
</ul>

<h4 id="sec:keywords">Keywords</h4>

<p>
The following are the keywords of Cinquecento.
</p>

<div class="code">
<!-- pipe through mc -60
@containerof
@define
@defloc
@lambda 
@let
@local
@global 
@names 
@record 
@typeof
_Bool
break 
case 
char 
const
continue 
default 
do 
double 
else 
enum 
float 
for 
if 
int 
long 
return 
short 
signed 
sizeof 
struct 
switch 
typedef 
union 
unsigned 
void 
volatile
while 
-->
<pre>
@containerof _Bool        enum         struct 
@define      break        float        switch 
@defloc      case         for          typedef 
@lambda      char         if           union 
@let         const        int          unsigned 
@local       continue     long         void 
@global      default      return       volatile
@names       do           short        while 
@record      double       signed 
@typeof      else         sizeof 
</pre>
</div>

<h4 id="sec:identifiers">Identifiers</h4>

<p>
Identifiers are non-keyword tokens used to identify
Cinquecento variables and the symbols represented
within domains.
</p>

<p>
The first character of an identifier must be a letter or underscore.
Subsequent characters must be letters, underscores, or digits.
</p>

<p>
There is an exception: the two character sequence <span class="val">::</span>
may appear anywhere within an identifier, including
at the beginning.
</p>


<h4 id="sec:literals">Literals</h4>

<p>
Literals are lexical tokens that encode character, string,
and integer constants.  Their syntax follows that of C literals.
</p>

<p>
A character literal is a printable ASCII character
surrounded by single quotes.
</p>

<p>
Cinquecento also recognizes the C character escape sequences:
<span class="val">\a</span>,
<span class="val">\b</span>,
<span class="val">\f</span>,
<span class="val">\n</span>,
<span class="val">\r</span>,
<span class="val">\t</span>,
<span class="val">\v</span>,
<span class="val">\\</span>,
<span class="val">\?</span>,
<span class="val">\'</span>,
<span class="val">\"</span>,
<span class="val">\<span class="arg">o</span></span>,
<span class="val">\<span class="arg">oo</span></span>,
<span class="val">\<span class="arg">ooo</span></span>,
<span class="val">\x<span class="arg">h</span>...<span class="arg">h</span></span>.
</p>


<p>
A string literal is a sequence of ASCII or escaped characters
surrounded by double quotes.
</p>

<p>
Two string literals separated by
whitespace are concatenated into
a single string.
</p>

<p>
An integer literal is a sequence of digit characters.
With no prefix, integer literals are interpreted in decimal.
The <span class="val">0x</span> prefix and <span class="val">0X</span> prefix causes hexadecimal interpretation.
The <span class="val">0</span> prefix causes octal interpretation.
The <span class="val">0b</span> prefix and <span class="val">0B</span> prefix causes binary interpretation.
</p>

<p>
By default, the C type imposed on an integer constant
is is the smallest integer type (up
to <span class="val">int</span>?) that can represent the
value.  The suffixes <span class="val">U</span>,
<span class="val">UL</span>, <span class="val">ULL</span>,
<span class="val">L</span>, 
<span class="val">LL</span>, and their lowercase variants
impose the specified long and/or unsigned types upon the value.
The suffixes <span class="val">K</span>,
<span class="val">M</span>, <span class="val">G</span>,
<span class="val">T</span>, 
and their lowercase variants
impose the type <span class="val">unsigned long long</span>
upon the value and shift the value left by 10, 20, 30, or 40 bits,
respectively.
</p>

<h4 id="sec:scope">Scope and Variables</h4>

<p>
Cinquecento is lexically scoped and dynamically typed.
</p>

<p>
The block statement:
</p>
<div class="code">
<pre>
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>
introduces a new level of lexical scope.
</p>

<p>
Expressions that appear outside of a block statement
are called top-level expressions.

The outermost level of scope, called the top-level environment,
contains bindings for built-in
functions and other values.
</p>

<p>
Bindings are mutable.  The assignment form
</p>
<div class="code">
<span class="arg">var</span> = <span class="arg">expr</span>;
</div>
<p>
updates the value bound to the variable <span class="arg">var</span>
to the value of <span class="arg">expr</span>.
</p>

<p>
If <span class="arg">var</span> is an unbound variable,
the <span class="id">=</span> operator implicitly creates
a binding for <span class="arg">var</span>
that is visible in the innermost
level of lexical scope.  If the assignment occurs
in a top-level expression, a new binding is added
to the top-level environment.
These rules also apply to the other assignment operators
(<span class="id">+=</span>,
<span class="id">-=</span>,
<span class="id">*=</span>,
<span class="id">/=</span>,
<span class="id">%=</span>,
<span class="id">&amp;=</span>,
<span class="id">|=</span>,
<span class="id">^=</span>,
<span class="id">&lt;&lt;=</span>,
<span class="id">&gt;&gt;=</span>,
<span class="id">++</span>,
<span class="id">--</span>).
</p>

<p>
The <span class="fnindex" id="syn:_at_local">@local</span> statement
explicitly declares new variable bindings for the block
in which it appears:
</p>
<div class="code">
<pre>
{
	@local <span class="arg">var</span>, ... ;
	...
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>
establishes new bindings for the
variables <span class="arg">var ... </span> within the
enclosing block.

These bindings shadow any other bindings of
<span class="arg">var ... </span> in enclosing blocks
or the top-level environment.

Any number of <span class="id">@local</span> statements
may appear in a block, but they all must appear 
before any other statements.
</p>

<p>
The <span class="fnindex" id="syn:_at_global">@global</span>
statement declares new variable bindings in the
top-level environment:
</p>
<div class="code">
<pre>
@global <span class="arg">var</span>, ... ;
</pre>
</div>

<p>
Variables declared with
<span class="id">@local</span>
and
<span class="id">@global</span>
are initially bound to <tt>nil</tt>.
</p>

<p>
The parameters of a <span class="id">@lambda</span> form
establish local bindings in the block that forms the
body of the function definition, just as if they had
been declared with <span class="id">@local</span>.
</p>

<p>
A reference to an unbound variable is resolved in the top-level
environment.  It is an error if no binding to the variable
has occurred before the reference is evaluated.
</p>

<h4 id="sec:types">Types</h4>

<p>
Cinquecento defines several types of values.  Every
value in Cinquecento belongs to exactly one type.  For
each type there is a predicate to test whether a value
belongs to the type.
</p>

<p>
Types with standard semantics include <em>string</em>,
<em>pair</em>, <em>function</em>, <em>record</em>, <em>record descriptor</em>,
and <em>file descriptor</em>.
</p>

<p>
The types special to Cinquecento are <em>cid</em>, <em>cvalue</em>,
<em>ctype</em>, <em>domain</em>, <em>address
space</em>, <em>name space</em>, and <em>range</em>.
These types represent different aspects of a program in
execution; their roles are described in the
<a href="#sec:domainover">overview of domains</a>.
</p>

<p>
There are also several container types for storing
values of any type: <em>list</em>, <em>vector</em>, and
<em>table</em>.
</p>

<p>
The special value <tt>nil</tt> is not a member of any
other type or equal to any other value.
</p>

<p>
There are no numeric types other than cvalue.
</p>

<p>
The following functions are predicates on the type of a
value.  They each test their
argument <span class="arg">val</span> for membership in
a particular type and return
the cvalue <span class="arg">1</span> if
the value belongs to the type,   
or <span class="arg">0</span> otherwise.
</p>

<div class="table-short">
<table>

<tr>
<td>
Address space
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isas">isas(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
C identifier
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:iscid">iscid(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
C type
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isctype">isctype(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
C value
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:iscvalue">iscvalue(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Domain
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isdom">isdom(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
File descriptor
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isfd">isfd(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
List
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:islist">islist(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Nil
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isnil">isnil(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Name space
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isns">isns(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Pair
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:ispair">ispair(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Procedure
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isprocedure">isprocedure(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Range
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrange">isrange(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Record
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrec">isrec(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Record descriptor
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isrd">isrd(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
String
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isstring">isstring(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Table
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:istable">istable(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

<tr>
<td>
Vector
</td>
<td>
<div class="proto">
<div class="function">
<span class="id" id="fn:isvector">isvector(<span class="arg">val</span>)</span>
</div>
</div>
</td>
</tr>

</table>
</div>


<h4 id="sec:functions">Functions</h4>

<p>
As in Scheme and other functional languages,
Cinquecento functions are first-class values.
They may be dynamically created, returned from
functions, bound to variables, and stored in containers.
</p>

<p>
Cinquecento functions are closures over their lexical
environment: free variables in the body of a function
definition refer to the bindings of those variables
contained in the enclosing blocks or in the top-level
environment.
</p>

<p>
The <span class="fnindex" id="syn:_at_lambda">@lambda</span>
expression defines new function values.  The syntax
is:
</p>

<div class="code">
<pre>
@lambda <span class="arg">formals</span> { <span class="arg">statement</span>; ... }
</pre>
</div>

<p>
The syntax of <span class="arg">formals</span> determines
how formal parameters are bound to actual parameters:
</p>

<ul>
<li>
If <span class="arg">formals</span> is a list of variable identifiers of the form
<span class="id">(<span class="arg">v1</span>, <span class="arg">v2</span>, ...,
<span class="arg">vn</span>)</span>,
then the function accepts
<span class="arg"><em>n</em></span> parameters,
and each actual
parameter is bound to the corresponding variable.
<span class="arg">Formals</span> may be <span class="id">()</span>,
defining a function of zero parameters.
</li>

<li>
If <span class="arg">formals</span> is a list of identifiers of the form
<span class="id">(<span class="arg">v1</span>, <span class="arg">v2</span>, ...,
<span class="arg">vn</span>, <span class="arg">varg</span> ...)</span> (where the
final <span class="id">...</span> is concrete syntax),
then the function is a variable arity function of at
least
<span class="arg"><em>n</em></span> parameters .
The first <span class="arg"><em>n</em></span> actual parameters
are bound to the first <span class="arg"><em>n</em></span> variables;
<span class="arg"><em>n</em></span> may be zero.
The remaining parameters, possibly zero, are passed in a freshly allocated
list that is bound to <span class="arg">varg</span>.
</li>

</ul>

<p>
The body of the function is a sequence of statements
to be evaluated when the function is called.
</p>

<p>
A function call is an expression of the form
</p>
<div class="code">
<pre>
<span class="arg">fn</span>(<span class="arg">expr</span>, ...)
</pre>
</div>
<p>
where <span class="arg">fn</span> is an expression
that evaluates to a function.

The number of expressions appearing in the argument
list <span class="arg">expr</span>, ... must match
the number expected by the function.
</p>

<p>

A <span class="fnindex" id="syn:return">return</span>
statement in the body of a function returns control to
the expression that called the function.  The syntax
variants are:
</p>
<div class="code">
<pre>
return;
return <span class="arg">expr</span>;
</pre>
</div>
<p>
The first form returns the value <span class="val">nil</span>.
The second form returns the value of <span class="arg">expr</span>. 
</p>

<p>
The value of a function call expression is the value
returned by evaluation
of a <span class="id">return</span> statement in
the body of the called function, or the value of the
last evaluated expression in the body 
if the function returns without reaching a
<span class="id">return</span> statement.
</p>

<p>
The <span class="fnindex" id="syn:_at_define">@define</span> form
is syntactic sugar for naming a function definition.
For example
</p>
<div class="code">
<pre>
@define <span class="arg">name</span>(<span class="arg">var</span>, ...)
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>
<p>

is equivalent to 
</p>
<div class="code">
<pre>
<span class="arg">name</span> = @lambda(<span class="arg">var</span>, ...)
{
	<span class="arg">statement</span>;
	...
}
</pre>
</div>

<p>
The <span class="fnindex" id="syn:_at_defloc">@defloc</span> form
is like <span class="fnindex" id="syn:_at_defloc">@define</span>,
except that it forces the binding to be local to the innermost
level of lexical scope.
</p>

<p>
Multiple values may be returned from a function by
returning a list of the values:
</p>

<div class="code">
<pre>
@define foo()
{
	return [1, 2, 3];
}
</pre>
</div>

<p>
While the value returned is an ordinary list, its
elements can be bound directly to variables:
</p>

<div class="code">
<pre>
; [x, y, z] = foo();
; printf("%d %d %d\n", x, y, z);
<span class="arg">1 2 3</span>
</pre>
</div>

<p>
Any number of variables up to the number of elements in
the returned list may be bound.  Assignment start
from the front of the list:
</p>

<div class="code">
<pre>
; [x, y] = foo();
; printf("%d %d\n", x, y);
<span class="arg">1 2</span>
</pre>
</div>

<p>
The identifier <span class="id">_</span> is reserved
for binding values that will not be used:
</p>

<div class="code">
<pre>
; [_, _, z] = foo();
; printf("%d\n", z);
<span class="arg">3</span>
</pre>
</div>

<p>
Only variable identifiers (and not, <em>e.g.</em>,
nested binding forms) may appear as elements of this
binding form.  They are subject to the same implicit
binding rules as ordinary assignments.  As an expression,
the value of this binding form is <span class="id">nil</span>.
</p>

<p>
The built-in function <span class="id">apply</span>
and the syntax form <span class="id">@lazyapply</span>
are used to call functions.
</p>

<div class="docitem" id="fn:apply">
<div class="proto">
<div class="function">
<span class="id">apply(<span class="arg">fn</span>, <span class="arg">arg</span>, ..., <span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">Apply</span> returns the result of
applying the function <span class="arg">fn</span> to
the remaining arguments.  The arguments
<span class="arg">arg ... </span> comprise the leading
arguments to <span class="arg">fn</span>; the elements
of <span class="arg">list</span> comprise the remaining arguments.
</div>
</div>

<div class="docitem" id="syn:_at_lazyapply">
<div class="proto">
<div class="function">
<span class="id">@lazyapply(<span class="arg">fn</span>, <span class="arg">arg</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any expression</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">@lazyapply</span> provides a lazy form of function application.
Rather than evaluating the argument expressions,
this form, when evaluated, constructs for each argument expression a separate procedure of
no arguments that, when called, evaluates the expression.
The function <span class="arg">fn</span> is applied to these thunks,
and the resulting value is returned.
</div>
</div>

<h4 id="sec:control">Control</h4>

<p>
Cinquecento supports the control flow statements of C,
including the loop statements <span class="val">do</span>-<span class="val">while</span>,
<span class="val">for</span>,
and <span class="val">while</span>,
the conditional statements <span class="val">if</span>,
<span class="val">if</span>-<span class="val">else</span>,
and <span class="val">switch</span> (with <span class="val">case</span>
and <span class="val">default</span> labels),
and the <span class="val">goto</span> statement.
</p>

<p>
In all cases but <span class="val">switch</span>, these
statements have the same syntax they have in C.  The
syntax of <span class="val">switch</span> has been
expanded to support pattern matching, discussed in
<a href="#sec:patterns">the switch statement and
pattern matching</a> below, but is backward compatible
with C: a switch statement that is legal C will have
the same semantics in Cinquecento as in C.
</p>

<p>
As in C, the integer value <span class="val">0</span>
is considered false in conditional evaluation.  Unlike
C, the value <span class="id">nil</span> is also
considered false.  (The value
of <span class="id">!nil</span>
is <span class="val">1</span>.)  All other values are
considered true.
</p>

<p>
Control flow through loops
and <span class="val">switch</span> statements can be
controlled with <span class="val">break</span>
and <span class="val">continue</span> as in C.  Neither
these keywords nor <span class="val">goto</span> can be
used to leave or enter the body of a function.
</p>

<p>
Several functions support additional forms of non-local
control flow:
</p>

<div class="docitem" id="fn:error">
<div class="proto">
<div class="function">
<span class="id">error(<span class="arg">fmt</span>, <span class="arg">arg</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
Aborts the current continuation and signals an error to the current caller of the
Cinquecento evaluator.  An error message
is formatted by passing <span class="arg">fmt</span> and <span class="arg">arg ...</span>
to <span class="id"><a href="#fn:sprintfa">sprintfa</a></span>
and printed along with a stack trace to the current
output stream.
</div>
</div>

<div class="docitem" id="fn:fault">
<div class="proto">
<div class="function">
<span class="id">fault()</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
<span class="id">Fault</span> should be called
only in the context of an address space 
<span class="id">get</span> or <span class="id">put</span>
function to signal an address space access error
to the Cinquecento evaluator. 
</div>
</div>

<div class="docitem" id="fn:callcc">
<div class="proto">
<div class="function">
<span class="id">callcc(<span class="arg">fn</span>)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
</p>
Calls <span class="arg">fn</span>, passing the current
continuation as its single argument.  The continuation is
represented as a function of one argument, the value to
be passed to the
continuation.  <span class="id">Callcc</span> returns
the value returned by the call
to <span class="arg">fn</span>.
</p>
<p>
It is currently unsafe to invoke continuations that
return to calls to built-in functions.
</p>
</div>
</div>


<div class="docitem" id="fn:applyk">
<div class="proto">
<div class="function">
<span class="id">applyk(<span class="arg">fn</span>, <span class="arg">succ</span>, <span class="arg">fail</span>, <span class="arg">arg</span>, ..., <span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">succ</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">fail</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">Applyk</span> is like
<span class="id"><a href="#fn:apply">apply</a></span>,
but provides control over the outcome of function
applications that cause an error to be raised.
The function <span class="arg">fn</span>
is applied to the arguments <span class="arg">arg ... list</span>
in the same manner as <span class="id"><a href="#fn:apply">apply</a></span>.
If the application causes an error to be raised,
the same error message and stack trace that normally would be printed
are printed, 
then evaluation continues by calling the function
<span class="arg">fail</span> with no arguments.
Otherwise, the function <span class="arg">succ</span>
is called with the result of the application as its
single argument.
</div>
</div>

<h4 id="sec:patterns">The switch statement and pattern matching</h4>

<p>
As in C, the <span class="val">case</span>s of a
<span class="val">switch</span> are compared in
lexical order; control jumps to the first statement
with a matching <span class="val">case</span> label, or to the
optional <span class="val">default</span> label,
regardless of where it appears, if
no <span class="val">case</span> matches.
Control skips past the <span class="val">switch</span> body 
if there is no matching case
and no <span class="val">default</span> label.
</p>

<p>
The syntax and semantics
of <span class="val">switch</span> has been expanded
from that of C in several ways.
First, <span class="val">switch</span> can dispatch on
any type, not just integer types, and therefore the
expressions in <span class="val">case</span> statements
need not be integers.  For example:
</p>

<div class="code">
<pre>
; x = [1,2];
<span class="arg">[ 1, 2 ]</span>
; switch (x) { case [1,2]: printf("match\n"); }
<span class="arg">match</span>
; switch (x) { case []: break; default: printf("non-match\n"); }
<span class="arg">non-match</span>
</pre>
</div>

<p>
The expression being dispatched
(here, <span class="val">x</span>) is compared with
the expressions in <span class="val">case</span>
statements (here, <span class="val">[1,2]</span>
and <span class="val">[]</span>) using
the <span class="val">==</span> operator,
<a href = "#sec:equivalence">whose semantics</a> depends on the values
being compared.  Generally speaking, and unlike
C, <span class="val">case</span> statements may
include <i>expressions</i>, not just constants.  For example,
</p>

<div class="code">
<pre>
; switch (x) { case (gettimeofday() > 2 ? [1,2] : []) : printf("match\n"); }
<span class="arg">match</span>
</pre>
</div>

<p>
When a particular <span class="val">switch</span>
contains <span class="val">case</span> statements with
expressions they are executed in logical order; if a
match occurs prior to reaching a
particular <span class="val">case</span>, then
that <span class="val">case</span>'s expression is not
executed.
</p>

<p>
Cinquecento's most liberal extension
of <span class="val">switch</span> is in supporting
pattern matching, as provided in functional languages
like <a href = "http://caml.inria.fr">Ocaml</a> and 
<a href = "http://www.erlang.org">Erlang</a>.  In addition 
to <span class="val">case</span>
statements a <span class="val">switch</span> may also contain
<span class="val">@match</span> statements, with syntax 
<span class="val">@match <span class="arg">p</span>: 
<span class="arg">s</span> </span> where <span class="arg">p</span> is
a <i>pattern</i> and <span class="arg">s</span> is a statement.  A
pattern is, roughly speaking, a constant but with the allowance that
it may contain variables (including the special <i>don't care</i>
variable <span class="arg">_</span>, also referred to as
the <i>wildcard</i> variable).  So <span class="val">[ 1, 2
]</span> and <span class="val">[ x, 2 ]</span> and <span class="val">[
  [x, y], _, 2 ]</span> are patterns,
while <span class="val">1+2</span> and <span class="val">[ 1, x+2
  ]</span> are not.  A more general form of matching is permitted
using the syntax <span class="val">@match <span class="arg">p</span> 
&& <span class="arg">e</span>:
<span class="arg">s</span> </span> where <span class="arg">e</span> is
an expression that further constrains whether the match should
succeed; we discuss this form in detail below.
 </p>

<p>When pattern matching, variables that occur in patterns correspond
to portions of the object being matched against, and can be
referred to in the code associated with
the <span class="val">@match</span>.  This is most easily seen with an
example:
</p>

<div class="code">
<pre>
; x = [1,2];
<span class="arg">[ 1, 2 ]</span>
; switch (x) { @match [1,y] : printf("match: y = %d\n",y); }
<span class="arg">match: y = 2</span>
; switch (x) { @match [1,_] : printf("matched\n"); }
<span class="arg">matched</span>
; switch (x) { @match [2,y] : break; default: printf("no match\n"); }
<span class="arg">no match</span>
</pre>
</div>

<p>
The first <span class="val">switch</span> statement
matches the initial clause because there exists a value
of <span class="val">y</span> for which the expression
matches the value of <span class="val">x</span>, i.e.,
when <span class="val">y</span>
is <span class="val">2</span>.
Thus, <span class="val">y</span> is bound
to <span class="val">2</span> inside the body of
the <span class="val">@match</span> expression. The
second pattern matches for the same reason, but in this
case the  <span class="arg">_</span> is used so
nothing is bound in the body of the <span class="val">@match</span>.
The third <span class="val">switch</span> fails to match
because there is no valuation
of <span class="val">y</span> that would
permit <span class="val">[2,y]</span> to
match <span class="val">x</span>'s value
of <span class="val">[1,2]</span>.
</p>

<p>Particulars on matching <a href =
"#para:list-pats">lists</a>, <a href="#para:record-pats">records</a>
and <a href = "#para:table-pats">tables</a> are given 
elsewhere in the manual.</p>

<p>
In general, patterns may not contain duplicate
variables, though they may contain more than one
wildcard.  So patterns
like <span class="val">[x,x]</span>, which you might
like to write to match against two-element lists whose
elements are the same value, are disallowed.  On the other hand, the
extended form of pattern matching can be used to recover lost
flexibility.  For example</p>

<div class="code">
<pre>
; x = [1,1];
<span class="arg">[ 1, 1 ]</span>
; switch(x) { @match [y,z] && y == z : printf("match %a %a\n",y,z); }
<span class="arg">match 1 1</span>
; switch(x) { @match [y,z] && y != z : break; default: printf("failed\n"); }
<span class="arg">failed</span>
</pre>
</div>

The first switch statement's pattern <span class="val">[y,z]</span>
matches any two-element list, binding the two elements
to <span class="val">x</span> and <span class="val">y</span>,
respectively, but the additional expression <span class="val">y ==
z</span>, which we call a <i>fender</i>, forces these two elements to
be equal for the pattern to match.  The second switch statement's
pattern is the same, but its fender requires that the two elements are
unequal.  Thus <span class="val">[1,1]</span> matches in the first
switch but not the second.  In general, a fender can be any legal
expression, with its truth or falsity interpreted just as
in <span class="val">if</span> and <span class="val">while</span>
guards, and any variables appearing in a pattern are bound in both the
fender and the body of the <span class="val">@match</span>.
</p>

<p>Pattern variables will <i>shadow</i> variables defined
in a surrounding scope, which may be surprising.  For
example, you might write
</p>

<div class="code">
<pre>
; x = [1,2];
<span class="arg">[ 1, 2 ]</span>
; y = "hello";
<span class="arg">"hello"</span>
; switch (x) { @match y : printf("match, y = %a\n",y); }
<span class="arg">match, y = [ 1, 2 ]</span>
; y;
<span class="arg">"hello"</span>
</pre>
</div>

<p>
Here, the <span class="val">@match</span> statement in
the <span class="val">switch</span>
treats <span class="val">y</span> as a binding variable
which will match anything,
binding <span class="val">y</span> to it.  You might
have expected the match to fail if you
thought <span class="val">y</span> in the @match
corresponded to the variable defined in the outer
scope.  After the <span class="val">switch</span>
concludes, references to <span class="val">y</span>
refer to the <span class="val">y</span> defined in the
outer scope.  In effect, you can think of pattern
variables as being <span class="val">@local</span> to
the @match arm in which they appear.
</p>

<p>
On the other hand, pattern matching only occurs within
<span class="val">@match</span> statements, not 
<span class="val">case</span> statements.  For the latter, 
references to variables in general expressions will refer 
to the outer scope whereas for the former they act as
binders.  For example:
</p>

<div class="code">
<pre>
; x = 6;
<span class="arg">6</span>
; switch (6) { case x : printf("match, x = %d\n",x); }
<span class="arg">match, x = 6</span>
; switch (9) { case x : break; default: printf("no match\n"); }
<span class="arg">no match</span>
; switch (9) { @match x : printf("match, x = %d\n",x); }
<span class="arg">match, x = 9</span>
</pre>
</div>

<p>
A normal <span class="val">switch</span> statement permits falling
through from one <span class="val">case</span> to the next.  In
general, falling through into a <span class="val">@match</span> is
treated as an error.  This is because <span class="val">@match</span>
is most useful when binding variables, and in general there is no
guarantee those variables will be properly bound when falling
through.  For example, consider this code:

<div class="code">
<pre>
switch (7) { @match 7 : while (0); @match [x]: printf("x=%d\n",x); }
</pre>
</div>

<p>
This code will match the first clause, execute
the <span class="val">while (0)</span> and then fall through to the
body of the second <span class="val">@match</span>.  But this clause
refers to the variable <span class="val">x</span> so that executing
the second body without having properly bound it makes no sense.  As
such, Cinquecento will complain with a run-time error:

<div class="code">
<pre>
error: attempt to fall through to a @match
               error	(builtin function)
               entry	(<stdin>:1)
</pre>
</div>

<p>
It is equally dangerous to <span class="val">goto</span> under a
<span class="val">@match</span> statement, but this is not something
we prevent at the moment.  You may fall through <i>from</i>
a <span class="val">@match</span> into a <span class="val">case</span>
or <span clas="val">default</span>.
</p>

<p>
We do permit fall-through in the following idiomatic situation: when
you have multiple <span class="val">@match</span> clauses (with or
without fenders) that bind the same (non-wildcard) variables, with all
bodies empty but the last.  It is also permitted to bind more
variables in earlier clauses as long as fallen-to clauses match a
subset of those variables.  As an example, you can do:
</p>

<div class="code">
<pre>
; switch ([2,1]) { @match [x]: @match [x,_]: @match [x,_,_]: 
    printf("x = %d\n",x); break; }
<span class="arg">x = 2</span>
</pre>
</div>

<p>
This code will match a list of length one, two, or three, and print
its first element.
</p>

<h4 id="sec:domainover">Overview of Domains</h4>

<p>
This section summarizes the concepts and terminology
of Cinquecento domains.
</p>

<p>
Domains are Cinquecento objects that are used to
represent programs in execution.  This representation
is based on the idea of providing an interface to
program state that is based on the syntax of C
programming language.  Domains represent three aspects
of a program in execution: its memory, symbols, and
types.
</p>

</p>
The domain interface is defined procedurally: like an
object in an object-oriented language, a domain
encapsulates the implementation of a predefined set of
operations.
</p>

<p>
The domain interface can be called directly, but
normally Cinquecento programs interact with domains
through C expressions, which are translated by the
Cinquecento evaluator into implicit calls to the domain
interface.
</p>

<p>
A domain is formed by pairing a Cinquecento
<span class="type">address space</span> with a Cinquecento <span class="type">name space</span>.
These objects define complementary subsets of the domain interface.
</p>

<p>
An <span class="type">address space</span> represents the memory of a C program:
a mapping of byte addresses to byte values.
It encapsulates three functions.
Two access functions,
<span class="type">get</span>
and <span class="type">put</span>,
read and write memory.
<span class="type">Map</span>
returns the accessible address
ranges.
</p>

<p>
The
prototypical address space represents the live memory
of a running programs, but address spaces can also
represent less dynamic content, such as the content of
files or strings.  More generally, address spaces can
be composed of ordinary Cinquecento functions that
manage a view of arbitrary synthetic storage.
</p>

<p>
A <span class="type">name space</span>
catalogs the symbols and types of a C program.
It encapsulates five functions.
<span class="type">Looksym</span>
and <span class="type">looktype</span>
map symbol and type names to their definitions.
<span class="type">Enumsym</span>
and <span class="type">enumtype</span>
list the symbols and types
of the name space.
<span class="type">Lookaddr</span>
maps an address to the nearest
symbol.
</p>

<p>
Address spaces and name spaces can be shared among domains.
For example, domains representing multiple running instances of the same
program binary will necessarily have separate address spaces, but
may share a common name space.
</p>

<p>
Domains are supported by two other types of Cinquecento values:
<span class="type">ctype</span>
and <span class="type">cvalue</span>.
</p>

<p>
A <span class="type">ctype</span> represents
a type that can be defined in a C program.
Ctypes both identify C types
(<em>e.g.</em>, pointer to <span class="val">struct foo</span>),
and define C types
(<em>e.g.</em>, the fields and size of <span class="val">struct foo</span>).
</p>

<p>
A <span class="type">cvalue</span> represents a typed,
scalar value that can be computed in a C program.
Every cvalue has an associated ctype that defines
its type.  Cvalues in Cinquecento are much like
<span class="type">rvalues</span> in C: they can be read and written
from memory using variable reference and assignment
operators, combined with other cvalues using C
operators, and cast to other types using casting operators.
</p>

<p>
Every cvalue has an associated domain that
gives meaning to C operations performed on the cvalue.
For example, when a cvalue pointer is dereferenced,
memory is accessed through the address space of its associated domain.
When a cvalue is cast to another type,
the new type definition is obtained from 
the name space of its associated domain.
</p>

<p>
Cvalues from different domains can be combined
without casting in certain sensible cases,
such as array indexing.

A cvalue also can be explicitly cast into a different
domain using the <em>extended cast operator</em>.
</p>

<p>
Domains, name spaces, and address spaces are
first-class values in Cinquecento.
Name spaces and address spaces can be constructed from
Cinquecento functions that implement their interfaces.
In addition, a syntax form, <span class="id"><a
href="#syn:_at_names">@names</a></span>, defines new name spaces
using an extended form of C declaration syntax.  
</p>

<p>
Programs can extend
the domain interface by associating additional functions
with name spaces and address spaces
to expose platform-specific
debugging functionality,
such as access to registers, process control,
and breakpoint control.
</p>

<h4 id="sec:cids">C identifiers</h4>

<p>
C identifiers (cids) represent identifiers in C programs.
They also provide a general-purpose symbol type,
similar to the symbol type of Lisp-based languages.
</p>

<p>
The
predicate <a href="#fn:iscid"><span class="fnindex">iscid</span></a>
tests whether a value is a cid.
</p>

<p id="syn:cid">
A cid literal is a single quote followed by any sequence
of characters comprising a valid C identifier:
</p>

<div class="code">
<pre>
; s = 'identifier;
<span class="arg">identifier</span>
; iscid(s);
<span class="arg">1</span>
</pre>
</div>

<p>
The following functions operate on cids.
</p>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:mkcid">
<span class="id">mkcid(<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cid</span>
</div>
</div>
<div class="desc">
Converts the identifier in the string <span class="arg">str</span>
to a cid.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:cid2str">
<span class="id">cid2str(<span class="arg">cid</span>)</span>
</div>
<div class="param">
<span class="arg">cid</span>: <span class="type">cid</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing the characters of the identifier
<span class="arg">cid</span>.
</div>
</div>


<h4 id="sec:cvalues">Cvalues</h4>

<p>
Cvalues represent scalar typed values of domains,
including integers, floats, and pointers to any type.
Every cvalue has an associated ctype that represents
the type of the value, an associated domain through
which operations such as pointer dereference and type
conversion are resolved, and an <em>underlying
encoding</em> of its value, in the form of an unsigned,
64-bit, 2's complement integer.
</p>

<p>
The
predicate <a href="#fn:iscvalue"><span class="fnindex">iscvalue</span></a>
tests whether a value is a cvalue.
</p>

<p>
The syntax <a href="#syn:_at_typeof"><span class="fnindex">@typeof</span></a>
obtains the ctype associated with a cvalue.
</p>

<p>
Cvalues are the only numeric type in Cinquecento.  The
arithmetic, logical, and relational operators of C are
defined over cvalues, and yield equivalent values.  In
particular, Cinquecento applies the same integer promotion rules and "usual
conversions" that are applied to the operands of unary
and binary operators in C to determine a common type
for the operation and its result.
For example, the relational
operators (<span class="id">&lt;</span>,
<span class="id">&lt;=</span>,
<span class="id">&gt;</span>,
<span class="id">&gt;=</span>,
<span class="id">==</span>,
<span class="id">!=</span>) are implemented by
<a href="#fn:cvalcmp"><span class="id">cvalcmp</span></a>,
which promotes and converts its operands before
comparing them.
</p>


<p>
Functions that operate on cvalues include:
</p>

<div class="docitem" id="fn:domof">
<div class="proto">
<div class="function">
<span class="id">domof(<span class="arg">v</span>))</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">domain</span>
</div>
</div>
<div class="desc">
Returns the domain of <span class="arg">v</span>.
</div>
</div>

<div class="docitem" id="fn:equalcval">
<div class="proto">
<div class="function">
<span class="id">equalcval(<span class="arg">u</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: <span class="type">cvalue</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
<span class="id">Equalcval</span> is an equivalence predicate over cvalues.  
The cvalues <span class="arg">u</span>
and <span class="arg">v</span> are
<span class="id">equalcval</span> if and only if they
have the same underlying encoding.
</div>
</div>

<div class="docitem" id="fn:eqvcval">
<div class="proto">
<div class="function">
<span class="id">eqvcval(<span class="arg">u</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: <span class="type">cvalue</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
<span class="id">Eqvcval</span> is an equivalence predicate over cvalues.  
The cvalues <span class="arg">u</span>
and <span class="arg">v</span> are
<span class="id">eqvcval</span> if and only if they
have the same underlying encoding and
<a href="#fn:eqvctype"><span class="fnindex">eqvctype</span></a>
types.
</div>
</div>

<div class="docitem" id="fn:hashcval">
<div class="proto">
<div class="function">
<span class="id">hashcval(<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">v</span>
suitable for use with the equivalence predicate 
<a href="#fn:equalcval"><span class="id">equalcval</span></a>.
</div>
</div>

<div class="docitem" id="fn:hashqvcval">
<div class="proto">
<div class="function">
<span class="id">hashqvcval(<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">v</span>
suitable for use with the equivalence predicate 
<a href="#fn:eqvcval"><span class="id">eqvcval</span></a>.
</div>
</div>


<div class="docitem" id="fn:cvalcmp">
<div class="proto">
<div class="function">
<span class="id">cvalcmp(<span class="arg">u</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: <span class="type">cvalue</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (-1, 0, or 1)
</div>
</div>
<div class="desc">
Returns the result of comparing
cvalues <span class="arg">u</span>
and <span class="arg">v</span> in the manner of C.
Domain promotion and the usual conversions are
performed on the operands, and the underlying encodings
of the resulting cvalues are compared as either
unsigned or signed values, according to whether their
common type is unsigned or signed.  Returns -1, 0, or 1
if <span class="arg">u</span> is, respectively, less
than, equal to, or greater
than <span class="arg">v</span>.
</div>
</div>


<h4 id="sec:ranges">Ranges</h4>

<p>
A <em>range</em> is an object that represents a
contiguous span of locations in an address space as a
pair of cvalues: the offset of the beginning of the
span, and its length.
</p>

<p>
The predicate
<a href="#fn:isrange"><span class="id">isrange</span></a>
tests whether a value is a range.
</p>

<p>
The functions that operate on ranges are:
</p>

<div class="docitem" id="fn:mkrange">
<div class="proto">
<div class="function">
<span class="id">mkrange(<span class="arg">beg</span>,<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">beg</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">range</span>
</div>
</div>
<div class="desc">
Constructs a new range representing the span
of <span class="arg">len</span> bytes beginning
at <span class="arg">beg</span>.  <span class="arg">Len</span>
must be greater than zero.
</div>
</div>

<div class="docitem" id="fn:rangebeg">
<div class="proto">
<div class="function">
<span class="id">rangebeg(<span class="arg">r</span>)</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the beginning of the range <span class="arg">r</span>.
</div>
</div>

<div class="docitem" id="fn:rangelen">
<div class="proto">
<div class="function">
<span class="id">rangelen(<span class="arg">r</span>)</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the length of the range <span class="arg">r</span>.
</div>
</div>

<div class="docitem" id="fn:isrinr">
<div class="proto">
<div class="function">
<span class="id">isrinr(<span class="arg">r</span>,<span class="arg">rs</span>)</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="param">
<span class="arg">rs</span>: <span class="type">vector or list of ranges</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
This predicate returns non-zero if the
range <span class="arg">r</span> is contained in the
set of ranges <span class="arg">rs</span>, possibly by
spanning one or more adjoined ranges.  The elements
of <span class="arg">rs</span> are assumed to be
non-overlapping and sorted by increasing offset.
</div>
</div>

<h4 id="sec:symref">Symbol references</h4>

<p>
If <span class="id">id</span> is a symbol defined
in domain <span class="id">dom</span>, then an
expression of the form
</p>

<div class="code">
<pre>
dom`id
</pre>
</div>

<p>
is a reference to <span class="id">id</span>.
</p>

<p>
Such a reference may appear anywhere that a value may appear
in a C expression (<em>i.e.</em>, a C <em>rvalue</em>).
The result is a cvalue
that represents the value stored at the location (offset)
of the symbol.  To compute this cvalue, the evaluator:
</p>

<ol>
<li>
Calls <span class="id"><a href="#fn:looksym">looksym</a>(dom,'id)</span> to obtain
the definition of the symbol;
</li>
<li>
Reads (using the address
space <a href="#fn:asget"><span class="id">get</span></a> method) consecutive
bytes from the address space associated with the
domain, starting at the location of the symbol, up to
the number of bytes in the size of its type;
</li>
<li>
Constructs a new cvalue whose domain is <span class="id">dom</span>,
whose type is the type of the symbol,
and whose value is the interpretation of the bytes
read from the address space as a value of the type of the symbol.
</li>
</ol>

<p>
If the symbol for an identifier has a type of the
enumeration constant variant, then identifier is an
enumeration constant, and the reference is handled
differently: instead of causing an access to the
address space, a reference to an enumeration constant
evaluates to a cvalue representing the value of the
constant.  Its domain is the referenced domain, and its
type is the enumeration type for which the constant was
defined.
</p>

<p>
An enumeration constant may be referenced through a
name space rather than a domain.  The domain of the
resulting cvalue is a freshly allocated domain whose
name space is the one being referenced, and whose
address space is that of the literal domain.
</p>


<p>
A symbol reference may also appear anywhere that a
location may appear in a C expression (<em>i.e.</em>, a
C <em>lvalue</em>), such as on the left side of an
assignment form:
</p>

<div class="code">
<pre>
dom`id = x;
</pre>
</div>

<p>
To evaluate this assignment, the evaluator:
</p>

<ol>
<li>
Calls <span class="id"><a href="#fn:looksym">looksym</a>(dom,'id)</span> to obtain
the definition of the symbol;
</li>
<li>
Constructs an encoding of the value on the right side
based on the type of the symbol;
</li>
<li>
Writes (using the address space <a href="#fn:asput"><span class="id">put</span></a> method)
the encoding to the address space associated with
the domain at the location of the symbol.
</li>
</ol>

<p>
An attempt to assign to a reference to an enumeration
constant draws an error.
</p>


<h4 id="sec:litdom">The Literal Domain</h4>

<p>
Cinquecento represents arithmetic literals as cvalues
from the built-in literal domain <span class="val">litdom</span>.
This domain is constructed from the <span class="val">clp64le</span> name space
and the abstract address space returned by
<span class="id"><a href="#fn:sprintfa">mknas</a></span>.
Only the size of arithmetic types matters in this domain; 
pointer size and endianness are irrelevant,
because expressions in this domain never reference memory.
</p>

<h4 id="sec:casts">Type and Domain Conversion</h4>

<p>
Conversion is the process of producing a new cvalue
from an old one by changing its type or domain.
Cinquecento supports the same explicit and implicit
type conversion semantics and operations as C, while
extending the notion of conversion to domains.
</p>

<h5>Explicit conversions</h5>

<p>
The cast operator <span id="syn:cast"
class="id">()</a></span> performs, as in C, an explicit
conversion of the type of a value.  Expressions of
the form
</p>

<div class="code">
(<span class="arg">typename</span>)<span class="arg">expr</span>
</div>

<p>
yield a new cvalue that represents the conversion of the
value <span class="arg">expr</span> to the
type named <span class="arg">typename</span>.
<span class="arg">Typename</span> is a
<a href="#sec:qualifiedtname">qualified type name</a>
(with optional qualifier).  If the type name provides a
qualifier, then it is resolved in the name space or
domain bound to the qualifier.  Otherwise it is
resolved in the domain
of <span class="arg">expr</span>.
</p>

<p>
The cast operator is useful when the name of the type
to which the value is to be converted is known
statically and can be written in type name syntax.
Sometimes, however, the type is determined dynamically,
and represented by a ctype.  In this case,
the conversion can be performed with the <em>extended cast
operator</em> <span id="syn:xcast"
class="id">{}.
</p>

<p>
For example, the following conversion expression:
</p>

<div class="code">
<pre>
q = (struct dom`T*)p;
</pre>
</div>

<p>
can be expressed (more laboriously) with the extended cast operator: 
</p>

<div class="code">
<pre>
t = looktype(dom, @typename(struct T*));
q = {t}p;
</pre>
</div>

<p>
Unlike the cast operator, the extended cast operator
expects its type argument to be a defined type, not a
type name to be resolved.  For example, the following
expression draws an error because the type operand
to the conversion is undefined:
</p>

<div class="code">
<pre>
q = {@typename(struct T*)}p;
</pre>
</div>

<p>
As a special case, if the type operand is
the <em>name</em> <span class="id">void*</span> with
undefined representation, or any alias for that name,
and the value being converted has pointer type, then
the conversion is performed as if the type operand had
the pointer representation of the type of the value
being converted.
</p>

<p id="cncpt:xcastdom">
The extended cast operator also performs
<em>domain conversion</em>.
If <span class="val">dom</span> is a domain, then the
expession
</p>

<div class="code">
<pre>
q = {dom}p;
</pre>
</div>

<p>
converts <span class="val">p</span> to the
domain <span class="val">dom</span>.
</p>

<p>
Domain conversion always involves an implicit type
conversion.  The domain into which the value is being
converted is searched for a definition of type of the
value being converted.  The resulting type definition
is the type to which the value is converted.  It is an
error if there is no definition for the type in the
new domain.
</p> 

<p>
As a special case, when the domain operand is the
literal domain, the type of the operand is stripped
of <tt>typedef</tt> aliases, to ensure that for base
types there exists a definition for the type name.
</p>

<p>
The extended cast operator also accepts a name space or
an address space as the operand to which the value is
converted.  In this case, a new domain is constructed.
Its name space (or address space) is the operand of the
extended cast operator, and its address space (or name
space) is that of the domain of the value being
converted.
</p>

<p>
Ordinarily, the <span class="arg">expr</span> operand
to the conversion operators is a cvalue.  However,
these operators also can be applied to a string.  In
this case, the string is implicitly converted to a
pointer, in a freshly allocated domain, to the first
byte of the string.  For example, in this form:
</p>

<div class="code">
p = (char*)"hello, world\n";
</div>

<p>
<span class="id">p</span> is bound to
a <span class="id">char*</span> cvalue that points to
the first byte of the string <span class="id">"hello,
world\n"</span>.  A new domain is constructed for this
pointer with the name space of the literal domain and a
fresh <a href="#fn:mksas"><span class="id">mksas</span></a>
address space backed by the string operand.
</p>

<h5>Implicit conversions</h5>

<p>
The evaluation of many C operators includes certain
implicit conversions of the operands.  Cinquecento
adheres to the implicit conversions of C, while
extending them to domains.
</p>

<p>
<em>Integer promotion</em> in C is the act of converting a
value of one of the smaller integer types 
(<span class="id">_Bool</span>, <span class="id">char</span>,
<span class="id">unsigned char</span>,
<span class="id">short</span>,
or <span class="id">unsigned short</span>) to a value
of type <span class="id">int</span>.  It is performed
implicitly to the operand of the unary operators
<span class="id">+</span>,
<span class="id">-</span>, <span class="id">~</span>, and
<span class="id">!</span>, and to each of the operands
of the binary operators
<span class="id">+</span>,
<span class="id">-</span>,
<span class="id">*</span>,
<span class="id">/</span>,
<span class="id">%</span>,
<span class="id">&</span>,
<span class="id">|</span>,
<span class="id">^</span>
<span class="id">&lt;</span>,
<span class="id">&gt;</span>,
<span class="id">&lt;=</span>,
<span class="id">&gt;=</span>,
<span class="id">==</span>,
<span class="id">!=</span>,
<span class="id">&lt;&lt;</span>, and
<span class="id">&gt;&gt;</span>,
</p>

<p>
Following integer promotion, the operands to any of the binary
operators except <span class="id">&lt;&lt;</span> and
<span class="id">&gt;&gt;</span> are converted to a
common type through a set of rules called the <em>usual
conversions</em>.  Generally, the usual conversions
determine the smallest type (in terms of the size of
the set of values it represents) that can represent
both values.</p>

<p>
For operands of the same domain, the precise rules are
based on the usual conversions in C.  However, consider
addition of two operands whose types are two
different <span class="id">typedef</span> aliases for
<span class="id">int</span>.  What should the type name
of the result be? C offers no guidance: in the context
of C evaluation rules, the types of rvalues are
intangible, so the type name of this result does not
matter.  To resolve this dilemma, Cinquecento follows
the <span class="id">typedef</span> aliases of each of
the types until a common type (possibly the C base type)
is found.
</p>

<p>
For operands of two different domains, the operands
are first converted to a common domain, and then
the usual conversions are applied.  The rules for
determining the common domain for such <em>mixed-domain
expressions</em> are as follows:
</p>

<ol>

<li>
<p>
If one operand is from the literal domain and the other
is from some other domain, then the operand from the
literal domain is implicitly converted to the domain of
the other operand.
</p>
</li>

<li>
<p>
If the operands are from different non-literal domains,
and neither operand has a pointer type, then both
operands are converted to the literal domain.
</p>
</li>

<li>
<p>
If the operands are from different non-literal domains,
and one or both operands has a pointer type, then the
result depends on the operation.  If the operation is
addition, then (by definition of pointer addition) only
one of the operands has a pointer type.  The
non-pointer operand is converted to the domain of the
pointer operand.  If the operation is subtraction, and
if only one of the operands has a pointer type, then as
with addition the non-pointer operand is converted to
the domain of the pointer operand.  The other case,
subtraction of two pointers from different domains,
raises an error.  No other binary operations on pointer
values are defined, since array indexing expands to
pointer addition.
</p>
</li>

<li>
<p>
All other mixed-domain expressions, including
comparison of pointers from different domains,
draw an error.
</p>
</li>
</ol>

<p>
Remember that the above rules are implicitly applied to
operands of binary expression.  It is always possible
to explicitly cast either operand in order to arrange
an evaluation not supported by the rules.
</p>



<h4 id="sec:cvalueops">C Operators</h4>

<p>
The operators of C are defined over Cinquecento cvalues
and have isomorphic semantics.

The operator set includes arithmetic, bitwise, relational, and logical operators,
as well as operators for accessing values of C's aggregate data types,
and pointer dereference.  All of the operators observe the precedence
and associativity rules of C.
</p>

<p>
The binary arithmetic and bitwise operators
(<span class="id">+</span>,
<span class="id">-</span>,
<span class="id">*</span>,
<span class="id">/</span>,
<span class="id">%</span>,
<span class="id">&amp;</span>,
<span class="id">|</span>,
<span class="id">^</span>,
<span class="id">&lt;&lt;</span>,
<span class="id">&gt;&gt;</span>
)
operate on cvalues of integer type.
Each yields a cvalue of value and
type equivalent to the result in C of
the same operator on operands of
equivalent type and value.
Overflow and underflow semantics on arithmetic are preserved,
and the C type promotion and conversion rules are applied.
</p>


<p>
Similarly, the unary operators 
(<span class="id">+</span>,
<span class="id">-</span>,
<span class="id">!</span>,
<span class="id">~</span>)
operate on cvalues of integer type
and yield a cvalue of type and value
equivalent to the result in C of
the same operator on an operand of equivalent
type and value.
</p>

<p>
The relational operators 
(<span class="id">&lt;</span>,
<span class="id">&lt;=</span>,
<span class="id">&gt;</span>,
<span class="id">&gt;=</span>,
<span class="id">==</span>,
<span class="id">!=</span>)
compare cvalues.  The result of each operator
is a boolean: <span class="val">0</span>
or <span class="val">1</span>, represented
as a cvalue of type <span class="val">int</span>
in the literal domain.
</p>

<p>
The logical operators
(<span class="id">&amp;&amp;</span> and 
<span class="id">||</span>)
compute logical and and over integers, treated as boolean values,
as in C.  Evaluation is short circuited, as in C.
</p>

<h4 id="sec:equivalence">Equivalence and other relations</h4>

<p>
Equivalence is determined by the functions
<span class="id" id="fn:equal">equal</span>,
<span class="id" id="fn:eqv">eqv</span>, and
<span class="id" id="fn:eq">eq</span>.
</p>

<div class="docitem" id="fn:equal">
<div class="proto">
<div class="function">
<span class="id">equal(<span class="arg">u</span>,<span class="arg">v</span>)
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: any values
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
Determines the equality of <span class="arg">u</span>
and <span class="arg">v</span> according to the
following rules.
<ul>
<li>
If <span class="arg">u</span>
and <span class="arg">v</span> are of different types,
they are not <span class="id">equal</span>;
</li>
<li>
If <span class="arg">u</span> is <span class="id">nil</span>
and <span class="arg">v</span>  is <span class="id">nil</span>,
they are <span class="id">equal</span>;
</li>
<li>
If <span class="arg">u</span>
and <span class="arg">v</span> are both address spaces,
cids, domains, file descriptors, name spaces,
procedures, record descriptors, or tables, they
are <span class="id">equal</span> if and only if they
are the same object (pointer equality);
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both cvalues, they are <span class="id">equal</span>
if and only if they are <a href="#fn:equalcval"><span class="id">equalcval</span></a>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both lists or vectors, they are <span class="id">equal</span>
if and only if they have the same length and each of their
corresponding elements are <span class="id">equal</span>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both pairs, they are <span class="id">equal</span>
if and only if both their cars and their cdrs
are <span class="id">equal</span>;
</li>
<li>
If <span class="arg">u</span>
and <span class="arg">v</span> are both ranges, they
are <span class="id">equal</span> if and only if their
offsets and lengths are both <a href="#fn:equalcval"><span class="id">equalcval</span></a>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both records, they are <span class="id">equal</span>
if and only if they have the same record descriptor and each of their
corresponding fields are <span class="id">equal</span>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both strings, they are <span class="id">equal</span>
if and only if they have the same length and contain the same sequence of bytes;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both ctypes, they are <span class="id">equal</span>
if and only if they are <a href="#fn:equalctype"><span class="id">equalctype</span></a>.
</li>
</ul>
</div>
</div>

<div class="docitem" id="fn:eqv">
<div class="proto">
<div class="function">
<span class="id">eqv(<span class="arg">u</span>,<span class="arg">v</span>)
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: any values
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
Determines the equivalence of <span class="arg">u</span>
and <span class="arg">v</span> according to the
following rules.
<ul>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both cvalues, they are <span class="id">eqv</span>
if and only if they are <a href="#fn:eqvcval"><span class="id">eqvcval</span></a>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both ctypes, they are <span class="id">eqv</span>
if and only if they are <a href="#fn:eqvctype"><span class="id">eqvctype</span></a>;
</li>
<li>
Otherwise <span class="arg">u</span> and <span class="arg">v</span>
are <span class="id">eqv</span>
if and only if they are <a href="#fn:equal"><span class="id">equal</span></a>.
</li>
</ul>
</div>
</div>

<div class="docitem" id="fn:eq">
<div class="proto">
<div class="function">
<span class="id">eq(<span class="arg">u</span>,<span class="arg">v</span>)
</div>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: any values
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
Determines the equivalence of <span class="arg">u</span>
and <span class="arg">v</span> according to the
following rules.
<ul>
<li>
If <span class="arg">u</span> is <span class="id">nil</span>
and <span class="arg">v</span>  is <span class="id">nil</span>,
they are <span class="id">eq</span>;
</li>
<li>
If <span class="arg">u</span> and <span class="arg">v</span>
are both cvalues, they are <span class="id">eq</span>
if and only if they are <a href="#fn:eqvcval"><span class="id">eqvcval</span></a>;
</li>
<li>
Otherwise <span class="arg">u</span>
and <span class="arg">v</span>
are <span class="id">eq</span> if and only if they are
the same object (pointer equality).
</li>
</ul>
</div>
</div>

<p>
Each equivalence function is associated with a hash
function.  Each hash function has the property that any
two values that are equivalent by the associated
equivalence function have the same hash value.  This
property of hash functions is used in the
implementation of <a href="#sec:tables">tables</a>.
</p>


<div class="docitem" id="fn:hash">
<div class="proto">
<div class="function">
<span class="id">hash(<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">v</span>
suitable for use with the equivalence predicate 
<a href="#fn:equal"><span class="id">equal</span></a>.
</div>
</div>

<div class="docitem" id="fn:hashqv">
<div class="proto">
<div class="function">
<span class="id">hashqv(<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">v</span>
suitable for use with the equivalence predicate 
<a href="#fn:eqv"><span class="id">eqv</span></a>.
</div>
</div>

<div class="docitem" id="fn:hashq">
<div class="proto">
<div class="function">
<span class="id">hashq(<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">v</span>
suitable for use with the equivalence predicate 
<a href="#fn:eq"><span class="id">eq</span></a>.
</div>
</div>

<p>
The equivalence operators <span class="id">==</span>
and <span class="id">!=</span> are defined
over all types of Cinquecento values.  If the operands
are both cvalues, the result is determined
by <a href="#fn:cvalcmp"><span class="id">cvalcmp</span></a>.
If the operands are both strings, the result is
determined
by <a href="#fn:strcmp"><span class="id">strcmp</span></a>.
If one operand is a string and the other is a
<span class="id">char*</span> or <span class="id">unsigned char*</span>
cvalue, then the cvalue is promoted to a string by calling
<a href="#fn:stringof"><span class="id">stringof</span></a>
and compared to the string with
<a href="#fn:strcmp"><span class="id">strcmp</span></a>.
Operands of any other type are compared with 
<a href="#fn:equal"><span class="id">equal</span></a>.
</p>

<p>
The other relational operators
(<span class="id">&lt;</span>,
<span class="id">&lt;=</span>,
<span class="id">&gt;</span>,
<span class="id">&gt;=</span>,
<span class="id">!=</span>) are defined 
on cvalues, strings, and 
combinations of strings and <span class="id">char*</span> or <span class="id">unsigned char*</span> cvalues in the same manner as
the <span class="id">==</span>
and <span class="id">!=</span> operators.
It is an error to apply them to operands of any other type.
</p>

<h4 id="sec:pointers">Pointers</h4>

<p>
Pointer-typed cvalues represent typed locations in a domain.
</p>

<p>
We illustrate the use of pointers with a simple domain
<span class="id">dom</span>, defined as follows:
</p>

<div class="code">
<pre>
ns = @names c32le {
	struct T {
		@0 int id;
		@4 struct T *next;
		@8;
	};
	@0 int x;
	@4 int y;
	@0 struct T t;
};
as = mkzas(1024);
dom = mkdom(ns, as);
</p>
</pre>
</div>



<p>
As in C, one way to obtain a pointer is through the unary
reference operator.  For example, the form
</p>

<div class="code">
<pre>
p = &amp;dom`x;
</pre>
</div>

<p>
binds <span class="val">p</span>
to a cvalue that represents the
location associated with
<span class="val">x</span> in <span class="val">dom</span>.
</p>

<p>
The domain of a pointer-typed cvalue provides the address space in
which pointer operators on the cvalue are applied.
The operator <span class="val">*</span> dereferences
pointer-typed cvalues.  Precisely
as a C programmer would expect, <span class="val">*</span> accesses the
contents of the location in the associated domain,
using the pointed-to type to determine the size and encoding of
the accessed range.  For example, given the above
binding of <span class="val">p</span>, the two expressions:
</p>

<div class="code">
<pre>
*p
dom`x
</pre>
</div>

<p>
would yield equivalent cvalues.
</p>

<p>
Pointer arithmetic is C pointer arithmetic.  The following sequence
of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`x;
p = p+1;
</pre>
</div>

<p>
leaves <span class="val">p</span> bound to a pointer cvalue that
refers to the location following <span class="val">x</span>
in <span class="val">dom</span>.
As in C, the amount by which the value
of a pointer is incremented is determined by the size
of the underlying type of the pointer.
</p>

<p>
Pointers to aggregate types also work as expected.  The
following sequence of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`t;
p->next = p+1;
</pre>
</div>

<p>
assigns the <span class="val">next</span> field of the <span class="val">struct T</span>
at location <span class="val">t</span> in <span class="val">dom</span> to point to
the beginning of the next logical <span class="val">struct T</span>.
Although there is no symbol corresponding to this
location, we can, as in C, use pointers to impute types
to otherwise untyped locations.
</p>

<p>
Cinquecento maintains the C pointer/array relationship.
The effect of the following sequence of expressions is equivalent
to that of the preceding one:
</p>

<div class="code">
<pre>
p = &amp;dom`t;
p[0].next = p+1;
</pre>
</div>

<p>
The adherence to C pointer semantics extends to
disregard for pointer safety.  The following sequence
of expressions:
</p>

<div class="code">
<pre>
p = &amp;dom`x;
p = p+256;
</pre>
</div>

<p>
binds <span class="val">p</span> to a pointer to a location that
does not exist in the address space of <span class="val">dom</span> (since
we used <a href="#fn:mkzas"><span class="val">mkzas</span></a> to create a fixed 1024-byte address
space).
</p>

<p>
An attempt to dereference a pointer to an unmapped
location draws an error.  To test whether a range is
mapped without risk of error, call
<span class="fnindex"><a href="#fn:ismapped">ismapped</a></span>.
</p>

<h4 id="sec:objects">The object model</h4>

<p>
Three types in Cinquecento &mdash names spaces, address
spaces, and domains &mdash have object-oriented structure.
This section describes the object model.
</p>

<p>
Every object comprises a set of named functions,
called its <em>methods</em>, and a name.
</p>

<p id="syn:invoke">
The primary operation on objects is method invocation.
Given an object <span class="val">o</span>, the method
named <span class="val">f</span> is invoked
(called) with arguments <span class="val"><span class="arg">arg</span>,
...</span> by the following syntax:

<div class="code">
<pre>
o.f(<span class="arg">arg</span>, ...)
</pre>
</div>

</p>

<p>
A method is an ordinary Cinquecento function, but
method invocation is not a completely ordinary function call.
In method invocation, one additional argument, the
object upon which the method is invoked, is prepended
to the argument
list <span class="val"><span class="arg">arg</span>,
...</span></span>.  This argument is conventionally
named <span class="val">this</span> in method
definitions.
</p>

<p>
By default it is an error to invoke a method
named <span class="val">f</span> on an object that does
not define <span class="val">f</span>.  However,
if the object defines a method named
<span class="val">dispatch</span>, then such unresolved
invocations are transformed into the following invocation
of <span class="val">dispatch</span>:
<div class="code">
<pre>
o.dispatch(<span class="val">"f"</span>, <span class="arg">arg</span>, ...)
</pre>
</div>

<p>
The value of a method invocation is the value returned
by the resulting function call.
</p>

<p>
An expression of the form
</p>

<div class="code">
<pre>
o.f
</pre>
</div>

<p>
evaluates to a function that, when called on
arguments <span class="val"><span class="arg">arg</span>,
...</span></span>, is equivalent to the method invocation
</p>

<div class="code">
<pre>
o.f(<span class="arg">arg</span>, ...)
</pre>
</div>

<p>
The name of an object is a string that is typically used by
programs to label an object.  The system provides
functions to access and update object names, but does
not interpret names nor care whether they are used.
Two objects may have the same name.  The default value
of an object's name is <span class="val">nil</span>.
</p>

<p>
<div class="docitem" id="fn:nameof">
<div class="proto">
<div class="function">
<span class="id">nameof(<span class="arg">o</span>)
</div>
<div class="param">
<span class="arg">o</span>: <span class="type">name space</span>, <span class="type">address space</span>, or <span class="type">domain</span>
</div>
<div class="returns">
<span class="type">string</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Returns the name of the object <span class="arg">o</span>.
</div>
</div>

<p>
<div class="docitem" id="fn:setname">
<div class="proto">
<div class="function">
<span class="id">setname(<span class="arg">o</span>, <span class="arg">s</span>)
</div>
<div class="param">
<span class="arg">o</span>: <span class="type">name space</span>, <span class="type">address space</span>, or <span class="type">domain</span>
</div>
<div class="param">
<span class="arg">s</span>: <span class="type">string</span> or <span class="type">nil</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Updates the name of the object <span class="arg">o</span> to <span class="arg">s</span>.
</div>
</div>


<p>
Name spaces and address spaces are constructed from
tables of methods:
</p>

<div class="docitem" id="fn:mkas">
<div class="proto">
<div class="function">
<span class="id">mkas(<span class="arg">tab</span>[,<span class="arg">name</span>])</span>
</div>
<div class="function">
<span class="id">mkns(<span class="arg">tab</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
These functions construct a new address space or new
name space, respectively, from the method table
<span class="arg">tab</span>.  Keys
in <span class="arg">tab</span> are strings,
identifying method names.  Values
in <span class="arg">tab</span> are the
corresponding method functions.  The name of the object is
initialized to <span class="arg">name</span>, if
provided.

<p>
Certain methods are required to be defined by name
spaces and address spaces, either as explicit entries
in their method tables or as names recognized by
a <span class="val">dispatch</span> method.  These
methods are discussed below in the sections on
<a href="#sec:namespaces">names spaces</a>
and
<a href="#sec:addressspaces">address spaces</a>.
Name spaces and address spaces may define any number of
additional methods.
</p>

</div>
</div>


<p>
A domain object is constructed from a name space and
address space object.
</p>

<div class="docitem" id="fn:mkdom">
<div class="proto">
<div class="function">
<span class="id">mkdom(<span class="arg">ns</span>,<span class="arg">as</span>[,<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">ns</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">as</span>: <span class="type">address space</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">domain</span>
</div>
</div>
<div class="desc">
Constructs a new domain whose associated name space 
and address space are
<span class="arg">ns</span> and
<span class="arg">as</span>.  The name of the object is
initialized to <span class="arg">name</span>, if
provided.
</div>
</div>

<p>
Any method defined by either the name space or address space
used to construct a domain may be invoked on the domain.
Names are resolved in the following order:
</p>

<ol>
<li>Name space method table;</li>
<li>Address space method table;</li>
<li>Name space <span class="val">dispatch</span> method, if defined;</li>
<li>Address space <span class="val">dispatch</span> method, if defined.</li>
</ol>

<p>
If both the name space and the address space define
a <span class="val">dispatch</span> method, only the
name space <span class="val">dispatch</span> will ever
be used to resolve method invocations through the
domain.
</p>

<p id="syn:asof">
The name space and address space used to construct a
domain <span class="val">dom</span> can be accessed by
the following syntax:
</p>

<div class="code">
<pre>
dom.ns  /* evaluates to the name space of dom */
dom.as  /* evaluates to the address space of dom */
</pre>
</div>

In addition, two functions provide equivalent access:

<div class="docitem" id="fn:asof">
<div class="proto">
<div class="function">
<span class="id">asof(<span class="arg">dom</span>)
</div>
<div class="function">
<span class="id">nsof(<span class="arg">dom</span>)
</div>
<div class="param">
<span class="arg">dom</span>: <span class="type">domain</span>
</div>
<div class="returns">
<span class="type">address space or name space</span>
</div>
</div>
<div class="desc">
These functions return the address space or 
name space, respectively, used to construct
the domain <span class="arg">dom</span>.
</div>
</div>


<p>
The object model described here was designed to
implement the domain abstraction, not for
general-purpose object-oriented programming.
Plans for future development of Cinquecento
include support for a better object system.
</p>

<h4 id="sec:symbols">Symbols, Fields, Parameters</h4>

<p>
A C <em>symbol</em> &mdash a named, typed location
&mdash is represented in Cinquecento as a triple
comprising name (of type string), type (ctype), and
optional attribute table (table).
</p>

<p>
The attribute table maps names (strings) to
values.  The only attribute consulted by the system is
the one named <span class="val">"offset"</span>.  Its
value is a cvalue representing the offset of the first
byte of the object named by the symbol from the start
of the address space in which it resides.  Attribute
tables otherwise offer a convenient way for programs to
associate arbitrary data with a symbol.
</p>

<p>
L1 implements symbols using vectors, rather than, say,
a record or a dedicated primitive type.  This
representation is likely to change.  To avoid breaking
in the future, programs should use the following
functions to create and access symbols, and not
directly access the vector.  In particular, the effect
of modifying a symbol vector is undefined.  (In what
follows, <span class="type">symbol</span> denotes the
representation of symbols.)
</p>


<div class="docitem" id="fn:mksym">
<div class="proto">
<div class="function">
<span class="id">mksym(<span class="arg">type</span>,<span class="arg">id</span>[,<span class="arg">attr</span>])
</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span>
</div>
<div class="param">
<span class="arg">attr</span>: <span class="type">table or cvalue</span> or
<span class="type">nil</span>
</div>
<div class="returns">
<span class="type">symbol</span>
</div>
</div>
<div class="desc">
Constructs a new symbol from
<span class="arg">type</span>,
<span class="arg">id</span>, and
<span class="arg">attr</span>.
If <span class="arg">attr</span> is a cvalue, it is
promoted to an attribute table that maps
<span class="val">"offset"</span> to <span class="arg">attr</span>.
If <span class="arg">attr</span> is <span class="arg">nil</span>
or omitted, no attribute table is created.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:symid">
<span class="id">symid(<span class="arg">sym</span>)</span>
</div>
<div class="param">
<span class="arg">sym</span>: <span class="type">symbol</span>
</div>
<div class="returns">
<span class="type">cid</span>
</div>
</div>
<div class="desc">
Returns the name of <span class="arg">sym</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:symtype">
<span class="id">symtype(<span class="arg">sym</span>)</span>
</div>
<div class="param">
<span class="arg">sym</span>: <span class="type">symbol</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the type of <span class="arg">sym</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:symattr">
<span class="id">symattr(<span class="arg">sym</span>)</span>
</div>
<div class="param">
<span class="arg">sym</span>: <span class="type">symbol</span>
</div>
<div class="returns">
<span class="type">table or nil</span>
</div>
</div>
<div class="desc">
Returns the attribute table of <span class="arg">sym</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:symoff">
<span class="id">symoff(<span class="arg">sym</span>)</span>
</div>
<div class="param">
<span class="arg">sym</span>: <span class="type">symbol</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
If <span class="arg">sym</span> does not have an
attribute table, or if its attribute table does not define
the attribute <span class="val">"offset"</span>,
then this function returns <span class="val">nil</span>.
Otherwise it returns the value of the
attribute <span class="val">"offset"</span >.
</div>
</div>


<p>
Two additional C abstractions &mdash the fields of an
aggregate ctype (<span class="val">struct</span>
or <span class="val">union</span>), and the parameters
of a function &mdash are structually analogous to a
symbol.  Because of the similarity, Cinquecento uses
its symbol representation for these two abstractions.
</p>

<p>
A difference between fields and symbols is that the
offset attribute of a field represents the offset of
the first byte of the field from the start of the
aggregate in which it resides.  Parameters are
different from symbols in that there is no notion of an
offset, and some parameters ("abstract declarators")
omit an identifier. 
</p>

<p>
The following functions, based on the symbol functions,
operate on fields and parameters (denoted <span class="type">field</span>
and <span class="type">param</span> below).
</p>

<div class="docitem" id="fn:mkfield">
<div class="proto">
<div class="function">
<span class="id">mkfield(<span class="arg">type</span>,<span class="arg">id</span>[,<span class="arg">attr</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span>
</div>
<div class="param">
<span class="arg">attr</span>: <span class="type">table or cvalue</span> or
<span class="type">nil</span>
</div>
<div class="returns">
<span class="type">field</span>
</div>
</div>
<div class="desc">
Constructs a new field
from <span class="arg">type</span>,
<span class="arg">id</span>, and
<span class="arg">attr</span>.
The resulting value is a suitable
element for the <span class="arg">fields</span>
argument
to <span class="fnindex"><a href="#fn:mkctype_struct">mkctype_struct</a></span>
or <span class="fnindex"><a href="#fn:mkctype_union">mkctype_union</a></span>.
If <span class="arg">attr</span> is a cvalue, it is
promoted to an attribute table that maps
<span class="val">"offset"</span> to <span class="arg">attr</span>.
If <span class="arg">attr</span> is <span class="arg">nil</span>
or omitted, no attribute table is created.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:fieldid">
<span class="id">fieldid(<span class="arg">field</span>)</span>
</div>
<div class="param">
<span class="arg">field</span>: <span class="type">field</span>
</div>
<div class="returns">
<span class="type">cid</span>
</div>
</div>
<div class="desc">
Returns the name of <span class="arg">field</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:fieldtype">
<span class="id">fieldtype(<span class="arg">field</span>)</span>
</div>
<div class="param">
<span class="arg">field</span>: <span class="type">field</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the type of <span class="arg">field</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:fieldattr">
<span class="id">fieldattr(<span class="arg">field</span>)</span>
</div>
<div class="param">
<span class="arg">field</span>: <span class="type">field</span>
</div>
<div class="returns">
<span class="type">table or nil</span>
</div>
</div>
<div class="desc">
Returns the attribute table of <span class="arg">field</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:fieldoff">
<span class="id">fieldoff(<span class="arg">field</span>)</span>
</div>
<div class="param">
<span class="arg">field</span>: <span class="type">field</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
If <span class="arg">field</span> does not have an
attribute table, or if its attribute table does not define
the attribute <span class="val">"offset"</span>,
then this function returns <span class="val">nil</span>.
Otherwise it returns the value of the
attribute <span class="val">"offset"</span >.
</div>
</div>

<div class="docitem" id="fn:mkparam">
<div class="proto">
<div class="function">
<span class="id">mkparam(<span class="arg">type</span>[,<span class="arg">id</span>[,<span class="arg">attr</span>]])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span> or <span class="type">nil</span>
</div>
<div class="param">
<span class="arg">attr</span>: <span class="type">table</span> or
<span class="type">nil</span>
</div>
<div class="returns">
<span class="type">param</span>
</div>
</div>
<div class="desc">
Constructs a new param
from <span class="arg">type</span>,
<span class="arg">id</span>, and
<span class="arg">attr</span>.
The resulting value is a suitable
element for the <span class="arg">params</span>
argument
to <span class="fnindex"><a href="#fn:mkctype_fn">mkctype_fn</a></span>.
If <span class="arg">attr</span> is <span class="val">nil</span> or omitted,
no attribute table is created.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:paramid">
<span class="id">paramid(<span class="arg">param</span>)</span>
</div>
<div class="param">
<span class="arg">param</span>: <span class="type">param</span>
</div>
<div class="returns">
<span class="type">cid</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Returns the name of <span class="arg">param</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:paramtype">
<span class="id">paramtype(<span class="arg">param</span>)</span>
</div>
<div class="param">
<span class="arg">param</span>: <span class="type">param</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the type of <span class="arg">param</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:paramattr">
<span class="id">paramattr(<span class="arg">param</span>)</span>
</div>
<div class="param">
<span class="arg">param</span>: <span class="type">param</span>
</div>
<div class="returns">
<span class="type">table or nil</span>
</div>
</div>
<div class="desc">
Returns the attribute table of <span class="arg">param</span>.
</div>
</div>



<h4 id="sec:namespaces">Name spaces</h4>

<p>
Name spaces are <a href="#sec:objects">objects</a> that
catalog information about a set of C types and symbols.
The primitive constructor for a name space is
<span class="fnindex"><a href="#fn:mkns">mkns</a></span>.
Higher-level constructors are the syntax <span class="fnindex"><a
href="#syn:_at_names">@names</a></span> and the function
<span class="fnindex"><a
href="#fn:mknsraw">mknsraw</a></span>.
The predicate
<a href="#fn:isns"><span class="fnindexid">isns</span></a>
tests whether a value is a name space.
</p>

<p>
Every name space implements the following five methods:
</p>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:nslooktype">
<span class="id">looktype(<span class="arg">this</span>,<span class="arg">typename</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">typename</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
This name space method returns the definition of the type
name <span class="arg">typename</span> in the name
space, or <span class="val">nil</span> if the type is
not defined.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:nslooksym">
<span class="id">looksym(<span class="arg">this</span>,<span class="arg">id</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span>
</div>
<div class="returns">
<span class="type">symbol</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
This name space method returns the definition of the symbol
named <span class="arg">id</span> in the name
space, or <span class="val">nil</span> if the symbol is
not defined.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:nsenumtype">
<span class="id">enumtype(<span class="arg">this</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
This name space method returns a table containing the
types defined by the name space.
Keys are type names, values are corresponding type definitions.
Modifying the table may cause undefined effects.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:nsenumsym">
<span class="id">enumsym(<span class="arg">this</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
This name space returns a table containing the symbols
defined by the name space.
Keys are identifiers, values are corresponding symbols.
Modifying the table may cause undefined effects.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:nslookaddr">
<span class="id">lookaddr(<span class="arg">this</span>,<span class="arg">addr</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">addr</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">symbol</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
This name space method returns a symbol defined in the
name space whose offset is closet to, but not greater
than, the offset <span class="arg">addr</span>.
If there is more than one such symbol, an arbitrary one is returned.
If no such symbol exists, <span class="val">nil</span> is returned.
</div>
</div>

<p id="para:nstypes">
The <span class="fnindex"><a href="#fn:enumtype">enumtype</a></span>
and
<span class="fnindex"><a href="#fn:looktype">looktype</a></span>
methods of every name space must provide definitions
for the following types:
<div class="code">
<pre>
char         unsigned char          _Bool         _Complex
short	     unsigned short	    float         double _Complex
int	     unsigned int	    double        long double _Complex
long	     unsigned long	    long double
long long    unsigned long long     void*
</pre>
</div>
</p>

<p>
The definition for <span class="val">void*</span>
establishes the pointer representation for the name
space.  The other definitions establish mandatory C base types.
</p>

<p>
In addition, these methods may define any number of additional
tagged aggregated types,
tagged enumeration types,
and <span class="val">typedef</span>s.
</p>

<p>
A composite type &mdash a pointer to, an array of, or a
function of an already defined type &mdash need not be
explicitly defined by
<span class="fnindex"><a href="#fn:enumtype">enumtype</a></span>
and
<span class="fnindex"><a href="#fn:enumtype">looktype</a></span>.
Other than the
special case of <span class="val">void*</span>, the system will never
consult either method for a composite type definition.
</p>


<p>
Several functions operate on name spaces:
</p>

<div class="docitem" id="fn:nsptr">
<div class="proto">
<div class="function">
<span class="id">nsptr(<span class="arg">ns</span>)</span>
</div>
<div class="param">
<span class="arg">ns</span>: <span class="type">name space</span>
</div>
<div class="returns">
<span class="type">value</span>
</div>
</div>
<div class="desc">
Returns the representation of the pointer type defined
in <span class="arg">ns</ span>.
</div>
</div>

<div class="docitem" id="fn:looktype">
<div class="proto">
<div class="function">
<span class="id">looktype(<span class="arg">obj</span>,<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">obj</span>: <span class="type">domain</span> or <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">typename</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Returns the definition of the type
name <span class="arg">typename</span>
in the name space or domain <span class="arg">obj</span>.
</div>
</div>

<div class="docitem" id="fn:looksym">
<div class="proto">
<div class="function">
<span class="id">looksym(<span class="arg">obj</span>,<span class="arg">id</span>)</span>
</div>
<div class="param">
<span class="arg">obj</span>: <span class="type">domain</span> or <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span>
</div>
<div class="returns">
<span class="type">symbol</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Returns the definition of the symbol
named <span class="arg">id</span>
in the name space or domain <span class="arg">obj</span>.
</div>
</div>



<h4 id="sec:rootnamespaces">Root Name Spaces</h4>

<p>
Cinquecento defines several top-level <em>root name
spaces</em> that correspond to common C compiler
choices.  They vary in the size and encoding of
integers and pointers.
</p>

<div class="table-short">
<table>

<tr>
<th>Root name space</th>
<th><span class="id">sizeof(void*)</span></th>
<th><span class="id">sizeof(long)</span></th>
<th>Encoding</th>
</tr>

<tr>
<td>
<span class="id">c32le</span>
</td>
<td>
4
</td>
<td>
4
</td>
<td>
little endian
</td>
</tr>

<tr>
<td>
<span class="id">c32be</span>
</td>
<td>
4
</td>
<td>
4
</td>
<td>
big endian
</td>
</tr>

<tr>
<td>
<span class="id">c64le</span>
</td>
<td>
4
</td>
<td>
8
</td>
<td>
little endian
</td>
</tr>

<tr>
<td>
<span class="id">c64be</span>
</td>
<td>
4
</td>
<td>
8
</td>
<td>
big endian
</td>
</tr>

<tr>
<td>
<span class="id">clp64le</span>
</td>
<td>
8
</td>
<td>
8
</td>
<td>
little endian
</td>
</tr>

<tr>
<td>
<span class="id">clp64be</span>
</td>
<td>
8
</td>
<td>
8
</td>
<td>
big endian
</td>
</tr>

</table>
</div>
 
<p>
In addition to the <a href="#para:nstypes">types</a> defined by all name spaces,
every root name spaces defines the following convenience
<span class="val">typedef</span>s:

<div class="code">
<pre>
int8         uint8 	     uintptr
int16	     uint16
int32	     uint32
int64	     uint64
</pre>
</div>

The types <span class="val">int</span><span class="arg">X</span>
and <span class="val">uint</span><span class="arg">X</span>
correspond, respectively, to signed and unsigned
integers of <span class="arg">X</span> bytes.
The type <span class="val">uintptr</span> represents
is an unsigned integer large enough to hold pointers.
</p>

<p>
One function operates on root name spaces.
</p>

<div class="docitem" id="fn:myrootns">
<div class="proto">
<div class="function">
<span class="id">myrootns()</span>
</div>
<div class="returns">
<span class="type">ns</span>
</div>
</div>
<div class="desc">
Returns the root name space corresponding to the machine
model for which the currently running L1 executable was built.
</div>
</div>

<h4 id="sec:_at_names"><span class="val">@names</span></h4>

<p>
The <span class="id"><a href="#syn:_at_names">@names</a></span>
form is used to construct a name space from a set of type and symbol
declarations.
</p>

<p>
The syntax is:
</p>
<div class="docitem" id="syn:_at_names">
<div class="proto">
<div class="syntax">
<span class="id">@names <span class="arg">parent</span> {
	<span class="arg">decl</span> ...
}
</span>
</div>
<div class="param">
<span class="arg">parent</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">decl</span>: <span class="type">type or symbol declaration</span>
</div>
<div class="returns">
<span class="type">name space</span>
</div>
</div>
</div>

<p>
The result is a fresh name space that contains the types and symbols
defined in <span class="arg">parent</span> as well as 
those declared by the <span class="arg">decl ...</span>
forms in the body.  If a <span class="arg">decl</span>
declaration collides with (defines the same name as) a
symbol or type in <span class="arg">parent</span>, the
new <span class="arg">decl</span> definition shadows
the <span class="arg">parent</span> definition.
</p>

<p>
A <span class="arg">decl</span> comes in one of four declaration forms:
aggregate,
symbol,
enumeration,
or typedef.
Generally, the syntax of these forms are extensions of the
corresponding declaration forms in C.
</p>

<p>
Aggregate declarations declare
a <span class="val">struct</span>
or <span class="val">union</span> type.  Here is a basic example:
</p>

<div class="code">
<pre>
ns = @names c32le {
	struct foo {
		@0x0	int field1;
		@0x4	char *field2;
		@0x8;
	};
};
</pre>
</div>

<p>
This form constructs (and binds to the
variable <span class="id">ns</span>) a new name space
derived from the root name
space <span class="val">c32le</span>.  The body of
the <span class="val">@names</span> form contains a
single declaration of the aggregate type
<span class="val">struct foo</span>.  This declaration
is syntactically like a C aggregate declaration, except:

<ul>

<li>
each field declaration begins with an <em>attribute
expression</em> of the
form <span class="val">@<span class="arg">expr</span></span>
that specifies the offset of the field relative to the
beginning of the aggregate;
</li>

<li>
the declaration ends with a final attribute
expression (not associated with any field) that
specifies the size of the aggregate.
</li>

</ul>
</p>

<p>
Here, the declaration says
that <span class="val">struct foo</span> has two
fields.  The field
named <span class="val">field1</span> begins at byte
offset <span class="val">0</span> from the start of the
aggregrate, and has type <span class="val">int</span>.
The field named <span class="val">field2</span> begins
at byte offset <span class="val">4</span> from the
start of the aggregrate, and has
type <span class="val">char*</span>.  The third and
final line of the aggregate declares
the overall size of a <span class="val">struct foo</span>
to be <span class="val">8</span> bytes.
</p>

<p>
The value of this <span class="val">@names</span> form
is a new name space that contains the types and symbols
of <span class="val">c32le</span> plus the newly declared
type <span class="val">struct foo</span>.  
The definitions of the types <span class="val">int</span>
and <span class="val">char*</span> given to the
fields of <span class="val">struct foo</span> are drawn from
the parent name space <span class="val">c32le</span>.
</p>

<p>
An attribute expression is, in general, either an
expression that evaluates to a cvalue representing the offset, as in the above example,
or an expression that evaluates to a table.
In the latter case, the table must include an
entry whose key is the
string <span class="val">"offset"</span> and whose
value is a cvalue specifying the offset.  The table may
include any number of addition key/value pairs, none of
which will consulted by the Cinquecento evaluator, but
rather may be used by programs to  associate
additional information with the aggregate or individual fields.
</p>

<p>
Internally, the Cinquecento evaluator maintains a
separate attribute table for every field as well as for
the entire aggregate.  If the attribute expression is a
cvalue, this value is implicitly promoted to an
attribute table by creating a fresh table of one
element that maps the string
<span class="val">"offset"</span> to the specified
cvalue.  The following form, for instance, yields a
name space that is equivalent to the one given above,
except that an additional (silly)
attribute <span class="val">flavor</span> is associated
with both <span class="val">field2</span> and the
overall aggregate.
</p>

<div class="code">
<pre>
ns = @names c32le {
	struct foo {
	   	@0x0	int field1;
		@[ "offset" : 0x4,
		   "flavor" : "bald" ] int field2;
		@[ "offset" : 0x8,
		   "flavor" : "all-weather" ];
	   };
};
</pre>
</div>

<p>
Bitfields involve a special attribute expression.
Normally the offset attribute of a field is interpreted
to be a count of bytes from the beginning of the
aggregate to the beginning of the field.  If, however,
the attribute expression begins
with <span class="val">@@</span> instead of
<span class="val">@</span>, then the offset is
interpreted as a count of <em>bits</em> from the
beginning of the aggregate.  In this case, an
additional bitfield width, specified like
a C bitfield width, is expected, and the type of the
resulting field is wrapped in a bitfield ctype.
</p>

<p>
For example:
<div class="code">
<pre>
ns = @names c32le {
	struct foo {
		@0x0	int field1;
		@@0x4*8	int bitfield : 3;
		@0x8;
	};
};
</pre>
</div>
declares <span class="val">bitfield</span> to be a 3-bit bitfield at bit offset 32 of
<span class="val">struct foo</span>.
</p>

<p>
The bitfield attribute expression must be a cvalue
expression.  An explicit table expression is not
permitted.
</p>

<p>
An aggregate may declare <em>anonymous
fields</em> of aggregate type.  These interior
aggregates may be declared within the containing
aggregate, or refer to an aggregate declared elsewhere.
Either way, their fields become in effect the fields of
the containing aggregate.  For example, this sequence
of expressions:
</p>

<div class="code">
<pre>
ns = @names c32le {
   struct foo {
   	@0x0	int field1;
	@0x4	struct {
			@0x0 int subfield1;
			@0x4 int subfield2;
			@0x8;
		};
	@0xc    struct bar;
	@0x10;
   };
   struct bar {
	@0x0	int subfield3;
	@0x4;
   };
};

dom = mkdom(ns, litdom.as);
p = (struct foo*){dom}0;
printf("%d ", &p->field1);
printf("%d ", &p->subfield1);
printf("%d ", &p->subfield2);
printf("%d\n", &p->subfield3);
</pre>
</div>

<p>
yields
</p>

<div class="code">
<pre>
0 4 8 12
</pre>
</div>

<p>
The result of creating an aggregate with multiple fields
of the same name is undefined.
</p>

<p>
The attribute expression that declares the size of the
aggregate is required in every non-empty aggregate
declaration.  It always appears as the final
declaration.  In the special case of a zero-sized
aggregate containing no fields, the final attribute is
permitted but not required:
</p>

<div class="code">
<pre>
ns = @names c32le {
	struct empty { };
};
</pre>
</div>

<p>
Explicit offset attributes offer far greater control
over the layout of an aggregate type than is possible
in C.  This flexibility is designed to allow
Cinquecento to be independent of variations in C
compiler aggregate layout policies, but it also admits
some unnatural constructions.  Multiple overlapping
fields, unaligned fields, fields that extend past the
aggregate, fields that begin before (given negative
offset values) the aggregate, and arbitrary gaps in
between fields, are all permitted.  In particular,
given this flexibility, the Cinquecento evaluator makes
no distinction between
a <span class="val">struct</span> aggregate and
a <span class="val">union</span> aggregate, other than
type name.
</p>

<p>
Symbol declarations associate a name and type with a
location.  The syntax for a symbol declaration is like
the syntax of a C variable declaration, except that each symbol
declaration begins with an attribute expression.  For example:
</p>


<div class="code">
<pre>
ns = @names c32le {
	@0x1000	int x;
};
</pre>
</div>

<p>
The attribute expression of a symbol gives the offset
in bytes from the beginning of the address space
(address <span class="val">0</span>) to the first byte
of the object named by the symbol.  As with attribute
expressions of aggregates, the attribute expression
for a symbol may be either a cvalue giving the offset,
or a table containing a key <span class="val">"offset"</span>
paired with an offset value; regardless, the evaluator
maintains an attribute table for each symbol.
</p>

<p>
Here, the declaration associates
a symbol named <span class="val">x</span> of 
type <span class="val">int</span>
with the location beginning at offset <span class="val">0x1000</span>.
</p>

<p>
In C, an initializer may follow a variable declaration
(<span class="val">int x = 5;</span>),
but not in Cinquecento.  Name spaces project symbolic
interpretations over the raw bytes of address spaces;
they do not populate them with values.
</p>

<p>
Enumeration declarations declare
an <span class="val">enum</span> type.  The syntax for
an enumeration declaration is the same as enumeration
declaration syntax in C.
</p>

<div class="code">
<pre>
ns = @names c32le {
	enum Rkind
	{
		Rundef=0,
		Ru08le,
		Ru16le,
		Rnrep,
	};
};
</pre>
</div>

<p>
The implicit initialization rules of C are followed in
Cinquecento.  Unless explicitly initialized, the first
constant of an <span class="val">enum</span> is
initialized to <span class="val">0</span>.  Any
subsequent uninitialized constant is set to the
result of incrementing the previous constant.
The initializer expression may be any expression
that yields a cvalue.
</p>

<p>
The constants of an enumeration declaration may be
referenced in a subsequent enumeration constant
expression, as well as in the element size expression
of an array declaration.  For example:
</p>

<div class="code">
<pre>
ns = @names c32le {
	enum Rkind
	{
		Rundef,
		Ru08le,
		Ru16le,
		Rnrep,
	};

	enum Qkind
	{
		Qundef = Rnrep,
		Q1,
		Q2,
		Qnq,
	};

	struct foo {
		@0x0	int rs[Rnrep];
		@0x4;
	};

	@0x100 int RQ[Rnrep+Qnq];
};
</pre>
</div>

<p>
(It is an oversight that enumeration constants may not
be referenced in attribute expressions; this will be
addressed soon.)
</p>

<p>
Typedef declarations gives names to arbitrary types.
Their syntax follows that of C.
</p>

<div class="code">
<pre>
ns = @names c32le {
	typedef
	enum Rkind
	{
		Rundef,
		Ru08le,
		Ru16le,
		Rnrep,
	} Rkind;

	struct foo {
		@0x0	Rkind r;
		@0x4	foo_t next;
		@0x8;
	};

	typedef struct foo* foo_t;
};
</pre>
</div>

<p>
As illustrated in this example, a typedef name
may be referenced before its declaration,
unlike C.
</p>

<p>
A name can be associated with
the resulting name space object with <span class="fnindex"><a href="#fn:setname">setname</a></span>.
</p>


<p>
A common use of <span class="val">@names</span> is to
include a file of externally generated type and symbol
declarations into the <span class="val">@names</span> body:
</p>

<div class="code">
<pre>
ns = @names c32le {
	@include "mydecls.names"
};
</pre>
</div>

<p>
For instance, the program <span class="val">dwarf2cqct</span>
(available on the <a href="http://cqctworld.org">web</a>),
generates declarations suitable for inclusion in the body
of a <span class="val">@names</span> form from the DWARF debugging
information contained in an ELF executable.
</p>

<p>
Unfortunately, there is no straightforward way to make
the filename in these forms (or in any use of
<span class="id">@include</span>) a variable to be
evaluated at run time.  The idiomatic workaround is to
use <span class="fnindex"><a href="#fn:eval">eval</a></span>:
</p>

<div class="code">
<pre>
@define atnames(parent, file)
{
	@local s, f;
	s = sprintfa("@lambda(pns) {
			@names pns { @include \"%s\" };
		      };",
		     file);
	f = eval(s);
	return f(parent);
}
ns = atnames(c32le, "/tmp/mydecls.names");
</pre>
</div>



<p>

The <span class="id"><a href="#syn:_at_names">@names</a></span>
form is a high-level syntactic form that is expanded
(at compile time) into a series of ctype and symbol
definitions that are entered into a pair of tables that
map type and symbol names to their definitions.  The
following function is the low-level constructor that
produces a name space from these tables.
It is not needed by most programs.
</p>

<div class="docitem" id="fn:mknsraw">
<div class="proto">
<div class="function">
<span class="id">mknsraw(<span class="arg">parent</span>,<span class="arg">typetab</span>,<span class="arg">symtab</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">parent</span>: <span class="type">name space</span>
</div>
<div class="param">
<span class="arg">typetab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">symtab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">name space</span>
</div>
</div>
<div class="desc" id="cncpt:incompletetype">
<span class="arg">Typetab</span> is a table whose keys
are type names (as ctypes) and whose values are type
definitions (as ctypes).  The type definitions may be
<em>incomplete</em>: types definitions may refer to
type names rather than fully specified types.  As long
as a definition for the referenced type occurs either
elsewhere in <span class="arg">typetab</span> or in the
name space <span class="arg">parent</span>, the type
definition will be implicitly resolved.  If a referenced
type is defined in both <span
class="arg">typetab</span> and <span
class="arg">parent</span>, the <span
class="arg">typetab</span> definition has precedence.
</div>
<div class="desc">
<span class="arg">Symtab</span> is a table whose keys
are symbol names (as strings) and whose values are
symbols (in the 3-element vector form defined above).
As with <span class="arg">typetab</span>, the types
occurring in symbols may be type references.
</div>
<div class="desc">
<span class="id">Mknsraw</span> resolves all type
references, then constructs and returns a new name
space.
</div>


<div class="desc">
The name of the resulting name space object is
initialized to <span class="arg">name</span>, if
provided.
</div>
</div>

<h4 id="sec:addressspaces">Address spaces</h4>

<p>
Address spaces are <a href="#sec:objects">objects</a>
that represent sparse byte-addressed storage.
The primitive constructor for an address space is
<span class="fnindex"><a href="#fn:mkas">mkas</a></span>.
The predicate
<a href="#fn:isas"><span class="fnindexid">isas</span></a>
tests whether a value is an address space.
</p>

<p>
Every address space implements the following four methods:
</p>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:asget">
<span class="id">get(<span class="arg">this</span>,<span class="arg">r</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
This address space method returns a string containing
the bytes located in the
range <span class="arg">r</span> of the address space.
It is an error (<span class="fnindex"><a href="#fn:fault">fault</a></span>)
if the range is out of bounds.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:asput">
<span class="id">put(<span class="arg">this</span>,<span class="arg">r</span>,<span class="arg">s</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="param">
<span class="arg">s</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
This address space method replace the bytes
located in the range <span class="arg">r</span> of the address space
with those in <span class="arg">s</span>.
It is an error (<span class="fnindex"><a href="#fn:fault">fault</a></span>)
if the range is out of bounds or if <span class="arg">s</span>
is shorter than the range.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:asmap">
<span class="id">map(<span class="arg">this</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="returns">
<span class="type">vector of ranges</span>
</div>
</div>
<div class="desc">
This address space method returns a vector
of non-overlapping ranges in order of increasing offset
corresponding to the ranges of the address space
that may be accessed by 
<span class="fnindex"><a href="#fn:asget">get</a></span>
or <span class="fnindex"><a href="#fn:asput">put</a></span>
method invocations.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function"  id="fn:asismapped">
<span class="id">ismapped(<span class="arg">this</span>,<span class="arg">r</span>)
</div>
<div class="param">
<span class="arg">this</span>: <span class="type">invoking object</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">range</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
This address space method is a predicate that returns
non-zero if <span class="arg">r</span> is contained in
the set of ranges mapped by the address space.
</div>
</div>


<p>
Several functions create new address spaces
with specific forms of backing storage.
</p>

<div class="docitem" id="fn:mknas">
<div class="proto">
<div class="function">
<span class="id">mknas()</span>
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Returns a null address space that has no backing
storage.  It is an error to access (get or put) this
address space.  Null address spaces are used to
construct domains that act solely as sources for types
and symbols; for example, the literal domain is backed
by a null address space.
</div>
</div>

<div class="docitem" id="fn:mksas">
<div class="proto">
<div class="function">
<span class="id">mksas(<span class="arg">s</span>)</span>
</div>
<div class="param">
<span class="arg">s</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Returns an address space backed by the
string <span class="arg">s</span> storage.  The memory
associated with the string is shared with the address
space, so that an update made to either the string or
the address space will be reflected in the other.
</div>
</div>

<div class="docitem" id="fn:mkzas">
<div class="proto">
<div class="function">
<span class="id">mkzas(<span class="arg">n</span>)</span>
</div>
<div class="param">
<span class="arg">n</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
Returns an address space backed by a freshly allocated
zero-filled string.  The call
 <span class="val"><span class="id">mkzas</span>(<span class="arg">n</span>)</span>
is equivalent to 
<span class="val"><span class="id">mksas</span>(<span class="id">mkstr</span>(<span class="arg">n</span>))</span>.
</div>
</div>

<div class="docitem" id="fn:mkmas">
<div class="proto">
<div class="function">
<span class="id">mkmas([<span class="arg">ptr</span>,<span class="arg">len</span>])</span>
</div>
<div class="function">
<span class="id">mkmasx(<span class="arg">ptr</span>,<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">address space</span>
</div>
</div>
<div class="desc">
<span class="id">Mkmas</span> returns an address space that is backed by the
address space of the calling process, non-moving, and identity mapped.  Yep.
If <span class="arg">ptr</span> and <span class="arg">len</span> are provided,
access is restricted to the <span class="arg">len</span> byte range of the
address space beginning at address <span class="arg">ptr</span>.
<span class="id">Mkmasx</span> is
like <span class="id">mkmas</span>, except that it is
an error if the requested range intersects with any
range of the address space currently managed by the
Cinquecento evaluator.
</div>
</div>

<p>
Several functions operate on address spaces.
</p>

<div class="docitem" id="fn:ismapped">
<div class="proto">
<div class="function">
<span class="id">ismapped(<span class="arg">ptr</span>[,<span class="arg">len</span>])</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
This predicate returns non-zero if a range of bytes is
mapped in the address space associated
with <span class="arg">ptr</span>.
The range begins at the address <span class="arg">ptr</span>.
If provided,  <span class="arg">len</span> is the length in
bytes of the range; otherwise the length is
<span class="val">sizeof(*<span class="arg">ptr</span>)</span>.
</div>
</div>

<div class="docitem" id="fn:stringof">
<div class="proto">
<div class="function">
<span class="id">stringof(<span class="arg">ptr</span>)</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of type <span class="type">char*</span> or <span class="type">unsigned char*</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the bytes
beginning at <span class="arg">ptr</span> from the
address space associated with <span
class="arg">ptr</span>.  The string extends to, but
does not include, the first null byte at or beyond
<span class="arg">ptr</span>.  <span
class="id">Stringof</span> does not span address space
mapping boundaries: if the boundary of the address
space mapping containing <span class="arg">ptr</span>
is reached before a null byte is encountered, then the
search ends and the string of bytes seen so far is
returned.  The address space <a href="#fn:asmap">map</a> method is called to determine
an upper bound of the search, but to guard against inaccurate address
space mappings, <span class="id">stringof</span>
ends the search if it reaches a 4KB-aligned boundary
that is deemed unmapped by the address space <a href="#fn:asismapped">ismapped</a> method.
</div>
</div>

<div class="docitem" id="fn:getbytes">
<div class="proto">
<div class="function">
<span class="id">getbytes(<span class="arg">ptr</span>[,<span class="arg">len</span>])</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the bytes
beginning at <span class="arg">ptr</span> from the
address space associated with <span
class="arg">ptr</span>.  If provided, <span
class="arg">len</span> is a non-negative count of bytes
to read; otherwise, <tt>sizeof(*<span
class="arg">ptr</span>)</tt> bytes are read.
</div>
</div>

<div class="docitem" id="fn:putbytes">
<div class="proto">
<div class="function">
<span class="id">putbytes(<span class="arg">ptr</span>,<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">ptr</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Copies the bytes in <span class="arg">str</span> into
the address space associated with <span
class="arg">ptr</span>, starting at the location
pointed to by <span class="arg">ptr</span>.
</div>
</div>


<div class="docitem" id="fn:memcpy">
<div class="proto">
<div class="function">
<span class="id">memcpy(<span class="arg">p</span>,<span class="arg">q</span>,<span class="arg">n</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">q</span>: <span class="type">cvalue</span> of any pointer type
</div>
<div class="param">
<span class="arg">n</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Copies <span class="arg">n</span> bytes starting at <span class="arg">q</span>
to the storage at <span class="arg">p</span>.
</div>
</div>


<div class="docitem" id="fn:malloc">
<div class="proto">
<div class="function">
<span class="id">malloc(<span class="arg">len</span>)
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns a pointer to <span class="arg">len</span> bytes
backed by a new domain comprised of a freshly allocated
<a href="#fn:isctype"><span class="id">mkmas</span></a>
address space and the name space of the literal domain.  The
lifespan of the storage is tied to the lifespan of the backing
address space.
</div>
</div>


<h4 id="sec:ctypes">Ctypes</h4>

<p>
<em>Ctypes</em> represent types that can be named or
defined in the type system of C.  The
predicate <a href="#fn:isctype"><span class="id">isctype</span></a>
tests whether a value is a ctype.
</p>

<p>
Ctypes are subdivided into 12 <em>variants</em>:
</p>

<div id="inset">
<p>
void base pointer function array struct union enum typedef<br />
bitfield enumconst<br />
undefined<br />
</p>
</div>
	
<p>
The variants in the first row correspond directly to
the types that appear in C programs.
</p>

<p>
The variants in the second row are used to represent,
respectively, the types of bitfields of structure and
unions types, and the constants of enumeration types.
</p>

<p>
The undefined variant is used to represent types whose
names but not definitions occur in a name space.
</p>

<p>
Ctypes are one of the more complicated features of Cinquecento.
Details follow.
</p>

<h5>Type syntax</h5>

<p>
The syntax of C includes <em>type syntax</em> used to
name (reference) and declare C types.  Cinquecento accepts a slightly modified form of C type
syntax.
</p>

<p>
In C, use of type syntax is limited to certain
contexts: declarations of variables and types,
and <span class="id">sizeof</span> and cast operations.
In Cinquecento, type syntax is likewise limited to
certain contexts: as an operand of the forms
<a href="#syn:_at_containerof">@containerof</a>,
<a href="#syn:sizeof">sizeof</a>,
<a href="#syn:_at_typename">@typename</a>,
<a href="#syn:_at_typeof">@typeof</a>;
as the first operand to the cast operator <a href="#syn:cast">( )</a>;
and in symbol and type definitions appearing within the body of the <a href="#syn:_at_names">@names</a> form.
</p>

<p>
Depending on the context, one of three forms of type
syntax are allowed:
</p>

<ul>
<li>
<em>Type names</em> refer to types declared
elsewhere.  They may appear in symbol and type
definitions within the body of
the <a href="#syn:_at_names">@names</a> form, and as
the operand to
the <a href="#syn:_at_typename">@typename</a> form.
Their syntax is C type name syntax:
<div class="code">
<pre>
int
unsigned long
void
struct foo
union bar
enum baz
foo_t
int**
foo_t* (*) (struct foo *fp)
</pre>
</div>

</li>
<li>
<em id="sec:qualifiedtname">Qualified type names</em> are type names
that include an additional reference to a domain or name space in
which the definition of the type is to be resolved.
They may appear as an operand of the forms in <a href="#syn:_at_containerof">@containerof</a>,
<a href="#syn:sizeof">sizeof</a>,
and <a href="#syn:_at_typeof">@typeof</a>, and as the
first operand to the cast
operator <a href="#syn:cast">( )</a>.  Their syntax is
an extended type name syntax that includes an optional
identifier and bactick before the type specifier:
<div class="code">
<pre>
ns`int
ns`unsigned long
ns`void
struct ns`foo
union ns`bar
enum ns`baz
ns`foo_t
ns`int**
ns`foo_t* (*) (struct foo *fp)
</pre>
</div>
<p>
Details about this syntax are given in the following section.
</p>

</li>
<li>
<em>Type declarations</em> associate a type name with a
definition of the type.  They may appear only in
a <a href="#syn:_at_names">@names</a> form.  Their
syntax is like C type declaration syntax, but extended
to allow type and variable declarations to include
explicit specification of location, layout and encoding
of the defined object.  Example:
<div class="code">
<pre>
ns = @names c32le {
	struct node {
		@0x0 int x;
		@0x4 node_t *next;
		@0x8;
	};
	typedef struct node node_t;
	@0x800000 node_t *head;
};
</pre>
</div>

<p>
Details about this syntax are given in the discussion
of <a href="#syn:_at_names ">@names</a>.
</p>

</li>
</ul>


<h5>Qualified type names</h5>

<p>
A qualified type name may appear in 
a subset of the type name contexts: in <a href="#syn:_at_containerof">@containerof</a>,
<a href="#syn:sizeof">sizeof</a>,
<a href="#syn:_at_typeof">@typeof</a> forms, and as the
first operand to the cast
operator <a href="#syn:cast">( )</a>.  The meaning of a
qualified type name depends on the context, and so is
described separately for each context, but the syntax
is always the same.  For base type names, the qualifier
preceeds the name:
</p>

<div class="code">
<pre>
dom`int
litdom`unsigned long
ns`void
</pre>
</div>

<p>
For tagged type names, the qualifier precedes the tag:
</p>

<div class="code">
<pre>
struct dom`foo
union ns`bar
enum dom`baz
</pre>
</div>


<p>
For names declared with <span class="val">typedef</span>,
the qualifier precedes the name:
</p>

<div class="code">
<pre>
dom`foo_t
</pre>
</div>

<p>
Every other type name is an array, pointer, or function
type based on one of the above three forms.
Syntactically, the qualifier is part of the type being
modified:
</p>

<div class="code">
<pre>
dom`int[100]
struct dom`foo*
dom`foo_t* (*)(int arg)
</pre>
</div>

<p>
Qualifiers themselves are variable identifers typically
bound to a domain or name space value.  (It would be
nice if they could be arbitrary expressions, but the
parser does not support that.)
</p>

<h5>Ctypes</h5>

<p>
In the context of Cinquecento ctypes, a <em>type
name</em> is the abstract structure denoted by type name
syntax in C.  For example, the
syntax <span class="val">int*</span> denotes the type
name pointer-to-<span class="val">int</span>.  Such
names are first-class ctype values in Cinquecento:
</p>

<div class="code">
<pre>
; t = @typename(int*);
<span class="arg">int *</span>
; isctype(t);
<span class="arg">1</span>
; printf("%t\n", t);
<span class="arg">int *</span>
; isptr(t);
<span class="arg">1</span>
; printf("%t\n", subtype(t));
<span class="arg">int</span>
</pre>
</div>

<p>

This example shows the use
of <span class="fnindex"><a href="#syn:_at_typename">@typename</a></span>
to construct a ctype from the the C
syntax <span class="val">int*</span>.
The <span class="val">%t</span> <a href="#sec:fmt">format</a>
verb returns a printed representation of a ctype in C
syntax.  (This verb is used by the L1 repl to print
ctype values.)  Associated with each ctype variant is a
predicate (<em>e.g.,</em>
<a href="#fn:isptr"><span class="fnindex">isptr</span></a>)
that tests whether a value is an instance of the
variant, and a set of functions (<em>e.g.,</em>
<a href="#fn:subtype"><span class="fnindex">subtype</span></a>)
to deconstruct and inspect the type.
</p>

<p>
The ctype constructor functions, one for each ctype
variant, provide an alternative to the special syntax
of <span class="fnindex"><a href="#syn:_at_typename">@typename</a></span>.
Continuing the example:
</p>

<div class="code">
<pre>
; u = mkctype_ptr(mkctype_int());
<span class="arg">int *</span>
; t == u;
<span class="arg">1</span>
</pre>
</div>

<p>
A type name determines the abstract structure of a
type, but not the concrete encoding of a value of the
type in an address space.  Here, the
name <span class="val">int*</span> alone could very
well describe a 64-bit pointer to a 64-bit integer
encoded in big-endian order, or a 32-bit pointer to a
32-bit integer encoded in little-endian order, or some
other variation.  Such ctypes are said to
be <em>undefined</em>:
</p>

<div class="code">
<pre>
; sizeof(t);
<span class="arg">error: attempt to determine size of undefined type</span>
; sizeof(subtype(t));
<span class="arg">error: attempt to determine size of undefined type</span>
</pre>
</div>

<p>
<em>Type definitions</em> are ctypes that extend the
abstract structure of type names with concrete
information about encoding and substructure.
They are created through the use of optional arguments
to the ctype constructors:
</p>

<div class="code">
<pre>
; u = mkctype_ptr(mkctype_int(), cqct`Ru64le);
<span class="arg">int *</span>
; sizeof(u);
<span class="arg">8</span>
</pre>
</div>

<p>
The optional second argument to
<a href="#fn:mkctype_ptr"><span class="id">mkctype_ptr</span></a>
gives the <em>representation</em> of the type.  The
value <span class="val">cqct`Ru64le</span> is one of
several constants defined in the
built-in <span class="val">cqct</span> name space.  In
this example, we have specified that the pointer value
is represented as an unsigned 64-bit little-endian
integer, a specification sufficient to read or write
the value of such a pointer.  Representation constants
are defined for common integer, pointer, and float
encodings
(see <a href="#fn:mkctype_base"><span class="id">mkctype_base</span></a>).
</p>

<p>
Although type names and type definitions may be related,
they are not equivalent ctypes:
</p>

<div class="code">
<pre>
; t == u;
<span class="arg">0</span>
</pre>
</div>

<p>
The function <a href="#fn:typename"><span class="id">typename</span></a>
maps a type definition to its name, essentially stripping
it of all defining information.
</p>

<div class="code">
<pre>
; t == typename(u);
<span class="arg">1</span>
</pre>
</div>

<p>
In the previous definition
of <span class="val">u</span>, we created a type
definition for the pointer type, but left its subtype
undefined:
</p>

<div class="code">
<pre>
; u = mkctype_ptr(mkctype_int(), cqct`Ru64le);
<span class="arg">int *</span>
; sizeof(u);
<span class="arg">8</span>
; sizeof(subtype(u));
<span class="arg">error: attempt to determine size of undefined type</span>
</pre>
</div>

<p>
This is not a particularly useful type definition.
While it provides sufficient information to access the
pointer value, it provides no information about how to
dereference this pointer, because the type does not
define the concrete encoding of the
pointed-to <span class="id">int</span> value.  We can
fix this by adding a representation argument
to <a href="#fn:mkctype_int"><span class="id">mkctype_int</span></a>:
</p>

<div class="code">
<pre>
; u = mkctype_ptr(mkctype_int(cqct`Rs64le), cqct`Ru64le);
<span class="arg">int *</span>
; sizeof(u);
<span class="arg">8</span>
; sizeof(subtype(u));
<span class="arg">8</span>
</pre>
</div>

<p>
A ctype is <em>fully defined</em> if it is a type
definition whose constituent subtypes, if any, are also
fully defined.  Of all the preceding definitions
of <span class="val">u</span>, only the final one is
fully defined.
</p>

<p>
A type name may be used to look up a type definition in
a name space.
</p>

<p>
Fortunately, most Cinquecento programs do not directly
work with these details.  Name spaces provide
definitions of types, and most types come along
for the ride when symbols are referenced.
</p>

<div class="docitem" id="syn:_at_typeof">
<div class="proto">
<div class="function">
<span class="id">@typeof(<span class="arg">typename</span>)</span>
</div>
<div class="function">
<span class="id">@typeof(<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">typename</span>: <span class="type">type name syntax</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">cvalue expression</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
The <span class="id">@typeof</span> operator is similar
to the <span class="id">sizeof</span> operator in that
it is applied to either a type name or to an expression
that yields a cvalue.  In both cases it returns a ctype
value that represents the type of its operand.  In the
type name case, if the operand is a fully qualified
type name, then the type name is resolved in the domain
referenced by the type name; otherwise, the type name
is resolved in the literal domain.  In the cvalue case,
the <span class="id">&</span> may be applied to the
operand to construct the corresponding pointer type.
</div>
</div>

<div class="docitem" id="fn:typename">
<div class="proto">
<div class="function">
<span class="id">typename(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a ctype representing the type name of <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:equalctype">
<div class="proto">
<span class="id">equalctype(<span class="arg">u</span>,<span class="arg">v</span>)</span>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: <span class="type">ctype</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
<span class="id">Equalctype</span> is an equivalence predicate over
ctypes.  
The ctypes <span class="arg">u</span>
and <span class="arg">v</span> are
<span class="id">equalctype</span> if
and only if they are both:

<ul>
<li>
<span class="id">void</span>;
</li>
<li>
base types with the same representation;
</li>
<li>
<span class="id">typedef</span>s with <a href="#fn:equal"><span class="id">equal</span></a> identifiers;
</li>
<li>
<span class="id">struct</span>s,
<span class="id">union</span>s, or
<span class="id">enum</span>s with <a href="#fn:equal"><span class="id">equal</span></a> tags;
</li>
<li>
pointer
or undefined types with <span class="id">equalctype</span> subtypes;
</li>
<li>
array types with <a href="#fn:equal"><span class="id">equal</span></a> element counts
and <span class="id">equalctype</span> subtypes;
</li>
<li>
function types with <span class="id">equalctype</span> return types,
parameter lists of the same length,
and parameters with corresponding <span class="id">equalctype</span> types.
</li>
<li>
bitfield types with <a href="#fn:equal"><span class="id">equal</span></a> widths and
<span class="id">equalctype</span> container types; or
</li>
<li>
enumeration constant types with
<span class="id">equalctype</span> subtypes.
</li>
</ul>
</div>
</div>

<div class="docitem" id="fn:eqvctype">
<div class="proto">
<span class="id">eqvctype(<span class="arg">u</span>,<span class="arg">v</span>)</span>
<div class="param">
<span class="arg">u</span>,<span class="arg">v</span>: <span class="type">ctype</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (<span class="val">1</span> or <span class="val">0</span>)
</div>
</div>
<div class="desc">
<span class="id">Eqvctype</span> is an equivalence predicate over
ctypes.  
The ctypes <span class="arg">u</span>
and <span class="arg">v</span> are
<span class="id">eqvctype</span> if
and only if they are (for now) <a href="#fn:equalctype"><span class="id">equalctype</span></a>
</div>
</div>

<div class="docitem" id="fn:hashctype">
<div class="proto">
<div class="function">
<span class="id">hashctype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">ctype</span>
suitable for use with the equivalence predicate 
<a href="#fn:equalctype"><span class="id">equalctype</span></a>.
</div>
</div>

<div class="docitem" id="fn:hashqvctype">
<div class="proto">
<div class="function">
<span class="id">hashqvctype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns an unsigned 32-bit integer hash of <span class="type">ctype</span>
suitable for use with the equivalence predicate 
<a href="#fn:eqvctype"><span class="id">eqvctype</span></a>.
</div>
</div>

<p>
The following table summarizes the functions that
manipulate each of the ctypes variant.  The predicates
determine the variant of a ctype.  Each predicate takes
one argument, a ctype, and returns
<span class="val">1</span> if the predicate is true for
that ctype, <span class="val">0</span> otherwise.  With
the exception
of <span class="id">issu</span>, <span class="id">isstruct</span>,
and <span class="id">isunion</span>, the predicates are
mutually exclusive; <span class="id">issu</span>
returns true if its argument is structure or union
aggregate, <span class="id">isstruct</span> returns
true if its argument is a structure,
and <span class="id">isunion</span> returns true if its
argument is a union.  The accessors return attributes
of a ctype instance in each category; the constructors
construct new instances of each category.  Descriptions of
the accessors and constructors follow the table.
</p>

<div class="table">
<table>

<tr>
<th>Type category</th>
<th>Predicate</th>
<th>Accessors</th>
<th>Constructors</th>
</tr>

<tr>
<td>
Aggregate
</td>
<td>
<span class="fnindex" id="fn:isstruct">isstruct</span><br />
<span class="fnindex" id="fn:issu">issu</span><br />
<span class="fnindex" id="fn:isunion">isunion</span>
</td>
<td>
<span class="fnindex"><a href="#fn:fields">fields</a></span><br />
<span class="fnindex"><a href="#fn:suetag">suetag</a></span><br />
<span class="fnindex"><a href="#fn:susize">susize</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_struct">mkctype_struct</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_union">mkctype_union</a></span>
</td>
</tr>

<tr>
<td>
Array
</td>
<td><span class="fnindex" id="fn:isarray">isarray</span></td>
<td>
<span class="fnindex"><a href="#fn:arraynelm">arraynelm</a></span><br />
<span class="fnindex"><a href="#fn:subtype">subtype</a></span><br />
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_array">mkctype_array</a></span>
</td>
</tr>

<tr>
<td>
Base C type
</td>
<td><span class="fnindex" id="fn:isbase">isbase</span></td>
<td>
<span class="fnindex"><a href="#fn:basebase">basebase</a></span><br />
<span class="fnindex"><a href="#fn:baseid">baseid</a></span><br />
<span class="fnindex"><a href="#fn:baserep">baserep</a></span><br />
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_base">mkctype_base</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_bool">mkctype_bool</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_char">mkctype_char</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_short">mkctype_short</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_int">mkctype_int</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_long">mkctype_long</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_vlong">mkctype_vlong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uchar">mkctype_uchar</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ushort">mkctype_ushort</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uint">mkctype_uint</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ulong">mkctype_ulong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_uvlong">mkctype_uvlong</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_float">mkctype_float</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_double">mkctype_double</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ldouble">mkctype_ldouble</a></span>
<span class="fnindex"><a href="#fn:mkctype_complex">mkctype_complex</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_doublex">mkctype_doublex</a></span><br />
<span class="fnindex"><a href="#fn:mkctype_ldoublex">mkctype_ldoublex</a></span>
</td>
</tr>

<tr>
<td>
Bitfield
</td>
<td><span class="fnindex" id="fn:isbitfield">isbitfield</span></td>
<td>
<span class="fnindex"><a href="#fn:bitfieldcontainer">bitfieldcontainer</a></span><br />
<span class="fnindex"><a href="#fn:bitfieldpos">bitfieldpos</a></span><br />
<span class="fnindex"><a href="#fn:bitfieldwidth">bitfieldwidth</a></span><br />
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_bitfield">mkctype_bitfield</a></span>
</td>
</tr>

<tr>
<td>
Enumeration
</td>
<td><span class="fnindex" id="fn:isenum">isenum</span></td>
<td>
<span class="fnindex"><a href="#fn:enumconsts">enumconsts</a></span><br />
<span class="fnindex"><a href="#fn:suetag">suetag</a></span><br />
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_enum">mkctype_enum</a></span><br />
</td>
</tr>

<tr>
<td>
Enumeration constant
</td>
<td><span class="fnindex" id="fn:isenumconst">isenumconst</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_const">mkctype_const</a></span>
</td>
</tr>


<tr>
<td>
Function
</td>
<td><span class="fnindex" id="fn:isfunc">isfunc</span></td>
<td>
<span class="fnindex"><a href="#fn:params">params</a></span><br />
<span class="fnindex"><a href="#fn:rettype">rettype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_fn">mkctype_fn</a></span>
</td>
</tr>

<tr>
<td>
Pointer
</td>
<td><span class="fnindex" id="fn:isptr">isptr</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_ptr">mkctype_ptr</a></span>
</td>
</tr>

<tr>
<td>
Typedef
</td>
<td><span class="fnindex" id="fn:istypedef">istypedef</span></td>
<td>
<span class="fnindex"><a href="#fn:typedefid">typedefid</a></span><br />
<span class="fnindex"><a href="#fn:typedeftype">typedeftype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_typedef">mkctype_typedef</a></span>
</td>
</tr>

<tr>
<td>
Undefined
</td>
<td><span class="fnindex" id="fn:isundeftype">isundeftype</span></td>
<td>
<span class="fnindex"><a href="#fn:subtype">subtype</a></span>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_undef">mkctype_undef</a></span>
</td>
</tr>

<tr>
<td>
Void
</td>
<td><span class="fnindex" id="fn:isvoid">isvoid</span></td>
<td>
<em>n/a</em>
</td>
<td>
<span class="fnindex"><a href="#fn:mkctype_void">mkctype_void</a></span>
</td>
</tr>

</table>
</div>

<p>
The following functions are the ctype accessors.
</p>

<div class="docitem" id="fn:subtype">
<div class="proto">
<div class="function">
<span class="id">subtype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype or nil</span>
</div>
</div>
<div class="desc">
The ctype categories array, enumeration, enumeration
constant, pointer, and undefined each modify another,
subordinate ctype.  Given a ctype from any one of these
categories, <span class="id">subtype</span> returns the
subordinate ctype, or <span class="val">nil</span> if
the ctype does not define its subordinate.
</div>
</div>

<div class="docitem" id="fn:fields">
<div class="proto">
<div class="function">
<span class="id">fields(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="returns">
<span class="type">vector of fields</span>
</div>
</div>
<div class="desc">
Returns a vector containing the
definitions of the fields in the aggregate <span
class="arg">type</span>.  Each element of the vector is a
<a href="#sec:symbols">field</a>
that can be inspected with the functions
<span class="fnindex"><a
href="#fn:fieldid">fieldid</a></span>,
<span class="fnindex"><a href="#fn:fieldtype">fieldtype</a></span>,
<span class="fnindex"><a href="#fn:fieldattr">fieldattr</a></span>, and
<span class="fnindex"><a href="#fn:fieldoff">fieldoff</a></span>.
Modifying the vector may cause undefined effects.
</div>
</div>

<div class="docitem" id="fn:lookfield">
<div class="proto">
<div class="function">
<span class="id">lookfield(<span class="arg">type</span>,<span class="arg">id</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">field</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Returns the <a href="#sec:symbols">field</a> named <span class="arg">id</span> 
in the aggregate <span class="arg">type</span>, or <span class="val">nil</span>
if no field has that name.
</div>
</div>

<div class="docitem" id="fn:suetag">
<div class="proto">
<div class="function">
<span class="id">suetag(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate or enumeration ctype</span>
</div>
<div class="returns">
<span class="type">cid or nil</span>
</div>
</div>
<div class="desc">
Returns the tag of the aggregate or enumeration
ctype <span class="arg">type</span> as a string.
Returns <span class="val">nil</span>
if <span class="arg">type</span> does not define a tag
(<em>i.e.</em>, if <span class="arg">type</span> is an
anonymous aggregate or enumeration).
</div>
</div>

<div class="docitem" id="fn:suattr">
<div class="proto">
<div class="function">
<span class="id">suattr(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="returns">
<span class="type">table or nil</span>
</div>
</div>
<div class="desc">
Returns the attribute table of <span class="arg">type</span>.
</div>
</div>


<div class="docitem" id="fn:susize">
<div class="proto">
<div class="function">
<span class="id">susize(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">aggregate ctype</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
If <span class="arg">type</span> does not have an
attribute table, or if its attribute table does not define
the attribute <span class="val">"offset"</span>,
then this function returns <span class="val">nil</span>.
Otherwise it returns the value of the
attribute <span class="val">"offset"</span >.
</div>
</div>

<div class="docitem" id="fn:arraynelm">
<div class="proto">
<div class="function">
<span class="id">arraynelm(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">array ctype</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
Returns the number of elements in the array type <span
class="arg">type</span>.  Returns <span class="val">nil</span> if the type does not define the number of elements.
</div>
</div>

<div class="docitem" id="fn:basebase">
<div class="proto">
<div class="function">
<span class="id">basebase(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the base type specifier
(see <a href="#fn:mkctype_base"><span class="id">mkctype_base</span></a>)
of the base C type represented by <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:baseid">
<div class="proto">
<div class="function">
<span class="id">baseid(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name of the base C type represented
by <span class="arg">type</span> as a string.
</div>
</div>

<div class="docitem" id="fn:baserep">
<div class="proto">
<div class="function">
<span class="id">baserep(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">base ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the representation specifier
(see <a href="#fn:mkctype_base"><span class="id">mkctype_base</span></a>)
of the base C type represented by <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:bitfieldcontainer">
<div class="proto">
<div class="function">
<span class="id">bitfieldcontainer(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the ctype in which the bitfield type
represented by <span class="arg">type</span> is contained.
</div>
</div>

<div class="docitem" id="fn:bitfieldpos">
<div class="proto">
<div class="function">
<span class="id">bitfieldpos(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the bit offset within its container of the
first bit of the bitfield type represented by
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:bitfieldwidth">
<div class="proto">
<div class="function">
<span class="id">bitfieldwidth(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">bitfield ctype</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the width of the bitfield type represented
by <span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:enumconsts">
<div class="proto">
<div class="function">
<span class="id">enumconsts(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">enumeration ctype</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing the definitions of the
constants in the enumeration
type <span class="arg">type</span>.  Each item in the
vector is a two-element vector that defines one
constant.  The first element is the name of the
constant as a string, the second is the value of
constant as a cvalue.
</div>
</div>

<div class="docitem" id="fn:params">
<div class="proto">
<div class="function">
<span class="id">params(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">function ctype</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing the
definitions of the parameters in the function type represented by <span
class="arg">type</span>.
Each element of the vector is a
<a href="#sec:symbols">param</a>
that can be inspected with the functions
<span class="fnindex"><a href="#fn:paramid">paramid</a></span>,
<span class="fnindex"><a href="#fn:paramtype">paramtype</a></span>, and
<span class="fnindex"><a href="#fn:paramattr">paramattr</a></span>.
Modifying the vector may cause undefined effects.
</div>
</div>

<div class="docitem" id="fn:rettype">
<div class="proto">
<div class="function">
<span class="id">rettype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">function ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the return type of the function type represented by
<span class="arg">type</span>.
</div>
</div>


<div class="docitem" id="fn:typedefid">
<div class="proto">
<div class="function">
<span class="id">typedefid(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="returns">
<span class="type">cid</span>
</div>
</div>
<div class="desc">
Returns the name of the type defined by the typedef type represented by
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:typedeftype">
<div class="proto">
<div class="function">
<span class="id">typedeftype(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns the type aliased by the typedef type represented by
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:settypedeftype">
<div class="proto">
<div class="function">
<span class="id">settypedeftype(<span class="arg">typedef</span>, <span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">typedef</span>: <span class="type">typedef ctype</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Modifies the typedef ctype <span class="arg">typedef</span> to be
an alias for <span class="arg">type</span>.
</div>
</div>

<p>
The following functions are the ctype constructors.
</p>

<div class="docitem">
<div class="proto">

<div class="function">
<span class="id" id="fn:mkctype_struct">mkctype_struct(<span class="arg">tag</span>[,<span class="arg">fields</span>[,<span class="arg">size</span>]])</span>
</div>

<div class="function">
<span class="id" id="fn:mkctype_union">mkctype_union(<span class="arg">tag</span>[,<span class="arg">fields</span>[,<span class="arg">size</span>]])</span>
</div>

<div class="param">
<span class="arg">tag</span>: <span class="type">cid</span>
</div>
<div class="param">
<span class="arg">fields</span>: <span class="type">vector of fields</span>
or <span class="type">nil</span>
</div>
<div class="param">
<span class="arg">attr</span>: <span class="type">table</span> or 
<span class="type">ctype</span> or <span class="type">nil</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a struct or union
aggregate type.
<span class="arg">Tag</span> is the type tag.  
<span class="arg">Fields</span>, if provided, is a vector
defining the fields of the aggregate, each element of
which is a field constructed
by <span class="fnindex"><a href="#fn:mkfield">mkfield</a></span>.
<span class="arg">Attr</span> is an attribute table
defined and used in the manner of the <a href="#sec:symbols">symbol attribute table</a>.
The attribute named <span class="val">"offset"</span> determines
the size in byte of the aggregate.
If <span class="arg">attr</span> is a cvalue, it is
promoted to an attribute table that maps
<span class="val">"offset"</span> to <span class="arg">attr</span>.
If <span class="arg">attr</span> is <span class="arg">nil</span>
or omitted, no attribute table is created.
</div>
</div>



<div class="docitem" id="fn:mkctype_array">
<div class="proto">
<div class="function">
<span class="id">mkctype_array(<span class="arg">type</span>[,<span class="arg">nelm</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">typedef ctype</span>
</div>
<div class="param">
<span class="arg">nelm</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an array of 
represented by <span class="arg">type</span>.
<span class="arg">Nelm</span>, if provided, is the number of elements
in arrays represented by the type.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:mkctype_base">mkctype_base(<span class="arg">base</span>[,<span class="arg">rep</span>])</span>
</div>
<div class="param">
<span class="arg">base</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">rep</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
<p>
Returns a new ctype representing the base C type corresponding 
to <span class="arg">base</span>, which may be any one of
the following base type specifiers defined in the
<span class="val">cqct</span> name space:
</p>

<div class="table-short">
<table>
<tr>
<td><span class="val">Vbool</span></td>
<td><span class="val">_Bool</span></td>
</tr>
<tr>
<td><span class="val">Vchar</span></td>
<td><span class="val">char</span></td>
</tr>
<tr>
<td><span class="val">Vshort</span></td>
<td><span class="val">short</span></td>
</tr>
<tr>
<td><span class="val">Vint</span></td>
<td><span class="val">int</span></td>
</tr>
<tr>
<td><span class="val">Vlong</span></td>
<td><span class="val">long</span></td>
</tr>
<tr>
<td><span class="val">Vvlong</span></td>
<td><span class="val">long long</span></td>
</tr>
<tr>
<td><span class="val">Vuchar</span></td>
<td><span class="val">unsigned char</span></td>
</tr>
<tr>
<td><span class="val">Vushort</span></td>
<td><span class="val">unsigned short</span></td>
</tr>
<tr>
<td><span class="val">Vuint</span></td>
<td><span class="val">unsigned int</span></td>
</tr>
<tr>
<td><span class="val">Vulong</span></td>
<td><span class="val">unsigned long</span></td>
</tr>
<tr>
<td><span class="val">Vuvlong</span></td>
<td><span class="val">unsigned long long</span></td>
</tr>
<tr>
<td><span class="val">Vfloat</span></td>
<td><span class="val">float</span></td>
</tr>
<tr>
<td><span class="val">Vdouble</span></td>
<td><span class="val">double</span></td>
</tr>
<tr>
<td><span class="val">Vldouble</span></td>
<td><span class="val">long double</span></td>
</tr>
<tr>
<td><span class="val">Vcomplex</span></td>
<td><span class="val">_Complex</span></td>
</tr>
<tr>
<td><span class="val">Vdoublex</span></td>
<td><span class="val">double _Complex</span></td>
</tr>
<tr>
<td><span class="val">Vldoublex</span></td>
<td><span class="val">long double _Complex</span></td>
</tr>
</table>
</div>

<p>
<span class="arg">Rep</span> may be any one of the
following representation specifiers defined in the
<span class="val">cqct</span> name space:
</p>

<div class="table-short">
<table>
<tr>
<td><span class="val">Rundef</span></td>
<td>undefined representation</td>
</tr>
<tr>
<td><span class="val">Ru08le</td>
<td>8-bit unsigned little endian</td>
</tr>
<tr>
<td><span class="val">Ru16le</td>
<td>16-bit unsigned little endian</td>
</tr>
<tr>
<td><span class="val">Ru32le</td>
<td>32-bit unsigned little endian</td>
</tr>
<tr>
<td><span class="val">Ru64le</td>
<td>64-bit unsigned little endian</td>
</tr>
<tr>
<td><span class="val">Rs08le</td>
<td>8-bit signed little endian</td>
</tr>
<tr>
<td><span class="val">Rs16le</td>
<td>16-bit signed little endian</td>
</tr>
<tr>
<td><span class="val">Rs32le</td>
<td>32-bit signed little endian</td>
</tr>
<tr>
<td><span class="val">Rs64le</td>
<td>64-bit signed little endian</td>
</tr>
<tr>
<td><span class="val">Ru08be</td>
<td>8-bit unsigned big endian</td>
</tr>
<tr>
<td><span class="val">Ru16be</td>
<td>16-bit unsigned big endian</td>
</tr>
<tr>
<td><span class="val">Ru32be</td>
<td>32-bit unsigned big endian</td>
</tr>
<tr>
<td><span class="val">Ru64be</td>
<td>64-bit unsigned big endian</td>
</tr>
<tr>
<td><span class="val">Rs08be</td>
<td>8-bit signed big endian</td>
</tr>
<tr>
<td><span class="val">Rs16be</td>
<td>16-bit signed big endian</td>
</tr>
<tr>
<td><span class="val">Rs32be</td>
<td>32-bit signed big endian</td>
</tr>
<tr>
<td><span class="val">Rs64be</td>
<td>64-bit signed big endian</td>
</tr>
<tr>
<td><span class="val">Rf32</td> 
<td>32-bit floating point</td>
</tr>
<tr>
<td><span class="val">Rf64</td> 
<td>64-bit floating point</td>
</tr>
<tr>
<td><span class="val">Rf96</td> 
<td>96-bit floating point</td>
</tr>
<tr>
<td><span class="val">Rf128</td>
<td>128-bit floating point</td>
</tr>
<tr>
<td><span class="val">Rx64</td> 
<td>64-bit complex floating point</td>
</tr>
<tr>
<td><span class="val">Rx128</td> 
<td>128-bit complex floating point</td>
</tr>
<tr>
<td><span class="val">Rx192</td>
<td>192-bit complex floating point</td>
</tr>
</table>
</div>

<p>
<span class="arg">Rep</span> defaults to <span class="val">Rundef</span>.
</p>

</div>
</div>



<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:mkctype_bool">mkctype_bool([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_char">mkctype_char([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_short">mkctype_short([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_int">mkctype_int([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_long">mkctype_long([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_vlong">mkctype_vlong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uchar">mkctype_uchar([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ushort">mkctype_ushort([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uint">mkctype_uint([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ulong">mkctype_ulong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_uvlong">mkctype_uvlong([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_float">mkctype_float([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_double">mkctype_double([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ldouble">mkctype_ldouble([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_complex">mkctype_complex([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_doublex">mkctype_doublex([<span class="arg">rep</span>])</span>
</div>
<div class="function">
<span class="id" id="fn:mkctype_ldoublex">mkctype_ldoublex([<span class="arg">rep</span>])</span>
</div>
<div class="param">
<span class="arg">rep</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">

These functions are wrappers
for <a href="#fn:mkctype_base"><span class="id">mkctype_base</span></a>
that each return a new ctype representing the base C
type corresponding to the suffix of the function name.
The default value of the representation specifier
<span class="arg">rep</span> is <span class="val">Rundef</span>.
</div>
</div>

<div class="docitem" id="fn:mkctype_bitfield">
<div class="proto">
<div class="function">
<span class="id">mkctype_bitfield(<span class="arg">type</span>,<span class="arg">width</span>,<span class="arg">pos</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">width</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">pos</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a bitfield type.  The
constructed bitfield type
has <span class="arg">width</span> bits, is contained in a
field of the type represented
by <span class="arg">type</span>, and starts at bit
offset <span class="arg">pos</span> in the containing type.
</div>
</div>

<div class="docitem" id="fn:mkctype_enum">
<div class="proto">
<div class="function">
<span class="id">mkctype_enum(<span class="arg">tag</span>[,<span class="arg">consts</span>[,<span class="arg">type</span>]])</span>
</div>
<div class="param">
<span class="arg">tag</span>: <span class="type">cid</span>
</div>
<div class="param">
<span class="arg">consts</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an enumeration type.  
<span class="arg">Tag</span> is the type tag.  
If provided, <span class="arg">consts</span> is a vector defining
the constants of the enumeration type.  Each element of 
<span class="arg">consts</span> is a two-element vector.
The first element is the name of the
constant as a cid, the second is the value of
constant as a cvalue.  <span class="arg">Type</span>, if provided, is the
underlying (subordinate) type of the enumeration.
</div>
</div>

<div class="docitem" id="fn:mkctype_const">
<div class="proto">
<div class="function">
<span class="id">mkctype_const(<span class="arg">type</span>)</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing the type of an enumeration constant.
<span class="arg">Type</span> is the underlying (subordinate)
enumeration type of the constant.
</div>
</div>

<div class="docitem" id="fn:mkctype_fn">
<div class="proto">
<div class="function">
<span class="id">mkctype_fn(<span class="arg">rettype</span>,<span class="arg">params</span>)</span>
</div>
<div class="param">
<span class="arg">rettype</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">params</span>: <span class="type">vector</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a function type.
<span class="arg">Type</span> is the return type of the function.
<span class="arg">Params</span> is a vector
defining the parameters of the function, each element of which
is a param constructed
by <span class="fnindex"><a href="#fn:mkparam">mkparam</a></span>.
</div>
</div>

<div class="docitem" id="fn:mkctype_ptr">
<div class="proto">
<div class="function">
<span class="id">mkctype_ptr(<span class="arg">type</span>[,<span class="arg">rep</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="param">
<span class="arg">rep</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a pointer to the type represented by
<span class="arg">type</span>.
<span class="arg">Rep</span> specifies the representation
of the pointer type, and defaults to <span class="val">cqct`Rundef</span>.
</div>
</div>

<div class="docitem" id="fn:mkctype_typedef">
<div class="proto">
<div class="function">
<span class="id">mkctype_typedef(<span class="arg">id</span>[,<span class="arg">type</span>])</span>
</div>
<div class="param">
<span class="arg">id</span>: <span class="type">cid</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing a typedef.  
<span class="arg">Id</span> is the name of the typedef.
If provided, <span class="arg">type</span> is a ctype representing
the aliased type.
</div>
</div>

<div class="docitem" id="fn:mkctype_undef">
<div class="proto">
<div class="function">
<span class="id">mkctype_undef(<span class="arg">id</span>[,<span class="arg">type</span>])</span>
</div>
<div class="param">
<span class="arg">type</span>: <span class="type">ctype</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing an undefined type whose name is
<span class="arg">type</span>.
</div>
</div>

<div class="docitem" id="fn:mkctype_void">
<div class="proto">
<div class="function">
<span class="id">mkctype_void()</span>
</div>
<div class="returns">
<span class="type">ctype</span>
</div>
</div>
<div class="desc">
Returns a new ctype representing the void type.
</div>
</div>


<h4 id="sec:records">Records</h4>

<p id="syn:_at_record">
Records allows the creation of new aggregate types with
named fields.  A <em>record descriptor</em> is a
Cinquecento value that define a particular record type;
it associates a record type name with the definition of
the record type.  A <em>record</em> is instance of a
record type.  It has an associated record descriptor
and bindings for the fields defined by the record
descriptor.
</p>

<p>
For example, the expression:
</p>
<div class="code">
<pre>
@record myrec { field1, field2, field3 };
</pre>
</div>
<p>
defines a new record type, named <span class="id">myrec</span>.

The record type has three fields, named
<span class="id">field1</span>, 
<span class="id">field2</span>, and 
<span class="id">field3</span>.

The value of the <span class="id">@record</span> expression
is the resulting record descriptor.
</p>

<p>
In addition, evaluation of
the <span class="id">@record</span> expression
implicitly defines two functions,
named <span class="id">myrec</span>
and <span class="id">ismyrec</span>,
in the innermost level of lexical scope.
</p>

<p>
The function <span class="id">ismyrec</span> is a predicate
for instances of <span class="id">myrec</span>.  Like
the type predicates, it accepts
a single argument and returns <span class="val">1</span>
if the argument is an instance of <span class="id">myrec</span>,
and <span class="val">0</span> otherwise.
</p>

<p>
The function <span class="id">myrec</span> is the
constructor for instances of the <span class="id">myrec</span> type.

For example:
</p>
<div class="code">
<pre>
x = myrec("abc", 1, @lambda(x){ printf("hi\n")});
</pre>
</div>
<p>

binds <span class="id">x</span> to a new instance of the
<span class="id">myrec</span> type.
</p>

<p>
The function <span class="id">myrec</span>
expects either zero arguments,
in which case the fields of the new instance are bound to <span class="id">nil</span>,
or exactly as many arguments as there are fields in the type,
in which case the arguments are bound to the fields in the order
they were given in the <span class="id">@record</span> definition.
</p>

<p>
The dot operator provides access to the fields of a record instance:
</p>
<div class="code">
<pre>
printf("%a", x.field1);   // print x's field1
x.field1 = "bcd";         // update x's field1

x.field2 += 5;		  // update x's field2
++x.field2;               // update x's field2

x.field3("blah");	  // call the value of x's field3
</pre>
</div>

<p>
The following routines operate on records and record descriptors.
</p>

<div class="docitem" id="fn:rdof">
<div class="proto">
<div class="function">
<span class="id">rdof(<span class="arg">r</span>)</span>
</div>
<div class="param">
<span class="arg">r</span>: <span class="type">record</span>
</div>
<div class="returns">
<span class="type">record descriptor</span>
</div>
</div>
<div class="desc">
Returns the record descriptor associated with the record
<span class="arg">r</span>. 
</div>
</div>

<div class="docitem" id="fn:rdfields">
<div class="proto">
<div class="function">
<span class="id">rdfields(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns the list of field names for the record descriptor
<span class="arg">rd</span> in the order they were given in the
<span class="id">@record</span> definition for <span class="arg">rd</span>.
</div>
</div>

<div class="docitem" id="fn:rdis">
<div class="proto">
<div class="function">
<span class="id">rdis(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the predicate for instances of
the record descriptor <span class="arg">rd</span>.  The
function takes a single argument and returns non-zero
if and only if the argument is an instance of <span class="arg">rd</span>.
</div>
</div>

<div class="docitem" id="fn:rdmk">
<div class="proto">
<div class="function">
<span class="id">rdmk(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the constructor for instances of
the record descriptor <span class="arg">rd</span>.  The
function takes either zero arguments,
in which case the fields of the new instance are bound to
<span class="val">nil</span>, or exactly as many arguments
as there are fields in the type,
in which case the arguments are bound to the fields
in the order they were given in the definition of
the record descriptor.
</div>
</div>

<div class="docitem" id="fn:rdname">
<div class="proto">
<div class="function">
<span class="id">rdname(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">cid</span>
</div>
</div>
<div class="desc">
Returns the name associated with the record descriptor
<span class="arg">rd</span>. 
</div>
</div>

<p>
Record descriptors have an associated format procedure
that is implicitly called when 
the <span class="val">%a</span> conversion of the
formatted I/O library routines is applied to an instance of the record type.
The format procedure takes a single argument,
the record instance,
and returns a string representing the formatted
record.
</p>

<p>
The following routines access the format procedure
associated with a record descriptor.
</p>

<div class="docitem" id="fn:rdfmt">
<div class="proto">
<div class="function">
<span class="id">rdfmt(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
Returns the format procedure of the record descriptor
<span class="arg">rd</span>. 
</div>
</div>

<div class="docitem" id="fn:rdsetfmt">
<div class="proto">
<div class="function">
<span class="id">rdsetfmt(<span class="arg">rd</span>,<span class="arg">fmt</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the format procedure of the record descriptor
<span class="arg">rd</span> to <span class="arg">fmt</span>.
</div>
</div>

<p>
Several functions are used by the implementation of the
record system.
</p>

<div class="docitem" id="fn:mkrd">
<div class="proto">
<div class="function">
<span class="id">mkrd(<span class="arg">name</span>,<span class="arg">fields</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">cide</span>
</div>
<div class="param">
<span class="arg">fields</span>: <span class="type">list of cid</span>
</div>
<div class="returns">
<span class="type">record descriptor</span>
</div>
</div>
<div class="desc">
Creates a record descriptor for the record
type named <span class="arg">name</span>.  The names of
the fields of the record type are set, in order, to the
cids in the list <span class="arg">fields</span>.
The record descriptor is returned.
</div>
</div>

<div class="docitem" id="fn:rdgettab">
<div class="proto">
<div class="function">
<span class="id">rdgettab(<span class="arg">rd</span>)</span>
</div>
<div class="function">
<span class="id">rdsettab(<span class="arg">rd</span>)</span>
</div>
<div class="param">
<span class="arg">rd</span>: <span class="type">record descriptor</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
The record system maintains for each record descriptor
a pair of tables, one that maps the name of a field to
a function that accesses the field in an instance of the
record, and one that maps the name of a field to a function
that updates the value of field.
<span class="id">Rdgettab</span> returns the
table of accessor functions.  An accessor function
expects as argument an instance of the record descriptor and
returns the value of the corresponding
field in the record.  <span class="id">rdsettab</span> returns the
table of update functions.  An update function expects
as arguments an instance of the record descriptor and a new value.
It sets the field in the record to the new value and returns the new
value.
</div>
</div>

<p id="para:record-pats">
We support general matching on records following a design 
similar to matching on lists.  As an example:
</p>

<div class="code">
<pre>
; @record myrec { field1, field2 };
<span class="arg">&lt;rd myrec&gt;</span>
; x = myrec(1,2);
<span class="arg">&lt;myrec 1031590bc&gt;</span>
; switch (x) { @match myrec(a,2): printf("a = %d\n", a); break; }
<span class="arg">a = 1</span>
</pre>
</div>

<p>
Record patterns match against fields in the order they 
were defined, and all fields must be present in the 
pattern.  If fields are missing then the pattern fails
to match.  Alternatively you can match against particular
fields by naming those fields; not all fields need to 
be listed when using this form, and they may be listed in
any order.  Continuing the previous example:
</p>

<div class="code">
<pre>
; switch (x) { @match myrec(field2=2): printf("ok\n"); break; }
<span class="arg">ok</span>
; switch (x) { @match myrec(field2=2,field1=y): printf("y=%d\n", y); break; }
<span class="arg">y=1</span>
</pre>
</div>

<p>
Be warned that an expression to create a record
resembles a function call and so if you
mistakenly include a function call in
a <span class="val">@match</span> Cinquecento will interpret 
it as a record pattern and fail to match it.
</p>

<h4 id="sec:containers">Container Types</h4>

<p>
Cinquecento supports three built-in container types:
lists, vectors, and tables.
</p>

<p>
Several functions operate on any type of container.
</p>

<div class="docitem" id="fn:length">
<div class="proto">
<div class="function">
<span class="id">length(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">string</span>, or <span class="type">table</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of items stored in 
<span class="arg">container</span>.
</div>
</div>

<div class="docitem" id="fn:isempty">
<div class="proto">
<div class="function">
<span class="id">isempty(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">string</span>, or <span class="type">table</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns <span class="val">1</span> if <span
class="arg">container</span> contains zero elements, <span class="val">0</span> otherwise.
</div>
</div>

<div class="docitem" id="fn:copy">
<div class="proto">
<div class="function">
<span class="id">copy(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, <span class="type">table</span>, or <span class="type">string</span>
</div>
<div class="returns">
<span class="type">same as container</span>
</div>
</div>
<div class="desc">
Returns a shallow copy of <span class="arg">container</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:foreach">foreach(<span class="arg">fn</span>,<span class="arg">container</span>,[<span class="arg">container2</span>, ...])</span>
</div>
<div class="function">
<span class="id" id="fn:map">map(<span class="arg">fn</span>,<span class="arg">container</span>,[<span class="arg">container2, ...</span>])</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list</span>, <span class="type">vector</span>, or <span class="type">table</span>
</div>
<div class="param">
<span class="arg">container2, ... </span>: <span class="type">list</span> or <span class="type">vector</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">

<div>
Calls <span class="arg">fn</span> on each item in the provided <span
class="arg">containers</span>. 
If the containers are either lists or vectors,
<span class="id">foreach</span> 
calls <span class="arg">fn</span>
on corresponding elements of the containers.
<span class="arg">fn</span> must 
accept as many arguments as there are containers,
and the containers must have the same length.
</div>

<div>
If <span class="arg">container</span> is a table,
then no other containers may be provided, and 
<span class="id">foreach</span> visits each key/value pair in
unspecified order, calling <span class="arg">fn</span>
with the key and value, in that order, as separate
arguments.
</div>

<div>
<span class="id">Foreach</span> discards the values
returned by <span class="arg">fn</span> and returns
<span class="val">nil</span>.
</div>

<div>
<span class="id">Map</span> is like <span class="id">foreach</span>
except that it collects the values
returned by <span class="arg">fn</span> in a list,
and returns the list.  If the <span class="arg">containers</span>
are vectors or lists,
the order of the elements in
the list returned by <span class="id">map</span>
corresponds to the order of the elements
in the <span class="arg">containers</span>.
</div>

</div>
</div>

<div class="docitem" id="fn:sort">
<div class="proto">
<div class="function">
<span class="id">sort(<span class="arg">container</span>,<span class="arg">cmp</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or vector</span>
</div>
<div class="param">
<span class="arg">cmp</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Sorts in place the elements of <span
class="arg">container</span>, using <span
class="arg">cmp</span> to compare elements.  <span
class="arg">Cmp</span> accepts two arguments, each an
element of <span class="arg">container</span>, and
returns: a negative cvalue if the first argument
compares less than the second; a positive cvalue if the
first argument compares greater than the second; or
zero if they are equal.  Returns <span class="arg">container</span>
following the update.
</div>
</div>

<div class="docitem" id="fn:bsearch">
<div class="proto">
<div class="function">
<span class="id">bsearch(<span class="arg">key</span>,<span class="arg">container</span>,<span class="arg">cmp</span>)</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or vector</span>
</div>
<div class="param">
<span class="arg">cmp</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">element of container or nil</span>
</div>
</div>
<div class="desc">
Searches the elements of <span
class="arg">container</span> for one matching <span class="arg">key</span>.
The elements of the container must be sorted in ascending order
according to the comparison function <span class="arg">cmp</span>.
<span
class="arg">Cmp</span> accepts two arguments, first (always) <span class="arg">key</span> and second an
element of <span class="arg">container</span>, and
returns: a negative cvalue if the first argument
compares less than the second; a positive cvalue if the
first argument compares greater than the second; or
zero if they are equal.
</div>
</div>

<div class="docitem" id="fn:pop">
<div class="proto">
<div class="function">
<span class="id">pop(<span class="arg">container</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or table</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">container</span></span>
</div>
</div>
<div class="desc">
If <span class="arg">container</span> is a list,
removes and returns the first element, shifting any
remaining elements down one position.
If <span class="arg">container</span> is a table,
removes and returns an arbitrary key/value pair.
The pair is returned as a vector, with the key
in the first element and value in the second.
If the list or table is empty, <span class="id">pop</span> returns <span class="id">nil</span>.
</div>
</div>


<div class="docitem" id="fn:concat">
<div class="proto">
<div class="function">
<span class="id">concat(<span class="arg">x1</span>,<span class="arg">x2</span>)</span>
</div>
<div class="param">
<span class="arg">x1</span>: <span class="type">list or string</span>
</div>
<div class="param">
<span class="arg">x2</span>: <span class="type">list or string</span>
</div>
<div class="returns">
<span class="type">list or string</span>
</div>
</div>
<div class="desc">
Returns the concatentation of the arguments.  The arguments must
be of the same type.
</div>
</div>

<div class="docitem" id="fn:count">
<div class="proto">
<div class="function">
<span class="id">count(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of values
in <span class="arg">container</span> that
are <a href="#fn:equal"><span class="id">equal</span></a>
to <span class="arg">v</span>.
</div>
</div>

<div class="docitem" id="fn:index">
<div class="proto">
<div class="function">
<span class="id">index(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the index of the first value
in <span class="arg">container</span>
<a href="#fn:equal"><span class="id">equal</span></a>
to <span class="arg">v</span>, or 
or <span class="val">nil</span>
is there is no such value.
</div>
</div>

<div class="docitem" id="fn:ismember">
<div class="proto">
<div class="function">
<span class="id">ismember(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list, string, table, or vector</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns <span class="val">1</span> if 
<span class="arg">container</span> contains a value
<a href="#fn:equal"><span class="id">equal</span></a> to 
<span class="arg">v</span>,
or <span class="val">0</span>
otherwise.
</div>
</div>

<div class="docitem" id="fn:delete">
<div class="proto">
<div class="function">
<span class="id">delete(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or table</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">container</span>
</div>
</div>
<div class="desc">
Deletes every value
in <span class="arg">container</span>
that is
<a href="#fn:equal"><span class="id">equal</span></a>
to
<span class="arg">v</span>.
Returns <span class="arg">container</span> following the update.
</div>
</div>

<div class="docitem" id="fn:delq">
<div class="proto">
<div class="function">
<span class="id">delq(<span class="arg">container</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">container</span>: <span class="type">list or table</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">container</span>
</div>
</div>
<div class="desc">
Deletes every value
in <span class="arg">container</span>
that is
<a href="#fn:eq"><span class="id">eq</span></a>
to
<span class="arg">v</span>.
Returns <span class="arg">container</span> following the update.
</div>
</div>

<p>
Containers can be indexed with C array reference
operator (<span class="id">[]</span>).  The statement
</p>
<div class="code">
<pre>
	x = C[i];
</pre>
</div>
<p>
reads the <span class="id">i</span>th element from
container <span class="id">C</span>.  Likewise,
</p>
<div class="code">
<pre>
	C[i] = x;
</pre>
</div>
<p>
assigns the <span class="id">i</span>th element to
the value bound to <span class="id">x</span>, and the
statements
</p>
<div class="code">
<pre>
	C[i] += 1;	C[i]++;
</pre>
</div>
<p>
both increment the <span class="id">i</span>th element.
</p>

<p>
Unlike its use on C arrays, the <span class="id">[]</span>
operator on Cinquecento containers is not commutative.
In an
expression
<span class="id"><span class="arg">C</span>[<span class="arg">i</span>]</span>,
<span class="arg">C</span> must be a container and <span class="arg">i</span>
a valid index for the container.  For tables, a valid index is a key.
</p>

<p>
This and other syntax are supported by two generic functions on containers:
</p>

<div class="docitem" id="fn:cntrget">
<div class="proto">
<div class="function">
<span class="id">cntrget(<span class="arg">cntr</span>, <span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">cntr</span>: <span class="type">container</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">valid index for <span class="arg">cntr</span></span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">Cntrget</span> is the generic access function for
containers.  It returns the element of <span class="arg">cntr</span>
corresponding to <span class="arg">idx</span>.
</div>
</div>

<div class="docitem" id="fn:cntrput">
<div class="proto">
<div class="function">
<span class="id">cntrput(<span class="arg">cntr</span>, <span class="arg">idx</span>, <span class="arg">val</span>)</span>
</div>
<div class="param">
<span class="arg">cntr</span>: <span class="type">container</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type"><span class="type">valid index for <span class="arg">cntr</span></span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">see description</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">Cntrput</span> is the generic update function for
containers.  It updates the element
of <span class="arg">cntr</span> corresponding
to <span class="arg">idx</span> to
<span class="arg">val</span>, and returns <span class="arg">val</span>.
</div>
</div>


<h4 id="sec:lists">Lists</h4>

<p>
Lists are variable-length ordered collections, possibly
empty.  Lists are mutable, allowing items to be added
or deleted from any position, and contiguously indexed
from position 0.  The predicate
<a href="#fn:islist"><span class="id">islist</span></a> tests whether a value is
a list.
</p>

<div class="docitem" id="fn:list">
<div class="proto">
<div class="function">
<span class="id">list(<span class="arg">value</span>, ...)</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Constructs a new list containing the zero or more values passed as arguments.
The values are stored in argument order.
</div>
</div>

<div class="docitem" id="fn:mklist">
<div class="proto">
<div class="function">
<span class="id">mklist([<span class="arg">len</span>[,<span class="arg">val</span>]])</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Constructs a new list of size <span class="arg">len</span>, if provided,
or otherwise zero.
Each element is initialized to <span class="arg">val</span>, if provided,
otherwise to <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="syn:_emptylist_">
<div class="proto">
<div class="syntax">
<span class="id">[ <span class="arg">value</span>, ... ]</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
The syntax <span class="id">[...]</span> constructs a
new list containing the zero or more values enclosed in the
braces.  It is equivalent to calling <span
class="id">list</span> on the enclosed values.
</div>
</div>

<div class="docitem" id="fn:head">
<div class="proto">
<div class="function">
<span class="id">head(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">list</span></span>
</div>
</div>
<div class="desc">
Returns the first element of <span class="arg">list</span>.
</div>
</div>

<div class="docitem" id="fn:tail">
<div class="proto">
<div class="function">
<span class="id">tail(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a copy of <span class="arg">list</span> with the first element removed.
</div>
</div>


<div class="docitem" id="fn:listref">
<div class="proto">
<div class="function">
<span class="id">listref(<span class="arg">list</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">list</span></span>
</div>
</div>
<div class="desc">
Returns the item stored at position <span class="arg">idx</span> in
<span class="arg">list</span>.
</div>
</div>

<div class="docitem" id="listset">
<div class="proto">
<div class="function">
<span class="id">listset(<span class="arg">list</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Replaces the item at position <span
class="arg">idx</span> in <span
class="type">list</span> with <span
class="arg">value</span>.  It is an error if <span
class="type">list</span> does not contain more than
<span class="arg">idx</span> items.  Returns <span
class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:listins">
<div class="proto">
<div class="function">
<span class="id">listins(<span class="arg">list</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span>  at position <span
class="arg">idx</span> in <span
class="type">list</span>.  The elements at position <span
class="arg">idx</span> and higher, if any, are shifted up one position.
It is an error if <span
class="type">list</span> does not contain more than
<span class="arg">idx-1</span> items.  Returns <span
class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:listdel">
<div class="proto">
<div class="function">
<span class="id">listdel(<span class="arg">list</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Deletes the item at position <span
class="arg">idx</span> in <span
class="type">list</span>.  The elements at higher
positions, if any, are shifted down one position.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:append">
<div class="proto">
<div class="function">
<span class="id">append(<span class="arg">list</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span> at the end of
<span class="type">list</span>.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:push">
<div class="proto">
<div class="function">
<span class="id">push(<span class="arg">list</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Inserts <span class="arg">value</span> at the beginning of
<span class="type">list</span>, shifting all other elements up one position.
Returns <span class="type">list</span> following the update.
</div>
</div>

<div class="docitem" id="fn:reverse">
<div class="proto">
<div class="function">
<span class="id">reverse(<span class="arg">list</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a new list containing the elements of <span class="arg">list</span> in reverse order.
</div>
</div>

<div class="docitem" id="fn:slice">
<div class="proto">
<div class="function">
<span class="id">slice(<span class="arg">list</span>,
  <span class="arg">beg</span>,
  <span class="arg">end</span>)</span>
</div>
<div class="param">
<span class="arg">list</span>: <span class="type">list</span>
<span class="arg">beg</span>: <span class="type">cvalue</span>
<span class="arg">end</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a new list containing the elements
of <span class="arg">list</span> starting at
index <span class="arg">beg</span> up, but not
including, index <span class="arg">end</span>.
</div>
</div>

<p id="para:list-pats">
Lists can be deconstructed by pattern matching.  
For lists, legal patterns <i>p</i> are one of the following:

<ul>
<li>The empty list <span class="val">[]</span>
<li>A constant-length list where each list element is itself a
  pattern.  Examples of patterns having this form include
  <span class="val">[1,2]</span>; <span class="val">[<span class="arg">x</span>,
    2]</span>; <span class="val">[1, <span class="arg">_</span>]</span>;
    <span class="val">[_,<span class="arg">x</span>]</span>; and 
    <span class="val">[1,[<span class="arg">x</span>, 2]]</span>.
    Respectively, the first pattern only matches the constant
    list <span class="val">[1,2]</span>; the second pattern matches
    any two-element list whose second element
    is <span class="val">2</span>, binding <span class="arg">x</span> to
    the first element; the third pattern matches any two-element list
    whose first element is <span class="val">1</span> (and it ignores
    the second element); the fourth pattern matches any two-element
    list, binding the second element to <span class="arg">x</span>;
    and the last pattern matches a two-element list whose first
    element is <span class="val">1</span> and whose second element is
    itself a two-element list, in this case with the second element
    being <span class="val">2</span>, binding the first element to
    variable <span class="arg">x</span>
<li>A constant-length list where each list element is itself a
  pattern, as above, where the last element is a variable followed by
  <span class="val">...</span>.  In this case, the final variable
  matches against the <i>tail</i> of 
the list (which could be empty).  Thus, to match
against a list of at least length 3, and print the part
of the list beyond the first three elements, you would
do

<div class="code">
<pre>
; x = [1,2,3,4,5];
<span class="arg">[ 1, 2, 3, 4, 5 ]</span>
; switch (x) { @match [_,_,_,t...] : printf("match: t = %a\n",t); }
<span class="arg">match: t = [ 4, 5 ]</span>
</pre>
</div>
</ul>


<h4 id="sec:vectors">Vectors</h4>

<p>
Vectors are fixed-length ordered collections, possibly
empty.  Vectors are mutable, allowing items to be
changed at any position, and contiguously indexed from
position 0.  The predicate
<span class="id">isvector</span> tests whether a value is
a vector.
</p>

<div class="docitem" id="fn:mkvec">
<div class="proto">
<div class="function">
<span class="id">mkvec(<span class="arg">len</span>[,<span class="arg">val</span>])</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Constructs a new vector of size <span class="arg">len</span>.
Each element is initialized to <span class="arg">val</span>, if provided,
otherwise to <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="fn:vector">
<div class="proto">
<div class="function">
<span class="id">vector(<span class="arg">value</span>, ...)</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Constructs a new vector containing the zero or more values passed as arguments.
The values are stored in argument order.  The size of the vector is equal to the number of arguments.
</div>
</div>

<div class="docitem" id="fn:vecref">
<div class="proto">
<div class="function">
<span class="id">vecref(<span class="arg">vec</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">vec</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">depends on contents of <span class="arg">vec</span></span>
</div>
</div>
<div class="desc">
Returns the item stored at position <span class="arg">idx</span> in
<span class="arg">vec</span>.
</div>
</div>

<div class="docitem" id="fn:vecset">
<div class="proto">
<div class="function">
<span class="id">vecset(<span class="arg">vec</span>,<span class="arg">idx</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">vec</span>: <span class="type">vector</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Replaces the item at position <span
class="arg">idx</span> in <span
class="type">vec</span> with <span
class="arg">value</span>.  It is an error if <span
class="type">vec</span> does not contain more than
<span class="arg">idx</span> items.
</div>
</div>

<h4 id="sec:tables">Tables</h4>

<p>
Tables store key/value pairs.  Keys and values may be
any type of Cinquecento value other than <span
class="type">nil</span>.  The predicate
<span class="id">istable</span> tests whether a value is
a table.
</p>

<p>
Every table has a default value.  The default value is
set by the table constructors
<a href="#fn:mktab"><span class="id">mktab</span></a>,
<a href="#fn:mktabqv"><span class="id">mktabqv</span></a>,
and <a href="#fn:mktabq"><span class="id">mktabq</span></a>,
and determines the result of calls
to <a href="#fn:tablook"><span class="id">tablook</span></a>
on undefined keys.
</p>

<div class="docitem" id="fn:mktab">
<div class="proto">
<div class="function">
<span class="id">mktab([<span class="arg">def</span>])</span>
</div>
<div class="param">
<span class="arg">def</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
Creates and returns a new, empty table in which
key equivalence is determined by  
<a href="#fn:equal"><span class="id">equal</span></a>.
The default value of the table
is <span class="arg">def</span>, if provided, 
and otherwise <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="fn:mktabqv">
<div class="proto">
<div class="function">
<span class="id">mktabqv([<span class="arg">def</span>])</span>
</div>
<div class="param">
<span class="arg">def</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
Creates and returns a new, empty table in which
key equivalence is determined by  
<a href="#fn:eqv"><span class="id">eqv</span></a>.
The default value of the table
is <span class="arg">def</span>, if provided, 
and otherwise <span class="val">nil</span>.
</div>
</div>

<div class="docitem" id="fn:mktabq">
<div class="proto">
<div class="function">
<span class="id">mktabq([<span class="arg">def</span>])</span>
</div>
<div class="param">
<span class="arg">def</span>: <span class="type">value</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
Creates and returns a new, empty table in which
key equivalence is determined by  
<a href="#fn:eq"><span class="id">eq</span></a>.
The default value of the table
is <span class="arg">def</span>, if provided, 
and otherwise <span class="val">nil</span>.
</div>
</div>

<div class="docitem"  id="syn:_emptytable_">
<div class="proto">
<div class="syntax">
<span class="id">[ <span class="arg">key</span> : <span class="arg">value</span>, ... ]</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
This syntax constructs a
new table containing the zero or more key/value pairs enclosed in the
braces.  The syntax <span class="id">[ : ]</span> constructs an empty table.
The table is constructed with <a href="#fn:mktab"><span class="id">mktab</span></a>.
</div>
</div>


<div class="docitem" id="fn:tabinsert">
<div class="proto">
<div class="function">
<span class="id">tabinsert(<span class="arg">tab</span>,<span class="arg">key</span>,<span class="arg">value</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="param">
<span class="arg">value</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
Inserts the pair <span class="arg">key</span>/<span
class="arg">value</span> into <span
class="arg">tab</span>.  Any previous entry for
the same <span class="arg">key</span> is removed.
Returns <span class="arg">value</span>.
</div>
</div>

<div class="docitem" id="fn:tablook">
<div class="proto">
<div class="function">
<span class="id">tablook(<span class="arg">tab</span>,<span class="arg">key</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">depends on the contents of <span class="arg">tab</span></span>
</div>
</div>
<div class="desc">
<p>
Searches <span class="arg">tab</span> for a pair whose
key is <span class="arg">key</span> and returns the
associated value.
</p>

<p>
If <span class="arg">tab</span> has no such pair,
then the effect and return value of <span class="id">tablook</span>
is determined by the default value of the table in
the following way.
</p>

<p>
If the default value is not <span class="val">nil</span>
and not a function, then a new pair is inserted
into the table whose key is <span class="arg">key</span>
and whose value is the default value, and the
default value is returned.
</p>

<p>
If the default value is a function,
then a new pair is inserted
into the table whose key is <span class="arg">key</span>
and whose value is the result of calling the function on zero arguments,
and this result is returned.
</p>

<p>
Otherwise (the default value
is <span class="val">nil</span>), no modification to
the table is performed and <span class="val">nil</span>
is returned.
</p>

</div>
</div>

<div class="docitem" id="fn:tabdelete">
<div class="proto">
<div class="function">
<span class="id">tabdelete(<span class="arg">tab</span>,<span class="arg">key</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="param">
<span class="arg">key</span>: <span class="type">any type</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Deletes the pair with key <span class="arg">key</span>
from <span class="arg">tab</span>, if it exists.
</div>
</div>

<div class="docitem" id="fn:tabkeys">
<div class="proto">
<div class="function">
<span class="id">tabkeys(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all keys in
<span class="arg">tab</span>.
</div>
</div>

<div class="docitem" id="fn:tabvals">
<div class="proto">
<div class="function">
<span class="id">tabvals(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all values in
<span class="arg">tab</span>.</div>
</div>

<div class="docitem" id="fn:tabenum">
<div class="proto">
<div class="function">
<span class="id">tabenum(<span class="arg">tab</span>)</span>
</div>
<div class="param">
<span class="arg">tab</span>: <span class="type">table</span>
</div>
<div class="returns">
<span class="type">vector</span>
</div>
</div>
<div class="desc">
Returns a vector containing all keys and values in
<span class="arg">tab</span>.  The length of the
returned vector is twice the number of pairs in <span
class="arg">tab</span>.  The first half of the vector
contains the keys of <span class="arg">tab</span>; the
second half contains, in corresponding order,  the values.
</div>
</div>

<p id="para:table-pats">
We can also match against tables, using patterns of the
form <span class="val">[</span> <i>k</i>:<i>p</i> <span class="val">]</span>
where <i>k</i> must be a constant (containing no
variables) and <i>p</i> is an arbitrary pattern.
Such a pattern matches if the table being
matched against contains the key <i>k</i> which maps to
a value that matches against pattern <i>p</i>, in which
case any variables in <i>p</i> are bound in the
adjacent code.  For example:
</p>

<div class="code">
<pre>
; x = [1:"hello", 3:4];
<span class="arg">&lt;table&gt</span>
; switch (x) { @match [1:v] : printf("match: v = %a\n",v); }
<span class="arg">match: v = "hello"</span>
</pre>
</div>

<p>
Table patterns can have multiple key-value pairs in
them, <a href = "#para:list-pats">similarly to lists</a>.  
Since table patterns do not
require exact matches (i.e., a pattern matches if the
table contains the specified keys but there could be
other key-value pairs in the table) there is no need
for the ... pattern for tables.  Keys are not permitted
to be pattern variables; this would be too inefficient
and ambiguous.
</p>

<h4 id="sec:characters">Characters</h4>

<p>

ASCII characters are represented as cvalues of type
<span class="val">char</span> or <span
class="val">unsigned char</span>.
</p>

<p>
The following functions operate on characters.
</p>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:isalnum">isalnum(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isalpha">isalpha(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isascii">isascii(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isblank">isblank(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:iscntrl">iscntrl(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isdigit">isdigit(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isgraph">isgraph(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:islower">islower(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isodigit">isodigit(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isprint">isprint(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:ispunct">ispunct(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isspace">isspace(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isupper">isupper(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:isxdigit">isxdigit(<span class="arg">char</span>)</span>
</div>
<div class="param">
<span class="arg">char</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue (1 or 0)</span>
</div>
</div>
<div class="desc">
These functions implement predicates on character values.
They correspond to the ctype (character type) interface of the
C library.  The predicates are based on fixed character values,
and do not depend on the locale of the Cinquecento
evaluator.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:tolower">tolower(<span class="arg">char</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:toupper">toupper(<span class="arg">char</span>)</span>
</div>
<div class="param">
<span class="arg">char</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
These functions convert a lowercase (or uppercase) character
to the corresponding uppercase (or lowercase) character.
</div>
</div>


<h4 id="sec:strings">Strings</h4>

<p>
The Cinquecento string type represents an array of
bytes.  Cinquecento strings have fixed length (possibly
zero), are indexed from position 0, and are not null
terminated.  Strings are mutable, but do not share
storage with other strings.  The maximum string length
is 2<sup>64</sup>-1.  The predicate
<a href="#fn:isstring"><span class="id">isstring</span></a> tests whether a value is
a string.
</p>

<p>
The C relational operators (<tt>==</tt>, <tt>!=</tt>,
<tt>&lt;&lt;</tt>, <tt>></tt>, <tt>&lt;=</tt>, <tt>>=</tt>) are
defined over strings.  They compare the contents of the
strings.  There is no way to test whether two string
instances are the same object.
</p>

<p>
The binary C operator <tt>+</tt> concatenates strings.
</p>

<p>
The following functions comprise the basic string
operations. Note that while some of these functions
share names with C standard library functions, they are
equivalent to these functions only when their string
operands do not contain NUL bytes.
</p>

<div class="docitem" id="fn:mkstr">
<div class="proto">
<div class="function">
<span class="id">mkstr(<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a new string containing <span
class="arg">len</span> null bytes.
</div>
</div>

<div class="docitem" id="fn:strlen">
<div class="proto">
<div class="function">
<span class="id">strlen(<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the number of bytes in <span class="arg">str</span>.
Equivalent to <tt>length(<span class="arg">str</span>)</tt>.
</div>
</div>

<div class="docitem" id="fn:strcmp">
<div class="proto">
<div class="function">
<span class="id">strcmp(<span class="arg">s1</span>,<span class="arg">s2</span>)</span>
</div>
<div class="param">
<span class="arg">s1</span>,<span class="arg">s2</span>: <span class="type">string</span>s
</div>
<div class="returns">
<span class="type">cvalue</span> (-1, 0, or 1)
</div>
</div>
<div class="desc">
Returns the result of comparing
strings <span class="arg">s1</span>
and <span class="arg">s2</span> byte-by-byte.
Returns -1, 0, or 1 if <span class="arg">s1</span>
is, respectively,
less than, equal to, or greater than <span class="arg">v</span>.
</div>
</div>


<div class="docitem" id="fn:strref">
<div class="proto">
<div class="function">
<span class="id">strref(<span class="arg">str</span>,<span class="arg">idx</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">idx</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue of type <span class="type">uchar</span>
</span>
</div>
</div>
<div class="desc">
Returns the character at index <span class="arg">idx</span> in
<span class="arg">str</span>.
</div>
</div>

<div class="docitem" id="fn:strstr">
<div class="proto">
<div class="function">
<span class="id">strstr(<span class="arg">s1</span>,<span class="arg">s2</span>)</span>
</div>
<div class="param">
<span class="arg">s1</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">s2</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue or nil</span>
</div>
</div>
<div class="desc">
Returns the index in <span class="arg">s1</span> of the first occurrence
of the string <span class="arg">s2</span>, or nil if <span class="arg">s2</span>
does not match.
</div>
</div>

<div class="docitem" id="fn:substr">
<div class="proto">
<div class="function">
<span class="id">substr(<span class="arg">str</span>,<span class="arg">start</span>,<span class="arg">end</span>)</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">start</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">end</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string containing a copy of the substring of <span
class="arg">from</span> starting at position
<span class="arg">start</span> up to but not including position 
<span class="arg">end</span>.
</div>
</div>

<div class="docitem" id="fn:strput">
<div class="proto">
<div class="function">
<span class="id">strput(<span class="arg">to</span>,<span class="arg">offset</span>,<span class="arg">from</span>)</span>
</div>
<div class="param">
<span class="arg">to</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">offset</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">from</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Copies the contents of string <span
class="arg">from</span> into <span 
class="arg">to</span>.  The copy begins at position
<span class="arg">offset</span> within <span
class="arg">to</span>.  It is an error if <span class="arg">to</span> is too short for <span
class="arg">from</span> to be copied in entirety.
</div>
</div>

<div class="docitem" id="fn:memset">
<div class="proto">
<div class="function">
<span class="id">memset(<span class="arg">str</span>,<span class="arg">byte</span>[,<span class="arg">lim</span>])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">byte</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">lim</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Fills the first <span class="arg">lim</span> bytes of string <span
class="arg">str</span> with the low eight bits of <span class="arg">byte</span>.
If <span class="arg">lim</span> is unspecified, the entire string is filled.
</div>
</div>

<div class="docitem" id="fn:strton">
<div class="proto">
<div class="function">
<span class="id">strton(<span class="arg">str</span>[,<span class="radix">base</span>])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">base</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Converts the contents of <span class="arg">str</span>
to an integer cvalue in the literal domain.  The format
of <span class="arg">str</span> may be any valid C
integer constant.  If provided and non-zero, <span class="arg">base</span>
specifies the base in which the string is interpreted.
</div>
</div>

<div class="docitem" id="fn:split">
<div class="proto">
<div class="function">
<span class="id">split(<span class="arg">str</span>[,<span class="arg">set</span>[,<span class="arg">lim</span>]])</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">set</span>: <span class="type">string or nil</span>
</div>
<div class="param">
<span class="arg">lim</span>: <span class="type">cval</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Searches <span class="arg">str</span> for substrings delimited
by characters in <span class="arg">set</span> and returns
a list of the substrings.

If <span class="arg">set</span> is not specified or is <span class="val">nil</span>,
the split occurs on consecutive white space delimiters.  Otherwise,
the split occurs on each occurrence of a delimiters from <span class="arg">set</span>,
and consecutive delimiters yield empty strings.

If <span class="arg">lim</span> is specified, at most
<span class="arg">lim</span> splits are performed; if input remains,
it is returned as the final element of the returned list.
</div>
</div>


<div class="docitem" id="fn:mapfile">
<div class="proto">
<div class="function">
<span class="id">mapfile(<span class="arg">filename</span>[,<span class="arg">mode</span>])</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a string reflecting a memory mapping of the 
file named <span class="arg">filename</span>.
The optional <span class="arg">mode</span> string specifies
the protection and sharing mode of the mapping, comprised
of the following characters:
 <span class="val">r</span> (read),
 <span class="val">w</span> (write),
 <span class="val">x</span> (execute),
 <span class="val">s</span> (shared).
When shared, the mapping shares backing storage with
the file and with any other shared mappings of the file
on the system.  Otherwise the mapping is a private copy.
The default mode is <span class="val">"rw"</span>.
</div>
</div>

<h4 id="sec:pairs">Pairs</h4>

<p>
A pair is an object that holds references
to two other Cinquecento values, called its <em>car</em>
and <em>cdr</em>.  It is akin to the
fundamental <em>cons cell</em> data structure of
Lisp-based languages.
</p>

<p>
Both pairs and the <a href="#sec:lists">list</a> type can be used to build
lists.  The primary difference is that a list built from
the list type is itself mutable, <em>i.e.</em>, it can
be updated in place by imperative operations such
as <a href="#fn:isstring"><span class="id">append</span></a>
and <a href="#fn:isstring"><span class="id">delete</span></a>.
Lists based on pairs, in contrast, are typically manipulated
by functional operations in the style of Lisp lists.
</p>

<p>
The conventional value for the empty list in
Cinquecento is <span class="id">nil</span>.
It is an error to call container and list functions
such as
<a href="#fn:isempty"><span class="id">isempty</span></a>,
<a href="#fn:length"><span class="id">length</span></a>, and
<a href="#fn:listref"><span class="id">listref</span></a>
on a list built from pairs and <span class="id">nil</span>.
</p>

<p>
Note that the list constructor syntax
<a href="#syn:_emptylist_"><span class="id">[...]</span></a>
is used to build instances of the list type, not
pair-based lists.
</p>

<p>
The predicate
<a href="#fn:ispair"><span class="id">ispair</span></a> tests whether a value is
a pair.
</p>

<p>
The functions that operate on pairs are:
</p>

<div class="docitem" id="fn:cons">
<div class="proto">
<div class="function">
<span class="id">cons(<span class="arg">v1</span>,<span class="arg">v2</span>)</span>
</div>
<div class="param">
<span class="arg">v1,v2</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">pair</span>
</div>
</div>
<div class="desc">
Constructs a new pair whose car is <span
class="arg">v1</span> and whose cdr is
<span
class="arg">v2</span>.
</div>
</div>

<div class="docitem" id="fn:car">
<div class="proto">
<div class="function">
<span class="id">car(<span class="arg">p</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: <span class="type">pair</span>
</div>
<div class="returns">
<span class="type">depends on the contents of <span class="arg">p</span></span>
</div>
</div>
<div class="desc">
Returns the the car of <span class="arg">p</span>.
</div>
</div>

<div class="docitem" id="fn:cdr">
<div class="proto">
<div class="function">
<span class="id">cdr(<span class="arg">p</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: <span class="type">pair</span>
</div>
<div class="returns">
<span class="type">depends on the contents of <span class="arg">p</span></span>
</div>
</div>
<div class="desc">
Returns the cdr of <span class="arg">p</span>.
</div>
</div>


<div class="docitem" id="fn:setcar">
<div class="proto">
<div class="function">
<span class="id">setcar(<span class="arg">p</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: <span class="type">pair</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the car of <span class="arg">p</span> to <span class="arg">v</span>.
</div>
</div>

<div class="docitem" id="fn:setcdr">
<div class="proto">
<div class="function">
<span class="id">setcdr(<span class="arg">p</span>,<span class="arg">v</span>)</span>
</div>
<div class="param">
<span class="arg">p</span>: <span class="type">pair</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the cdr of <span class="arg">p</span> to <span class="arg">v</span>.
</div>
</div>

<p>
A <em>weak pair</em> is a pair whose car is a <em>weak pointer</em>,
a pointer that is not followed by the collector.  An object
that is reachable only through weak pointers will be eventually reclaimed
by the collector, at which time its references will be replaced
with the value <span class="id">nil</span>.  A weak pair is otherwise
indistinguishable from a pair.
The predicate
<span class="id" id="fn:isweakpair">isweakpair</span> tests whether a value is
a weak pair.
</p>

<div class="docitem" id="fn:weakcons">
<div class="proto">
<div class="function">
<span class="id">weakcons(<span class="arg">v1</span>,<span class="arg">v2</span>)</span>
</div>
<div class="param">
<span class="arg">v1,v2</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">weak pair</span>
</div>
</div>
<div class="desc">
Constructs a new weak pair whose car is <span
class="arg">v1</span> and whose cdr is
<span
class="arg">v2</span>.  The car is a weak pointer
to <span class="arg">v1</span>.
</div>
</div>

<h4 id="sec:io">I/O</h4>

<p>
Cinquecento supports I/O backed by regular files, network
connections, or user-defined functions.  Such I/O resources
are represented by an instance of the file descriptor type.
The predicate <a href="#fn:isfd"><span class="id">isfd</span></a>
tests whether a value is a file descriptor.
</p>

<p>
When the storage for a regular file or network
connection descriptor is collected, the system
implicitly closes the underlying system file resource.
(This is not true for descriptors backed by
user-defined functions.)
</p>

<div class="docitem" id="fn:open">
<div class="proto">
<div class="function">
<span class="id">open(<span class="arg">filename</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Opens the file named <span class="arg">filename</span> and
returns the associated file descriptor.  <span
class="arg">Mode</span> specifies the mode of access:
<span class="val">"r"</span> (read),
<span class="val">"w"</span> (create or truncate for writing),
<span class="val">"rw"</span> (create or truncate for reading and writing),
<span class="val">"a"</span> (append), or
<span class="val">"ra"</span> (append and read).
Returns <span class="val">nil</span> if the file cannot
be opened; the error condition is available
via <span class="fnindex"><a href="#fn:errno">errno</a></span>.
</div>
</div>

<div class="docitem" id="fn:fdopen">
<div class="proto">
<div class="function">
<span class="id">fdopen(<span class="arg">fd</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Creates and returns a Cinquecento file descriptor that
is bound to the system-level file
descriptor <span class="arg">fd</span> of the calling
process.
<span class="arg">Mode</span> specifies whether the
file descriptor can be read, written, or both; see
<span class="fnindex"><a href="#fn:open">open</a></span>.
The native file descriptor is closed if and when the
Cinquecento file descriptor is closed, including the
implicit close that occurs when a file descriptor is
collected.
</div>
</div>


<div class="docitem" id="fn:tcpopen">
<div class="proto">
<div class="function">
<span class="id">tcpopen(<span class="arg">address</span>)</span>
</div>
<div class="param">
<span class="arg">address</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Opens a TCP connection to <span class="arg">address</span> and
returns the associated file descriptor.
<span class="arg">Address</span> is a string of the form
<tt>"<em>addr</em>:<em>port</em>"</tt>, where
<span class="arg">addr</span> is an IP address or hostname and
<span class="arg">port</span> is a port number or service
name.  Returns <span class="val">nil</span> if the connection cannot be opened;
the error condition is available via <span class="fnindex"><a href="#fn:errno">errno</a></span>.
</div>
</div>

<div class="docitem" id="fn:tcplisten">
<div class="proto">
<div class="function">
<span class="id">tcplisten(<span class="arg">address</span>)</span>
</div>
<div class="param">
<span class="arg">address</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Starts a TCP listener on <span class="arg">address</span> and
returns the associated file descriptor.
<span class="arg">Address</span> is a string of the form
<tt>"<em>addr</em>:<em>port</em>"</tt>, where
<span class="arg">addr</span> is an IP address or hostname and
<span class="arg">port</span> is a port number or service
name.
</div>
</div>

<div class="docitem" id="fn:tcpaccept">
<div class="proto">
<div class="function">
<span class="id">tcpaccept(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">file descriptor</span>
</div>
</div>
<div class="desc">
Accepts an incoming connection on the TCP listener associated
with <span class="arg">fd</span> (returned by 
<span class="fnindex"><a href="#fn:tcplisten">tcplisten</a></span>)
and returns a file descriptor for the new connection.
If no connection is waiting, the call blocks until one arrives.
</div>
</div>

<div class="docitem" id="fn:getpeername">
<div class="proto">
<div class="function">
<span class="id">getpeername(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the address, in the form <tt>"<em>addr</em>:<em>port</em>"</tt>,
of the peer endpoint of the TCP
connection associated with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:getsockname">
<div class="proto">
<div class="function">
<span class="id">getsockname(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the address, in the form <tt>"<em>addr</em>:<em>port</em>"</tt>,
of the local endpoint of the TCP
connection associated with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:sockpair">
<div class="proto">
<div class="function">
<span class="id">sockpair()</span>
</div>
<div class="returns">
<span class="type">list of two file descriptors</span>
</div>
</div>
<div class="desc">
Creates a buffered, bi-directional channel for
interprocess communication.  The two file
descriptors returned are its endpoints:
data written to one descriptor is available for reading
from the other.
</div>
</div>


<div class="docitem" id="fn:read">
<div class="proto">
<div class="function">
<span class="id">read(<span class="arg">fd</span>,<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Reads at most <span class="arg">len</span> bytes from
the I/O resource associated
with <span class="arg">fd</span>.  Returns a string
containing the bytes read, or <tt>nil</tt> if end of
file was encountered and no bytes were read.
</div>
</div>

<div class="docitem" id="fn:fread">
<div class="proto">
<div class="function">
<span class="id">fread(<span class="arg">fd</span>,<span class="arg">len</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">len</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">string</span> or <span class="type">nil</span>
</div>
</div>
<div class="desc">
Reads at most <span class="arg">len</span> bytes from the I/O
resource associated with <span class="arg">fd</span>.  The
call blocks until <span class="arg">len</span> bytes are
read or end of file is encountered.  Returns a string
containing the bytes read, or <tt>nil</tt> if end of
file was encountered and no bytes were read.
</div>
</div>

<div class="docitem" id="fn:write">
<div class="proto">
<div class="function">
<span class="id">write(<span class="arg">fd</span>,<span class="arg">str</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">str</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Writes the bytes contained in the string
<span class="arg">str</span> to the I/O resource associated
with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:close">
<div class="proto">
<div class="function">
<span class="id">close(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Closes the I/O resource associated with <span
class="arg">fd</span>.  Any pending buffered output is
written.  A call to <span class="id">close</span> on an
already closed descriptor has no effect.  A call to
<span class="id">read</span> or <span
class="id">write</span> on a closed descriptor draws an
error.
</div>
</div>

<div class="docitem" id="fn:seek">
<div class="proto">
<div class="function">
<span class="id">seek(<span class="arg">fd</span>, <span class="arg">offset</span>, <span class="arg">whence</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">offset</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">whence</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Invokes a system-level file seek operation (<span class="id">lseek</span>) on
the I/O resource associated
with <span class="arg">fd</span>.  The integer values
of <span class="arg">offset</span>
and <span class="arg">whence</span> are passed
unmodified to the seek; the caller is expected to know
how to use them.  Returns the value returned by the seek.
</div>
</div>

<div class="docitem" id="fn:ioctl">
<div class="proto">
<div class="function">
<span class="id">ioctl(<span class="arg">fd</span>, <span class="arg">offset</span>, <span class="arg">whence</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">req</span>: <span class="type">cvalue</span>
</div>
<div class="param">
<span class="arg">dat</span>: <span class="type">cvalue or string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Invokes a system-level <span class="id">ioctl</span> operation
on the I/O resource associated
with <span class="arg">fd</span>.  The integer value
of <span class="arg">req</span> is passed unmodified.
If <span class="arg">dat</span> is a cvalue, its integer value is passed unmodified; otherwise a pointer to the contents of the string is passed.
The caller is expected to know how to use these arguments.
Returns the value returned by <span class="id">ioctl</span>.
</div>
</div>

<div class="docitem" id="fn:select">
<div class="proto">
<div class="function">
<span class="id">select(<span class="arg">rfds</span>, <span class="arg">wfds</span>, <span class="arg">efds</span>[, <span class="arg">timeout</span>])</span>
</div>
<div class="param">
<span class="arg">rfds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">wfds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">efds</span>: <span class="type">list of file descriptors</span>
</div>
<div class="param">
<span class="arg">timeout</span>: <span class="type">list of cvalues</span>
</div>
<div class="returns">
<span class="type">list of lists of file descriptors</span>
</div>
</div>
<div class="desc">
Checks the status of the system-level file descriptors underlying the
file descriptors in <span class="arg">rfds</span>,
<span class="arg">wfds</span>, and
<span class="arg">efds</span> for ready-to-read,
ready-to-write, or pending exception, respectively.
Returns three fresh lists each containing,
respectively, the selected file descriptors
from <span class="arg">rfds</span>,
<span class="arg">wfds</span>, and
<span class="arg">efds</span>.  If
provided, <span class="arg">timeout</span> must be a
list of two cvalues &mdash; time in seconds and additional time
in microseconds &mdash;
specifying a period of time after which, if no descriptors are
otherwise ready, the call
to <span class="id">select</span> returns.
If <span class="arg">timeout</span> is not
provided, the call blocks until at least one descriptor becomes ready.
</div>
</div>


<div class="docitem" id="fn:fdname">
<div class="proto">
<div class="function">
<span class="id">fdname(<span class="arg">fd</span>)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the name of the I/O resource associated with <span
class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:mkfd">
<div class="proto">
<div class="function">
<span class="id">mkfd(<span class="arg">read</span>,<span class="arg">write</span>,<span class="arg">close</span>[,<span class="arg">name</span>])</span>
</div>
<div class="param">
<span class="arg">read</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">write</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">close</span>: <span class="type">function or nil</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">fd</span>
</div>
</div>

<div class="desc">
Returns a new file descriptor whose I/O semantics
are implemented by the functions <span class="arg">read</span>
and <span class="arg">write</span>.
</div>

<div class="desc">
<span class="arg">Read</span>
must be a function of one argument,
a cvalue <span class="arg">length</span>.
It is called to read data from the file descriptor;
it must return a string of length no greater than
<span class="arg">length</span>.
</div>

<div class="desc">
<span class="arg">Write</span>
must be a function of one argument,
a string <span class="arg">buf</span>.
It is called to write data to the file descriptor.
The system interprets a return value other than <span class="id">nil</span>
to signify an I/O error.
</div>

<div class="desc">
When the file descriptor is explicitly closed (by a call
to <span class="id">close</span>), the function
<span class="arg">close</span> is called with zero arguments.
Its return value is ignored.
Subsequent calls to <span class="id">close</span>
are ignored.
<span class="arg">Close</span> is <em>not</em>
called impliclity when the file descriptor storage is reclaimed;
use a finalizer to arrange the <span class="arg">close</span> call.
</div>

<div class="desc">
If <span class="arg">read</span> is <span class="id">nil</span>
then an attempt to read the resulting file descriptor draws an error;
similarly if <span class="arg">write</span> is <span class="id">nil</span>
the the file descriptor cannot be written.  
If <span class="arg">close</span> is <span class="id">nil</span>,
attempts to close operations are silently ignored.
</div>

<div class="desc">
If provided, <span class="arg">name</span> is the string
returned by <span class="id">fdname</span>; otherwise 
<span class="id">fdname</span> returns the empty string.
</div>
</div>


<h4 id="sec:fs">Filesystem Functions</h4>

<p>
This section documents functions that operate on the file system.
</p>

<div class="docitem" id="fn:access">
<div class="proto">
<div class="function">
<span class="id">access(<span class="arg">filename</span>,<span class="arg">mode</span>)</span>
</div>
<div class="param">
<span class="arg">filename</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">mode</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">

Evaluates <span class="arg">filename</span> for accessibility.
<span class="arg">Mode</span> is one or more (concatenated)
access mode specifications:
read permission
(<span class="val">"r"</span>),
write permission
(<span class="val">"w"</span>),
execute permission,
(<span class="val">"x"</span>),
and mere existence
(<span class="val">"f"</span>).
Returns
<span class="val">1</span>
if all specified modes are permitted,
otherwise
<span class="val">0</span>.
</div>
</div>

<div class="docitem" id="fn:mkdir">
<div class="proto">
<div class="function">
<span class="id">mkdir(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Creates a new directory named <span class="arg">name</span>.
</div>
</div>

<div class="docitem" id="fn:rmdir">
<div class="proto">
<div class="function">
<span class="id">rmdir(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Removes the directory named <span class="arg">name</span>.
</div>
</div>

<div class="docitem" id="fn:unlink">
<div class="proto">
<div class="function">
<span class="id">unlink(<span class="arg">name</span>)</span>
</div>
<div class="param">
<span class="arg">name</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Removes the file named <span class="arg">name</span>.
</div>
</div>


<h4 id="sec:fmt">Formatted Output</h4>

<p>
Cinquecento provides several functions for C-style
formatted output to various destinations.
</p>

<p>

Each function expects a format string argument.  The
format string may include conversion specifications
that are similar (but not identical) to those handled
by C stdio library functions.  Each conversion
specification begins with
the <span class="val">%</span> character, optionally
followed by zero or more modifiers characters,
optionally followed by a decimal width specifier, optionally
followed by the <span class="val">.</span> character
and a decimal precision specifier, finally followed by a single
verb character.  The accepted modifier characters are
<span class="val">+</span>, <span class="val">-</span>, <span class="val">0</span>,
<span class="val">#</span>, and a single space.  The
modifier characters and the width and precision
specifiers have the same effects they have in C.  In
addition, the
modifiers <span class="val">l</span>, <span class="val">L</span>, <span class="val">h</span>
are accepted but have no effect; unlike the C stdio
formatter, Cinquecento can determine the size of an
integer operand from its type.
</p>

<p>
The conversions are processed in order; each
operates in turn on the remaining values passed to the
format function.
</p>

<p>
The recognized verb characters are:
</p>

<div class="table">
<table>

<tr>
<td><span class="val">a</span></td>
<td>
Formats any type of value in an implementation-defined
format.
</td>
</tr>

<tr>
<td><span class="val">c</span></td>
<td>
Formats a character value as an ASCII character (if printable)
or in octal.
</td>
</tr>

<tr>
<td><span class="val">d,o,x,X,u</span></td>
<td>
Formats an integer or pointer value in signed decimal,
octal, lowercase hex, uppercase hex, or unsigned
decimal.
</td>
</tr>

<tr>
<td><span class="val">e</span></td>
<td>

Formats a value of an enumerated type as the name of a
constant having the same value.  If more than one
constant has the same value, one constant is picked in
an undefined manner.  If no constant has the value, the
value is formatted as if the <span class="val">d</span>
verb had been used.
</td>
</tr>

<tr>
<td><span class="val">p</span></td>
<td>
Formats a pointer value in lowercase hex.
</td>
</tr>

<tr>
<td><span class="val">s,b,B</span></td>
<td>
Formats strings.
If the value is not a string, then the result of calling <span class="id"><a
href="#fn:stringof">stringof</a></span> on the value is used.
<div>
<span class="val">s</span> copies the string value, stopping at the first null byte.
</div>
<div>
<span class="val">b</span> is like <span class="val">s</span>, except the entire
string is printed, including null bytes.
</div>
<div>
<span class="val">B</span> is like <span class="val">b</span>, except unprintable
characters are formatted as octal literals and " and \ are escaped.
</div>
</td>
</tr>

<tr>
<td>
<span class="val">t</span>
</td>
<td>
Formats a ctype.  The value may be in one of two forms:
(1) a ctype, in which case it is formatted as a
conventional C type specification, or (2) a vector,
representing a C symbol, of the form <span
class="val">[ <span class="arg">T</span>, <span
class="arg">ID</span>, ... ]</span>, where <span
class="arg">T</span> is a ctype and <span
class="arg">ID</span> is a string or <span
class="val">nil</span>, in which case the symbol is
formatted as conventional (possibly abstract) C
declaration.
</td>
</tr>

<tr>
<td>
<span class="val">y</span>
</td>
<td>
Formats an integer or pointer value as <span
class="val">"<span class="arg">symbol</span>+<span
class="arg">offset</span>"</span>.
<span class="arg">Symbol</span> is the name of the symbol returned
by a call to the name space <span class="arg"><a
href="#fn:lookaddr">lookaddr</a></span> operation on
the value.  <span class="arg">Offset</span> is the
difference between the value and the location of the symbol returned by
<span class="arg">lookaddr</span>.  If the difference
is zero, the offset is suppressed.
</td>
</tr>
</table>
</div>

<p>
The formatted output functions are:
</p>

<div class="docitem" id="fn:printf">
<div class="proto">
<div class="function">
<span class="id">printf(<span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sends formatted output to the current standard output.
</div>
</div>

<div class="docitem" id="fn:fprintf">
<div class="proto">
<div class="function">
<span class="id">fprintf(<span class="arg">fd</span>, <span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fd</span>: <span class="type">file descriptor</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sends formatted output to I/O resource associated with <span class="arg">fd</span>.
</div>
</div>

<div class="docitem" id="fn:sprintfa">
<div class="proto">
<div class="function">
<span class="id">sprintfa(<span class="arg">fmt</span>, ...)</span>
</div>
<div class="param">
<span class="arg">fmt</span>: <span class="type">format string</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns a new string containing formatted output.
</div>
</div>


<h4 id="sec:compile">Quotation, Compilation, and Evaluation</h4>

<p>
L1 provides access to some stages of
Cinquecento expression evaluation.  The details of
these interfaces are likely to change.
</p>

<div class="docitem" id="fn:eval">
<div class="proto">
<div class="function">
<span class="id">eval(<span class="arg">expr</span>)</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">eval</span> evaluates the Cinquecento
expression contained in the
string <span class="arg">expr</span> and returns the
computed value.  The evaluation occurs in the top-level
environment of the caller.
</div>
</div>

<div class="docitem" id="fn:evalk">
<div class="proto">
<div class="function">
<span class="id">evalk(<span class="arg">expr</span>, <span class="arg">succ</span>, <span class="arg">fail</span>)</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">succ</span>: <span class="type">function</span>
</div>
<div class="param">
<span class="arg">fail</span>: <span class="type">function</span>
</div>
<div class="returns">
<span class="type">see description</span>
</div>
</div>
<div class="desc">
<span class="id">Evalk</span> is like 
<span class="id">eval</span>, but provides control over
the outcome of evaluations that cause an error to be raised.
<span class="id">Evalk</span> evaluates the Cinquecento
expression contained in the
string <span class="arg">expr</span>.
If the evaluation causes an error to be raised, the
same error message and stack trace that normally would be
be printed are printed, then evaluation continues by calling the function
<span class="arg">fail</span> with no arguments.
Otherwise, the function <span class="arg">succ</span>
is called with the result of the application as its
single argument.
<span class="id">Evalk</span>(<span class="arg">expr</span>,
<span class="arg">succ</span>,<span class="arg">fail</span>)
is equivalent to <span class="id">applyk</span>(
<span class="id">eval</span>,
<span class="arg">succ</span>,
<span class="arg">fail</span>,
<span class="arg">[expr]</span>).
</div>
</div>

<div class="docitem" id="fn:parse">
<div class="proto">
<div class="function">
<span class="id">parse(<span class="arg">expr<span>[,<span class="arg">file</span>[,<span class="arg">line</span>]])</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">string</span>
<span class="arg">file</span>: <span class="type">string</span>
<span class="arg">line</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">stx</span>
</div>
</div>
<div class="desc">
Returns the result of parsing the Cinquecento
expression in the string <span class="arg">expr</span>.
<span class="arg">File</span> is the file name of the
source attribute associated with the resulting syntax;
it defaults to <span class="val">"&lt;stdin&gt;"</span>.
<span class="arg">Line</span> is the starting line
number of the source attribute associated with the
resulting syntax; it defaults
to <span class="val">1</span>.
</div>
</div>

<div class="docitem" id="syn:_at_quote">
<div class="proto">
<div class="function">
<span class="id">@quote { <span class="arg">expr</span> }</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">see description</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
The <span class="id">@quote</span> form provides a syntactic interface
to the functionality <span class="id"><a href="#fn:stringof">parse</a></span>.
It returns the result of parsing the literal Cinquecento expression <span class="arg">expr</span>.
</div>
</div>

<div class="docitem" id="fn:compile">
<div class="proto">
<div class="function">
<span class="id">compile(<span class="arg">expr<span>)</span>
</div>
<div class="param">
<span class="arg">expr</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">function</span>
</div>
</div>
<div class="desc">
<span class="arg">Expr</span> must be a Cinquecento parse tree
of the form returned by <span class="id"><a href="#fn:stringof">parse</a></span> or <span class="id"><a href="#syn:_at_quote">@quote</a></span>.
<span class="id">Compile</span> returns a function
that, when called, returns the result of evaluating the
original expression.
</div>
</div>


<p>
If <span class="arg">e</span> is a literal
Cinquecento expression, then the expressions
<div class="code">
<pre>
	eval("<span class="arg">e</span>")
</pre>
</div>
and
<div class="code">
<pre>
	compile(parse("<span class="arg">e</span>"))()
</pre>
</div>
and
<div class="code">
<pre>
	compile(@quote { <span class="arg">e</span> })()
</pre>
</div>
are equivalent.
</p>


<h4 id="sec:storage">Storage Management</h4>

<p>
Storage in the L1 implementation of Cinquecento is
managed by a generational stop-the-world copying
collector.  Its design draws on published
descriptions of storage management in <em>Chez Scheme</em>
[<a href="#bib:csug">CSUG</a>, <a href="#bib:bibop">BiBOP</a>,
<a href="#bib:guardian">Guardians</a>].
</p>

<p>
User functions related to storage management are:
</p>


<div class="docitem" id="fn:gc">
<div class="proto">
<div class="function">
<span class="id">gc()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Runs the collector.
</div>
</div>

<div class="docitem" id="fn:postgc">
<div class="proto">
<div class="function">
<span class="id">postgc()</span>
</div>
<div class="returns">
<span class="type">ignored</span>
</div>
</div>
<div class="desc">
The system calls the
nullary function <span class="id">postgc</span>
after each collection cycle.
By default,
<span class="id">postgc</span> is a function that
returns <span class="val">nil</span>.  Programs may
rebind <span class="id">postgc</span> to another function
that performs work intended to be coordinated with
collection.  Since other code may independently modify
<span class="id">postgc</span>, the
old value of <span class="id">postgc</span> should be called
at some point during the evaluation of its replacement.  For example,
the first time the function
<span class="fnindex"><a href="#fn:finalize">finalize</a></span>
is called, it replaces <span class="id">postgc</span> with a function
that calls the previous value
of <span class="id">postgc</span> and then services
any registered finalizers.
</div>
</div>


<div class="docitem" id="fn:compact">
<div class="proto">
<div class="function">
<span class="id">compact()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
This function moves all currently live objects to a
region of memory that will never be collected again.
Its effect is to spare the collector most of the
overhead of ever scanning these objects again, at the
cost of their perpetual storage.  Mutable objects
preserved by <span class="id">compact</span> that later
acquire references to objects in younger generations
may still be scanned during future collections.
</div>
</div>

<div class="docitem" id="fn:gclock">
<div class="proto">
<div class="function">
<span class="id">gclock(<span class="arg">val</span>)</span>
</div>
<div class="function">
<span class="id">gcunlock(<span class="arg">val</span>)</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">any value</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Prevents the storage associated
with <span class="arg">val</span> from being reclaimed
or moved by the collector.  Locking incurs significant
space and execution overhead; it should be done
sparingly.  An object may be locked multiple times.
A locked object
may be later unlocked by an equal number of calls to <span class="id">gcunlock</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:gcstats">gcstats()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Prints information about the current state of the storage manager.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:mkguardian">mkguardian()</span>
</div>
<div class="returns">
<span class="type">procedure</span>
</div>
</div>
<div class="desc">
Guardians protect objects from reclamation.  The
semantics and interface of the guardians provided by L1
are very similar to those in published descriptions of <em>Chez Scheme</em>
[<a href="#bib:csug">CSUG</a>].
</div>
</div>

<div class="docitem" id="fn:finalize">
<div class="proto">
<div class="function">
<span class="id">finalize(v, fn)</span>
</div>
<div class="param">
<span class="arg">v</span>: <span class="type">any value</span>
</div>
<div class="param">
<span class="arg">fn</span>: <span class="type">function or nil</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">

Registers a finalizer function to be called before the
collector reclaims storage for the
value <span class="arg">v</span>.  The collector schedules a
call to the finalizer <span class="arg">fn</span> some
time after determining that <span class="arg">v</span>
is unreachable.  The sole argument passed
to <span class="arg">fn</span>
is <span class="arg">v</span>.

<p>
At the time it is passed to the finalizer, the
value <span class="arg">v</span> is unreachable but
otherwise has no special status.  In particular, the
finalizer may reintroduce references to the value,
e.g. by storing it in a hash table.  The finalizer will
not be called again for such a reincarnated value;
a new call to <span class="id">finalize</span>
must be arranged.
</p>

<p>
Only one finalizer can be associated with a value at
a time; <span class="id">finalize</span> replaces
the previously registered finalizer, if any.
To disassociate a finalizer from a value <span class="arg">v</span>,
call <span class="id">finalize(<span class="arg">v</span>, nil)</span>.
</p>

<p>
Finalizers are implemented through <a href="#fn:mkguardian">guardians</a>
and <span class="fnindex"><a href="#fn:postgc">postgc</a></span>.
</p>

</div>
</div>

<h4 id="sec:perf">Instrumentation</h4>

<p>
The function <span class="id">statistics</span> provides
access to internal instrumentation of the L1 runtime.
</p>

<div class="docitem" id="fn:statistics">
<div class="proto">
<div class="function">
<span class="id">statistics()</span>
</div>
<div class="returns">
<span class="type">table</span>
</div>
</div>
<div class="desc">
<p>
Returns a table containing instrumentation data for the
current L1 execution.  Each key/value pair of the table
is a separate instrumentation report.  Keys are cids,
identifying the form of instrumentation.  The type of
the corresponding value depends on the instrumentation.
Instrumentation reports include:
</p>

<div class="table-short">
<table>
<tr>
<td>
<span class="id">exetime</span>
</td>
<td>
Elapsed wall clock time in microseconds spent in L1 execution,
including calls to foreign functions,
system calls,
collection and other storage management.
</td>
</tr>
<tr>
<td>
<span class="id">collectime</span>
</td>
<td>
The portion of <span class="id">exetime</span>,
in microseconds, spent in the L1 collector.
</td>
</tr>
</table>
</div>

</div>
</div>


<h4 id="sec:system">System Functions</h4>

<p>
This section documents various system-level functions.
</p>

<div class="docitem" id="fn:l1version">
<div class="proto">
<div class="function">
<span class="id">l1version()</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">

Returns a string describing the L1 system version.

The string has the format

<div class="code">
<pre>
<span class="val">"L1 version <span class="arg">commit</span> <span class="arg">date</span>"</span>
</pre>
</div>

where <span class="val"><span class="arg">commit</span></span>
is the version control commit identifier,
and <span class="val"><span class="arg">date</span></span>
is the commit date.
</div>
</div>

<div class="docitem" id="fn:errno">
<div class="proto">
<div class="function">
<span class="id">errno()</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns a list of two elements that describe the most
recent OS-level error caused by execution of an L1
system function.  The first element is a cvalue whose
value is the <span class="arg">errno</span> value
returned by the operating system.  The second element
is string containing the textual description of the
error.
</div>
</div>

<div class="docitem" id="fn:exit">
<div class="proto">
<div class="function">
<span class="id">exit(<span class="arg">status</span>)</span>
</div>
<div class="param">
<span class="arg">status</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">does not return</span>
</div>
</div>
<div class="desc">
Causes the Cinquecento evaluator to exit with status <span class="arg">status</span>.
</div>
</div>

<div class="docitem" id="fn:fork">
<div class="proto">
<div class="function">
<span class="id">fork()</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Causes the process in which the Cinquecento evaluator is running to fork.
The call returns <span class="val">0</span> in the created process (child),
and the process identifier of the child in the original process.
</div>
</div>

<div class="docitem" id="fn:waitpid">
<div class="proto">
<div class="function">
<span class="id">waitpid(<span class="arg">pid</span>,<span class="arg">options</span>)</span>
</div>
<div class="returns">
<span class="type">list of two cvalues</span>
</div>
</div>
<div class="desc">
Returns the result of calling the system call <span class="val">waitpid</span>.
<span class="arg">Pid</span> and <span class="arg">options</span>
are passed, respectively, as the pid and options arguments to
<span class="val">waitpid</span>.  The return value is
a list of two cvalues representing the two values
return <span class="val">waitpid</span>: the process
identifer for the process whose change has been
reported, and the status descriptor that encodes the change.
</div>
</div>

<div class="docitem" id="fn:popen">
<div class="proto">
<div class="function">
<span class="id">popen(<span class="arg">arg</span>,...[,<span class="arg">flags</span>])</span>
</div>
<div class="param">
<span class="arg">arg</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">flags</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">list of file descriptors</span>
</div>
</div>
<div class="desc">
<p>
Executes a command in a new process with I/O connected
to the calling process.  The
arguments <span class="arg">arg ...</span>  form the
elements of the argument vector used to create (via
double <span class="id">fork</span> then <span class="id">execve</span>)
the new process image.
There is no way to affect its enviornment.
There is no standard way to obtain the exit status of the process.
An error is raised if the process cannot be created.
</p>

<p>
By default, <span class="id">popen</span> returns a
list of three file descriptors connected (via unix
domain sockets in stream mode) to the standard input,
standard output, and standard error, respectively, of
the new process.
<span class="arg">Flags</span> is a bitmask of flags
used to specify alternative plumbing.  (We show
internal names for these flags, but these are not
defined in any library.)  If bit zero is set
(<span class="id">PopenNoErr</span>), standard error is
redirected to <span class="id">/dev/null</span>, and is
not represented in the returned descriptor list.  If
bit one is set (<span class="id">PopenStderr</span>),
standard error is not redirected, but rather is left
connected to the standard error of the calling
process,.  Likewise, if bit two is set
(<span class="id">PopenStdout</span>), standard output
is left connected to the standard output of the calling
process.  Finally, if bit three is set
(<span class="id">PopenFullDuplex</span>), standard
input and output of the new process are connected to
the same file descriptor.
</p>

<p>
The definition of <span class="id">popen</span> is
likely to change in the future. The current definition
differs substantially from the well known standard C
library call of the same name.
</p>

</div>
</div>

<div class="docitem" id="fn:chdir">
<div class="proto">
<div class="function">
<span class="id">chdir(<span class="arg">dir</span>)</span>
</div>
<div class="param">
<span class="arg">dir</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Changes the current working directory of the Cinquecento evaluator process
to <span class="arg">dir</span>.
</div>
</div>

<div class="docitem" id="fn:cwd">
<div class="proto">
<div class="function">
<span class="id">cwd()</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the current working directory of the Cinquecento evaluator process.
</div>
</div>

<div class="docitem" id="fn:getpid">
<div class="proto">
<div class="function">
<span class="id">getpid()</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the process identifier of the process in which
the Cinquecento system is running.
</div>
</div>

<div class="docitem" id="fn:gettimeofday">
<div class="proto">
<div class="function">
<span class="id">gettimeofday()</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns the current time in microseconds.
</div>
</div>

<div class="docitem" id="fn:getenv">
<div class="proto">
<div class="function">
<span class="id">getenv(var)</span>
</div>
<div class="param">
<span class="arg">var</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">string or nil</span>
</div>
</div>
<div class="desc">
Returns the value associated with the variable <span class="arg">var</span>
in the environment of the calling process, or <span class="val">nil</span>
if the variable is undefined.
</div>
</div>

<div class="docitem" id="fn:setenv">
<div class="proto">
<div class="function">
<span class="id">setenv(var,val)</span>
</div>
<div class="param">
<span class="arg">var</span>: <span class="type">string</span>
</div>
<div class="param">
<span class="arg">val</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the value associated with the variable <span class="arg">var</span>
in the environment of the calling process to <span class="arg">val</span>,
creating the variable if necessary.
</div>
</div>

<div class="docitem" id="fn:environ">
<div class="proto">
<div class="function">
<span class="id">environ()</span>
</div>
<div class="returns">
<span class="type">list of string</span>
</div>
</div>
<div class="desc">
Returns the environment of the calling process as list each of whose elements
is a string of the form <span class="val">"<span class="arg">VAR</span>=<span class="arg">VAL</span>"</span>, where <span class="arg">VAR</span>
is the name of a defined environment variable  and 
<span class="arg">VAL</span> is the corresponding value.
</div>
</div>


<div class="docitem" id="fn:uname">
<div class="proto">
<div class="function">
<span class="id">uname()</span>
</div>
<div class="returns">
<span class="type">list of strings</span>
</div>
</div>
<div class="desc">
Returns the system "uname" information as list of four
strings: operating system name, operating system
release, operating system version, and hardware
identifier.
</div>
</div>


<div class="docitem" id="fn:loadpath">
<div class="proto">
<div class="function">
<span class="id">loadpath()</span>
</div>
<div class="returns">
<span class="type">list</span>
</div>
</div>
<div class="desc">
Returns the current load path as a list of strings.
</div>
</div>

<div class="docitem" id="fn:setloadpath">
<div class="proto">
<div class="function">
<span class="id">setloadpath(l)</span>
</div>
<div class="param">
<span class="arg">l</span>: <span class="type">list</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Sets the current load path to the list of strings <span class="arg">l</span>.
</div>
</div>


<div class="docitem" id="fn:backtrace">
<div class="proto">
<div class="function">
<span class="id">backtrace()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Prints to the current standard output a formatted
snapshot of the Cinquecento call stack.
</div>
</div>

<div class="docitem" id="fn:rand">
<div class="proto">
<div class="function">
<span class="id">rand(<span class="arg">max</span>)</span>
</div>
<div class="param">
<span class="arg">max</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">cvalue</span>
</div>
</div>
<div class="desc">
Returns a random integer in the range [0...<span
class="arg">max</span>).  It is an error if <span
class="arg">max</span> exceeds the
implementation-defined maximum random number.
</div>
</div>

<div class="docitem" id="fn:randseed">
<div class="proto">
<div class="function">
<span class="id">randseed(<span class="arg">seed</span>)</span>
</div>
<div class="param">
<span class="arg">seed</span>: <span class="type">cvalue</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Seeds the random number generator used by <span class="id">rand</span>.
The seed value <span class="val">1</span> restores the
random number generator to its initial state.
</div>
</div>

<div class="docitem" id="fn:resettop">
<div class="proto">
<div class="function">
<span class="id">resettop()</span>
</div>
<div class="returns">
<span class="type">nil</span>
</div>
</div>
<div class="desc">
Resets the top-level environment to the initial
bindings established when the Cinquecento evaluator is
started.  All user-defined bindings are destroyed.
</div>
</div>



<h4 id="sec:mash">Compression and Hashing</h4>

<p>
This section documents functions related to compression and hashing.
</p>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:inflate">inflate(<span class="arg">buf</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:inflatezlib">inflatezlib(<span class="arg">buf</span>)</span>
</div>
<div class="param">
<span class="arg">buf</span>: <span class="type">string</span> or <span class="type">cvalue</span> of type <span class="type">char*</span> or <span class="type">unsigned char*</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
<span class="id">inflate</span> decompresses the
contents of the string <span class="arg">buf</span> using the deflate
compression algorithm (which is used for gzip, zip, and
zlib files).  <span class="id">inflatezlib</span> is
like <span class="id">inflate</span>, but operates on
strings with a zlib header and trailer.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:sha1">sha1(<span class="arg">buf</span>)</span>
</div>
<div class="param">
<span class="arg">buf</span>: <span class="type">string</span>
</div>
<div class="returns">
<span class="type">string</span>
</div>
</div>
<div class="desc">
Returns the SHA-1 hash of <span class="arg">buf</span>.
</div>
</div>


<h4 id="sec:stdlib">Standard Libraries</h4>

<p>
The L1 implementation of Cinquecento comes with several 
standard libraries stored
in the lib/ subdirectory. Since they are included in
l1's load path, these libraries are loaded via the command:
</p>
<div class="code">
@include &lt;<span class="arg">library</span>&gt;<br />
</div>

<p>
In <a href=libs.html>this document</a>, the APIs for many of
the provided libraries are specified.
</p>


<h4 id="sec:runtime">L1 Executable</h4>

<p>
The L1 executable is a command-line program that
provides an interactive read-eval-print-loop interface
to Cinquecento.  It is built by default when the L1
source distribution is compiled.
</p>

<h5>The load path</h5>

<p>
The system load path is a list of paths that is searched
in order for any input file that is included with the form:
</p>

<div class="code">
@include &lt;<span class="arg">filename</span>&gt;<br />
</div>

<p>
The load path may be inspected and changed from within
Cinquecento with the functions
<a href="#fn:setloadpath">loadpath</a>
and <a href="#fn:setloadpath">setloadpath</a>.
</p>

<p>
The default load path consists of one path:
<span class="val"><span class="arg">L1PATH</span>/lib</span>,
where <span class="val"><span class="arg">L1PATH</span></span>
is an absolute path to the directory containing the L1
executable.  L1 attempts to
set <span class="val"><span class="arg">L1PATH</span></span>
to the directory in which the actual L1 executable
resides, even if it was invoked through a symbolic
link.
</p>

<p>
Two L1 command-line options affect the load path.  First,
each occurrence of a command line option of the form
</p>

<div class="code">
-l <span class="arg">path</span>
</div>

<p>
prepends <span class="val"><span class="arg">path</span></span>
to the load path.  Each occurrence is processed in the
order in which it appears.  Second, if
the <span class="val">-s</span> option is given, then
the default load path is <em>not</em> included in the
load path; instead, the load path consists only of
paths specified with the <span class="val">-l</span>
option.
</p>

<p>
Two additional mechanisms override the use of
<span class="val"><span class="arg">L1PATH</span>/lib</span>
as the default path:
</p>

<ul>

<li>
When L1 is built, if the preprocessor variable <span class="val">LIBDIR</span> is defined
for the compilation of the l1 driver (main.c), then the
default load path is initialized to its value, which
must be a string containing colon-separated list of
directories.
</li>

<li>
When L1 is executed, if the environment
variable <span class="val">L1LIBPATH</span> is defined,
then its value, which must be a colon-separated list of
directories, is appended to the path specified
by <span class="val">LIBDIR</span>, if any.
</li>

</ul>

<p>
If neither <span class="val">LIBDIR</span>  (at compile
time) nor <span class="val">L1LIBPATH</span> (at run
time) is defined, then the default load path is
set to the list containing the single directory
<span class="val"><span class="arg">L1PATH</span>/lib</span>,
as described above.
</p>

<h5>The prelude</h5>

<p>
Before the first evaluation of a user expression, the
L1 evaluator loads the <em>prelude</em> by implicitly evaluating the form
</p>

<div class="code">
@include &lt;<span class="arg">prelude.cqct</span>&gt;<br />
</div>

<p>
The library distributed with L1 includes the
version of <span class="val">prelude.cqct</span> that the
evaluator expects to load with this evaluation.
This file defines an increasing portion of the
default top-level environment of the Cinquecento
evaluator, including many functions, name spaces, and
other top-level variables described in this manual.
</p>

<p>
The prelude can be suppressed by passing the <span class="val">-s</span>
option to L1.
</p>

<h4 id="sec:cinterface">C Interface</h4>

<p>
Note: This section is significantly out of date with the implementation.
</p>

<p>
The following functions comprise the C interface to the
L1 implementation of Cinquecento.  The interface is defined in 
<span class="val">cqct.h</span>.
For an example of
how to use the interface, see the file <span
class="val">main.c</span> in the L1 implementation, which
implements the L1 read-eval-print loop.
The functions are described below in roughly the order in
which a typical program would call them.
</p>

<p>
The interface operates on values of several opaque
types.
</p>

<div class="table">
<table>
<tr>
<td><span class="id">Toplevel</span></td>
<td>Toplevel environment</td>
</tr>
<tr>
<td><span class="id">Val</span></td>
<td>Cinquecento value</td>
</tr>
<tr>
<td><span class="id">VM</span></td>
<td>Evaluator for compiled Cinquecento expressions</td>
</tr>
<tr>
<td><span class="id">Xfd</span></td>
<td>File descriptor representation</td>
</tr>
</table>
</div>

<p>
A <span class="id">Val</span> is pointer to a structure
allocated and managed by the L1 storage manager.  Its
fields should not be accessed.  Since the L1 storage
manager is based on a copying garbage collector, the
value of a <span class="id">Val</span> (<em>i.e.</em>,
the address of the referenced structure) may change
across calls to functions that invoke the L1 evaluator,
including 
<span class="fnindex"><a href="#fn:cqctcompile">cqctcompile</a></span>,
<span class="fnindex"><a href="#fn:cqctcallfn">cqctcallfn</a></span>,
<span class="fnindex"><a href="#fn:cqctcallthunk">cqctcallthunk</a></span>,
and <span class="fnindex"><a href="#fn:cqcteval">cqctcalleval</a></span>.

The function <span class="fnindex"><a href="#fn:cqctgcpersist">cqctgcpersist</a></span>
can be called to lock the location in memory of 
an individual <span class="id">Val</span>,
but this operation creates storage and run-time overhead
for the storage manager.
</p>

<p>
A <span class="id">Val</span> can represent any type of
Cinquecento value.  The <span class="id">Qkind</span>
type defines enumeration constants for each valid type:
</p>

<div class="code">
<pre>
typedef
enum {
	Qundef = 0,	/* the undefined value (private) */
	Qnil,		/* the nil value */
	Qas,		/* address space */
	Qbox,		/* box (private) */
	Qcl,		/* closure */
	Qcode,		/* code object (private) */
	Qcval,		/* cvalue */
	Qdom,		/* domain */
	Qexpr,		/* syntax */
	Qfd,		/* file descriptor */
	Qlist,		/* list */
	Qns,		/* name space */
	Qpair,		/* pair (unused) */
	Qrange,		/* range */
	Qrd,		/* record descriptor */
	Qrec,		/* record */
	Qstr,		/* string */
	Qtab,		/* table */
	Qvec,		/* vector */
	Qxtn,		/* ctype */
	Qnkind		/* invalid (# of kinds) */
} Qkind;
</pre>
</div>


<p>
Use the <span class="val">Vkind</span> macro
to determine the 
type of a <span class="id">Val</span>:
</p>

<div class="docitem" id="fn:Vkind">
<div class="proto">
<div class="function">
<span class="id">Qkind Vkind(Val v)</span>
</div>
</div>
<div class="desc">
This macro evaluates to the <span class="id">Qkind</span>
value corresponding to the type of the value <span class="arg">v</span>.
</div>
</div>

<p>
An <span class="id">Xfd</span> is a structure whose
fields define an interface to an open file descriptor.
The Cinquecento initializer,
<span class="id"><a href="#fn:cqctinit">cqctinit</a></span> uses its <span class="id">Xfd</span>
parameter to override the default destination of
standard I/O.
</p>

<div class="code">
<pre>
typedef struct Xfd Xfd;
struct Xfd {
	uint64_t (*read)(Xfd*, char*, uint64_t);
	uint64_t (*write)(Xfd*, char*, uint64_t);
	void (*close)(Xfd*);
	int fd;
};
</pre>
</div>

<p>
Each function is passed the <span class="id">xfd</span>
from which it was referenced.

The <span class="id">fd</span> is a convenience for the user;
the system does not use its value.

The other arguments to <span class="id">read</span>
and <span class="id">write</span> are a pointer to the
data buffer and the number of bytes to be transferred;
these functions should return the number of bytes
actually transferred or <span class="id">(uint64_t)-1</span> on error.

The function <span class="id">close</span>
is called when the system decides to close the file descriptor.

Any of the functions in an
<span class="id">Xfd</span> may be <span class="id">NULL</span>;
if the system needs to call a <span class="id">NULL</span> function, it becomes a no-op.
</p>

<div class="docitem" id="fn:cqctinit">
<div class="proto">
<div class="function">
<span class="id">Toplevel* cqctinit(char **<span class="arg">loadpath</span>, 
Xfd *<span class="arg">in</span>, 
Xfd *<span class="arg">out</span>, 
Xfd *<span class="arg">err</span>)</span>
</div>
</div>
<div class="desc">
This function must be called first.  It allocates
and returns an initialized Cinquecento top-level environment
containing bindings for all built-in functions and
other values.  It also initializes the Cinquecento
storage manager.  If <span class="arg">loadpath</span> is non-NULL,
it is the vector of directories in which the
the @include &lt;<span class="arg">filename</span>>
form searches for <span class="arg">filename</span>; its final element must be NULL.
If <span class="arg">in</span> is non-NULL,
it specifies the input file to which the
the Cinquecento <span class="id">stdin</span> file descriptor
is bound; otherwise its default value is the standard input of the host
process.
Similarly, <span class="arg">out</span>
and <span class="arg">err</span>
specify the Cinquecento <span class="id">stdout</span>
and <span class="id">stderr</span> descriptors,
which are otherwise default to standard output and error.
</div>
</div>

<div class="docitem" id="fn:cqctfaulthook">
<div class="proto">
<div class="function">
<span class="id">int cqctfaulthook(void (*<span class="arg">fn</span>)(void), int <span class="arg">in</span>)</span>
</div>
</div>
<div class="desc">
In the event of a non-recoverable error in the
Cinquecento system, functions previously registered by
this interface are called in reverse order of their registration.
When <span class="arg">in</span> is non-zero, this
function registers <span class="arg">fn</span>;
when <span class="arg">in</span> is
zero, <span class="arg">fn</span> is unregistered.  At
most 4 functions can be registered.  When a
non-recoverable error occurs, if no functions are
registered, or if each registered function returns, the
system stops executing in an unspecified manner.
Programs wishing to regain control should register a
function that performs a non-local escape.
<span class="id">Cqctfaulthook</span> returns non-zero
if there an error occurs during (un)registration.
</div>
</div>


<div class="docitem" id="fn:cqctmkvm">
<div class="proto">
<div class="function">
<span class="id">VM* cqctmkvm(Toplevel *<span class="arg">top</span>)</span>
</div>
</div>
<div class="desc">
Returns a new Cinquecento evaluator initialized with
the top-level environment bound
to <span class="arg">top</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcompile">Val cqctcompile(char *<span class="arg">expr</span>,
char *<span class="arg">src</span>,
Toplevel *<span class="arg">top</span>,
char *<span class="arg">argsid</span>)</span>
</div>
</div>
<div class="desc">
Compiles Cinquecento code in the string
<span class="arg">expr</span> and returns a function
that, when called, executes the code.
If <span class="arg">argsid</span> is null, the returned
function takes no arguments; otherwise it is a variable arity
function whose argument list is bound to a parameter
whose name is the string pointed to <span class="arg">argsid</span>.
If <span class="arg">src</span> is non-zero, it will
be printed during error formatting as a location
identifier for <span class="arg">str</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcallfn">int cqctcallfn(VM *<span class="arg">vm</span>, Val <span class="arg">fn</span>, int <span class="arg">argc</span>, Val *<span class="arg">argv</span>, Val *<span class="arg">rv</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctcallthunk">int cqctcallthunk(VM *<span class="arg">vm</span>, Val <span class="arg">thunk</span>, Val *<span class="arg">rv</span>)</span>
</div>
</div>

<div class="desc">

<span class="id">Cqctcallfn</span> calls <span class="arg">fn</span>,
passing the <span class="arg">argc</span> arguments stored in the
array <span class="arg">argv</span>.  On success, the value returned
by <span class="arg">fn</span> is stored in the value pointed to by
<span class="arg">rv</span> and the call returns <span
class="val">0</span>.  If an error occurs, the call returns <span
class="val">-1</span>.

</div>

<div class="desc">
<span class="id">Cqctcallthunk</span> calls <span
class="arg">thunk</span>.  On success, the value returned by <span
class="arg">thunk</span> is stored in the value pointed to by <span
class="arg">rv</span> and the call returns <span class="val">0</span>.
If an error occurs, the call returns <span class="val">-1</span>.
</div>

</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqcteval">int cqcteval(VM *<span class="arg">vm</span>, char *<span class="arg">str</span>, char *<span class="arg">whence</span>, Val *<span class="arg">rv</span>)</span>
</div>
</div>

<div class="desc">
<span class="id">Cqcteval</span> composes
<span class="id">cqctparsestr</span>,
<span class="id">cqctcompile</span>, and
<span class="id">cqctcallthunk</span>.
The Cinquecento expression <span class="arg">str</span> is parsed, compiled, and executed.
On success, the value of the expression
is stored in the value pointed to by
<span class="arg">rv</span> and the call returns <span class="val">0</span>.
If an error occurs, the call returns <span class="val">-1</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctsprintval">char* cqctsprintval(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Prints the value <span class="arg">v</span> into a freshly allocated C string;
the
caller is responsible for freeing the returned string
with <span class="fnindex"><a href="#fn:cqctfreecstr">cqctfreecstr</a></span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcbase">Cbase cqctvalcbase(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns the name of the base C type of the cvalue
<span class="arg">v</span>.  The result is undefined
if <span class="arg">v</span> is not a cvalue.
The enumerated type <span class="id">Cbase</span> defines
the type names used by the system:
<div class="code">
<pre>
typedef
enum Cbase {
	Vundef=0,
	Vchar,
	Vshort,
	Vint,
	Vlong,
	Vvlong,
	Vuchar,
	Vushort,
	Vuint,
	Vulong,
	Vuvlong,
	Vfloat,
	Vdouble,
	Vlongdouble,
	Vcomplex,
	Vdoublex,
	Vlongdoublex,
	Vnbase,
	Vptr = Vnbase,
	Vvoid,
	Vnallbase,
} Cbase;
</pre>
</div>
Only names in the range <span class="id">Vchar</span> ... <span class="id">Vlongdoublex</span> will be returned by <span class="id">cqctvalcbase</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctint8val">Val cqctint8val(int8_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint16val">Val cqctint16val(int16_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint32val">Val cqctint32val(int32_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctint64val">Val cqctint64val(int64_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint8val">Val cqctuint8val(uint8_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint16val">Val cqctuint16val(uint16_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint32val">Val cqctuint32val(uint32_t <span class="arg">x</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctuint64val">Val cqctuint64val(uint64_t <span class="arg">x</span>)</span>
</div>
</div>
<div class="desc">
These functions construct and return a Cinquecento literal cvalue
of the indicated type from <span class="arg">x</span>.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalint8">int8_t cqctvalint8(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint16">int16_t cqctvalint16(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint32">int32_t cqctvalint32(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvalint64">int64_t cqctvalint64(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint8">uint8_t cqctvaluint8(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint16">uint16_t cqctvaluint16(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint32">uint32_t cqctvaluint32(Val <span class="arg">v</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctvaluint64">uint64_t cqctvaluint64(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
These functions convert the
value <span class="arg">v</span> to a C integer of the
indicated type.  The result is undefined
if <span class="arg">v</span> is not a cvalue.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrval">Val cqctcstrval(char *<span class="arg">s</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that is a
copy of the null-terminated C string <span class="arg">s</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrnval">Val cqctcstrnval(char *<span class="arg">s</span>, uint64_t <span class="arg">len</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string by copying <span class="arg">len</span> bytes starting at <span class="arg">s</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrvalshared">Val cqctcstrvalshared(char *<span class="arg">s</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that
shares storage with the null-terminated C string <span class="arg">s</span>.
Responsibility for the storage remains with the caller.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctcstrnvalshared">Val cqctcstrnvalshared(char *<span class="arg">s</span>, uint64_t <span class="arg">len</span>)</span>
</div>
</div>
<div class="desc">
Constructs and returns a Cinquecento string that shares the <span class="arg">len</span> bytes of storage starting at <span class="arg">s</span>.
Responsibility for the storage remains with the caller.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstr">char* cqctvalcstr(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Copies the Cinquecento string <span class="arg">v</span> to a C
string.  The result is undefined
if <span class="arg">v</span> is not a string.  The
caller is responsible for freeing the returned string
with <span class="fnindex"><a href="#fn:cqctfreecstr">cqctfreecstr</a></span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstrshared">char* cqctvalcstrshared(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the underlying contiguous storage
of the string <span class="arg">v</span>, if possible.
The storage is shared with the Cinquecento string
object; callers should arrange to protect this object
from garbage collection when appropriate.  The result
is zero if <span class="arg">v</span> is a string whose
storage cannot be represented by a single pointer (call 
<span class="fnindex"><a href="#fn:cqctvalcstr">cqctvalcstr</a></span>
instead), and undefined if <span class="arg">v</span> is not a
string.
</div>
</div>


<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvalcstrlen">uint64_t cqctvalcstrlen(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns the number of bytes in the string <span class="arg">v</span>.
The result is undefined if <span class="arg">v</span> is not a string.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlength">uint64_t cqctlength(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
If <span class="arg">v</span> is a container object, returns the number of elements
in the container; it is equivalent to the built-in function <span class="id"><a href="#fn:length">length</a></span>.
The result is undefined if <span class="arg">v</span> is not a container.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctmklist">Val cqctmklist(uint64_t <span class="arg">n</span>)</span>
</div>
</div>
<div class="desc">
This function is a C wrapper for
<span class="fnindex"><a href="#fn:mklist">mklist</a></span>.
It returns a Cinquecento list initialized with <span class="arg">n</span> <span class="val">nil</span>
elements.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlistref">Val cqctlistref(Val <span class="arg">l</span>, uint64_r <span class="arg">idx</span>)</span>
</div>
</div>
<div class="desc">
Returns the element at index <span class="arg">idx</span>
in the list <span class="arg">l</span>, or <span class="val">0</span>
if the index is out of bounds or <span class="arg">l</span>
is not a list.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlistset">Val cqctlistset(Val <span class="arg">l</span>, uint64_r <span class="arg">idx</span>, Val <span class="arg">val</span>)</span>
</div>
</div>
<div class="desc">
Sets the element at index <span class="arg">idx</span>
in the list <span class="arg">l</span> to <span class="arg">val</span>,
and returns <span class="arg">l</span>.
If the index is out of bounds or <span class="arg">l</span>
is not a list, returns <span class="val">0</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlistappend">Val cqctlistappend(Val <span class="arg">l</span>, Val <span class="arg">val</span>)</span>
</div>
</div>
<div class="desc">
Appends <span class="arg">val</span> to the end of the list
<span class="arg">l</span>, and returns <span class="arg">l</span>.
If the index is out of bounds or <span class="arg">l</span>
is not a list, returns <span class="val">0</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctlistvals">Val* cqctlistvals(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the array of <span class="id">Val</span>s in
the list <span class="arg">v</span>.
The number of elements in the array is the length returned by
<span class="id"><a href="#fn:cqctlength">cqctlength</a></span>.
The result is undefined if <span class="arg">v</span> is not a list.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctmkvec">Val cqctmkvec(uint64_t <span class="arg">n</span>)</span>
</div>
</div>
<div class="desc">
This function is a C wrapper for
<span class="fnindex"><a href="#fn:mkvec">mkvec</a></span>.
It returns a Cinquecento vector initialized with <span class="arg">n</span> <span class="val">nil</span>
elements.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvecref">Val cqctvecref(Val <span class="arg">v</span>, uint64_r <span class="arg">idx</span>)</span>
</div>
</div>
<div class="desc">
Returns the element at index <span class="arg">idx</span>
in the vector <span class="arg">v</span>, or <span class="val">0</span>
if the index is out of bounds or <span class="arg">v</span>
is not a vector.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvecset">Val cqctvecset(Val <span class="arg">v</span>, uint64_r <span class="arg">idx</span>, Val <span class="arg">val</span>)</span>
</div>
</div>
<div class="desc">
Sets the element at index <span class="arg">idx</span>
in the vector <span class="arg">v</span> to <span class="arg">val</span>,
and returns <span class="arg">v</span>.
If the index is out of bounds or <span class="arg">v</span>
is not a vector, returns <span class="val">0</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctvecvals">Val* cqctvecvals(Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Returns a pointer to the array of <span class="id">Val</span>s in
the vector <span class="arg">v</span>.
The number of elements in the array is the length returned by
<span class="id"><a href="#fn:cqctlength">cqctlength</a></span>.
The result is undefined if <span class="arg">v</span> is not a vector.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctmkrange">Val cqctmkrange(Val <span class="arg">beg</span>, Val <span class="arg">len</span>)</span>
</div>
</div>
<div class="desc">
This function is a C wrapper for
<span class="fnindex"><a href="#fn:mkrange">mkrange</a></span>.
It returns a Cinquecento range representing the span of <span class="arg">len</span>
bytes beginning at <span class="arg">beg</span>, or <span class="val">0</span>
if either one <span class="arg">len</span> or <span class="arg">beg</span>
is not a cvalue.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctrangebeg">Val cqctrangebeg(Val <span class="arg">r</span>)</span>
</div>
</div>
<div class="desc">
Returns a cvalue corresponding to the beginning of the range <span class="arg">r</span>,
or <span class="val">0</span>
if <span class="arg">r</span> is not a range.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctrangelen">Val cqctrangelen(Val <span class="arg">r</span>)</span>
</div>
</div>
<div class="desc">
Returns a cvalue corresponding to the length of the range <span class="arg">r</span>,
or <span class="val">0</span>
if <span class="arg">r</span> is not a range.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctmkfd">Val cqctmkfd(Xfd *<span class="arg">Xfd</span>,
char *<span class="arg">name</span>);</span>
</div>
</div>
<div class="desc">
This function is a C wrapper for
<span class="fnindex"><a href="#fn:mkfd">mkfd</a></span>.
Returns a Cinquecento file descriptor value backed by the C functions
defined in <span class="arg">xfd</span>.
The first argument passed to each of the <span class="arg">xfd</span> functions will be a <em>copy</em> of <span class="arg">xfd</span>.
If <span class="arg">name</span> is <span class="id">NULL</span>,
the file descriptor is unnamed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctenvbind">void cqctenvbind(Toplevel *<span class="arg">top</span>, char *<span class="arg">name</span>,
Val <span class="arg">val</span>);</span>
</div>
</div>
<div class="desc">
Updates (or creates) the binding of <span class="arg">name</span>
in the top-level environment <span class="arg">top</span>
to <span class="arg">val</span>.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctenvlook">Val cqctenvlook(Toplevel *<span class="arg">top</span>, char *<span class="arg">name</span>);</span>
</div>
</div>
<div class="desc">
Returns the value bound to <span class="arg">name</span>
in the top-level environment <span class="arg">top</span>
or <span class="id">NULL</span> if the variable is unbound.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctgcprotect">void cqctgcprotect(VM *<span class="arg">vm</span>, Val <span class="arg">v</span>)</span>
</div>
</div>
<div class="desc">
Protects the value <span class="arg">v</span> from
garbage collection by registering it with the current
GC protection frame of <span class="arg">vm</span>.
References to the value will be valid until after at least
one of the following events: (1) the frame is popped, (2)
<span class="fnindex"><a href="#fn:cqctgcunprotect">cqctgcunprotect</a></span>
is called on the same arguments while the current GC frame is active,
or (3) <span class="arg">vm</span> is freed.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctinterrupt">void cqctinterrupt(VM *<span class="arg">vm</span>)</span>
</div>
</div>
<div class="desc">
Interrupt the Cinquecento evaluator <span class="arg">vm</span>,
if it is executing.
</div>
</div>

<div class="docitem">
<div class="proto">
<div class="function">
<span class="id" id="fn:cqctfreecstr">void cqctfreecstr(char *<span class="arg">str</span>)</span>
</div>
<div class="function">
<span class="id" id="fn:cqctfini">void cqctfini(Toplevel *<span class="arg">top</span>)</span>
</div>
</div>
<div class="desc">
These functions free the resources allocated by the above functions.
<span class="id">Cqctfreecstr</span> frees a C string returned by
<span class="fnindex"><a href="#fn:cqctval2cstr">cqctval2cstr</a></span>
or <span class="fnindex"><a href="#fn:cqctsprintval">cqctsprintval</a></span>.
<span class="id">Cqctfini</span> frees a top-level
environment, and should be called only after all virtual
machines sharing the environment have been freed.
</div>
</div>

<h4 id="sec:bib">Bibliography</h4>

<div>
<table>

<tr>
<td>
<span id="bib:sicp">[SICP]</span>
</td>
<td>
Harold Abelson and Gerald Jay Sussman with Julie Sussman.
<em><a href="http://mitpress.mit.edu/sicp/full-text/book/book.html">Structure and Interpretation of Computer Programs (2nd Edition)</a></em>.
MIT Press, 1996.
</td>
</tr>

<tr>
<td>
<span id="bib:csug">[CSUG]</span>
</td>
<td>
 R. Kent Dybvig. <em><a href="http://www.scheme.com/csug8">The Chez Scheme Version 8 User's Guide</a></em>.  Cadence Research Systems, 2009.
</td>
</tr>

<tr>
<td>
<span id="bib:tspl">[TSPL]</span>
</td>
<td>
R. Kent Dybvig. <em><a href="http://www.scheme.com/tspl4/">The Scheme Programming Language, 4th edition</a></em>. MIT Press, 2009
</td>

<tr>
<td>
<span id="bib:bibop">[BiBOP]</span>
</td>
<td>
R. Kent Dybvig, David Eby, and Carl Bruggeman.
<em><a href="http://www.cs.indiana.edu/~dyb/pubs/bibop.pdf">Don't stop the BiBOP: Flexible and efficient storage management for dynamically typed languages.</a></em>  Indiana University technical report #400, March 1994. 
</td>
</tr>

<tr>
<td>
<span id="bib:guardian">[Guardians]</span>
</td>
<td>
R. Kent Dybvig, David Eby, and Carl Bruggeman.
<em><a href="http://www.cs.indiana.edu/~dyb/pubs/guardians-pldi93.pdf">
Guardians in a generation-based collector.</a></em>
ACM SIGPLAN 1993 Conference on Programming Language
Design and Implementation, 207-216, June 1993.
</td>
</tr>

<tr>
<td>
<span id="bib:ls">[Little]</span>
</td>
<td>
Daniel P. Friedman and Matthias Felleisen.
<em>The Little Schemer (4th Edition)</em>.
MIT Press, 1995.
</td>
</tr>

<tr>
<td>
<span id="bib:hs">[H&S]</span>
</td>
<td>
Samuel P. Harbison III and Guy L. Steele Jr.
<em>C: A Reference Manual (5th Edition)</em>.
Prentice Hall, 2002.
</td>
</tr>

<tr>
<td>
<span id="bib:kr">[K&R]</span>
</td>
<td>
Brian W. Kernighan and Dennis M. Ritchie.
<em>The C Programming Language (2nd Edition)</em>.
Prentice Hall, 1988.
</td>
</tr>

</table>


<h4 id="sec:synindex">Syntax Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<a href="#syn:cidlit"><span class="val">'id</span> (cid literal)</a><br />
<a href="#syn:invoke"><span class="val"><span class="arg">o</span>.<span class="arg">f</span> (method invocation)</a><br />
<a href="#syn:asof"><span class="val"><span class="arg">dom</span>.as</span></a><br />
<a href="#syn:asof"><span class="val"><span class="arg">dom</span>.ns</span></a><br />
<a href="#syn:_emptylist_">[<span class="arg">value</span>, ... ]</a><br />
<a href="#syn:_emptytable_">[<span class="arg">key</span> : <span class="arg">value</span>, ...]</a><br />
<a href="#syn:_at_define">@define</a><br />
<a href="#syn:_at_defloc">@defloc</a><br />
<a href="#syn:_at_global">@global</a><br />
<a href="#syn:_at_include">@include</a><br />
<a href="#syn:_at_lambda">@lambda</a><br />
<a href="#syn:_at_lazyapply">@lazyapply</a><br />
<a href="#syn:_at_local">@local</a><br />
<a href="#syn:_at_names">@names</a><br />
<a href="#syn:_at_quote">@quote</a><br />
<a href="#syn:_at_record">@record</a><br />
<a href="#syn:return">return</a><br />
<a href="#syn:_at_typeof">@typeof</a><br />
</div>
</div>
</div>

<h4 id="sec:cindex">C Interface Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<a href="#fn:cqctcallfn">cqctcallfn</a><br />
<a href="#fn:cqctcallthunk">cqctcallthunk</a><br />
<a href="#fn:cqctcompile">cqctcompile</a><br />
<a href="#fn:cqctcstrnval">cqctcstrnval</a><br />
<a href="#fn:cqctcstrnvalshared">cqctcstrnvalshared</a><br />
<a href="#fn:cqctcstrval">cqctcstrval</a><br />
<a href="#fn:cqctcstrvalshared">cqctcstrvalshared</a><br />
<a href="#fn:cqctenvbind">cqctenvbind</a><br />
<a href="#fn:cqctenvlook">cqctenvlook</a><br />
<a href="#fn:cqcteval">cqcteval</a><br />
<a href="#fn:cqctfaulthook">cqctfaulthook</a><br />
<a href="#fn:cqctfini">cqctfini</a><br />
<a href="#fn:cqctinit">cqctinit</a><br />
<a href="#fn:cqctint8val">cqctint8val</a><br />
<a href="#fn:cqctint16val">cqctint16val</a><br />
<a href="#fn:cqctint32val">cqctint32val</a><br />
<a href="#fn:cqctint64val">cqctint64val</a><br />
<a href="#fn:cqctinterrupt">cqctinterrupt</a><br />
<a href="#fn:cqctlength">cqctlength</a><br />
<a href="#fn:cqctlistappend">cqctlistappend</a><br />
<a href="#fn:cqctlistref">cqctlistref</a><br />
<a href="#fn:cqctlistset">cqctlistset</a><br />
<a href="#fn:cqctlistvals">cqctlistvals</a><br />
<a href="#fn:cqctmkfd">cqctmkfd</a><br />
<a href="#fn:cqctmklist">cqctmklist</a><br />
<a href="#fn:cqctmkrange">cqctmkrange</a><br />
<a href="#fn:cqctmkvec">cqctmkvec</a><br />
<a href="#fn:cqctmkvm">cqctmkvm</a><br />
<a href="#fn:cqctrangebeg">cqctrangebeg</a><br />
<a href="#fn:cqctrangelen">cqctrangelen</a><br />
<a href="#fn:cqctsprintval">cqctsprintval</a><br />
<a href="#fn:cqctuint8val">cqctuint8val</a><br />
<a href="#fn:cqctuint16val">cqctuint16val</a><br />
<a href="#fn:cqctuint32val">cqctuint32val</a><br />
<a href="#fn:cqctuint64val">cqctuint64val</a><br />
<a href="#fn:cqctvalcbase">cqctvalcbase</a><br />
<a href="#fn:cqctvalcstr">cqctvalcstr</a><br />
<a href="#fn:cqctvalcstrlen">cqctvalcstrlen</a><br />
<a href="#fn:cqctvalcstrshared">cqctvalcstrshared</a><br />
<a href="#fn:cqctvalint8">cqctvalint8</a><br />
<a href="#fn:cqctvalint16">cqctvalint16</a><br />
<a href="#fn:cqctvalint32">cqctvalint32</a><br />
<a href="#fn:cqctvalint64">cqctvalint64</a><br />
<a href="#fn:cqctvaluint8">cqctvaluint8</a><br />
<a href="#fn:cqctvaluint16">cqctvaluint16</a><br />
<a href="#fn:cqctvaluint32">cqctvaluint32</a><br />
<a href="#fn:cqctvaluint64">cqctvaluint64</a><br />
<a href="#fn:cqctvecref">cqctvecref</a><br />
<a href="#fn:cqctvecset">cqctvecset</a><br />
<a href="#fn:cqctvecvals">cqctvecvals</a><br />
</div>
</div>
</div>


<h4 id="sec:fnindex">Function Index</h4>
<div class="id">
<div class="index">
<div class="fnindex">
<a href="#fn:asof">asof</a><br />
<a href="#fn:access">access</a><br />
<a href="#fn:append">append</a><br />
<a href="#fn:apply">apply</a><br />
<a href="#fn:applyk">applyk</a><br />
<a href="#fn:arraynelm">arraynelm</a><br />
<a href="#fn:backtrace">backtrace</a><br />
<a href="#fn:basebase">basebase</a><br />
<a href="#fn:baseid">baseid</a><br />
<a href="#fn:baserep">baserep</a><br />
<a href="#fn:bitfieldcontainer">bitfieldcontainer</a><br />
<a href="#fn:bitfieldpos">bitfieldpos</a><br />
<a href="#fn:bitfieldwidth">bitfieldwidth</a><br />
<a href="#fn:bsearch">bsearch</a><br />
<a href="#fn:callcc">callcc</a><br />
<a href="#fn:car">car</a><br />
<a href="#fn:cdr">cdr</a><br />
<a href="#fn:chdir">chdir</a><br />
<a href="#fn:cid2str">cid2str</a><br />
<a href="#fn:close">close</a><br />
<a href="#fn:cntrget">cntrget</a><br />
<a href="#fn:cntrput">cntrput</a><br />
<a href="#fn:compact">compact</a><br />
<a href="#fn:compile">compile</a><br />
<a href="#fn:concat">concat</a><br />
<a href="#fn:cons">cons</a><br />
<a href="#fn:copy">copy</a><br />
<a href="#fn:count">count</a><br />
<a href="#fn:cvalcmp">cvalcmp</a><br />
<a href="#fn:cwd">cwd</a><br />
<a href="#fn:delete">delete</a><br />
<a href="#fn:delq">delq</a><br />
<a href="#fn:domof">domof</a><br />
<a href="#fn:enumconsts">enumconsts</a><br />
<a href="#fn:nsenumsym">enumsym</a> (ns method)<br />
<a href="#fn:nsenumtype">enumtype</a> (ns method)<br />
<a href="#fn:environ">environ</a><br />
<a href="#fn:eq">eq</a><br />
<a href="#fn:equal">equal</a><br />
<a href="#fn:equalctype">equalctype</a><br />
<a href="#fn:equalcval">equalcval</a><br />
<a href="#fn:eqv">eqv</a><br />
<a href="#fn:eqvctype">eqvctype</a><br />
<a href="#fn:eqvcval">eqvcval</a><br />
<a href="#fn:errno">errno</a><br />
<a href="#fn:error">error</a><br />
<a href="#fn:eval">eval</a><br />
<a href="#fn:evalk">evalk</a><br />
<a href="#fn:exit">exit</a><br />
<a href="#fn:fault">fault</a><br />
<a href="#fn:fdname">fdname</a><br />
<a href="#fn:fdopen">fdopen</a><br />
<a href="#fn:fieldattr">fieldattr</a><br />
<a href="#fn:fieldid">fieldid</a><br />
<a href="#fn:fieldoff">fieldoff</a><br />
<a href="#fn:fields">fields</a><br />
<a href="#fn:fieldtype">fieldtype</a><br />
<a href="#fn:finalize">finalize</a><br />
<a href="#fn:foreach">foreach</a><br />
<a href="#fn:fork">fork</a><br />
<a href="#fn:fprintf">fprintf</a><br />
<a href="#fn:fread">fread</a><br />
<a href="#fn:gc">gc</a><br />
<a href="#fn:gclock">gclock</a><br />
<a href="#fn:gcstats">gcstats</a><br />
<a href="#fn:gclock">gcunlock</a><br />
<a href="#fn:asget">get</a> (as method)<br />
<a href="#fn:getbytes">getbytes</a><br />
<a href="#fn:getenv">getenv</a><br />
<a href="#fn:getpid">getpid</a><br />
<a href="#fn:getpeername">getpeername</a><br />
<a href="#fn:getsockname">getsockname</a><br />
<a href="#fn:gettimeofday">gettimeofday</a><br />
<a href="#fn:hash">hash</a><br />
<a href="#fn:hashctype">hashctype</a><br />
<a href="#fn:hashcval">hashcval</a><br />
<a href="#fn:hashq">hashqv</a><br />
<a href="#fn:hashqv">hashqv</a><br />
<a href="#fn:hashqvctype">hashqvctype</a><br />
<a href="#fn:hashqvcval">hashqvcval</a><br />
<a href="#fn:head">head</a><br />
<a href="#fn:index">index</a><br />
<a href="#fn:inflate">inflate</a><br />
<a href="#fn:inflate">inflatezlib</a><br />
<a href="#fn:ioctl">ioctl</a><br />
<a href="#fn:isalnum">isalnum</a><br />
<a href="#fn:isalpha">isalpha</a><br />
<a href="#fn:isarray">isarray</a><br />
<a href="#fn:isas">isas</a><br />
<a href="#fn:isascii">isascii</a><br />
<a href="#fn:isbase">isbase</a><br />
<a href="#fn:isbitfield">isbitfield</a><br />
<a href="#fn:isblank">isblank</a><br />
<a href="#fn:iscid">iscid</a><br />
<a href="#fn:iscntrl">iscntrl</a><br />
<a href="#fn:isctype">isctype</a><br />
<a href="#fn:iscvalue">iscvalue</a><br />
<a href="#fn:isdigit">isdigit</a><br />
<a href="#fn:isdom">isdom</a><br />
<a href="#fn:isempty">isempty</a><br />
<a href="#fn:isenum">isenum</a><br />
<a href="#fn:isenumconst">isenumconst</a><br />
<a href="#fn:isfd">isfd</a><br />
<a href="#fn:isfunc">isfunc</a><br />
<a href="#fn:isgraph">isgraph</a><br />
<a href="#fn:islist">islist</a><br />
<a href="#fn:islower">islower</a><br />
<a href="#fn:ismapped">ismapped</a> (function)<br />
<a href="#fn:asismapped">ismapped</a> (as method)<br />
<a href="#fn:ismember">ismember</a><br />
<a href="#fn:isnil">isnil</a><br />
<a href="#fn:isns">isns</a><br />
<a href="#fn:isodigit">isodigit</a><br />
<a href="#fn:ispair">ispair</a><br />
<a href="#fn:isprint">isprint</a><br />
<a href="#fn:isprocedure">isprocedure</a><br />
<a href="#fn:isptr">isptr</a><br />
<a href="#fn:ispunct">ispunct</a><br />
<a href="#fn:isrange">isrange</a><br />
<a href="#fn:isrd">isrd</a><br />
<a href="#fn:isrec">isrec</a><br />
<a href="#fn:isrinr">isrinr</a><br />
<a href="#fn:isspace">isspace</a><br />
<a href="#fn:isstring">isstring</a><br />
<a href="#fn:isstruct">isstruct</a><br />
<a href="#fn:issu">issu</a><br />
<a href="#fn:istable">istable</a><br />
<a href="#fn:istypedef">istypedef</a><br />
<a href="#fn:isundeftype">isundeftype</a><br />
<a href="#fn:isunion">isunion</a><br />
<a href="#fn:isupper">isupper</a><br />
<a href="#fn:isvector">isvector</a><br />
<a href="#fn:isvoid">isvoid</a><br />
<a href="#fn:isweakpair">isweakpair</a><br />
<a href="#fn:isxdigit">isxdigit</a><br />
<a href="#fn:l1version">l1version</a><br />
<a href="#fn:length">length</a><br />
<a href="#fn:list">list</a><br />
<a href="#fn:listdel">listdel</a><br />
<a href="#fn:listins">listins</a><br />
<a href="#fn:listref">listref</a><br />
<a href="#fn:listset">listset</a><br />
<a href="#fn:nslookaddr">lookaddr</a> (ns method)<br />
<a href="#fn:lookfield">lookfield</a><br />
<a href="#fn:nslooksym">looksym</a> (ns method)<br />
<a href="#fn:looksym">looksym</a> (function)<br />
<a href="#fn:nslooktype">looktype</a> (ns method)<br />
<a href="#fn:looktype">looktype</a> (function)<br />
<a href="#fn:malloc">malloc</a><br />
<a href="#fn:map">map</a> (function)<br />
<a href="#fn:asmap">map</a> (as method)<br />
<a href="#fn:mapfile">mapfile</a><br />
<a href="#fn:memcpy">memcpy</a><br />
<a href="#fn:memset">memset</a><br />
<a href="#fn:mkcid">mkcid</a><br />
<a href="#fn:mkctype_array">mkctype_array</a><br />
<a href="#fn:mkctype_base">mkctype_base</a><br />
<a href="#fn:mkctype_bitfield">mkctype_bitfield</a><br />
<a href="#fn:mkctype_bool">mkctype_bool</a><br />
<a href="#fn:mkctype_char">mkctype_char</a><br />
<a href="#fn:mkctype_complex">mkctype_complex</a><br />
<a href="#fn:mkctype_const">mkctype_const</a><br />
<a href="#fn:mkctype_double">mkctype_double</a><br />
<a href="#fn:mkctype_doublex">mkctype_doublex</a><br />
<a href="#fn:mkctype_enum">mkctype_enum</a><br />
<a href="#fn:mkctype_float">mkctype_float</a><br />
<a href="#fn:mkctype_fn">mkctype_fn</a><br />
<a href="#fn:mkctype_int">mkctype_int</a><br />
<a href="#fn:mkctype_ldouble">mkctype_ldouble</a><br />
<a href="#fn:mkctype_ldoublex">mkctype_ldoublex</a><br />
<a href="#fn:mkctype_long">mkctype_long</a><br />
<a href="#fn:mkctype_ptr">mkctype_ptr</a><br />
<a href="#fn:mkctype_short">mkctype_short</a><br />
<a href="#fn:mkctype_struct">mkctype_struct</a><br />
<a href="#fn:mkctype_typedef">mkctype_typedef</a><br />
<a href="#fn:mkctype_uchar">mkctype_uchar</a><br />
<a href="#fn:mkctype_uint">mkctype_uint</a><br />
<a href="#fn:mkctype_ulong">mkctype_ulong</a><br />
<a href="#fn:mkctype_undef">mkctype_undef</a><br />
<a href="#fn:mkctype_union">mkctype_union</a><br />
<a href="#fn:mkctype_ushort">mkctype_ushort</a><br />
<a href="#fn:mkctype_uvlong">mkctype_uvlong</a><br />
<a href="#fn:mkctype_vlong">mkctype_vlong</a><br />
<a href="#fn:mkctype_void">mkctype_void</a><br />
<a href="#fn:mkdir">mkdir</a><br />
<a href="#fn:mkdom">mkdom</a><br />
<a href="#fn:mkfd">mkfd</a><br />
<a href="#fn:mkfield">mkfield</a><br />
<a href="#fn:mkguardian">mkguardian</a><br />
<a href="#fn:mklist">mklist</a><br />
<a href="#fn:mkmas">mkmas</a><br />
<a href="#fn:mkmas">mkmasx</a><br />
<a href="#fn:mknas">mknas</a><br />
<a href="#fn:mkas">mkns</a><br />
<a href="#fn:mknsraw">mknsraw</a><br />
<a href="#fn:mkparam">mkparam</a><br />
<a href="#fn:mkrange">mkrange</a><br />
<a href="#fn:mkrd">mkrd</a><br />
<a href="#fn:mksas">mksas</a><br />
<a href="#fn:mkstr">mkstr</a><br />
<a href="#fn:mksym">mksym</a><br />
<a href="#fn:mktab">mktab</a><br />
<a href="#fn:mktabq">mktabq</a><br />
<a href="#fn:mktabqv">mktabqv</a><br />
<a href="#fn:mkvec">mkvec</a><br />
<a href="#fn:mkzas">mkzas</a><br />
<a href="#fn:myrootns">myrootns</a><br />
<a href="#fn:nameof">nameof</a><br />
<a href="#fn:asof">nsof</a><br />
<a href="#fn:nsptr">nsptr</a><br />
<a href="#fn:open">open</a><br />
<a href="#fn:paramid">paramid</a><br />
<a href="#fn:params">params</a><br />
<a href="#fn:paramtype">paramtype</a><br />
<a href="#fn:parse">parse</a><br />
<a href="#fn:pop">pop</a><br />
<a href="#fn:popen">popen</a><br />
<a href="#fn:postgc">postgc</a><br />
<a href="#fn:asput">put</a> (as method)<br />
<a href="#fn:printf">printf</a><br />
<a href="#fn:push">push</a><br />
<a href="#fn:putbytes">putbytes</a><br />
<a href="#fn:rangebeg">rangebeg</a><br />
<a href="#fn:rangelen">rangelen</a><br />
<a href="#fn:rand">rand</a><br />
<a href="#fn:rand">randseed</a><br />
<a href="#fn:rdis">rdis</a><br />
<a href="#fn:rdfields">rdfields</a><br />
<a href="#fn:rdfmt">rdfmt</a><br />
<a href="#fn:rdgettab">rdgettab</a><br />
<a href="#fn:rdmk">rdmk</a><br />
<a href="#fn:rdname">rdname</a><br />
<a href="#fn:rdof">rdof</a><br />
<a href="#fn:rdsetfmt">rdsetfmt</a><br />
<a href="#fn:rdgettab">rdsettab</a><br />
<a href="#fn:read">read</a><br />
<a href="#fn:resettop">resettop</a><br />
<a href="#fn:rettype">rettype</a><br />
<a href="#fn:reverse">reverse</a><br />
<a href="#fn:seek">seek</a><br />
<a href="#fn:select">select</a><br />
<a href="#fn:setcar">setcar</a><br />
<a href="#fn:setcdr">setcdr</a><br />
<a href="#fn:setenv">setenv</a><br />
<a href="#fn:setloadpath">setloadpath</a><br />
<a href="#fn:setname">setname</a><br />
<a href="#fn:settypedeftype">settypedeftype</a><br />
<a href="#fn:sha1">sha1</a><br />
<a href="#fn:slice">slice</a><br />
<a href="#fn:sockpair">sockpair</a><br />
<a href="#fn:sort">sort</a><br />
<a href="#fn:split">split</a><br />
<a href="#fn:sprintfa">sprintfa</a><br />
<a href="#fn:statistics">statistics</a><br />
<a href="#fn:stringof">stringof</a><br />
<a href="#fn:strcmp">strcmp</a><br />
<a href="#fn:strlen">strlen</a><br />
<a href="#fn:strput">strput</a><br />
<a href="#fn:strref">strref</a><br />
<a href="#fn:strstr">strstr</a><br />
<a href="#fn:strton">strton</a><br />
<a href="#fn:suattr">suattr</a><br />
<a href="#fn:substr">substr</a><br />
<a href="#fn:subtype">subtype</a><br />
<a href="#fn:suekind">suekind</a><br />
<a href="#fn:suetag">suetag</a><br />
<a href="#fn:susize">susize</a><br />
<a href="#fn:symattr">symattr</a><br />
<a href="#fn:symid">symid</a><br />
<a href="#fn:symoff">symoff</a><br />
<a href="#fn:symtype">symtype</a><br />
<a href="#fn:tabdelete">tabdelete</a><br />
<a href="#fn:tabenum">tabenum</a><br />
<a href="#fn:tabinsert">tabinsert</a><br />
<a href="#fn:tabkeys">tabkeys</a><br />
<a href="#fn:tablook">tablook</a><br />
<a href="#fn:tabvals">tabvals</a><br />
<a href="#fn:tail">tail</a><br />
<a href="#fn:tcpaccept">tcpaccept</a><br />
<a href="#fn:tcplisten">tcplisten</a><br />
<a href="#fn:tcpopen">tcpopen</a><br />
<a href="#fn:tolower">tolower</a><br />
<a href="#fn:toupper">toupper</a><br />
<a href="#fn:typedefid">typedefid</a><br />
<a href="#fn:typedeftype">typedeftype</a><br />
<a href="#fn:typename">typename</a><br />
<a href="#fn:uname">uname</a><br />
<a href="#fn:unlink">unlink</a><br />
<a href="#fn:vecref">vecref</a><br />
<a href="#fn:vecset">vecset</a><br />
<a href="#fn:vector">vector</a><br />
<a href="#fn:waitpid">waitpid</a><br />
<a href="#fn:weakcons">weakcons</a><br />
<a href="#fn:write">write</a><br />
</div>
</div>
</div>

</div>
</body>
</html>
