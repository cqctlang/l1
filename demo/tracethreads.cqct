@include <ctlmux.cqct>

define test1(n)
{
	@local tab, mux, ns, as, dom;

	tab = [:];
	ns = @names clp64le { @include "./threads.names" };
	mux = mkctlmux();
	as = mux.launch(0, "./threads", sprintfa("%d", n));
	dom = mkdom(ns, as);
	dom.xcont();
	mux.run();
	foreach(lambda(k,v){ printf("task %d\t%d\n", k, v); }, tab);

	return nil; /* tail call would drop only ref to mux */
}

if(length(args) > 1)
	test1(strton(args[1]));
else
	test1(2);

